var Au=Object.defineProperty;var Nu=(i,e,t)=>e in i?Au(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var z=(i,e,t)=>Nu(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();var Fi,Q,Fl,ys,ia,jl,Ll,Il,uo,An,Nn,Rl,Ci={},zl=[],Fu=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ji=Array.isArray;function Pt(i,e){for(var t in e)i[t]=e[t];return i}function go(i){i&&i.parentNode&&i.parentNode.removeChild(i)}function ht(i,e,t){var s,r,n,o={};for(n in e)n=="key"?s=e[n]:n=="ref"?r=e[n]:o[n]=e[n];if(arguments.length>2&&(o.children=arguments.length>3?Fi.call(arguments,2):t),typeof i=="function"&&i.defaultProps!=null)for(n in i.defaultProps)o[n]===void 0&&(o[n]=i.defaultProps[n]);return mi(i,o,s,r,null)}function mi(i,e,t,s,r){var n={type:i,props:e,key:t,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r==null?++Fl:r,__i:-1,__u:0};return r==null&&Q.vnode!=null&&Q.vnode(n),n}function Bl(){return{current:null}}function Le(i){return i.children}function Tt(i,e){this.props=i,this.context=e}function Ws(i,e){if(e==null)return i.__?Ws(i.__,i.__i+1):null;for(var t;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null)return t.__e;return typeof i.type=="function"?Ws(i):null}function $l(i){var e,t;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((t=i.__k[e])!=null&&t.__e!=null){i.__e=i.__c.base=t.__e;break}return $l(i)}}function Fn(i){(!i.__d&&(i.__d=!0)&&ys.push(i)&&!Er.__r++||ia!=Q.debounceRendering)&&((ia=Q.debounceRendering)||jl)(Er)}function Er(){for(var i,e,t,s,r,n,o,a=1;ys.length;)ys.length>a&&ys.sort(Ll),i=ys.shift(),a=ys.length,i.__d&&(t=void 0,s=void 0,r=(s=(e=i).__v).__e,n=[],o=[],e.__P&&((t=Pt({},s)).__v=s.__v+1,Q.vnode&&Q.vnode(t),fo(e.__P,t,s,e.__n,e.__P.namespaceURI,32&s.__u?[r]:null,n,r==null?Ws(s):r,!!(32&s.__u),o),t.__v=s.__v,t.__.__k[t.__i]=t,Hl(n,t,o),s.__e=s.__=null,t.__e!=r&&$l(t)));Er.__r=0}function Vl(i,e,t,s,r,n,o,a,l,c,h){var u,d,g,p,y,v,_,f=s&&s.__k||zl,S=e.length;for(l=ju(t,e,f,l,S),u=0;u<S;u++)(g=t.__k[u])!=null&&(d=g.__i==-1?Ci:f[g.__i]||Ci,g.__i=u,v=fo(i,g,d,r,n,o,a,l,c,h),p=g.__e,g.ref&&d.ref!=g.ref&&(d.ref&&po(d.ref,null,g),h.push(g.ref,g.__c||p,g)),y==null&&p!=null&&(y=p),(_=!!(4&g.__u))||d.__k===g.__k?l=Wl(g,l,i,_):typeof g.type=="function"&&v!==void 0?l=v:p&&(l=p.nextSibling),g.__u&=-7);return t.__e=y,l}function ju(i,e,t,s,r){var n,o,a,l,c,h=t.length,u=h,d=0;for(i.__k=new Array(r),n=0;n<r;n++)(o=e[n])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=n+d,(o=i.__k[n]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?mi(null,o,null,null,null):ji(o)?mi(Le,{children:o},null,null,null):o.constructor==null&&o.__b>0?mi(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=i,o.__b=i.__b+1,a=null,(c=o.__i=Lu(o,t,l,u))!=-1&&(u--,(a=t[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(r>h?d--:r<h&&d++),typeof o.type!="function"&&(o.__u|=4)):c!=l&&(c==l-1?d--:c==l+1?d++:(c>l?d--:d++,o.__u|=4))):i.__k[n]=null;if(u)for(n=0;n<h;n++)(a=t[n])!=null&&!(2&a.__u)&&(a.__e==s&&(s=Ws(a)),Xl(a,a));return s}function Wl(i,e,t,s){var r,n;if(typeof i.type=="function"){for(r=i.__k,n=0;r&&n<r.length;n++)r[n]&&(r[n].__=i,e=Wl(r[n],e,t,s));return e}i.__e!=e&&(s&&(e&&i.type&&!e.parentNode&&(e=Ws(i)),t.insertBefore(i.__e,e||null)),e=i.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Ht(i,e){return e=e||[],i==null||typeof i=="boolean"||(ji(i)?i.some(function(t){Ht(t,e)}):e.push(i)),e}function Lu(i,e,t,s){var r,n,o,a=i.key,l=i.type,c=e[t],h=c!=null&&(2&c.__u)==0;if(c===null&&i.key==null||h&&a==c.key&&l==c.type)return t;if(s>(h?1:0)){for(r=t-1,n=t+1;r>=0||n<e.length;)if((c=e[o=r>=0?r--:n++])!=null&&!(2&c.__u)&&a==c.key&&l==c.type)return o}return-1}function ra(i,e,t){e[0]=="-"?i.setProperty(e,t==null?"":t):i[e]=t==null?"":typeof t!="number"||Fu.test(e)?t:t+"px"}function Ui(i,e,t,s,r){var n,o;e:if(e=="style")if(typeof t=="string")i.style.cssText=t;else{if(typeof s=="string"&&(i.style.cssText=s=""),s)for(e in s)t&&e in t||ra(i.style,e,"");if(t)for(e in t)s&&t[e]==s[e]||ra(i.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")n=e!=(e=e.replace(Il,"$1")),o=e.toLowerCase(),e=o in i||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),i.l||(i.l={}),i.l[e+n]=t,t?s?t.u=s.u:(t.u=uo,i.addEventListener(e,n?Nn:An,n)):i.removeEventListener(e,n?Nn:An,n);else{if(r=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in i)try{i[e]=t==null?"":t;break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?i.removeAttribute(e):i.setAttribute(e,e=="popover"&&t==1?"":t))}}function na(i){return function(e){if(this.l){var t=this.l[e.type+i];if(e.t==null)e.t=uo++;else if(e.t<t.u)return;return t(Q.event?Q.event(e):e)}}}function fo(i,e,t,s,r,n,o,a,l,c){var h,u,d,g,p,y,v,_,f,S,C,k,T,F,M,A,B,E=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),n=[a=e.__e=t.__e]),(h=Q.__b)&&h(e);e:if(typeof E=="function")try{if(_=e.props,f="prototype"in E&&E.prototype.render,S=(h=E.contextType)&&s[h.__c],C=h?S?S.props.value:h.__:s,t.__c?v=(u=e.__c=t.__c).__=u.__E:(f?e.__c=u=new E(_,C):(e.__c=u=new Tt(_,C),u.constructor=E,u.render=Ru),S&&S.sub(u),u.props=_,u.state||(u.state={}),u.context=C,u.__n=s,d=u.__d=!0,u.__h=[],u._sb=[]),f&&u.__s==null&&(u.__s=u.state),f&&E.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=Pt({},u.__s)),Pt(u.__s,E.getDerivedStateFromProps(_,u.__s))),g=u.props,p=u.state,u.__v=e,d)f&&E.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),f&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(f&&E.getDerivedStateFromProps==null&&_!==g&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(_,C),!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(_,u.__s,C)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(u.props=_,u.state=u.__s,u.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(N){N&&(N.__=e)}),k=0;k<u._sb.length;k++)u.__h.push(u._sb[k]);u._sb=[],u.__h.length&&o.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(_,u.__s,C),f&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(g,p,y)})}if(u.context=C,u.props=_,u.__P=i,u.__e=!1,T=Q.__r,F=0,f){for(u.state=u.__s,u.__d=!1,T&&T(e),h=u.render(u.props,u.state,u.context),M=0;M<u._sb.length;M++)u.__h.push(u._sb[M]);u._sb=[]}else do u.__d=!1,T&&T(e),h=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++F<25);u.state=u.__s,u.getChildContext!=null&&(s=Pt(Pt({},s),u.getChildContext())),f&&!d&&u.getSnapshotBeforeUpdate!=null&&(y=u.getSnapshotBeforeUpdate(g,p)),A=h,h!=null&&h.type===Le&&h.key==null&&(A=Ul(h.props.children)),a=Vl(i,ji(A)?A:[A],e,t,s,r,n,o,a,l,c),u.base=e.__e,e.__u&=-161,u.__h.length&&o.push(u),v&&(u.__E=u.__=null)}catch(N){if(e.__v=null,l||n!=null)if(N.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;n[n.indexOf(a)]=null,e.__e=a}else{for(B=n.length;B--;)go(n[B]);jn(e)}else e.__e=t.__e,e.__k=t.__k,N.then||jn(e);Q.__e(N,e,t)}else n==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=Iu(t.__e,e,t,s,r,n,o,l,c);return(h=Q.diffed)&&h(e),128&e.__u?void 0:a}function jn(i){i&&i.__c&&(i.__c.__e=!0),i&&i.__k&&i.__k.forEach(jn)}function Hl(i,e,t){for(var s=0;s<t.length;s++)po(t[s],t[++s],t[++s]);Q.__c&&Q.__c(e,i),i.some(function(r){try{i=r.__h,r.__h=[],i.some(function(n){n.call(r)})}catch(n){Q.__e(n,r.__v)}})}function Ul(i){return typeof i!="object"||i==null||i.__b&&i.__b>0?i:ji(i)?i.map(Ul):Pt({},i)}function Iu(i,e,t,s,r,n,o,a,l){var c,h,u,d,g,p,y,v=t.props,_=e.props,f=e.type;if(f=="svg"?r="http://www.w3.org/2000/svg":f=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),n!=null){for(c=0;c<n.length;c++)if((g=n[c])&&"setAttribute"in g==!!f&&(f?g.localName==f:g.nodeType==3)){i=g,n[c]=null;break}}if(i==null){if(f==null)return document.createTextNode(_);i=document.createElementNS(r,f,_.is&&_),a&&(Q.__m&&Q.__m(e,n),a=!1),n=null}if(f==null)v===_||a&&i.data==_||(i.data=_);else{if(n=n&&Fi.call(i.childNodes),v=t.props||Ci,!a&&n!=null)for(v={},c=0;c<i.attributes.length;c++)v[(g=i.attributes[c]).name]=g.value;for(c in v)if(g=v[c],c!="children"){if(c=="dangerouslySetInnerHTML")u=g;else if(!(c in _)){if(c=="value"&&"defaultValue"in _||c=="checked"&&"defaultChecked"in _)continue;Ui(i,c,null,g,r)}}for(c in _)g=_[c],c=="children"?d=g:c=="dangerouslySetInnerHTML"?h=g:c=="value"?p=g:c=="checked"?y=g:a&&typeof g!="function"||v[c]===g||Ui(i,c,g,v[c],r);if(h)a||u&&(h.__html==u.__html||h.__html==i.innerHTML)||(i.innerHTML=h.__html),e.__k=[];else if(u&&(i.innerHTML=""),Vl(e.type=="template"?i.content:i,ji(d)?d:[d],e,t,s,f=="foreignObject"?"http://www.w3.org/1999/xhtml":r,n,o,n?n[0]:t.__k&&Ws(t,0),a,l),n!=null)for(c=n.length;c--;)go(n[c]);a||(c="value",f=="progress"&&p==null?i.removeAttribute("value"):p!=null&&(p!==i[c]||f=="progress"&&!p||f=="option"&&p!=v[c])&&Ui(i,c,p,v[c],r),c="checked",y!=null&&y!=i[c]&&Ui(i,c,y,v[c],r))}return i}function po(i,e,t){try{if(typeof i=="function"){var s=typeof i.__u=="function";s&&i.__u(),s&&e==null||(i.__u=i(e))}else i.current=e}catch(r){Q.__e(r,t)}}function Xl(i,e,t){var s,r;if(Q.unmount&&Q.unmount(i),(s=i.ref)&&(s.current&&s.current!=i.__e||po(s,null,e)),(s=i.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(n){Q.__e(n,e)}s.base=s.__P=null}if(s=i.__k)for(r=0;r<s.length;r++)s[r]&&Xl(s[r],e,t||typeof i.type!="function");t||go(i.__e),i.__c=i.__=i.__e=void 0}function Ru(i,e,t){return this.constructor(i,t)}function Hs(i,e,t){var s,r,n,o;e==document&&(e=document.documentElement),Q.__&&Q.__(i,e),r=(s=typeof t=="function")?null:t&&t.__k||e.__k,n=[],o=[],fo(e,i=(!s&&t||e).__k=ht(Le,null,[i]),r||Ci,Ci,e.namespaceURI,!s&&t?[t]:r?null:e.firstChild?Fi.call(e.childNodes):null,n,!s&&t?t:r?r.__e:e.firstChild,s,o),Hl(n,i,o)}function Yl(i,e){Hs(i,e,Yl)}function zu(i,e,t){var s,r,n,o,a=Pt({},i.props);for(n in i.type&&i.type.defaultProps&&(o=i.type.defaultProps),e)n=="key"?s=e[n]:n=="ref"?r=e[n]:a[n]=e[n]===void 0&&o!=null?o[n]:e[n];return arguments.length>2&&(a.children=arguments.length>3?Fi.call(arguments,2):t),mi(i.type,a,s||i.key,r||i.ref,null)}function Us(i){function e(t){var s,r;return this.getChildContext||(s=new Set,(r={})[e.__c]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(n){this.props.value!=n.value&&s.forEach(function(o){o.__e=!0,Fn(o)})},this.sub=function(n){s.add(n);var o=n.componentWillUnmount;n.componentWillUnmount=function(){s&&s.delete(n),o&&o.call(n)}}),t.children}return e.__c="__cC"+Rl++,e.__=i,e.Provider=e.__l=(e.Consumer=function(t,s){return t.children(s)}).contextType=e,e}Fi=zl.slice,Q={__e:function(i,e,t,s){for(var r,n,o;e=e.__;)if((r=e.__c)&&!r.__)try{if((n=r.constructor)&&n.getDerivedStateFromError!=null&&(r.setState(n.getDerivedStateFromError(i)),o=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(i,s||{}),o=r.__d),o)return r.__E=r}catch(a){i=a}throw i}},Fl=0,Tt.prototype.setState=function(i,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Pt({},this.state),typeof i=="function"&&(i=i(Pt({},t),this.props)),i&&Pt(t,i),i!=null&&this.__v&&(e&&this._sb.push(e),Fn(this))},Tt.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),Fn(this))},Tt.prototype.render=Le,ys=[],jl=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ll=function(i,e){return i.__v.__b-e.__v.__b},Er.__r=0,Il=/(PointerCapture)$|Capture$/i,uo=0,An=na(!1),Nn=na(!0),Rl=0;var Bu=0;function m(i,e,t,s,r,n){e||(e={});var o,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?o=e[a]:l[a]=e[a];var c={type:i,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Bu,__i:-1,__u:0,__source:r,__self:n};if(typeof i=="function"&&(o=i.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return Q.vnode&&Q.vnode(c),c}var Yt,_e,hn,oa,Xs=0,Gl=[],Ee=Q,aa=Ee.__b,la=Ee.__r,ca=Ee.diffed,ha=Ee.__c,ua=Ee.unmount,da=Ee.__;function Os(i,e){Ee.__h&&Ee.__h(_e,i,Xs||e),Xs=0;var t=_e.__H||(_e.__H={__:[],__h:[]});return i>=t.__.length&&t.__.push({}),t.__[i]}function te(i){return Xs=1,Hr(ql,i)}function Hr(i,e,t){var s=Os(Yt++,2);if(s.t=i,!s.__c&&(s.__=[t?t(e):ql(void 0,e),function(a){var l=s.__N?s.__N[0]:s.__[0],c=s.t(l,a);l!==c&&(s.__N=[c,s.__[1]],s.__c.setState({}))}],s.__c=_e,!_e.__f)){var r=function(a,l,c){if(!s.__c.__H)return!0;var h=s.__c.__H.__.filter(function(d){return!!d.__c});if(h.every(function(d){return!d.__N}))return!n||n.call(this,a,l,c);var u=s.__c.props!==a;return h.forEach(function(d){if(d.__N){var g=d.__[0];d.__=d.__N,d.__N=void 0,g!==d.__[0]&&(u=!0)}}),n&&n.call(this,a,l,c)||u};_e.__f=!0;var n=_e.shouldComponentUpdate,o=_e.componentWillUpdate;_e.componentWillUpdate=function(a,l,c){if(this.__e){var h=n;n=void 0,r(a,l,c),n=h}o&&o.call(this,a,l,c)},_e.shouldComponentUpdate=r}return s.__N||s.__}function Me(i,e){var t=Os(Yt++,3);!Ee.__s&&vo(t.__H,e)&&(t.__=i,t.u=e,_e.__H.__h.push(t))}function Es(i,e){var t=Os(Yt++,4);!Ee.__s&&vo(t.__H,e)&&(t.__=i,t.u=e,_e.__h.push(t))}function we(i){return Xs=5,pt(function(){return{current:i}},[])}function mo(i,e,t){Xs=6,Es(function(){if(typeof i=="function"){var s=i(e());return function(){i(null),s&&typeof s=="function"&&s()}}if(i)return i.current=e(),function(){return i.current=null}},t==null?t:t.concat(i))}function pt(i,e){var t=Os(Yt++,7);return vo(t.__H,e)&&(t.__=i(),t.__H=e,t.__h=i),t.__}function Li(i,e){return Xs=8,pt(function(){return i},e)}function us(i){var e=_e.context[i.__c],t=Os(Yt++,9);return t.c=i,e?(t.__==null&&(t.__=!0,e.sub(_e)),e.props.value):i.__}function yo(i,e){Ee.useDebugValue&&Ee.useDebugValue(e?e(i):i)}function $u(i){var e=Os(Yt++,10),t=te();return e.__=i,_e.componentDidCatch||(_e.componentDidCatch=function(s,r){e.__&&e.__(s,r),t[1](s)}),[t[0],function(){t[1](void 0)}]}function bo(){var i=Os(Yt++,11);if(!i.__){for(var e=_e.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var t=e.__m||(e.__m=[0,0]);i.__="P"+t[0]+"-"+t[1]++}return i.__}function Vu(){for(var i;i=Gl.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(vr),i.__H.__h.forEach(Ln),i.__H.__h=[]}catch(e){i.__H.__h=[],Ee.__e(e,i.__v)}}Ee.__b=function(i){_e=null,aa&&aa(i)},Ee.__=function(i,e){i&&e.__k&&e.__k.__m&&(i.__m=e.__k.__m),da&&da(i,e)},Ee.__r=function(i){la&&la(i),Yt=0;var e=(_e=i.__c).__H;e&&(hn===_e?(e.__h=[],_e.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(vr),e.__h.forEach(Ln),e.__h=[],Yt=0)),hn=_e},Ee.diffed=function(i){ca&&ca(i);var e=i.__c;e&&e.__H&&(e.__H.__h.length&&(Gl.push(e)!==1&&oa===Ee.requestAnimationFrame||((oa=Ee.requestAnimationFrame)||Wu)(Vu)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),hn=_e=null},Ee.__c=function(i,e){e.some(function(t){try{t.__h.forEach(vr),t.__h=t.__h.filter(function(s){return!s.__||Ln(s)})}catch(s){e.some(function(r){r.__h&&(r.__h=[])}),e=[],Ee.__e(s,t.__v)}}),ha&&ha(i,e)},Ee.unmount=function(i){ua&&ua(i);var e,t=i.__c;t&&t.__H&&(t.__H.__.forEach(function(s){try{vr(s)}catch(r){e=r}}),t.__H=void 0,e&&Ee.__e(e,t.__v))};var ga=typeof requestAnimationFrame=="function";function Wu(i){var e,t=function(){clearTimeout(s),ga&&cancelAnimationFrame(e),setTimeout(i)},s=setTimeout(t,35);ga&&(e=requestAnimationFrame(t))}function vr(i){var e=_e,t=i.__c;typeof t=="function"&&(i.__c=void 0,t()),_e=e}function Ln(i){var e=_e;i.__c=i.__(),_e=e}function vo(i,e){return!i||i.length!==e.length||e.some(function(t,s){return t!==i[s]})}function ql(i,e){return typeof e=="function"?e(i):e}function Kl(i,e){for(var t in e)i[t]=e[t];return i}function In(i,e){for(var t in i)if(t!=="__source"&&!(t in e))return!0;for(var s in e)if(s!=="__source"&&i[s]!==e[s])return!0;return!1}function _o(i,e){var t=e(),s=te({t:{__:t,u:e}}),r=s[0].t,n=s[1];return Es(function(){r.__=t,r.u=e,un(r)&&n({t:r})},[i,t,e]),Me(function(){return un(r)&&n({t:r}),i(function(){un(r)&&n({t:r})})},[i]),t}function un(i){var e,t,s=i.u,r=i.__;try{var n=s();return!((e=r)===(t=n)&&(e!==0||1/e==1/t)||e!=e&&t!=t)}catch{return!0}}function wo(i){i()}function xo(i){return i}function Co(){return[!1,wo]}var So=Es;function Mr(i,e){this.props=i,this.context=e}function Jl(i,e){function t(r){var n=this.props.ref,o=n==r.ref;return!o&&n&&(n.call?n(null):n.current=null),e?!e(this.props,r)||!o:In(this.props,r)}function s(r){return this.shouldComponentUpdate=t,ht(i,r)}return s.displayName="Memo("+(i.displayName||i.name)+")",s.prototype.isReactComponent=!0,s.__f=!0,s.type=i,s}(Mr.prototype=new Tt).isPureReactComponent=!0,Mr.prototype.shouldComponentUpdate=function(i,e){return In(this.props,i)||In(this.state,e)};var fa=Q.__b;Q.__b=function(i){i.type&&i.type.__f&&i.ref&&(i.props.ref=i.ref,i.ref=null),fa&&fa(i)};var Hu=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Te(i){function e(t){var s=Kl({},t);return delete s.ref,i(s,t.ref||null)}return e.$$typeof=Hu,e.render=i,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(i.displayName||i.name)+")",e}var pa=function(i,e){return i==null?null:Ht(Ht(i).map(e))},Ss={map:pa,forEach:pa,count:function(i){return i?Ht(i).length:0},only:function(i){var e=Ht(i);if(e.length!==1)throw"Children.only";return e[0]},toArray:Ht},Uu=Q.__e;Q.__e=function(i,e,t,s){if(i.then){for(var r,n=e;n=n.__;)if((r=n.__c)&&r.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),r.__c(i,e)}Uu(i,e,t,s)};var ma=Q.unmount;function Zl(i,e,t){return i&&(i.__c&&i.__c.__H&&(i.__c.__H.__.forEach(function(s){typeof s.__c=="function"&&s.__c()}),i.__c.__H=null),(i=Kl({},i)).__c!=null&&(i.__c.__P===t&&(i.__c.__P=e),i.__c.__e=!0,i.__c=null),i.__k=i.__k&&i.__k.map(function(s){return Zl(s,e,t)})),i}function Ql(i,e,t){return i&&t&&(i.__v=null,i.__k=i.__k&&i.__k.map(function(s){return Ql(s,e,t)}),i.__c&&i.__c.__P===e&&(i.__e&&t.appendChild(i.__e),i.__c.__e=!0,i.__c.__P=t)),i}function yi(){this.__u=0,this.o=null,this.__b=null}function ec(i){var e=i.__.__c;return e&&e.__a&&e.__a(i)}function tc(i){var e,t,s;function r(n){if(e||(e=i()).then(function(o){t=o.default||o},function(o){s=o}),s)throw s;if(!t)throw e;return ht(t,n)}return r.displayName="Lazy",r.__f=!0,r}function js(){this.i=null,this.l=null}Q.unmount=function(i){var e=i.__c;e&&e.__R&&e.__R(),e&&32&i.__u&&(i.type=null),ma&&ma(i)},(yi.prototype=new Tt).__c=function(i,e){var t=e.__c,s=this;s.o==null&&(s.o=[]),s.o.push(t);var r=ec(s.__v),n=!1,o=function(){n||(n=!0,t.__R=null,r?r(a):a())};t.__R=o;var a=function(){if(!--s.__u){if(s.state.__a){var l=s.state.__a;s.__v.__k[0]=Ql(l,l.__c.__P,l.__c.__O)}var c;for(s.setState({__a:s.__b=null});c=s.o.pop();)c.forceUpdate()}};s.__u++||32&e.__u||s.setState({__a:s.__b=s.__v.__k[0]}),i.then(o,o)},yi.prototype.componentWillUnmount=function(){this.o=[]},yi.prototype.render=function(i,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),s=this.__v.__k[0].__c;this.__v.__k[0]=Zl(this.__b,t,s.__O=s.__P)}this.__b=null}var r=e.__a&&ht(Le,null,i.fallback);return r&&(r.__u&=-33),[ht(Le,null,e.__a?null:i.children),r]};var ya=function(i,e,t){if(++t[1]===t[0]&&i.l.delete(e),i.props.revealOrder&&(i.props.revealOrder[0]!=="t"||!i.l.size))for(t=i.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;i.i=t=t[2]}};function Xu(i){return this.getChildContext=function(){return i.context},i.children}function Yu(i){var e=this,t=i.h;if(e.componentWillUnmount=function(){Hs(null,e.v),e.v=null,e.h=null},e.h&&e.h!==t&&e.componentWillUnmount(),!e.v){for(var s=e.__v;s!==null&&!s.__m&&s.__!==null;)s=s.__;e.h=t,e.v={nodeType:1,parentNode:t,childNodes:[],__k:{__m:s.__m},contains:function(){return!0},insertBefore:function(r,n){this.childNodes.push(r),e.h.insertBefore(r,n)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.h.removeChild(r)}}}Hs(ht(Xu,{context:e.context},i.__v),e.v)}function sc(i,e){var t=ht(Yu,{__v:i,h:e});return t.containerInfo=e,t}(js.prototype=new Tt).__a=function(i){var e=this,t=ec(e.__v),s=e.l.get(i);return s[0]++,function(r){var n=function(){e.props.revealOrder?(s.push(r),ya(e,i,s)):r()};t?t(n):n()}},js.prototype.render=function(i){this.i=null,this.l=new Map;var e=Ht(i.children);i.revealOrder&&i.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return i.children},js.prototype.componentDidUpdate=js.prototype.componentDidMount=function(){var i=this;this.l.forEach(function(e,t){ya(i,t,e)})};var ic=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Gu=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,qu=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Ku=/[A-Z0-9]/g,Ju=typeof document<"u",Zu=function(i){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(i)};function rc(i,e,t){return e.__k==null&&(e.textContent=""),Hs(i,e),typeof t=="function"&&t(),i?i.__c:null}function nc(i,e,t){return Yl(i,e),typeof t=="function"&&t(),i?i.__c:null}Tt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(i){Object.defineProperty(Tt.prototype,i,{configurable:!0,get:function(){return this["UNSAFE_"+i]},set:function(e){Object.defineProperty(this,i,{configurable:!0,writable:!0,value:e})}})});var ba=Q.event;function Qu(){}function ed(){return this.cancelBubble}function td(){return this.defaultPrevented}Q.event=function(i){return ba&&(i=ba(i)),i.persist=Qu,i.isPropagationStopped=ed,i.isDefaultPrevented=td,i.nativeEvent=i};var ko,sd={enumerable:!1,configurable:!0,get:function(){return this.class}},va=Q.vnode;Q.vnode=function(i){typeof i.type=="string"&&function(e){var t=e.props,s=e.type,r={},n=s.indexOf("-")===-1;for(var o in t){var a=t[o];if(!(o==="value"&&"defaultValue"in t&&a==null||Ju&&o==="children"&&s==="noscript"||o==="class"||o==="className")){var l=o.toLowerCase();o==="defaultValue"&&"value"in t&&t.value==null?o="value":o==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?o="ondblclick":l!=="onchange"||s!=="input"&&s!=="textarea"||Zu(t.type)?l==="onfocus"?o="onfocusin":l==="onblur"?o="onfocusout":qu.test(o)&&(o=l):l=o="oninput":n&&Gu.test(o)?o=o.replace(Ku,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&r[o=l]&&(o="oninputCapture"),r[o]=a}}s=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=Ht(t.children).forEach(function(c){c.props.selected=r.value.indexOf(c.props.value)!=-1})),s=="select"&&r.defaultValue!=null&&(r.value=Ht(t.children).forEach(function(c){c.props.selected=r.multiple?r.defaultValue.indexOf(c.props.value)!=-1:r.defaultValue==c.props.value})),t.class&&!t.className?(r.class=t.class,Object.defineProperty(r,"className",sd)):(t.className&&!t.class||t.class&&t.className)&&(r.class=r.className=t.className),e.props=r}(i),i.$$typeof=ic,va&&va(i)};var _a=Q.__r;Q.__r=function(i){_a&&_a(i),ko=i.__c};var wa=Q.diffed;Q.diffed=function(i){wa&&wa(i);var e=i.props,t=i.__e;t!=null&&i.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value),ko=null};var oc={ReactCurrentDispatcher:{current:{readContext:function(i){return ko.__n[i.__c].props.value},useCallback:Li,useContext:us,useDebugValue:yo,useDeferredValue:xo,useEffect:Me,useId:bo,useImperativeHandle:mo,useInsertionEffect:So,useLayoutEffect:Es,useMemo:pt,useReducer:Hr,useRef:we,useState:te,useSyncExternalStore:_o,useTransition:Co}}},id="18.3.1";function ac(i){return ht.bind(null,i)}function Gt(i){return!!i&&i.$$typeof===ic}function lc(i){return Gt(i)&&i.type===Le}function cc(i){return!!i&&!!i.displayName&&(typeof i.displayName=="string"||i.displayName instanceof String)&&i.displayName.startsWith("Memo(")}function Ur(i){return Gt(i)?zu.apply(null,arguments):i}function hc(i){return!!i.__k&&(Hs(null,i),!0)}function uc(i){return i&&(i.base||i.nodeType===1&&i)||null}var dc=function(i,e){return i(e)},gc=function(i,e){return i(e)},fc=Le,pc=Gt,dt={useState:te,useId:bo,useReducer:Hr,useEffect:Me,useLayoutEffect:Es,useInsertionEffect:So,useTransition:Co,useDeferredValue:xo,useSyncExternalStore:_o,startTransition:wo,useRef:we,useImperativeHandle:mo,useMemo:pt,useCallback:Li,useContext:us,useDebugValue:yo,version:"18.3.1",Children:Ss,render:rc,hydrate:nc,unmountComponentAtNode:hc,createPortal:sc,createElement:ht,createContext:Us,createFactory:ac,cloneElement:Ur,createRef:Bl,Fragment:Le,isValidElement:Gt,isElement:pc,isFragment:lc,isMemo:cc,findDOMNode:uc,Component:Tt,PureComponent:Mr,memo:Jl,forwardRef:Te,flushSync:gc,unstable_batchedUpdates:dc,StrictMode:fc,Suspense:yi,SuspenseList:js,lazy:tc,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:oc};const rd=Object.freeze(Object.defineProperty({__proto__:null,Children:Ss,Component:Tt,Fragment:Le,PureComponent:Mr,StrictMode:fc,Suspense:yi,SuspenseList:js,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:oc,cloneElement:Ur,createContext:Us,createElement:ht,createFactory:ac,createPortal:sc,createRef:Bl,default:dt,findDOMNode:uc,flushSync:gc,forwardRef:Te,hydrate:nc,isElement:pc,isFragment:lc,isMemo:cc,isValidElement:Gt,lazy:tc,memo:Jl,render:rc,startTransition:wo,unmountComponentAtNode:hc,unstable_batchedUpdates:dc,useCallback:Li,useContext:us,useDebugValue:yo,useDeferredValue:xo,useEffect:Me,useErrorBoundary:$u,useId:bo,useImperativeHandle:mo,useInsertionEffect:So,useLayoutEffect:Es,useMemo:pt,useReducer:Hr,useRef:we,useState:te,useSyncExternalStore:_o,useTransition:Co,version:id},Symbol.toStringTag,{value:"Module"}));function nd(i,e=!1){return window.__TAURI_INTERNALS__.transformCallback(i,e)}async function Ie(i,e={},t){return window.__TAURI_INTERNALS__.invoke(i,e,t)}function mc(i,e="asset"){return window.__TAURI_INTERNALS__.convertFileSrc(i,e)}var xa;(function(i){i.WINDOW_RESIZED="tauri://resize",i.WINDOW_MOVED="tauri://move",i.WINDOW_CLOSE_REQUESTED="tauri://close-requested",i.WINDOW_DESTROYED="tauri://destroyed",i.WINDOW_FOCUS="tauri://focus",i.WINDOW_BLUR="tauri://blur",i.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",i.WINDOW_THEME_CHANGED="tauri://theme-changed",i.WINDOW_CREATED="tauri://window-created",i.WEBVIEW_CREATED="tauri://webview-created",i.DRAG_ENTER="tauri://drag-enter",i.DRAG_OVER="tauri://drag-over",i.DRAG_DROP="tauri://drag-drop",i.DRAG_LEAVE="tauri://drag-leave"})(xa||(xa={}));async function od(i,e){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(i,e),await Ie("plugin:event|unlisten",{event:i,eventId:e})}async function yc(i,e,t){var s;const r=(s=void 0)!==null&&s!==void 0?s:{kind:"Any"};return Ie("plugin:event|listen",{event:i,target:r,handler:nd(e)}).then(n=>async()=>od(i,n))}async function ad(i={}){return typeof i=="object"&&Object.freeze(i),await Ie("plugin:dialog|open",{options:i})}async function ld(i={}){return typeof i=="object"&&Object.freeze(i),await Ie("plugin:dialog|save",{options:i})}function bc(i){var e,t,s="";if(typeof i=="string"||typeof i=="number")s+=i;else if(typeof i=="object")if(Array.isArray(i)){var r=i.length;for(e=0;e<r;e++)i[e]&&(t=bc(i[e]))&&(s&&(s+=" "),s+=t)}else for(t in i)i[t]&&(s&&(s+=" "),s+=t);return s}function vc(){for(var i,e,t=0,s="",r=arguments.length;t<r;t++)(i=arguments[t])&&(e=bc(i))&&(s&&(s+=" "),s+=e);return s}const Ca=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,Sa=vc,_c=(i,e)=>t=>{var s;if((e==null?void 0:e.variants)==null)return Sa(i,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:r,defaultVariants:n}=e,o=Object.keys(r).map(c=>{const h=t==null?void 0:t[c],u=n==null?void 0:n[c];if(h===null)return null;const d=Ca(h)||Ca(u);return r[c][d]}),a=t&&Object.entries(t).reduce((c,h)=>{let[u,d]=h;return d===void 0||(c[u]=d),c},{}),l=e==null||(s=e.compoundVariants)===null||s===void 0?void 0:s.reduce((c,h)=>{let{class:u,className:d,...g}=h;return Object.entries(g).every(p=>{let[y,v]=p;return Array.isArray(v)?v.includes({...n,...a}[y]):{...n,...a}[y]===v})?[...c,u,d]:c},[]);return Sa(i,o,l,t==null?void 0:t.class,t==null?void 0:t.className)},To="-",cd=i=>{const e=ud(i),{conflictingClassGroups:t,conflictingClassGroupModifiers:s}=i;return{getClassGroupId:o=>{const a=o.split(To);return a[0]===""&&a.length!==1&&a.shift(),wc(a,e)||hd(o)},getConflictingClassGroupIds:(o,a)=>{const l=t[o]||[];return a&&s[o]?[...l,...s[o]]:l}}},wc=(i,e)=>{var o;if(i.length===0)return e.classGroupId;const t=i[0],s=e.nextPart.get(t),r=s?wc(i.slice(1),s):void 0;if(r)return r;if(e.validators.length===0)return;const n=i.join(To);return(o=e.validators.find(({validator:a})=>a(n)))==null?void 0:o.classGroupId},ka=/^\[(.+)\]$/,hd=i=>{if(ka.test(i)){const e=ka.exec(i)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},ud=i=>{const{theme:e,classGroups:t}=i,s={nextPart:new Map,validators:[]};for(const r in t)Rn(t[r],s,r,e);return s},Rn=(i,e,t,s)=>{i.forEach(r=>{if(typeof r=="string"){const n=r===""?e:Ta(e,r);n.classGroupId=t;return}if(typeof r=="function"){if(dd(r)){Rn(r(s),e,t,s);return}e.validators.push({validator:r,classGroupId:t});return}Object.entries(r).forEach(([n,o])=>{Rn(o,Ta(e,n),t,s)})})},Ta=(i,e)=>{let t=i;return e.split(To).forEach(s=>{t.nextPart.has(s)||t.nextPart.set(s,{nextPart:new Map,validators:[]}),t=t.nextPart.get(s)}),t},dd=i=>i.isThemeGetter,gd=i=>{if(i<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,s=new Map;const r=(n,o)=>{t.set(n,o),e++,e>i&&(e=0,s=t,t=new Map)};return{get(n){let o=t.get(n);if(o!==void 0)return o;if((o=s.get(n))!==void 0)return r(n,o),o},set(n,o){t.has(n)?t.set(n,o):r(n,o)}}},zn="!",Bn=":",fd=Bn.length,pd=i=>{const{prefix:e,experimentalParseClassName:t}=i;let s=r=>{const n=[];let o=0,a=0,l=0,c;for(let p=0;p<r.length;p++){let y=r[p];if(o===0&&a===0){if(y===Bn){n.push(r.slice(l,p)),l=p+fd;continue}if(y==="/"){c=p;continue}}y==="["?o++:y==="]"?o--:y==="("?a++:y===")"&&a--}const h=n.length===0?r:r.substring(l),u=md(h),d=u!==h,g=c&&c>l?c-l:void 0;return{modifiers:n,hasImportantModifier:d,baseClassName:u,maybePostfixModifierPosition:g}};if(e){const r=e+Bn,n=s;s=o=>o.startsWith(r)?n(o.substring(r.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:o,maybePostfixModifierPosition:void 0}}if(t){const r=s;s=n=>t({className:n,parseClassName:r})}return s},md=i=>i.endsWith(zn)?i.substring(0,i.length-1):i.startsWith(zn)?i.substring(1):i,yd=i=>{const e=Object.fromEntries(i.orderSensitiveModifiers.map(s=>[s,!0]));return s=>{if(s.length<=1)return s;const r=[];let n=[];return s.forEach(o=>{o[0]==="["||e[o]?(r.push(...n.sort(),o),n=[]):n.push(o)}),r.push(...n.sort()),r}},bd=i=>({cache:gd(i.cacheSize),parseClassName:pd(i),sortModifiers:yd(i),...cd(i)}),vd=/\s+/,_d=(i,e)=>{const{parseClassName:t,getClassGroupId:s,getConflictingClassGroupIds:r,sortModifiers:n}=e,o=[],a=i.trim().split(vd);let l="";for(let c=a.length-1;c>=0;c-=1){const h=a[c],{isExternal:u,modifiers:d,hasImportantModifier:g,baseClassName:p,maybePostfixModifierPosition:y}=t(h);if(u){l=h+(l.length>0?" "+l:l);continue}let v=!!y,_=s(v?p.substring(0,y):p);if(!_){if(!v){l=h+(l.length>0?" "+l:l);continue}if(_=s(p),!_){l=h+(l.length>0?" "+l:l);continue}v=!1}const f=n(d).join(":"),S=g?f+zn:f,C=S+_;if(o.includes(C))continue;o.push(C);const k=r(_,v);for(let T=0;T<k.length;++T){const F=k[T];o.push(S+F)}l=h+(l.length>0?" "+l:l)}return l};function wd(){let i=0,e,t,s="";for(;i<arguments.length;)(e=arguments[i++])&&(t=xc(e))&&(s&&(s+=" "),s+=t);return s}const xc=i=>{if(typeof i=="string")return i;let e,t="";for(let s=0;s<i.length;s++)i[s]&&(e=xc(i[s]))&&(t&&(t+=" "),t+=e);return t};function xd(i,...e){let t,s,r,n=o;function o(l){const c=e.reduce((h,u)=>u(h),i());return t=bd(c),s=t.cache.get,r=t.cache.set,n=a,a(l)}function a(l){const c=s(l);if(c)return c;const h=_d(l,t);return r(l,h),h}return function(){return n(wd.apply(null,arguments))}}const ze=i=>{const e=t=>t[i]||[];return e.isThemeGetter=!0,e},Cc=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,Sc=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Cd=/^\d+\/\d+$/,Sd=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,kd=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Td=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Od=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Ed=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ds=i=>Cd.test(i),ie=i=>!!i&&!Number.isNaN(Number(i)),is=i=>!!i&&Number.isInteger(Number(i)),dn=i=>i.endsWith("%")&&ie(i.slice(0,-1)),Lt=i=>Sd.test(i),Md=()=>!0,Dd=i=>kd.test(i)&&!Td.test(i),kc=()=>!1,Pd=i=>Od.test(i),Ad=i=>Ed.test(i),Nd=i=>!W(i)&&!H(i),Fd=i=>qs(i,Ec,kc),W=i=>Cc.test(i),ps=i=>qs(i,Mc,Dd),gn=i=>qs(i,zd,ie),Oa=i=>qs(i,Tc,kc),jd=i=>qs(i,Oc,Ad),Xi=i=>qs(i,Dc,Pd),H=i=>Sc.test(i),oi=i=>Ks(i,Mc),Ld=i=>Ks(i,Bd),Ea=i=>Ks(i,Tc),Id=i=>Ks(i,Ec),Rd=i=>Ks(i,Oc),Yi=i=>Ks(i,Dc,!0),qs=(i,e,t)=>{const s=Cc.exec(i);return s?s[1]?e(s[1]):t(s[2]):!1},Ks=(i,e,t=!1)=>{const s=Sc.exec(i);return s?s[1]?e(s[1]):t:!1},Tc=i=>i==="position"||i==="percentage",Oc=i=>i==="image"||i==="url",Ec=i=>i==="length"||i==="size"||i==="bg-size",Mc=i=>i==="length",zd=i=>i==="number",Bd=i=>i==="family-name",Dc=i=>i==="shadow",$d=()=>{const i=ze("color"),e=ze("font"),t=ze("text"),s=ze("font-weight"),r=ze("tracking"),n=ze("leading"),o=ze("breakpoint"),a=ze("container"),l=ze("spacing"),c=ze("radius"),h=ze("shadow"),u=ze("inset-shadow"),d=ze("text-shadow"),g=ze("drop-shadow"),p=ze("blur"),y=ze("perspective"),v=ze("aspect"),_=ze("ease"),f=ze("animate"),S=()=>["auto","avoid","all","avoid-page","page","left","right","column"],C=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],k=()=>[...C(),H,W],T=()=>["auto","hidden","clip","visible","scroll"],F=()=>["auto","contain","none"],M=()=>[H,W,l],A=()=>[Ds,"full","auto",...M()],B=()=>[is,"none","subgrid",H,W],E=()=>["auto",{span:["full",is,H,W]},is,H,W],N=()=>[is,"auto",H,W],j=()=>["auto","min","max","fr",H,W],L=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],G=()=>["start","end","center","stretch","center-safe","end-safe"],X=()=>["auto",...M()],P=()=>[Ds,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...M()],D=()=>[i,H,W],q=()=>[...C(),Ea,Oa,{position:[H,W]}],Z=()=>["no-repeat",{repeat:["","x","y","space","round"]}],R=()=>["auto","cover","contain",Id,Fd,{size:[H,W]}],de=()=>[dn,oi,ps],ee=()=>["","none","full",c,H,W],V=()=>["",ie,oi,ps],U=()=>["solid","dashed","dotted","double"],oe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ne=()=>[ie,dn,Ea,Oa],De=()=>["","none",p,H,W],Se=()=>["none",ie,H,W],xe=()=>["none",ie,H,W],Y=()=>[ie,H,W],le=()=>[Ds,"full",...M()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Lt],breakpoint:[Lt],color:[Md],container:[Lt],"drop-shadow":[Lt],ease:["in","out","in-out"],font:[Nd],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Lt],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Lt],shadow:[Lt],spacing:["px",ie],text:[Lt],"text-shadow":[Lt],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Ds,W,H,v]}],container:["container"],columns:[{columns:[ie,W,H,a]}],"break-after":[{"break-after":S()}],"break-before":[{"break-before":S()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:k()}],overflow:[{overflow:T()}],"overflow-x":[{"overflow-x":T()}],"overflow-y":[{"overflow-y":T()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:A()}],"inset-x":[{"inset-x":A()}],"inset-y":[{"inset-y":A()}],start:[{start:A()}],end:[{end:A()}],top:[{top:A()}],right:[{right:A()}],bottom:[{bottom:A()}],left:[{left:A()}],visibility:["visible","invisible","collapse"],z:[{z:[is,"auto",H,W]}],basis:[{basis:[Ds,"full","auto",a,...M()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[ie,Ds,"auto","initial","none",W]}],grow:[{grow:["",ie,H,W]}],shrink:[{shrink:["",ie,H,W]}],order:[{order:[is,"first","last","none",H,W]}],"grid-cols":[{"grid-cols":B()}],"col-start-end":[{col:E()}],"col-start":[{"col-start":N()}],"col-end":[{"col-end":N()}],"grid-rows":[{"grid-rows":B()}],"row-start-end":[{row:E()}],"row-start":[{"row-start":N()}],"row-end":[{"row-end":N()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":j()}],"auto-rows":[{"auto-rows":j()}],gap:[{gap:M()}],"gap-x":[{"gap-x":M()}],"gap-y":[{"gap-y":M()}],"justify-content":[{justify:[...L(),"normal"]}],"justify-items":[{"justify-items":[...G(),"normal"]}],"justify-self":[{"justify-self":["auto",...G()]}],"align-content":[{content:["normal",...L()]}],"align-items":[{items:[...G(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...G(),{baseline:["","last"]}]}],"place-content":[{"place-content":L()}],"place-items":[{"place-items":[...G(),"baseline"]}],"place-self":[{"place-self":["auto",...G()]}],p:[{p:M()}],px:[{px:M()}],py:[{py:M()}],ps:[{ps:M()}],pe:[{pe:M()}],pt:[{pt:M()}],pr:[{pr:M()}],pb:[{pb:M()}],pl:[{pl:M()}],m:[{m:X()}],mx:[{mx:X()}],my:[{my:X()}],ms:[{ms:X()}],me:[{me:X()}],mt:[{mt:X()}],mr:[{mr:X()}],mb:[{mb:X()}],ml:[{ml:X()}],"space-x":[{"space-x":M()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":M()}],"space-y-reverse":["space-y-reverse"],size:[{size:P()}],w:[{w:[a,"screen",...P()]}],"min-w":[{"min-w":[a,"screen","none",...P()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[o]},...P()]}],h:[{h:["screen","lh",...P()]}],"min-h":[{"min-h":["screen","lh","none",...P()]}],"max-h":[{"max-h":["screen","lh",...P()]}],"font-size":[{text:["base",t,oi,ps]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,H,gn]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",dn,W]}],"font-family":[{font:[Ld,W,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[r,H,W]}],"line-clamp":[{"line-clamp":[ie,"none",H,gn]}],leading:[{leading:[n,...M()]}],"list-image":[{"list-image":["none",H,W]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",H,W]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:D()}],"text-color":[{text:D()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...U(),"wavy"]}],"text-decoration-thickness":[{decoration:[ie,"from-font","auto",H,ps]}],"text-decoration-color":[{decoration:D()}],"underline-offset":[{"underline-offset":[ie,"auto",H,W]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:M()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",H,W]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",H,W]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:q()}],"bg-repeat":[{bg:Z()}],"bg-size":[{bg:R()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},is,H,W],radial:["",H,W],conic:[is,H,W]},Rd,jd]}],"bg-color":[{bg:D()}],"gradient-from-pos":[{from:de()}],"gradient-via-pos":[{via:de()}],"gradient-to-pos":[{to:de()}],"gradient-from":[{from:D()}],"gradient-via":[{via:D()}],"gradient-to":[{to:D()}],rounded:[{rounded:ee()}],"rounded-s":[{"rounded-s":ee()}],"rounded-e":[{"rounded-e":ee()}],"rounded-t":[{"rounded-t":ee()}],"rounded-r":[{"rounded-r":ee()}],"rounded-b":[{"rounded-b":ee()}],"rounded-l":[{"rounded-l":ee()}],"rounded-ss":[{"rounded-ss":ee()}],"rounded-se":[{"rounded-se":ee()}],"rounded-ee":[{"rounded-ee":ee()}],"rounded-es":[{"rounded-es":ee()}],"rounded-tl":[{"rounded-tl":ee()}],"rounded-tr":[{"rounded-tr":ee()}],"rounded-br":[{"rounded-br":ee()}],"rounded-bl":[{"rounded-bl":ee()}],"border-w":[{border:V()}],"border-w-x":[{"border-x":V()}],"border-w-y":[{"border-y":V()}],"border-w-s":[{"border-s":V()}],"border-w-e":[{"border-e":V()}],"border-w-t":[{"border-t":V()}],"border-w-r":[{"border-r":V()}],"border-w-b":[{"border-b":V()}],"border-w-l":[{"border-l":V()}],"divide-x":[{"divide-x":V()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":V()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...U(),"hidden","none"]}],"divide-style":[{divide:[...U(),"hidden","none"]}],"border-color":[{border:D()}],"border-color-x":[{"border-x":D()}],"border-color-y":[{"border-y":D()}],"border-color-s":[{"border-s":D()}],"border-color-e":[{"border-e":D()}],"border-color-t":[{"border-t":D()}],"border-color-r":[{"border-r":D()}],"border-color-b":[{"border-b":D()}],"border-color-l":[{"border-l":D()}],"divide-color":[{divide:D()}],"outline-style":[{outline:[...U(),"none","hidden"]}],"outline-offset":[{"outline-offset":[ie,H,W]}],"outline-w":[{outline:["",ie,oi,ps]}],"outline-color":[{outline:D()}],shadow:[{shadow:["","none",h,Yi,Xi]}],"shadow-color":[{shadow:D()}],"inset-shadow":[{"inset-shadow":["none",u,Yi,Xi]}],"inset-shadow-color":[{"inset-shadow":D()}],"ring-w":[{ring:V()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:D()}],"ring-offset-w":[{"ring-offset":[ie,ps]}],"ring-offset-color":[{"ring-offset":D()}],"inset-ring-w":[{"inset-ring":V()}],"inset-ring-color":[{"inset-ring":D()}],"text-shadow":[{"text-shadow":["none",d,Yi,Xi]}],"text-shadow-color":[{"text-shadow":D()}],opacity:[{opacity:[ie,H,W]}],"mix-blend":[{"mix-blend":[...oe(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":oe()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[ie]}],"mask-image-linear-from-pos":[{"mask-linear-from":ne()}],"mask-image-linear-to-pos":[{"mask-linear-to":ne()}],"mask-image-linear-from-color":[{"mask-linear-from":D()}],"mask-image-linear-to-color":[{"mask-linear-to":D()}],"mask-image-t-from-pos":[{"mask-t-from":ne()}],"mask-image-t-to-pos":[{"mask-t-to":ne()}],"mask-image-t-from-color":[{"mask-t-from":D()}],"mask-image-t-to-color":[{"mask-t-to":D()}],"mask-image-r-from-pos":[{"mask-r-from":ne()}],"mask-image-r-to-pos":[{"mask-r-to":ne()}],"mask-image-r-from-color":[{"mask-r-from":D()}],"mask-image-r-to-color":[{"mask-r-to":D()}],"mask-image-b-from-pos":[{"mask-b-from":ne()}],"mask-image-b-to-pos":[{"mask-b-to":ne()}],"mask-image-b-from-color":[{"mask-b-from":D()}],"mask-image-b-to-color":[{"mask-b-to":D()}],"mask-image-l-from-pos":[{"mask-l-from":ne()}],"mask-image-l-to-pos":[{"mask-l-to":ne()}],"mask-image-l-from-color":[{"mask-l-from":D()}],"mask-image-l-to-color":[{"mask-l-to":D()}],"mask-image-x-from-pos":[{"mask-x-from":ne()}],"mask-image-x-to-pos":[{"mask-x-to":ne()}],"mask-image-x-from-color":[{"mask-x-from":D()}],"mask-image-x-to-color":[{"mask-x-to":D()}],"mask-image-y-from-pos":[{"mask-y-from":ne()}],"mask-image-y-to-pos":[{"mask-y-to":ne()}],"mask-image-y-from-color":[{"mask-y-from":D()}],"mask-image-y-to-color":[{"mask-y-to":D()}],"mask-image-radial":[{"mask-radial":[H,W]}],"mask-image-radial-from-pos":[{"mask-radial-from":ne()}],"mask-image-radial-to-pos":[{"mask-radial-to":ne()}],"mask-image-radial-from-color":[{"mask-radial-from":D()}],"mask-image-radial-to-color":[{"mask-radial-to":D()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":C()}],"mask-image-conic-pos":[{"mask-conic":[ie]}],"mask-image-conic-from-pos":[{"mask-conic-from":ne()}],"mask-image-conic-to-pos":[{"mask-conic-to":ne()}],"mask-image-conic-from-color":[{"mask-conic-from":D()}],"mask-image-conic-to-color":[{"mask-conic-to":D()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:q()}],"mask-repeat":[{mask:Z()}],"mask-size":[{mask:R()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",H,W]}],filter:[{filter:["","none",H,W]}],blur:[{blur:De()}],brightness:[{brightness:[ie,H,W]}],contrast:[{contrast:[ie,H,W]}],"drop-shadow":[{"drop-shadow":["","none",g,Yi,Xi]}],"drop-shadow-color":[{"drop-shadow":D()}],grayscale:[{grayscale:["",ie,H,W]}],"hue-rotate":[{"hue-rotate":[ie,H,W]}],invert:[{invert:["",ie,H,W]}],saturate:[{saturate:[ie,H,W]}],sepia:[{sepia:["",ie,H,W]}],"backdrop-filter":[{"backdrop-filter":["","none",H,W]}],"backdrop-blur":[{"backdrop-blur":De()}],"backdrop-brightness":[{"backdrop-brightness":[ie,H,W]}],"backdrop-contrast":[{"backdrop-contrast":[ie,H,W]}],"backdrop-grayscale":[{"backdrop-grayscale":["",ie,H,W]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[ie,H,W]}],"backdrop-invert":[{"backdrop-invert":["",ie,H,W]}],"backdrop-opacity":[{"backdrop-opacity":[ie,H,W]}],"backdrop-saturate":[{"backdrop-saturate":[ie,H,W]}],"backdrop-sepia":[{"backdrop-sepia":["",ie,H,W]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":M()}],"border-spacing-x":[{"border-spacing-x":M()}],"border-spacing-y":[{"border-spacing-y":M()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",H,W]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[ie,"initial",H,W]}],ease:[{ease:["linear","initial",_,H,W]}],delay:[{delay:[ie,H,W]}],animate:[{animate:["none",f,H,W]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[y,H,W]}],"perspective-origin":[{"perspective-origin":k()}],rotate:[{rotate:Se()}],"rotate-x":[{"rotate-x":Se()}],"rotate-y":[{"rotate-y":Se()}],"rotate-z":[{"rotate-z":Se()}],scale:[{scale:xe()}],"scale-x":[{"scale-x":xe()}],"scale-y":[{"scale-y":xe()}],"scale-z":[{"scale-z":xe()}],"scale-3d":["scale-3d"],skew:[{skew:Y()}],"skew-x":[{"skew-x":Y()}],"skew-y":[{"skew-y":Y()}],transform:[{transform:[H,W,"","none","gpu","cpu"]}],"transform-origin":[{origin:k()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:le()}],"translate-x":[{"translate-x":le()}],"translate-y":[{"translate-y":le()}],"translate-z":[{"translate-z":le()}],"translate-none":["translate-none"],accent:[{accent:D()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:D()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",H,W]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":M()}],"scroll-mx":[{"scroll-mx":M()}],"scroll-my":[{"scroll-my":M()}],"scroll-ms":[{"scroll-ms":M()}],"scroll-me":[{"scroll-me":M()}],"scroll-mt":[{"scroll-mt":M()}],"scroll-mr":[{"scroll-mr":M()}],"scroll-mb":[{"scroll-mb":M()}],"scroll-ml":[{"scroll-ml":M()}],"scroll-p":[{"scroll-p":M()}],"scroll-px":[{"scroll-px":M()}],"scroll-py":[{"scroll-py":M()}],"scroll-ps":[{"scroll-ps":M()}],"scroll-pe":[{"scroll-pe":M()}],"scroll-pt":[{"scroll-pt":M()}],"scroll-pr":[{"scroll-pr":M()}],"scroll-pb":[{"scroll-pb":M()}],"scroll-pl":[{"scroll-pl":M()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",H,W]}],fill:[{fill:["none",...D()]}],"stroke-w":[{stroke:[ie,oi,ps,gn]}],stroke:[{stroke:["none",...D()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Vd=xd($d);function Ii(...i){return Vd(vc(i))}const Wd=_c("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),$e=Te(({className:i,variant:e,size:t,...s},r)=>m("button",{className:Ii(Wd({variant:e,size:t,className:i})),ref:r,...s}));$e.displayName="Button";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hd=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ud=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),Ma=i=>{const e=Ud(i);return e.charAt(0).toUpperCase()+e.slice(1)},Pc=(...i)=>i.filter((e,t,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===t).join(" ").trim(),Xd=i=>{for(const e in i)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Yd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gd=Te(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:r="",children:n,iconNode:o,...a},l)=>ht("svg",{ref:l,...Yd,width:e,height:e,stroke:i,strokeWidth:s?Number(t)*24/Number(e):t,className:Pc("lucide",r),...!n&&!Xd(a)&&{"aria-hidden":"true"},...a},[...o.map(([c,h])=>ht(c,h)),...Array.isArray(n)?n:[n]]));/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=(i,e)=>{const t=Te(({className:s,...r},n)=>ht(Gd,{ref:n,iconNode:e,className:Pc(`lucide-${Hd(Ma(i))}`,`lucide-${i}`,s),...r}));return t.displayName=Ma(i),t};/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qd=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ai=ae("check",qd);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kd=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Jd=ae("chevron-down",Kd);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zd=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Qd=ae("chevron-left",Zd);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eg=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],tg=ae("chevron-right",eg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sg=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ig=ae("chevron-up",sg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ng=ae("circle-alert",rg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const og=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ag=ae("circle-check-big",og);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],cg=ae("circle",lg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],ug=ae("clipboard",hg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dg=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],gg=ae("copy",dg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],pg=ae("download",fg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],di=ae("film",mg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yg=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],bg=ae("loader-circle",yg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vg=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],_g=ae("maximize-2",vg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wg=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],xg=ae("mic-off",wg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cg=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Da=ae("mic",Cg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sg=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],kg=ae("monitor",Sg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tg=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Og=ae("pause",Tg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eg=[["path",{d:"M2 10h6V4",key:"zwrco"}],["path",{d:"m2 4 6 6",key:"ug085t"}],["path",{d:"M21 10V7a2 2 0 0 0-2-2h-7",key:"git5jr"}],["path",{d:"M3 14v2a2 2 0 0 0 2 2h3",key:"1f7fh3"}],["rect",{x:"12",y:"14",width:"10",height:"7",rx:"1",key:"1wjs3o"}]],Mg=ae("picture-in-picture",Eg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dg=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Pg=ae("play",Dg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ng=ae("refresh-cw",Ag);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fg=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],jg=ae("rotate-ccw",Fg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lg=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ig=ae("save",Lg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rg=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],zg=ae("scissors",Rg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bg=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Pa=ae("search",Bg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $g=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Vg=ae("settings",$g);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wg=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],Hg=ae("skip-back",Wg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ug=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],Xg=ae("skip-forward",Ug);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yg=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Aa=ae("trash-2",Yg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gg=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],qg=ae("upload",Gg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kg=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Na=ae("video",Kg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jg=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Zg=ae("volume-2",Jg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qg=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Fa=ae("volume-x",Qg);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ef=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],tf=ae("x",ef);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sf=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],rf=ae("zoom-in",sf);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nf=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],of=ae("zoom-out",nf),ja=i=>{let e;const t=new Set,s=(c,h)=>{const u=typeof c=="function"?c(e):c;if(!Object.is(u,e)){const d=e;e=(h!=null?h:typeof u!="object"||u===null)?u:Object.assign({},e,u),t.forEach(g=>g(e,d))}},r=()=>e,a={setState:s,getState:r,getInitialState:()=>l,subscribe:c=>(t.add(c),()=>t.delete(c))},l=e=i(s,r,a);return a},af=i=>i?ja(i):ja,lf=i=>i;function cf(i,e=lf){const t=dt.useSyncExternalStore(i.subscribe,dt.useCallback(()=>e(i.getState()),[i,e]),dt.useCallback(()=>e(i.getInitialState()),[i,e]));return dt.useDebugValue(t),t}const hf=i=>{const e=af(i),t=s=>cf(e,s);return Object.assign(t,e),t},uf=i=>hf,df=i=>(e,t,s)=>{const r=s.subscribe;return s.subscribe=(o,a,l)=>{let c=o;if(a){const h=(l==null?void 0:l.equalityFn)||Object.is;let u=o(s.getState());c=d=>{const g=o(d);if(!h(u,g)){const p=u;a(u=g,p)}},l!=null&&l.fireImmediately&&a(u,u)}return r(c)},i(e,t,s)},gf=df,La=3600*24,ff=1e3,pf=1;function mf(i){try{return!i.id||!i.path||!i.name?(console.warn("[workspace] Invalid clip: missing required fields",i),null):typeof i.duration!="number"||isNaN(i.duration)||i.duration<=0||i.duration>La?(console.warn("[workspace] Invalid clip duration:",i.duration,"for clip",i.id),null):typeof i.start!="number"||typeof i.end!="number"||isNaN(i.start)||isNaN(i.end)||i.start<0||i.end<=i.start||i.end-i.start>La?(console.warn("[workspace] Invalid clip times:",{start:i.start,end:i.end},"for clip",i.id),null):typeof i.trimStart!="number"||typeof i.trimEnd!="number"||isNaN(i.trimStart)||isNaN(i.trimEnd)||i.trimStart<0||i.trimEnd<=i.trimStart||i.trimEnd>i.duration?(console.warn("[workspace] Invalid trim values:",{trimStart:i.trimStart,trimEnd:i.trimEnd},"for clip",i.id),{...i,trimStart:0,trimEnd:i.duration}):typeof i.track!="number"||isNaN(i.track)||i.track<0?(console.warn("[workspace] Invalid track number:",i.track,"for clip",i.id),{...i,track:0}):i}catch(e){return console.error("[workspace] Error validating clip:",e,i),null}}function Ac(i){var t,s;const e={clips:[],playhead:0,is_playing:!1,zoom:10,selected_clip_id:null,export_progress:0};try{if(!i||typeof i!="object")return console.warn("[workspace] Invalid state object, using defaults"),e;const r=[];if(Array.isArray(i.clips))for(const h of i.clips){const u=mf(h);u&&r.push(u)}let n=0;typeof i.playhead=="number"&&!isNaN(i.playhead)&&i.playhead>=0&&(n=i.playhead);let o=10;typeof i.zoom=="number"&&!isNaN(i.zoom)&&i.zoom>=pf&&i.zoom<=ff&&(o=i.zoom);let a=null;i.selected_clip_id&&typeof i.selected_clip_id=="string"&&r.some(h=>h.id===i.selected_clip_id)&&(a=i.selected_clip_id);let l=0;typeof i.export_progress=="number"&&!isNaN(i.export_progress)&&i.export_progress>=0&&i.export_progress<=100&&(l=i.export_progress);const c={clips:r,playhead:n,is_playing:!1,zoom:o,selected_clip_id:a,export_progress:l};return r.length!==((t=i.clips)==null?void 0:t.length)&&console.warn(`[workspace] Filtered out ${(((s=i.clips)==null?void 0:s.length)||0)-r.length} invalid clips`),c}catch(r){return console.error("[workspace] Error validating workspace state:",r),e}}async function yf(){try{const i=await Ie("load_workspace"),e=JSON.parse(i),t=Ac(e);return console.log("[workspace] Loaded and validated workspace",{clipsCount:t.clips.length,playhead:t.playhead,zoom:t.zoom}),t}catch(i){return console.warn("[workspace] No workspace to load or error loading:",i),null}}async function bf(i){try{const e=Ac(i),t=JSON.stringify(e);await Ie("save_workspace",{stateJson:t}),console.log("[workspace] Saved workspace successfully")}catch(e){throw console.error("[workspace] Failed to save workspace:",e),e}}let fn=null;const vf=1e3;function _f(i){fn&&clearTimeout(fn),fn=setTimeout(()=>{bf(i).catch(e=>{console.error("[workspace] Debounced save failed:",e)})},vf)}const qe=uf()(gf((i,e)=>({clips:[],playhead:0,isPlaying:!1,zoom:10,scrollOffset:0,selectedClipId:null,copiedClip:null,error:null,exportProgress:0,isHydrated:!1,addClip:t=>i(s=>({clips:[...s.clips,t],selectedClipId:t.id})),updateClip:(t,s)=>i(r=>({clips:r.clips.map(n=>n.id===t?{...n,...s}:n)})),removeClip:t=>i(s=>({clips:s.clips.filter(r=>r.id!==t),selectedClipId:s.selectedClipId===t?null:s.selectedClipId})),deleteClip:async t=>{const r=e().clips.find(n=>n.id===t);if(r)try{await Ie("delete_clip",{filePath:r.path}),i(n=>({clips:n.clips.filter(o=>o.id!==t),selectedClipId:n.selectedClipId===t?null:n.selectedClipId}))}catch(n){throw console.error("[ClipForge] Delete clip failed:",n),n}},setPlayhead:t=>i({playhead:t}),setIsPlaying:t=>i({isPlaying:t}),setZoom:t=>i({zoom:t}),setScrollOffset:t=>i({scrollOffset:Math.max(0,t)}),autoFitZoom:t=>{const s=e();if(s.clips.length===0){i({zoom:10,scrollOffset:0});return}const r=Math.max(...s.clips.map(l=>l.end)),o=t*.9/r,a=Math.max(.5,Math.min(50,o));console.log("[ClipForge] Auto-fit zoom:",{timelineWidth:t,maxDuration:r,zoom:a}),i({zoom:a,scrollOffset:0})},setSelectedClip:t=>i({selectedClipId:t}),copyClip:t=>{const r=e().clips.find(n=>n.id===t);r&&(i({copiedClip:{...r}}),console.log("[ClipForge] Copied clip:",r.name))},pasteClip:(t,s)=>{const r=e();if(!r.copiedClip)return;let n=t!=null?t:r.playhead,o=s!=null?s:0;if(s===void 0&&r.selectedClipId){const g=r.clips.find(p=>p.id===r.selectedClipId);g&&(o=g.track)}const a=r.copiedClip.end-r.copiedClip.start,c=[...r.clips.filter(g=>g.track===o)].sort((g,p)=>g.start-p.start),h=c.some(g=>n>=g.start&&n<g.end||n+a>g.start&&n+a<=g.end||n<=g.start&&n+a>g.start);let u=n;if(h&&c.filter(p=>n>=p.start&&n<p.end||n+a>p.start&&n+a<=p.end||n<=p.start&&n+a>p.start).length>0){const p=c.filter(v=>v.start>=n),y=a;p.forEach(v=>{r.updateClip(v.id,{start:v.start+y,end:v.end+y})}),u=n}const d={...r.copiedClip,id:`${r.copiedClip.id}-paste-${Date.now()}`,start:u,end:u+a,track:o};i(g=>({clips:[...g.clips,d],selectedClipId:d.id,playhead:u})),console.log("[ClipForge] Pasted clip:",{original:r.copiedClip.name,newId:d.id,track:o,startTime:u})},setError:t=>i({error:t}),setExportProgress:t=>i({exportProgress:t}),clearClips:()=>i({clips:[],selectedClipId:null}),resetWorkspace:async()=>{try{await Ie("reset_workspace"),i({clips:[],playhead:0,isPlaying:!1,zoom:10,selectedClipId:null,error:null,exportProgress:0})}catch(t){throw console.error("[ClipForge] Reset workspace failed:",t),t}},loadState:t=>i(t),hydrateFromWorkspace:async()=>{try{const t=await yf();t?(i({clips:t.clips,playhead:t.playhead,isPlaying:t.is_playing,zoom:t.zoom,selectedClipId:t.selected_clip_id,exportProgress:t.export_progress,isHydrated:!0}),console.log("[store] Hydrated from workspace")):(i({isHydrated:!0}),console.log("[store] No workspace to hydrate from"))}catch(t){console.error("[store] Failed to hydrate from workspace:",t),i({isHydrated:!0})}},trimClip:async(t,s,r)=>{const o=e().clips.find(a=>a.id===t);if(o)try{console.log("[ClipForge] Applying trim:",{id:t,trimStart:s,trimEnd:r,originalPath:o.path});const a=Date.now(),l=o.path.replace("/clips/","/clips/edited/").replace(/\.mp4$/,`_trimmed_${a}.mp4`);await Ie("trim_clip",{inputPath:o.path,outputPath:l,startTime:s,endTime:r});const c=r-s,h=o.start;i(u=>{const d=u.clips.map(y=>y.id===t?{...y,path:l,duration:c,start:h,end:h+c,trimStart:0,trimEnd:c}:y),g=d.find(y=>y.id===t);let p=u.playhead;return u.playhead<g.start?p=g.start:u.playhead>g.end&&(p=g.end),console.log("[ClipForge] Playhead constrained after trim:",{oldPlayhead:u.playhead,newPlayhead:p,clipBounds:{start:g.start,end:g.end}}),{clips:d,playhead:p}}),console.log("[ClipForge] Trim applied successfully, new path:",l)}catch(a){throw console.error("[ClipForge] Trim failed:",a),a}}})));qe.subscribe(i=>({clips:i.clips,playhead:i.playhead,is_playing:i.isPlaying,zoom:i.zoom,selected_clip_id:i.selectedClipId,export_progress:i.exportProgress}),i=>{qe.getState().isHydrated&&_f(i)},{equalityFn:(i,e)=>JSON.stringify(i)===JSON.stringify(e)});function wf(){const[i,e]=te(!1),[t,s]=te({current:0,total:0}),{addClip:r,setError:n,clips:o}=qe(),a=async()=>{try{e(!0),n(null);const c=await ad({multiple:!0,filters:[{name:"Video",extensions:["mp4","mov","webm","avi"]}]});if(!c)return;const h=Array.isArray(c)?c:[c];if(h.length===0)return;s({current:0,total:h.length});let u=0,d=0;const g=[];let p=o.length>0?Math.max(...o.map(y=>y.end)):0;for(let y=0;y<h.length;y++){const v=h[y];s({current:y+1,total:h.length});try{const _=v.split("/").pop()||v.split("\\").pop()||"video.mp4",f=await Ie("import_file",{filePath:v}),S={id:`clip_${Date.now()}_${u}`,path:f.file_path,name:_,start:p,end:p+f.duration,duration:f.duration,track:0,trimStart:0,trimEnd:f.duration,resolution:`${f.width}x${f.height}`,thumbnail_path:f.thumbnail_path,file_size:f.file_size,codec:f.codec,fps:f.fps,bit_rate:f.bit_rate,volume:1,muted:!1};r(S),p+=f.duration,u++,console.log("[v0] Imported clip:",S)}catch(_){d++;const f=v.split("/").pop()||v.split("\\").pop()||v;g.push(`${f}: ${_}`),console.error(`[v0] Import error for ${f}:`,_)}}u>0&&d===0?console.log(`[v0] Successfully imported ${u} file(s)`):u>0&&d>0?n(`Imported ${u} file(s), but ${d} failed: ${g.join(", ")}`):d>0&&n(`Failed to import all files: ${g.join(", ")}`)}catch(c){n(`Failed to import video: ${c}`),console.error("[v0] Import error:",c)}finally{e(!1),s({current:0,total:0})}},l=t.total>0?Math.round(t.current/t.total*100):0;return m("div",{className:"relative group",children:[m($e,{onClick:a,disabled:i,variant:"ghost",size:"icon",className:"h-12 w-12 hover:bg-blue-600 text-white border-2 border-blue-500 hover:border-blue-400 transition-all duration-200 shadow-lg",children:i?m("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):m(qg,{className:"h-6 w-6"})}),i&&t.total>1&&m("div",{className:"absolute -bottom-14 left-1/2 transform -translate-x-1/2 bg-zinc-800 border border-zinc-700 rounded-lg p-2 shadow-xl z-20 min-w-[200px]",children:[m("div",{className:"text-xs text-zinc-300 mb-1 text-center",children:["Importing ",t.current," of ",t.total]}),m("div",{className:"w-full bg-zinc-700 rounded-full h-1.5 overflow-hidden",children:m("div",{className:"bg-blue-500 h-full transition-all duration-300 ease-out",style:{width:`${l}%`}})}),m("div",{className:"text-xs text-zinc-500 mt-1 text-center",children:[l,"%"]})]}),m("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-zinc-800 text-white text-xs px-3 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10 shadow-lg",children:"Import Video"})]})}const xf=_c("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Oo=Te(({className:i,variant:e,...t},s)=>m("div",{ref:s,role:"alert",className:Ii(xf({variant:e}),i),...t}));Oo.displayName="Alert";const Eo=Te(({className:i,...e},t)=>m("div",{ref:t,className:Ii("text-sm [&_p]:leading-relaxed",i),...e}));Eo.displayName="AlertDescription";const Xr=Us({open:!1,setOpen:()=>{}}),Nc=({children:i})=>{const[e,t]=te(!1);return m(Xr.Provider,{value:{open:e,setOpen:t},children:m("div",{className:"relative inline-block",children:i})})},Mo=Te(({children:i},e)=>{const{setOpen:t}=us(Xr);return m("div",{ref:e,onClick:()=>t(s=>!s),children:i})});Mo.displayName="DropdownMenuTrigger";const Do=Te(({className:i,children:e,...t},s)=>{const{open:r,setOpen:n}=us(Xr),o=we(null);return Me(()=>{const a=l=>{o.current&&!o.current.contains(l.target)&&n(!1)};return r&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[r,n]),r?m("div",{ref:o,className:Ii("absolute right-0 z-50 mt-2 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md",i),...t,children:e}):null});Do.displayName="DropdownMenuContent";const xt=Te(({className:i,onClick:e,...t},s)=>{const{setOpen:r}=us(Xr),n=o=>{e==null||e(o),r(!1)};return m("div",{ref:s,className:Ii("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",i),onClick:n,...t})});xt.displayName="DropdownMenuItem";function Cf(){const[i,e]=te(!1),[t,s]=te("720p"),[r,n]=te(0),[o,a]=te(!1),[l,c]=te(null),{clips:h,setError:u,exportProgress:d,setExportProgress:g}=qe();return Me(()=>{let y;return(async()=>{y=await yc("ffmpeg-progress",_=>{console.log("[ExportButton] Received progress event:",_.payload),n(_.payload),g(_.payload)}),console.log("[ExportButton] Progress listener set up")})(),()=>{y&&(console.log("[ExportButton] Cleaning up progress listener"),y())}},[g]),m(Le,{children:[o&&l&&m(Oo,{className:"fixed top-20 right-4 z-50 w-96 bg-green-900/80 backdrop-blur-md border-green-600 shadow-2xl",children:[m(ag,{className:"h-4 w-4 text-green-400 mr-2"}),m(Eo,{className:"flex items-center text-white font-medium",children:["Export successful: ",l]})]}),m("div",{className:"flex items-center gap-3",children:[m("div",{className:"relative group",children:[m(Nc,{children:[m(Mo,{asChild:!0,children:m($e,{variant:"ghost",size:"icon",className:"h-12 w-12 hover:bg-zinc-700 text-white border-2 border-zinc-500 hover:border-zinc-400 transition-all duration-200 shadow-lg",disabled:i,children:m(Vg,{className:"h-6 w-6"})})}),m(Do,{className:"w-48 bg-zinc-800 border-zinc-700 p-2 rounded-lg shadow-xl",children:[m(xt,{onClick:()=>s("source"),className:`cursor-pointer hover:bg-zinc-700 rounded-md p-2 flex items-center justify-between text-white ${t==="source"?"bg-zinc-700":""}`,children:[m("div",{className:"flex items-center gap-3",children:[m("span",{className:"w-6 text-center",children:"🎬"}),m("span",{className:"text-sm",children:"Source"})]}),t==="source"&&m(ai,{className:"h-4 w-4 text-green-400"})]}),m(xt,{onClick:()=>s("480p"),className:`cursor-pointer hover:bg-zinc-700 rounded-md p-2 flex items-center justify-between text-white ${t==="480p"?"bg-zinc-700":""}`,children:[m("div",{className:"flex items-center gap-3",children:[m("span",{className:"w-6 text-center",children:"📱"}),m("span",{className:"text-sm",children:"480p (854×480)"})]}),t==="480p"&&m(ai,{className:"h-4 w-4 text-green-400"})]}),m(xt,{onClick:()=>s("720p"),className:`cursor-pointer hover:bg-zinc-700 rounded-md p-2 flex items-center justify-between text-white ${t==="720p"?"bg-zinc-700":""}`,children:[m("div",{className:"flex items-center gap-3",children:[m("span",{className:"w-6 text-center",children:"📱"}),m("span",{className:"text-sm",children:"720p (1280×720)"})]}),t==="720p"&&m(ai,{className:"h-4 w-4 text-green-400"})]}),m(xt,{onClick:()=>s("1080p"),className:`cursor-pointer hover:bg-zinc-700 rounded-md p-2 flex items-center justify-between text-white ${t==="1080p"?"bg-zinc-700":""}`,children:[m("div",{className:"flex items-center gap-3",children:[m("span",{className:"w-6 text-center",children:"🖥️"}),m("span",{className:"text-sm",children:"1080p (1920×1080)"})]}),t==="1080p"&&m(ai,{className:"h-4 w-4 text-green-400"})]}),m(xt,{onClick:()=>s("4K"),className:`cursor-pointer hover:bg-zinc-700 rounded-md p-2 flex items-center justify-between text-white ${t==="4K"?"bg-zinc-700":""}`,children:[m("div",{className:"flex items-center gap-3",children:[m("span",{className:"w-6 text-center",children:"🎥"}),m("span",{className:"text-sm",children:"4K (3840×2160)"})]}),t==="4K"&&m(ai,{className:"h-4 w-4 text-green-400"})]})]})]}),m("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-zinc-800 text-white text-xs px-3 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10 shadow-lg",children:"Export Settings"})]}),m("div",{className:"relative group",children:[m($e,{onClick:async()=>{if(h.length===0){u("No clips to export");return}const y=h.filter(v=>v.path&&v.path.trim()!=="");if(y.length===0){u("No valid clips found");return}try{e(!0),u(null),g(0),n(0),a(!1);const v=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),_=await ld({defaultPath:`clipforge-export-${v}.mp4`,filters:[{name:"Video",extensions:["mp4"]}]});if(!_){e(!1);return}const f=_.toLowerCase().endsWith(".mp4")?_:`${_}.mp4`,C=[...y].sort((T,F)=>T.start-F.start).map(T=>({path:T.path,trim_start:T.trimStart,trim_end:T.trimEnd,volume:T.volume,muted:T.muted}));console.log("[ClipForge] Exporting clips:",C),console.log("[ClipForge] Output path:",f),console.log("[ClipForge] Resolution:",t),console.log("[ClipForge] Total clips:",C.length),n(0);const k=await Ie("export_video",{clips:C,outputPath:f,resolution:t});n(100),g(100),a(!0),c(f.split("/").pop()||f.split("\\").pop()||"video.mp4"),console.log("[ClipForge] Export completed successfully:",k)}catch(v){u(`Export failed: ${v}`),console.error("[ClipForge] Export error:",v)}finally{e(!1),setTimeout(()=>{g(0),n(0)},2e3),setTimeout(()=>{a(!1),c(null)},5e3)}},disabled:i||h.length===0,size:"icon",className:"h-12 w-12 bg-green-600 hover:bg-green-500 text-white border-2 border-green-500 shadow-lg transition-all duration-200",children:m(pg,{className:"h-6 w-6"})}),m("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-zinc-800 text-white text-xs px-3 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10 shadow-lg",children:"Export Video"})]}),i&&r>0&&m("div",{className:"flex items-center gap-2",children:[m("div",{className:"w-24 h-2 bg-zinc-700 rounded-full overflow-hidden",children:m("div",{className:"h-full bg-green-500 transition-all duration-300 ease-out rounded-full",style:{width:`${r}%`}})}),m("span",{className:"text-xs text-zinc-400 font-mono",children:[Math.round(r),"%"]})]})]})]})}function Sf(){const[i,e]=te(!1),[t,s]=te(!1),[r,n]=te(null),[o,a]=te(null),[l,c]=te([]),[h,u]=te(null),[d,g]=te(!1),p=we(0),[y,v]=te(0),{addClip:_,setError:f,clips:S}=qe();Me(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const E=(await navigator.mediaDevices.enumerateDevices()).filter(N=>N.kind==="audioinput");if(console.log("[ClipForge] Found audio devices:",E.map(N=>`${N.label} (${N.deviceId})`)),c(E),!h&&E.length>0){const N=E.find(j=>j.deviceId==="default")||E[0];u(N.deviceId),console.log("[ClipForge] Selected default audio device:",N.label)}}catch(B){console.error("[ClipForge] Failed to enumerate audio devices:",B)}})()},[]);const C=()=>{if(o){console.log("[ClipForge] Manual stop requested");try{o.recorder.state!=="inactive"&&o.recorder.stop(),o.stream.getTracks().forEach(A=>{console.log("[ClipForge] Stopping track:",A.kind,A.label),A.stop()}),o.additionalStreams&&o.additionalStreams.forEach(A=>{A.getTracks().forEach(B=>{console.log("[ClipForge] Stopping additional track:",B.kind,B.label),B.stop()})}),o.audioContext&&(o.audioContext.close(),console.log("[ClipForge] Audio context closed")),console.log("[ClipForge] All tracks stopped successfully")}catch(A){console.error("[ClipForge] Error stopping recording:",A)}a(null),e(!1),n(null)}else console.warn("[ClipForge] Stop requested but no active recorder found")},k=()=>{if(o&&o.stream){const A=o.stream.getAudioTracks()[0];A&&(A.enabled=!A.enabled,console.log("[ClipForge] Audio",A.enabled?"enabled":"muted"))}},T=async()=>{try{console.log("[ClipForge] Starting webcam recording..."),e(!0),n("webcam"),f(null);const A={echoCancellation:!0,noiseSuppression:!0,sampleRate:44100};h&&h!=="default"&&(A.deviceId={exact:h},console.log("[ClipForge] Using audio device:",h));const B=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}},audio:A});console.log("[ClipForge] Got media stream:",B.getTracks().map(L=>`${L.kind}: ${L.label}`));const E=new MediaRecorder(B,{mimeType:"video/webm;codecs=vp8,opus"}),N=[];E.ondataavailable=L=>{L.data.size>0&&(console.log("[ClipForge] Data chunk received:",L.data.size,"bytes"),N.push(L.data))},E.onstop=async()=>{try{if(console.log("[ClipForge] Webcam recording stopped, processing..."),e(!1),s(!0),N.length===0)throw new Error("No video data was recorded");const L=new Blob(N,{type:"video/webm"});if(console.log("[ClipForge] Blob size:",L.size,"bytes"),L.size===0)throw new Error("Recorded video is empty");const G=await L.arrayBuffer(),X=Array.from(new Uint8Array(G)),P=`webcam_${Date.now()}.webm`;console.log("[ClipForge] Saving recording:",P);const D=await Ie("save_recording",{fileName:P,data:X,convertToMp4:!0});console.log("[ClipForge] Recording saved to:",D);const q=Date.now(),Z=p.current,R=q-Z,de=Math.max(R/1e3,1);if(console.log("[ClipForge] Webcam duration calculation:",{now:q,recordingStartTime:Z,elapsed:R,duration:de,durationSeconds:de}),de>86400)throw new Error("Recording duration is invalid");const ee=S.length>0?Math.max(...S.map(U=>U.end)):0,V={id:`clip_${Date.now()}`,path:D,name:"Webcam Recording",start:ee,end:ee+de,duration:de,track:0,trimStart:0,trimEnd:de,volume:1,muted:!1};if(console.log("[ClipForge] Validating clip:",{duration:V.duration,start:V.start,end:V.end,trimStart:V.trimStart,trimEnd:V.trimEnd,checks:{durationPositive:V.duration>0,durationReasonable:V.duration<=86400,endAfterStart:V.end>V.start,trimEndAfterStart:V.trimEnd>V.trimStart}}),V.duration>0&&V.duration<=86400&&V.end>V.start&&V.trimEnd>V.trimStart){let U;try{console.log("[ClipForge] Generating thumbnail for:",D),U=await Ie("generate_thumbnail",{filePath:D,duration:de,width:160,height:90}),console.log("[ClipForge] Thumbnail generated:",U)}catch(oe){console.warn("[ClipForge] Failed to generate thumbnail:",oe)}V.thumbnail_path=U,console.log("[ClipForge] Adding clip to store:",V),_(V),console.log("[ClipForge] Webcam recording complete!")}else throw new Error(`Generated clip has invalid values - duration: ${V.duration}, start: ${V.start}, end: ${V.end}, trimStart: ${V.trimStart}, trimEnd: ${V.trimEnd}`);s(!1),n(null),a(null)}catch(L){const G=L instanceof Error?L.message:String(L);console.error("[ClipForge] Error processing webcam recording:",L),f(`Failed to process webcam recording: ${G}`),e(!1),s(!1),n(null),a(null)}},a({recorder:E,stream:B});const j=Date.now();p.current=j,v(j),E.start(),console.log("[ClipForge] Webcam recorder started at:",j)}catch(A){f(`Failed to record webcam: ${A}`),console.error("[ClipForge] Webcam recording error:",A),e(!1),n(null),a(null)}},F=async()=>{try{console.log("[ClipForge] Starting screen recording..."),e(!0),n("screen"),f(null);const A=await navigator.mediaDevices.getDisplayMedia({video:{mediaSource:"screen",width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});console.log("[ClipForge] Got display stream:",A.getTracks().map(R=>`${R.kind}: ${R.label}`));let B=null;try{const R={echoCancellation:!0,noiseSuppression:!0,sampleRate:44100};h&&h!=="default"&&(R.deviceId={exact:h}),B=await navigator.mediaDevices.getUserMedia({audio:R}),console.log("[ClipForge] Got microphone stream:",B.getAudioTracks().map(de=>de.label))}catch(R){console.warn("[ClipForge] Could not get microphone audio:",R)}const E=new MediaStream,N=A.getVideoTracks()[0];N&&E.addTrack(N);const j=new AudioContext,L=j.createMediaStreamDestination(),G=A.getAudioTracks()[0];if(G&&(j.createMediaStreamSource(new MediaStream([G])).connect(L),console.log("[ClipForge] Added system audio to mix")),B){const R=B.getAudioTracks()[0];R&&(j.createMediaStreamSource(new MediaStream([R])).connect(L),console.log("[ClipForge] Added microphone audio to mix"))}const X=L.stream.getAudioTracks()[0];X&&(E.addTrack(X),console.log("[ClipForge] Added mixed audio track")),console.log("[ClipForge] Final stream tracks:",E.getTracks().map(R=>`${R.kind}: ${R.label}`));const P=new MediaRecorder(E,{mimeType:"video/webm;codecs=vp8,opus"}),D=[];P.ondataavailable=R=>{R.data.size>0&&(console.log("[ClipForge] Data chunk received:",R.data.size,"bytes"),D.push(R.data))},P.onstop=async()=>{try{if(console.log("[ClipForge] Screen recording stopped, processing..."),e(!1),s(!0),D.length===0)throw new Error("No video data was recorded");const R=new Blob(D,{type:"video/webm"});if(console.log("[ClipForge] Blob size:",R.size,"bytes"),R.size===0)throw new Error("Recorded video is empty");const de=await R.arrayBuffer(),ee=Array.from(new Uint8Array(de)),V=`screen_${Date.now()}.webm`;console.log("[ClipForge] Saving recording:",V);const U=await Ie("save_recording",{fileName:V,data:ee,convertToMp4:!0});console.log("[ClipForge] Recording saved to:",U);const oe=Date.now(),ne=p.current,De=oe-ne,Se=Math.max(De/1e3,1);if(console.log("[ClipForge] Screen duration calculation:",{now:oe,recordingStartTime:ne,elapsed:De,duration:Se,durationSeconds:Se}),Se>86400)throw new Error("Recording duration is invalid");const xe=S.length>0?Math.max(...S.map(le=>le.end)):0,Y={id:`clip_${Date.now()}`,path:U,name:"Screen Recording",start:xe,end:xe+Se,duration:Se,track:0,trimStart:0,trimEnd:Se,volume:1,muted:!1};if(console.log("[ClipForge] Validating screen clip:",{duration:Y.duration,start:Y.start,end:Y.end,trimStart:Y.trimStart,trimEnd:Y.trimEnd,checks:{durationPositive:Y.duration>0,durationReasonable:Y.duration<=86400,endAfterStart:Y.end>Y.start,trimEndAfterStart:Y.trimEnd>Y.trimStart}}),Y.duration>0&&Y.duration<=86400&&Y.end>Y.start&&Y.trimEnd>Y.trimStart){let le;try{console.log("[ClipForge] Generating thumbnail for:",U),le=await Ie("generate_thumbnail",{filePath:U,duration:Se,width:160,height:90}),console.log("[ClipForge] Thumbnail generated:",le)}catch(ce){console.warn("[ClipForge] Failed to generate thumbnail:",ce)}Y.thumbnail_path=le,console.log("[ClipForge] Adding clip to store:",Y),_(Y),console.log("[ClipForge] Screen recording complete!")}else throw new Error(`Generated screen clip has invalid values - duration: ${Y.duration}, start: ${Y.start}, end: ${Y.end}, trimStart: ${Y.trimStart}, trimEnd: ${Y.trimEnd}`);s(!1),n(null),a(null)}catch(R){const de=R instanceof Error?R.message:String(R);console.error("[ClipForge] Error processing screen recording:",R),f(`Failed to process screen recording: ${de}`),e(!1),s(!1),n(null),a(null)}};const q=[A];B&&q.push(B),a({recorder:P,stream:E,additionalStreams:q,audioContext:j});const Z=Date.now();p.current=Z,v(Z),P.start(),console.log("[ClipForge] Screen recorder started at:",Z)}catch(A){f(`Failed to record screen: ${A}`),console.error("[ClipForge] Screen recording error:",A),e(!1),n(null),a(null)}},M=async()=>{try{console.log("[ClipForge] Starting PiP recording..."),e(!0),n("pip"),f(null);const A=await navigator.mediaDevices.getDisplayMedia({video:{mediaSource:"screen",width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});console.log("[ClipForge] Got screen stream");const B={echoCancellation:!0,noiseSuppression:!0,sampleRate:44100};h&&h!=="default"&&(B.deviceId={exact:h});const E=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:360},frameRate:{ideal:30}},audio:B});console.log("[ClipForge] Got webcam stream with audio");const N=document.createElement("canvas");N.width=1920,N.height=1080;const j=N.getContext("2d"),L=document.createElement("video");L.srcObject=A,L.autoplay=!0,L.muted=!0;const G=document.createElement("video");G.srcObject=E,G.autoplay=!0,G.muted=!0,await Promise.all([new Promise(Y=>L.onloadedmetadata=Y),new Promise(Y=>G.onloadedmetadata=Y)]);const X=320,P=180,D=N.width-X-20,q=N.height-P-20;let Z;const R=()=>{j&&(j.drawImage(L,0,0,N.width,N.height),j.save(),j.strokeStyle="#3b82f6",j.lineWidth=4,j.strokeRect(D-2,q-2,X+4,P+4),j.drawImage(G,D,q,X,P),j.restore(),Z=requestAnimationFrame(R))};R();const de=N.captureStream(30),ee=new AudioContext,V=ee.createMediaStreamDestination(),U=A.getAudioTracks()[0];U&&(ee.createMediaStreamSource(new MediaStream([U])).connect(V),console.log("[ClipForge] Added system audio to PiP mix"));const oe=E.getAudioTracks()[0];oe&&(ee.createMediaStreamSource(new MediaStream([oe])).connect(V),console.log("[ClipForge] Added microphone audio to PiP mix"));const ne=V.stream.getAudioTracks()[0];ne&&(de.addTrack(ne),console.log("[ClipForge] Added mixed audio track to PiP stream"));const De=new MediaRecorder(de,{mimeType:"video/webm;codecs=vp8,opus"}),Se=[];De.ondataavailable=Y=>{Y.data.size>0&&(console.log("[ClipForge] Data chunk received:",Y.data.size,"bytes"),Se.push(Y.data))},De.onstop=async()=>{try{if(console.log("[ClipForge] PiP recording stopped, processing..."),e(!1),s(!0),cancelAnimationFrame(Z),A.getTracks().forEach(pe=>pe.stop()),E.getTracks().forEach(pe=>pe.stop()),Se.length===0)throw new Error("No video data was recorded");const Y=new Blob(Se,{type:"video/webm"});if(console.log("[ClipForge] Blob size:",Y.size,"bytes"),Y.size===0)throw new Error("Recorded video is empty");const le=await Y.arrayBuffer(),ce=Array.from(new Uint8Array(le)),se=`pip_${Date.now()}.webm`;console.log("[ClipForge] Saving recording:",se);const Pe=await Ie("save_recording",{fileName:se,data:ce,convertToMp4:!0});console.log("[ClipForge] Recording saved to:",Pe);const gs=Date.now(),jt=p.current,ss=gs-jt,at=Math.max(ss/1e3,1);if(console.log("[ClipForge] PiP duration calculation:",{now:gs,recordingStartTime:jt,elapsed:ss,duration:at,durationSeconds:at}),at>86400)throw new Error("Recording duration is invalid");const fs=S.length>0?Math.max(...S.map(pe=>pe.end)):0,fe={id:`clip_${Date.now()}`,path:Pe,name:"PiP Recording",start:fs,end:fs+at,duration:at,track:0,trimStart:0,trimEnd:at,volume:1,muted:!1};if(console.log("[ClipForge] Validating PiP clip:",{duration:fe.duration,start:fe.start,end:fe.end,trimStart:fe.trimStart,trimEnd:fe.trimEnd,checks:{durationPositive:fe.duration>0,durationReasonable:fe.duration<=86400,endAfterStart:fe.end>fe.start,trimEndAfterStart:fe.trimEnd>fe.trimStart}}),fe.duration>0&&fe.duration<=86400&&fe.end>fe.start&&fe.trimEnd>fe.trimStart){let pe;try{console.log("[ClipForge] Generating thumbnail for:",Pe),pe=await Ie("generate_thumbnail",{filePath:Pe,duration:at,width:160,height:90}),console.log("[ClipForge] Thumbnail generated:",pe)}catch(lt){console.warn("[ClipForge] Failed to generate thumbnail:",lt)}fe.thumbnail_path=pe,console.log("[ClipForge] Adding clip to store:",fe),_(fe),console.log("[ClipForge] PiP recording complete!")}else throw new Error(`Generated PiP clip has invalid values - duration: ${fe.duration}, start: ${fe.start}, end: ${fe.end}, trimStart: ${fe.trimStart}, trimEnd: ${fe.trimEnd}`);s(!1),n(null),a(null)}catch(Y){const le=Y instanceof Error?Y.message:String(Y);console.error("[ClipForge] Error processing PiP recording:",Y),f(`Failed to process PiP recording: ${le}`),e(!1),s(!1),n(null),a(null)}},a({recorder:De,stream:de,additionalStreams:[A,E],audioContext:ee});const xe=Date.now();p.current=xe,v(xe),De.start(),console.log("[ClipForge] PiP recorder started at:",xe)}catch(A){f(`Failed to record PiP: ${A}`),console.error("[ClipForge] PiP recording error:",A),e(!1),n(null),a(null)}};if(t)return m("div",{className:"flex items-center gap-3",children:[m($e,{variant:"ghost",size:"icon",className:"h-12 w-12 text-white border-2 border-blue-500 shadow-lg cursor-not-allowed",disabled:!0,children:m(bg,{className:"h-6 w-6 animate-spin text-blue-400"})}),m("div",{className:"text-sm text-blue-300 font-mono bg-zinc-800 px-4 py-2 rounded-md border border-blue-600 shadow-md",children:"Processing Recording..."})]});if(i){const A=o==null?void 0:o.stream.getAudioTracks()[0],B=A?!A.enabled:!1;return m("div",{className:"flex items-center gap-3",children:[m("div",{className:"relative group",children:[m($e,{variant:"destructive",size:"icon",className:"h-12 w-12 bg-red-600 hover:bg-red-500 text-white border-2 border-red-500 shadow-lg animate-pulse",onClick:C,children:m(cg,{className:"h-6 w-6"})}),m("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-red-900 text-white text-xs px-3 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10 shadow-lg",children:"Stop Recording"})]}),m("div",{className:"relative group",children:[m($e,{variant:"ghost",size:"icon",className:`h-12 w-12 text-white border-2 border-zinc-500 shadow-lg transition-all duration-200 ${B?"bg-zinc-700 hover:bg-zinc-600":"bg-green-600 hover:bg-green-500 border-green-500"}`,onClick:k,children:B?m(xg,{className:"h-6 w-6"}):m(Da,{className:"h-6 w-6"})}),m("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-zinc-800 text-white text-xs px-3 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10 shadow-lg",children:[B?"Unmute":"Mute"," Audio"]})]}),m("div",{className:"text-sm text-zinc-300 font-mono bg-zinc-800 px-4 py-2 rounded-md border border-zinc-600 shadow-md",children:[r==="webcam"?"Webcam":r==="screen"?"Screen":"PiP"," • ",Math.round((Date.now()-y)/1e3),"s"]})]})}return m("div",{className:"relative group",children:[m(Nc,{children:[m(Mo,{asChild:!0,children:m($e,{variant:"ghost",size:"icon",className:"h-12 w-12 hover:bg-green-600 text-white border-2 border-green-500 hover:border-green-400 transition-all duration-200 shadow-lg",children:m(Na,{className:"h-6 w-6"})})}),m(Do,{className:"w-64 bg-zinc-800 border-zinc-700 p-2 rounded-lg shadow-xl",children:[m("div",{className:"text-zinc-400 text-xs px-2 py-1 font-semibold",children:"Recording Mode"}),m(xt,{onClick:T,className:"cursor-pointer hover:bg-zinc-700 rounded-md p-2 flex items-center gap-3 text-white",children:[m(Na,{className:"h-5 w-5 text-green-400"}),m("span",{className:"text-sm",children:"Webcam"})]}),m(xt,{onClick:F,className:"cursor-pointer hover:bg-zinc-700 rounded-md p-2 flex items-center gap-3 text-white",children:[m(kg,{className:"h-5 w-5 text-blue-400"}),m("span",{className:"text-sm",children:"Screen"})]}),m(xt,{onClick:M,className:"cursor-pointer hover:bg-zinc-700 rounded-md p-2 flex items-center gap-3 text-white",children:[m(Mg,{className:"h-5 w-5 text-purple-400"}),m("span",{className:"text-sm",children:"PiP (Screen + Webcam)"})]}),m("div",{className:"bg-zinc-700 my-1 h-px"}),m("div",{className:"text-zinc-400 text-xs px-2 py-1 font-semibold flex items-center gap-2",children:[m(Da,{className:"h-3 w-3"}),"Microphone"]}),l.length>0?l.map(A=>m(xt,{onClick:()=>{u(A.deviceId),console.log("[ClipForge] Selected audio device:",A.label)},className:`cursor-pointer hover:bg-zinc-700 rounded-md p-2 text-white text-xs ${h===A.deviceId?"bg-zinc-700":""}`,children:m("div",{className:"flex items-center gap-2 w-full",children:[m("div",{className:`w-2 h-2 rounded-full ${h===A.deviceId?"bg-green-500":"bg-zinc-600"}`}),m("span",{className:"truncate flex-1",children:A.label||`Microphone ${A.deviceId.slice(0,8)}`})]})},A.deviceId)):m(xt,{disabled:!0,className:"text-zinc-500 text-xs px-2 py-1",children:"No microphones found"})]})]}),m("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-zinc-800 text-white text-xs px-3 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10 shadow-lg",children:"Record Video"})]})}function kf(){const[i,e]=te(!1),{clips:t,playhead:s,isPlaying:r,zoom:n,selectedClipId:o,exportProgress:a,setError:l}=qe();return m("div",{className:"relative group",children:[m($e,{onClick:async()=>{try{e(!0),l(null);const h={clips:t.map(u=>({id:u.id,name:u.name,path:u.path,start:u.start,end:u.end,duration:u.duration})),playhead:s,is_playing:r,zoom:n,selected_clip_id:o,export_progress:a};await Ie("save_workspace",{stateJson:JSON.stringify(h)}),console.log("Workspace saved manually"),setTimeout(()=>{},100)}catch(h){l(`Failed to save workspace: ${h}`),console.error("Save error:",h)}finally{e(!1)}},disabled:i,variant:"ghost",size:"icon",className:"h-12 w-12 hover:bg-zinc-700 text-white border-2 border-zinc-500 hover:border-zinc-400 transition-all duration-200 shadow-lg",children:i?m("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):m(Ig,{className:"h-6 w-6"})}),m("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-zinc-800 text-white text-xs px-3 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-10 shadow-lg",children:"Save Project"})]})}function Tf(){const[i,e]=te(!1),[t,s]=te(!1),r=qe(o=>o.resetWorkspace),n=async()=>{try{e(!0),await r(),s(!1),window.location.reload()}catch(o){console.error("Failed to reset workspace:",o),e(!1)}};return t?m("div",{className:"flex items-center gap-2",children:[m("span",{className:"text-sm text-zinc-300",children:"Delete all clips?"}),m("button",{onClick:n,disabled:i,className:"flex items-center gap-2 rounded-lg bg-red-500 px-3 py-2 text-sm font-medium text-white shadow-md transition-all hover:bg-red-600 disabled:cursor-not-allowed disabled:opacity-50",children:i?"Resetting...":"Confirm"}),m("button",{onClick:()=>s(!1),className:"flex items-center gap-2 rounded-lg bg-zinc-700 px-3 py-2 text-sm font-medium text-white shadow-md transition-all hover:bg-zinc-600",children:"Cancel"})]}):m("button",{onClick:()=>s(!0),className:"flex items-center gap-2 rounded-lg border border-zinc-600 bg-zinc-800 px-4 py-2 text-sm font-medium text-white shadow-md transition-all hover:bg-zinc-700 hover:shadow-lg",title:"Reset workspace (delete all clips)",children:[m(jg,{className:"h-4 w-4"}),"Reset"]})}function Of(){return m("header",{className:"flex items-center justify-between border-b border-zinc-700 bg-zinc-900 px-6 py-4 shadow-lg",children:[m("div",{className:"flex items-center gap-4",children:[m(di,{className:"h-8 w-8 text-blue-400"}),m("div",{children:[m("h1",{className:"text-2xl font-bold tracking-tight text-white",children:"ClipForge"}),m("p",{className:"text-xs text-zinc-400",children:"Video Editor"})]})]}),m("div",{className:"flex items-center gap-3",children:[m(Tf,{}),m(wf,{}),m(Sf,{}),m(kf,{}),m(Cf,{})]})]})}function w(i,e,t){return(e=function(s){var r=function(n,o){if(typeof n!="object"||!n)return n;var a=n[Symbol.toPrimitive];if(a!==void 0){var l=a.call(n,o);if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(n)}(s,"string");return typeof r=="symbol"?r:r+""}(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ia(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,s)}return t}function x(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ia(Object(t),!0).forEach(function(s){w(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Ia(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function ke(i,e){if(i==null)return{};var t,s,r=function(o,a){if(o==null)return{};var l={};for(var c in o)if({}.hasOwnProperty.call(o,c)){if(a.indexOf(c)>=0)continue;l[c]=o[c]}return l}(i,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);for(s=0;s<n.length;s++)t=n[s],e.indexOf(t)>=0||{}.propertyIsEnumerable.call(i,t)&&(r[t]=i[t])}return r}function Ft(i,e){return e||(e=i.slice(0)),Object.freeze(Object.defineProperties(i,{raw:{value:Object.freeze(e)}}))}class Ra{constructor(){w(this,"browserShadowBlurConstant",1),w(this,"DPI",96),w(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),w(this,"perfLimitSizeTotal",2097152),w(this,"maxCacheSideLimit",4096),w(this,"minCacheSideLimit",256),w(this,"disableStyleCopyPaste",!1),w(this,"enableGLFiltering",!0),w(this,"textureSize",4096),w(this,"forceGLPutImageData",!1),w(this,"cachesBoundsOfCurve",!1),w(this,"fontPaths",{}),w(this,"NUM_FRACTION_DIGITS",4)}}const ue=new class extends Ra{constructor(i){super(),this.configure(i)}configure(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,i)}addFonts(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=x(x({},this.fontPaths),i)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(i=>{delete this.fontPaths[i]})}clearFonts(){this.fontPaths={}}restoreDefaults(i){const e=new Ra,t=(i==null?void 0:i.reduce((s,r)=>(s[r]=e[r],s),{}))||e;this.configure(t)}},ls=function(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return console[i]("fabric",...t)};class At extends Error{constructor(e,t){super("fabric: ".concat(e),t)}}class Ef extends At{constructor(e){super("".concat(e," 'options.signal' is in 'aborted' state"))}}class Mf{}class Df extends Mf{testPrecision(e,t){const s="precision ".concat(t,` float;
void main(){}`),r=e.createShader(e.FRAGMENT_SHADER);return!!r&&(e.shaderSource(r,s),e.compileShader(r),!!e.getShaderParameter(r,e.COMPILE_STATUS))}queryWebGL(e){const t=e.getContext("webgl");t&&(this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(s=>this.testPrecision(t,s)),t.getExtension("WEBGL_lose_context").loseContext(),ls("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(e){return!!this.maxTextureSize&&this.maxTextureSize>=e}}const Pf={};let za;const Nt=()=>za||(za={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new Df,dispose(){},copyPasteData:Pf}),Js=()=>Nt().document,Yr=()=>Nt().window,Fc=()=>{var i;return Math.max((i=ue.devicePixelRatio)!==null&&i!==void 0?i:Yr().devicePixelRatio,1)},bi=new class{constructor(){w(this,"charWidthsCache",{}),w(this,"boundsOfCurveCache",{})}getFontCache(i){let{fontFamily:e,fontStyle:t,fontWeight:s}=i;e=e.toLowerCase(),this.charWidthsCache[e]||(this.charWidthsCache[e]={});const r=this.charWidthsCache[e],n="".concat(t.toLowerCase(),"_").concat((s+"").toLowerCase());return r[n]||(r[n]={}),r[n]}clearFontCache(i){(i=(i||"").toLowerCase())?this.charWidthsCache[i]&&delete this.charWidthsCache[i]:this.charWidthsCache={}}limitDimsByArea(i){const{perfLimitSizeTotal:e}=ue,t=Math.sqrt(e*i);return[Math.floor(t),Math.floor(e/t)]}},$n="6.7.1";function _r(){}const Ri=Math.PI/2,Dr=2*Math.PI,Po=Math.PI/180,et=Object.freeze([1,0,0,1,0,0]),Ao=16,rs=.4477152502,re="center",ye="left",it="top",Vn="bottom",Fe="right",rt="none",No=/\r?\n/,jc="moving",Gr="scaling",Lc="rotating",Fo="rotate",Ic="skewing",Si="resizing",Af="modifyPoly",Nf="modifyPath",Pr="changed",qr="scale",ot="scaleX",mt="scaleY",Zs="skewX",Qs="skewY",Ve="fill",nt="stroke",Ar="modified",Ps="json",pn="svg",$=new class{constructor(){this[Ps]=new Map,this[pn]=new Map}has(i){return this[Ps].has(i)}getClass(i){const e=this[Ps].get(i);if(!e)throw new At("No class registered for ".concat(i));return e}setClass(i,e){e?this[Ps].set(e,i):(this[Ps].set(i.type,i),this[Ps].set(i.type.toLowerCase(),i))}getSVGClass(i){return this[pn].get(i)}setSVGClass(i,e){this[pn].set(e!=null?e:i.type.toLowerCase(),i)}},Nr=new class extends Array{remove(i){const e=this.indexOf(i);e>-1&&this.splice(e,1)}cancelAll(){const i=this.splice(0);return i.forEach(e=>e.abort()),i}cancelByCanvas(i){if(!i)return[];const e=this.filter(t=>{var s;return t.target===i||typeof t.target=="object"&&((s=t.target)===null||s===void 0?void 0:s.canvas)===i});return e.forEach(t=>t.abort()),e}cancelByTarget(i){if(!i)return[];const e=this.filter(t=>t.target===i);return e.forEach(t=>t.abort()),e}};class Ff{constructor(){w(this,"__eventListeners",{})}on(e,t){if(this.__eventListeners||(this.__eventListeners={}),typeof e=="object")return Object.entries(e).forEach(s=>{let[r,n]=s;this.on(r,n)}),()=>this.off(e);if(t){const s=e;return this.__eventListeners[s]||(this.__eventListeners[s]=[]),this.__eventListeners[s].push(t),()=>this.off(s,t)}return()=>!1}once(e,t){if(typeof e=="object"){const s=[];return Object.entries(e).forEach(r=>{let[n,o]=r;s.push(this.once(n,o))}),()=>s.forEach(r=>r())}if(t){const s=this.on(e,function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];t.call(this,...n),s()});return s}return()=>!1}_removeEventListener(e,t){if(this.__eventListeners[e])if(t){const s=this.__eventListeners[e],r=s.indexOf(t);r>-1&&s.splice(r,1)}else this.__eventListeners[e]=[]}off(e,t){if(this.__eventListeners)if(e===void 0)for(const s in this.__eventListeners)this._removeEventListener(s);else typeof e=="object"?Object.entries(e).forEach(s=>{let[r,n]=s;this._removeEventListener(r,n)}):this._removeEventListener(e,t)}fire(e,t){var s;if(!this.__eventListeners)return;const r=(s=this.__eventListeners[e])===null||s===void 0?void 0:s.concat();if(r)for(let n=0;n<r.length;n++)r[n].call(this,t||{})}}const Fs=(i,e)=>{const t=i.indexOf(e);return t!==-1&&i.splice(t,1),i},qt=i=>{if(i===0)return 1;switch(Math.abs(i)/Ri){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},Kt=i=>{if(i===0)return 0;const e=i/Ri,t=Math.sign(i);switch(e){case 1:return t;case 2:return 0;case 3:return-t}return Math.sin(i)};class O{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof e=="object"?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}add(e){return new O(this.x+e.x,this.y+e.y)}addEquals(e){return this.x+=e.x,this.y+=e.y,this}scalarAdd(e){return new O(this.x+e,this.y+e)}scalarAddEquals(e){return this.x+=e,this.y+=e,this}subtract(e){return new O(this.x-e.x,this.y-e.y)}subtractEquals(e){return this.x-=e.x,this.y-=e.y,this}scalarSubtract(e){return new O(this.x-e,this.y-e)}scalarSubtractEquals(e){return this.x-=e,this.y-=e,this}multiply(e){return new O(this.x*e.x,this.y*e.y)}scalarMultiply(e){return new O(this.x*e,this.y*e)}scalarMultiplyEquals(e){return this.x*=e,this.y*=e,this}divide(e){return new O(this.x/e.x,this.y/e.y)}scalarDivide(e){return new O(this.x/e,this.y/e)}scalarDivideEquals(e){return this.x/=e,this.y/=e,this}eq(e){return this.x===e.x&&this.y===e.y}lt(e){return this.x<e.x&&this.y<e.y}lte(e){return this.x<=e.x&&this.y<=e.y}gt(e){return this.x>e.x&&this.y>e.y}gte(e){return this.x>=e.x&&this.y>=e.y}lerp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return t=Math.max(Math.min(1,t),0),new O(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)}distanceFrom(e){const t=this.x-e.x,s=this.y-e.y;return Math.sqrt(t*t+s*s)}midPointFrom(e){return this.lerp(e)}min(e){return new O(Math.min(this.x,e.x),Math.min(this.y,e.y))}max(e){return new O(Math.max(this.x,e.x),Math.max(this.y,e.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(e,t){return this.x=e,this.y=t,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setFromPoint(e){return this.x=e.x,this.y=e.y,this}swap(e){const t=this.x,s=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=s}clone(){return new O(this.x,this.y)}rotate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jo;const s=Kt(e),r=qt(e),n=this.subtract(t);return new O(n.x*r-n.y*s,n.x*s+n.y*r).add(t)}transform(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new O(e[0]*this.x+e[2]*this.y+(t?0:e[4]),e[1]*this.x+e[3]*this.y+(t?0:e[5]))}}const jo=new O(0,0),wr=i=>!!i&&Array.isArray(i._objects);function Rc(i){class e extends i{constructor(){super(...arguments),w(this,"_objects",[])}_onObjectAdded(s){}_onObjectRemoved(s){}_onStackOrderChanged(s){}add(){for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];const o=this._objects.push(...r);return r.forEach(a=>this._onObjectAdded(a)),o}insertAt(s){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return this._objects.splice(s,0,...n),n.forEach(a=>this._onObjectAdded(a)),this._objects.length}remove(){const s=this._objects,r=[];for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return o.forEach(l=>{const c=s.indexOf(l);c!==-1&&(s.splice(c,1),r.push(l),this._onObjectRemoved(l))}),r}forEachObject(s){this.getObjects().forEach((r,n,o)=>s(r,n,o))}getObjects(){for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return r.length===0?[...this._objects]:this._objects.filter(o=>o.isType(...r))}item(s){return this._objects[s]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(s,r){return!!this._objects.includes(s)||!!r&&this._objects.some(n=>n instanceof e&&n.contains(s,!0))}complexity(){return this._objects.reduce((s,r)=>s+=r.complexity?r.complexity():0,0)}sendObjectToBack(s){return!(!s||s===this._objects[0])&&(Fs(this._objects,s),this._objects.unshift(s),this._onStackOrderChanged(s),!0)}bringObjectToFront(s){return!(!s||s===this._objects[this._objects.length-1])&&(Fs(this._objects,s),this._objects.push(s),this._onStackOrderChanged(s),!0)}sendObjectBackwards(s,r){if(!s)return!1;const n=this._objects.indexOf(s);if(n!==0){const o=this.findNewLowerIndex(s,n,r);return Fs(this._objects,s),this._objects.splice(o,0,s),this._onStackOrderChanged(s),!0}return!1}bringObjectForward(s,r){if(!s)return!1;const n=this._objects.indexOf(s);if(n!==this._objects.length-1){const o=this.findNewUpperIndex(s,n,r);return Fs(this._objects,s),this._objects.splice(o,0,s),this._onStackOrderChanged(s),!0}return!1}moveObjectTo(s,r){return s!==this._objects[r]&&(Fs(this._objects,s),this._objects.splice(r,0,s),this._onStackOrderChanged(s),!0)}findNewLowerIndex(s,r,n){let o;if(n){o=r;for(let a=r-1;a>=0;--a)if(s.isOverlapping(this._objects[a])){o=a;break}}else o=r-1;return o}findNewUpperIndex(s,r,n){let o;if(n){o=r;for(let a=r+1;a<this._objects.length;++a)if(s.isOverlapping(this._objects[a])){o=a;break}}else o=r+1;return o}collectObjects(s){let{left:r,top:n,width:o,height:a}=s,{includeIntersecting:l=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c=[],h=new O(r,n),u=h.add(new O(o,a));for(let d=this._objects.length-1;d>=0;d--){const g=this._objects[d];g.selectable&&g.visible&&(l&&g.intersectsWithRect(h,u)||g.isContainedWithinRect(h,u)||l&&g.containsPoint(h)||l&&g.containsPoint(u))&&c.push(g)}return c}}return e}class zc extends Ff{_setOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const t in e)this.set(t,e[t])}_setObject(e){for(const t in e)this._set(t,e[t])}set(e,t){return typeof e=="object"?this._setObject(e):this._set(e,t),this}_set(e,t){this[e]=t}toggle(e){const t=this.get(e);return typeof t=="boolean"&&this.set(e,!t),this}get(e){return this[e]}}function xr(i){return Yr().requestAnimationFrame(i)}function jf(i){return Yr().cancelAnimationFrame(i)}let Lf=0;const cs=()=>Lf++,Jt=()=>{const i=Js().createElement("canvas");if(!i||i.getContext===void 0)throw new At("Failed to create `canvas` element");return i},If=()=>Js().createElement("img"),yt=i=>{const e=Jt();return e.width=i.width,e.height=i.height,e},Bc=(i,e,t)=>i.toDataURL("image/".concat(e),t),$c=(i,e,t)=>new Promise((s,r)=>{i.toBlob(s,"image/".concat(e),t)}),je=i=>i*Po,Zt=i=>i/Po,Rf=i=>i.every((e,t)=>e===et[t]),st=(i,e,t)=>new O(i).transform(e,t),St=i=>{const e=1/(i[0]*i[3]-i[1]*i[2]),t=[e*i[3],-e*i[1],-e*i[2],e*i[0],0,0],{x:s,y:r}=new O(i[4],i[5]).transform(t,!0);return t[4]=-s,t[5]=-r,t},Ke=(i,e,t)=>[i[0]*e[0]+i[2]*e[1],i[1]*e[0]+i[3]*e[1],i[0]*e[2]+i[2]*e[3],i[1]*e[2]+i[3]*e[3],t?0:i[0]*e[4]+i[2]*e[5]+i[4],t?0:i[1]*e[4]+i[3]*e[5]+i[5]],Lo=(i,e)=>i.reduceRight((t,s)=>s&&t?Ke(s,t,e):s||t,void 0)||et.concat(),Vc=i=>{let[e,t]=i;return Math.atan2(t,e)},Fr=i=>{const e=Vc(i),t=Math.pow(i[0],2)+Math.pow(i[1],2),s=Math.sqrt(t),r=(i[0]*i[3]-i[2]*i[1])/s,n=Math.atan2(i[0]*i[2]+i[1]*i[3],t);return{angle:Zt(e),scaleX:s,scaleY:r,skewX:Zt(n),skewY:0,translateX:i[4]||0,translateY:i[5]||0}},zi=function(i){return[1,0,0,1,i,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function ei(){let{angle:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:e=0,y:t=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=je(i),r=qt(s),n=Kt(s);return[r,n,-n,r,e?e-(r*e-n*t):0,t?t-(n*e+r*t):0]}const Io=function(i){return[i,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:i,0,0]},Wc=i=>Math.tan(je(i)),Hc=i=>[1,0,Wc(i),1,0,0],Uc=i=>[1,Wc(i),0,1,0,0],Kr=i=>{let{scaleX:e=1,scaleY:t=1,flipX:s=!1,flipY:r=!1,skewX:n=0,skewY:o=0}=i,a=Io(s?-e:e,r?-t:t);return n&&(a=Ke(a,Hc(n),!0)),o&&(a=Ke(a,Uc(o),!0)),a},zf=i=>{const{translateX:e=0,translateY:t=0,angle:s=0}=i;let r=zi(e,t);s&&(r=Ke(r,ei({angle:s})));const n=Kr(i);return Rf(n)||(r=Ke(r,n)),r},Cr=function(i){let{signal:e,crossOrigin:t=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(s,r){if(e&&e.aborted)return r(new Ef("loadImage"));const n=If();let o;e&&(o=function(l){n.src="",r(l)},e.addEventListener("abort",o,{once:!0}));const a=function(){n.onload=n.onerror=null,o&&(e==null||e.removeEventListener("abort",o)),s(n)};i?(n.onload=a,n.onerror=function(){o&&(e==null||e.removeEventListener("abort",o)),r(new At("Error loading ".concat(n.src)))},t&&(n.crossOrigin=t),n.src=i):a()})},ki=function(i){let{signal:e,reviver:t=_r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((s,r)=>{const n=[];e&&e.addEventListener("abort",r,{once:!0}),Promise.all(i.map(o=>$.getClass(o.type).fromObject(o,{signal:e}).then(a=>(t(o,a),n.push(a),a)))).then(s).catch(o=>{n.forEach(a=>{a.dispose&&a.dispose()}),r(o)}).finally(()=>{e&&e.removeEventListener("abort",r)})})},Jr=function(i){let{signal:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((t,s)=>{const r=[];e&&e.addEventListener("abort",s,{once:!0});const n=Object.values(i).map(a=>a&&a.type&&$.has(a.type)?ki([a],{signal:e}).then(l=>{let[c]=l;return r.push(c),c}):a),o=Object.keys(i);Promise.all(n).then(a=>a.reduce((l,c,h)=>(l[o[h]]=c,l),{})).then(t).catch(a=>{r.forEach(l=>{l.dispose&&l.dispose()}),s(a)}).finally(()=>{e&&e.removeEventListener("abort",s)})})},ti=function(i){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((e,t)=>(t in i&&(e[t]=i[t]),e),{})},Ro=(i,e)=>Object.keys(i).reduce((t,s)=>(e(i[s],s,i)&&(t[s]=i[s]),t),{}),Ce=(i,e)=>parseFloat(Number(i).toFixed(e)),Ti=i=>"matrix("+i.map(e=>Ce(e,ue.NUM_FRACTION_DIGITS)).join(" ")+")",ft=i=>!!i&&i.toLive!==void 0,Ba=i=>!!i&&typeof i.toObject=="function",$a=i=>!!i&&i.offsetX!==void 0&&"source"in i,bs=i=>!!i&&"multiSelectionStacking"in i;function Xc(i){const e=i&&Ct(i);let t=0,s=0;if(!i||!e)return{left:t,top:s};let r=i;const n=e.documentElement,o=e.body||{scrollLeft:0,scrollTop:0};for(;r&&(r.parentNode||r.host)&&(r=r.parentNode||r.host,r===e?(t=o.scrollLeft||n.scrollLeft||0,s=o.scrollTop||n.scrollTop||0):(t+=r.scrollLeft||0,s+=r.scrollTop||0),r.nodeType!==1||r.style.position!=="fixed"););return{left:t,top:s}}const Ct=i=>i.ownerDocument||null,Yc=i=>{var e;return((e=i.ownerDocument)===null||e===void 0?void 0:e.defaultView)||null},Gc=function(i,e,t){let{width:s,height:r}=t,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;i.width=s,i.height=r,n>1&&(i.setAttribute("width",(s*n).toString()),i.setAttribute("height",(r*n).toString()),e.scale(n,n))},Wn=(i,e)=>{let{width:t,height:s}=e;t&&(i.style.width=typeof t=="number"?"".concat(t,"px"):t),s&&(i.style.height=typeof s=="number"?"".concat(s,"px"):s)};function Va(i){return i.onselectstart!==void 0&&(i.onselectstart=()=>!1),i.style.userSelect=rt,i}class qc{constructor(e){w(this,"_originalCanvasStyle",void 0),w(this,"lower",void 0);const t=this.createLowerCanvas(e);this.lower={el:t,ctx:t.getContext("2d")}}createLowerCanvas(e){const t=(s=e)&&s.getContext!==void 0?e:e&&Js().getElementById(e)||Jt();var s;if(t.hasAttribute("data-fabric"))throw new At("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=t.style.cssText,t.setAttribute("data-fabric","main"),t.classList.add("lower-canvas"),t}cleanupDOM(e){let{width:t,height:s}=e;const{el:r}=this.lower;r.classList.remove("lower-canvas"),r.removeAttribute("data-fabric"),r.setAttribute("width","".concat(t)),r.setAttribute("height","".concat(s)),r.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(e,t){const{el:s,ctx:r}=this.lower;Gc(s,r,e,t)}setCSSDimensions(e){Wn(this.lower.el,e)}calcOffset(){return function(e){var t;const s=e&&Ct(e),r={left:0,top:0};if(!s)return r;const n=((t=Yc(e))===null||t===void 0?void 0:t.getComputedStyle(e,null))||{};r.left+=parseInt(n.borderLeftWidth,10)||0,r.top+=parseInt(n.borderTopWidth,10)||0,r.left+=parseInt(n.paddingLeft,10)||0,r.top+=parseInt(n.paddingTop,10)||0;let o={left:0,top:0};const a=s.documentElement;e.getBoundingClientRect!==void 0&&(o=e.getBoundingClientRect());const l=Xc(e);return{left:o.left+l.left-(a.clientLeft||0)+r.left,top:o.top+l.top-(a.clientTop||0)+r.top}}(this.lower.el)}dispose(){Nt().dispose(this.lower.el),delete this.lower}}const Bf={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...et]};class Bi extends Rc(zc){get lowerCanvasEl(){var e;return(e=this.elements.lower)===null||e===void 0?void 0:e.el}get contextContainer(){var e;return(e=this.elements.lower)===null||e===void 0?void 0:e.ctx}static getDefaults(){return Bi.ownDefaults}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(t),this.initElements(e),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(e){this.elements=new qc(e)}add(){const e=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}insertAt(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];const n=super.insertAt(e,...s);return s.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),n}remove(){const e=super.remove(...arguments);return e.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}_onObjectAdded(e){e.canvas&&e.canvas!==this&&(ls("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),e.canvas.remove(e)),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e){e._set("canvas",void 0),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?Fc():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(e,t){return this.setDimensions({width:e},t)}setHeight(e,t){return this.setDimensions({height:e},t)}_setDimensionsImpl(e){let{cssOnly:t=!1,backstoreOnly:s=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t){const r=x({width:this.width,height:this.height},e);this.elements.setDimensions(r,this.getRetinaScaling()),this.hasLostContext=!0,this.width=r.width,this.height=r.height}s||this.elements.setCSSDimensions(e),this.calcOffset()}setDimensions(e,t){this._setDimensionsImpl(e,t),t&&t.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(e){this.viewportTransform=e,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(e,t){const s=e,r=[...this.viewportTransform],n=st(e,St(r));r[0]=t,r[3]=t;const o=st(n,r);r[4]+=s.x-o.x,r[5]+=s.y-o.y,this.setViewportTransform(r)}setZoom(e){this.zoomToPoint(new O(0,0),e)}absolutePan(e){const t=[...this.viewportTransform];return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)}relativePan(e){return this.absolutePan(new O(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(e){e.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=xr(()=>this.renderAndReset()))}calcViewportBoundaries(){const e=this.width,t=this.height,s=St(this.viewportTransform),r=st({x:0,y:0},s),n=st({x:e,y:t},s),o=r.min(n),a=r.max(n);return this.vptCoords={tl:o,tr:new O(a.x,o.y),bl:new O(o.x,a.y),br:a}}cancelRequestedRender(){this.nextRenderHandle&&(jf(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(e){}renderCanvas(e,t){if(this.destroyed)return;const s=this.viewportTransform,r=this.clipPath;this.calcViewportBoundaries(),this.clearContext(e),e.imageSmoothingEnabled=this.imageSmoothingEnabled,e.patternQuality="best",this.fire("before:render",{ctx:e}),this._renderBackground(e),e.save(),e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._renderObjects(e,t),e.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(e),r&&(r._set("canvas",this),r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e,r)),this._renderOverlay(e),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(e),this.fire("after:render",{ctx:e}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(e,t){const s=this.viewportTransform;e.save(),e.transform(...s),e.globalCompositeOperation="destination-in",t.transform(e),e.scale(1/t.zoomX,1/t.zoomY),e.drawImage(t._cacheCanvas,-t.cacheTranslationX,-t.cacheTranslationY),e.restore()}_renderObjects(e,t){for(let s=0,r=t.length;s<r;++s)t[s]&&t[s].render(e)}_renderBackgroundOrOverlay(e,t){const s=this["".concat(t,"Color")],r=this["".concat(t,"Image")],n=this.viewportTransform,o=this["".concat(t,"Vpt")];if(!s&&!r)return;const a=ft(s);if(s){if(e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.closePath(),e.fillStyle=a?s.toLive(e):s,o&&e.transform(...n),a){e.transform(1,0,0,1,s.offsetX||0,s.offsetY||0);const l=s.gradientTransform||s.patternTransform;l&&e.transform(...l)}e.fill(),e.restore()}if(r){e.save();const{skipOffscreen:l}=this;this.skipOffscreen=o,o&&e.transform(...n),r.render(e),this.skipOffscreen=l,e.restore()}}_renderBackground(e){this._renderBackgroundOrOverlay(e,"background")}_renderOverlay(e){this._renderBackgroundOrOverlay(e,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new O(this.width/2,this.height/2)}centerObjectH(e){return this._centerObject(e,new O(this.getCenterPoint().x,e.getCenterPoint().y))}centerObjectV(e){return this._centerObject(e,new O(e.getCenterPoint().x,this.getCenterPoint().y))}centerObject(e){return this._centerObject(e,this.getCenterPoint())}viewportCenterObject(e){return this._centerObject(e,this.getVpCenter())}viewportCenterObjectH(e){return this._centerObject(e,new O(this.getVpCenter().x,e.getCenterPoint().y))}viewportCenterObjectV(e){return this._centerObject(e,new O(e.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return st(this.getCenterPoint(),St(this.viewportTransform))}_centerObject(e,t){e.setXY(t,re,re),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(e){return this.toDatalessObject(e)}toObject(e){return this._toObjectMethod("toObject",e)}toJSON(){return this.toObject()}toDatalessObject(e){return this._toObjectMethod("toDatalessObject",e)}_toObjectMethod(e,t){const s=this.clipPath,r=s&&!s.excludeFromExport?this._toObject(s,e,t):null;return x(x(x({version:$n},ti(this,t)),{},{objects:this._objects.filter(n=>!n.excludeFromExport).map(n=>this._toObject(n,e,t))},this.__serializeBgOverlay(e,t)),r?{clipPath:r}:null)}_toObject(e,t,s){let r;this.includeDefaultValues||(r=e.includeDefaultValues,e.includeDefaultValues=!1);const n=e[t](s);return this.includeDefaultValues||(e.includeDefaultValues=!!r),n}__serializeBgOverlay(e,t){const s={},r=this.backgroundImage,n=this.overlayImage,o=this.backgroundColor,a=this.overlayColor;return ft(o)?o.excludeFromExport||(s.background=o.toObject(t)):o&&(s.background=o),ft(a)?a.excludeFromExport||(s.overlay=a.toObject(t)):a&&(s.overlay=a),r&&!r.excludeFromExport&&(s.backgroundImage=this._toObject(r,e,t)),n&&!n.excludeFromExport&&(s.overlayImage=this._toObject(n,e,t)),s}toSVG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.reviver=t;const s=[];return this._setSVGPreamble(s,e),this._setSVGHeader(s,e),this.clipPath&&s.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(s,"background"),this._setSVGBgOverlayImage(s,"backgroundImage",t),this._setSVGObjects(s,t),this.clipPath&&s.push(`</g>
`),this._setSVGBgOverlayColor(s,"overlay"),this._setSVGBgOverlayImage(s,"overlayImage",t),s.push("</svg>"),s.join("")}_setSVGPreamble(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(e,t){const s=t.width||"".concat(this.width),r=t.height||"".concat(this.height),n=ue.NUM_FRACTION_DIGITS,o=t.viewBox;let a;if(o)a='viewBox="'.concat(o.x," ").concat(o.y," ").concat(o.width," ").concat(o.height,'" ');else if(this.svgViewportTransformation){const l=this.viewportTransform;a='viewBox="'.concat(Ce(-l[4]/l[0],n)," ").concat(Ce(-l[5]/l[3],n)," ").concat(Ce(this.width/l[0],n)," ").concat(Ce(this.height/l[3],n),'" ')}else a='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',s,'" ','height="',r,'" ',a,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",$n,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),`</defs>
`)}createSVGClipPathMarkup(e){const t=this.clipPath;return t?(t.clipPathId="CLIPPATH_".concat(cs()),'<clipPath id="'.concat(t.clipPathId,`" >
`).concat(t.toClipPathSVG(e.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map(e=>{const t=this["".concat(e,"Color")];if(ft(t)){const s=this["".concat(e,"Vpt")],r=this.viewportTransform,n={isType:()=>!1,width:this.width/(s?r[0]:1),height:this.height/(s?r[3]:1)};return t.toSVG(n,{additionalTransform:s?Ti(r):""})}}).join("")}createSVGFontFacesMarkup(){const e=[],t={},s=ue.fontPaths;this._objects.forEach(function n(o){e.push(o),wr(o)&&o._objects.forEach(n)}),e.forEach(n=>{if(!(o=n)||typeof o._renderText!="function")return;var o;const{styles:a,fontFamily:l}=n;!t[l]&&s[l]&&(t[l]=!0,a&&Object.values(a).forEach(c=>{Object.values(c).forEach(h=>{let{fontFamily:u=""}=h;!t[u]&&s[u]&&(t[u]=!0)})}))});const r=Object.keys(t).map(n=>`		@font-face {
			font-family: '`.concat(n,`';
			src: url('`).concat(s[n],`');
		}
`)).join("");return r?`	<style type="text/css"><![CDATA[
`.concat(r,`]]></style>
`):""}_setSVGObjects(e,t){this.forEachObject(s=>{s.excludeFromExport||this._setSVGObject(e,s,t)})}_setSVGObject(e,t,s){e.push(t.toSVG(s))}_setSVGBgOverlayImage(e,t,s){const r=this[t];r&&!r.excludeFromExport&&r.toSVG&&e.push(r.toSVG(s))}_setSVGBgOverlayColor(e,t){const s=this["".concat(t,"Color")];if(s)if(ft(s)){const r=s.repeat||"",n=this.width,o=this.height,a=this["".concat(t,"Vpt")]?Ti(St(this.viewportTransform)):"";e.push('<rect transform="'.concat(a," translate(").concat(n/2,",").concat(o/2,')" x="').concat(s.offsetX-n/2,'" y="').concat(s.offsetY-o/2,'" width="').concat(r!=="repeat-y"&&r!=="no-repeat"||!$a(s)?n:s.source.width,'" height="').concat(r!=="repeat-x"&&r!=="no-repeat"||!$a(s)?o:s.source.height,'" fill="url(#SVGID_').concat(s.id,`)"></rect>
`))}else e.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',s,'"',`></rect>
`)}loadFromJSON(e,t){let{signal:s}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!e)return Promise.reject(new At("`json` is undefined"));const r=typeof e=="string"?JSON.parse(e):e,{objects:n=[],backgroundImage:o,background:a,overlayImage:l,overlay:c,clipPath:h}=r,u=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([ki(n,{reviver:t,signal:s}),Jr({backgroundImage:o,backgroundColor:a,overlayImage:l,overlayColor:c,clipPath:h},{signal:s})]).then(d=>{let[g,p]=d;return this.clear(),this.add(...g),this.set(r),this.set(p),this.renderOnAddRemove=u,this})}clone(e){const t=this.toObject(e);return this.cloneWithoutData().loadFromJSON(t)}cloneWithoutData(){const e=yt(this);return new this.constructor(e)}toDataURL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:t="png",quality:s=1,multiplier:r=1,enableRetinaScaling:n=!1}=e,o=r*(n?this.getRetinaScaling():1);return Bc(this.toCanvasElement(o,e),t,s)}toBlob(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:t="png",quality:s=1,multiplier:r=1,enableRetinaScaling:n=!1}=e,o=r*(n?this.getRetinaScaling():1);return $c(this.toCanvasElement(o,e),t,s)}toCanvasElement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:t,height:s,left:r,top:n,filter:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=(t||this.width)*e,l=(s||this.height)*e,c=this.getZoom(),h=this.width,u=this.height,d=this.skipControlsDrawing,g=c*e,p=this.viewportTransform,y=[g,0,0,g,(p[4]-(r||0))*e,(p[5]-(n||0))*e],v=this.enableRetinaScaling,_=yt({width:a,height:l}),f=o?this._objects.filter(S=>o(S)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=y,this.width=a,this.height=l,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(_.getContext("2d"),f),this.viewportTransform=p,this.width=h,this.height=u,this.calcViewportBoundaries(),this.enableRetinaScaling=v,this.skipControlsDrawing=d,_}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),Nr.cancelByCanvas(this),this.disposed=!0,new Promise((e,t)=>{const s=()=>{this.destroy(),e(!0)};s.kill=t,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?e(!1):this.nextRenderHandle?this.__cleanupTask=s:s()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(e=>e.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}w(Bi,"ownDefaults",Bf);const $f=["touchstart","touchmove","touchend"],Vf=i=>{const e=Xc(i.target),t=function(s){const r=s.changedTouches;return r&&r[0]?r[0]:s}(i);return new O(t.clientX+e.left,t.clientY+e.top)},Hn=i=>$f.includes(i.type)||i.pointerType==="touch",Wa=i=>{i.preventDefault(),i.stopPropagation()},Ut=i=>{let e=0,t=0,s=0,r=0;for(let n=0,o=i.length;n<o;n++){const{x:a,y:l}=i[n];(a>s||!n)&&(s=a),(a<e||!n)&&(e=a),(l>r||!n)&&(r=l),(l<t||!n)&&(t=l)}return{left:e,top:t,width:s-e,height:r-t}},Wf=["translateX","translateY","scaleX","scaleY"],Hf=(i,e)=>jr(i,Ke(e,i.calcOwnMatrix())),jr=(i,e)=>{const t=Fr(e),{translateX:s,translateY:r,scaleX:n,scaleY:o}=t,a=ke(t,Wf),l=new O(s,r);i.flipX=!1,i.flipY=!1,Object.assign(i,a),i.set({scaleX:n,scaleY:o}),i.setPositionByOrigin(l,re,re)},Uf=i=>{i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},Kc=i=>({scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}),zo=(i,e,t)=>{const s=i/2,r=e/2,n=[new O(-s,-r),new O(s,-r),new O(-s,r),new O(s,r)].map(a=>a.transform(t)),o=Ut(n);return new O(o.width,o.height)},Zr=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:et;return Ke(St(arguments.length>1&&arguments[1]!==void 0?arguments[1]:et),i)},Bs=function(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:et,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:et;return i.transform(Zr(e,t))},Xf=function(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:et,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:et;return i.transform(Zr(e,t),!0)},Yf=(i,e,t)=>{const s=Zr(e,t);return jr(i,Ke(s,i.calcOwnMatrix())),s},Jc=(i,e)=>{var t;const{transform:{target:s}}=e;(t=s.canvas)===null||t===void 0||t.fire("object:".concat(i),x(x({},e),{},{target:s})),s.fire(i,e)},Gf={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Re=i=>typeof i=="string"?Gf[i]:i-.5,Lr="not-allowed";function Zc(i){return Re(i.originX)===Re(re)&&Re(i.originY)===Re(re)}function Ha(i){return .5-Re(i)}const Ot=(i,e)=>i[e],Qc=(i,e,t,s)=>({e:i,transform:e,pointer:new O(t,s)});function eh(i,e){const t=i.getTotalAngle()+Zt(Math.atan2(e.y,e.x))+360;return Math.round(t%360/45)}function Bo(i,e,t,s,r){var n;let{target:o,corner:a}=i;const l=o.controls[a],c=((n=o.canvas)===null||n===void 0?void 0:n.getZoom())||1,h=o.padding/c,u=function(d,g,p,y){const v=d.getRelativeCenterPoint(),_=p!==void 0&&y!==void 0?d.translateToGivenOrigin(v,re,re,p,y):new O(d.left,d.top);return(d.angle?g.rotate(-je(d.angle),v):g).subtract(_)}(o,new O(s,r),e,t);return u.x>=h&&(u.x-=h),u.x<=-h&&(u.x+=h),u.y>=h&&(u.y-=h),u.y<=h&&(u.y+=h),u.x-=l.offsetX,u.y-=l.offsetY,u}const qf=(i,e,t,s)=>{const{target:r,offsetX:n,offsetY:o}=e,a=t-n,l=s-o,c=!Ot(r,"lockMovementX")&&r.left!==a,h=!Ot(r,"lockMovementY")&&r.top!==l;return c&&r.set(ye,a),h&&r.set(it,l),(c||h)&&Jc(jc,Qc(i,e,t,s)),c||h},Ua={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},mn=(i,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+6*(e-i)*t:t<.5?e:t<2/3?i+(e-i)*(2/3-t)*6:i),Xa=(i,e,t,s)=>{i/=255,e/=255,t/=255;const r=Math.max(i,e,t),n=Math.min(i,e,t);let o,a;const l=(r+n)/2;if(r===n)o=a=0;else{const c=r-n;switch(a=l>.5?c/(2-r-n):c/(r+n),r){case i:o=(e-t)/c+(e<t?6:0);break;case e:o=(t-i)/c+2;break;case t:o=(i-e)/c+4}o/=6}return[Math.round(360*o),Math.round(100*a),Math.round(100*l),s]},Ya=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(i)/(i.endsWith("%")?100:1)},Gi=i=>Math.min(Math.round(i),255).toString(16).toUpperCase().padStart(2,"0"),Ga=i=>{let[e,t,s,r=1]=i;const n=Math.round(.3*e+.59*t+.11*s);return[n,n,n,r]};class be{constructor(e){if(w(this,"isUnrecognised",!1),e)if(e instanceof be)this.setSource([...e._source]);else if(Array.isArray(e)){const[t,s,r,n=1]=e;this.setSource([t,s,r,n])}else this.setSource(this._tryParsingColor(e));else this.setSource([0,0,0,1])}_tryParsingColor(e){return(e=e.toLowerCase())in Ua&&(e=Ua[e]),e==="transparent"?[255,255,255,0]:be.sourceFromHex(e)||be.sourceFromRgb(e)||be.sourceFromHsl(e)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(e){this._source=e}toRgb(){const[e,t,s]=this.getSource();return"rgb(".concat(e,",").concat(t,",").concat(s,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[e,t,s]=Xa(...this.getSource());return"hsl(".concat(e,",").concat(t,"%,").concat(s,"%)")}toHsla(){const[e,t,s,r]=Xa(...this.getSource());return"hsla(".concat(e,",").concat(t,"%,").concat(s,"%,").concat(r,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[e,t,s,r]=this.getSource();return"".concat(Gi(e)).concat(Gi(t)).concat(Gi(s)).concat(Gi(Math.round(255*r)))}getAlpha(){return this.getSource()[3]}setAlpha(e){return this._source[3]=e,this}toGrayscale(){return this.setSource(Ga(this.getSource())),this}toBlackWhite(e){const[t,,,s]=Ga(this.getSource()),r=t<(e||127)?0:255;return this.setSource([r,r,r,s]),this}overlayWith(e){e instanceof be||(e=new be(e));const t=this.getSource(),s=e.getSource(),[r,n,o]=t.map((a,l)=>Math.round(.5*a+.5*s[l]));return this.setSource([r,n,o,t[3]]),this}static fromRgb(e){return be.fromRgba(e)}static fromRgba(e){return new be(be.sourceFromRgb(e))}static sourceFromRgb(e){const t=e.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(t){const[s,r,n]=t.slice(1,4).map(o=>{const a=parseFloat(o);return o.endsWith("%")?Math.round(2.55*a):a});return[s,r,n,Ya(t[4])]}}static fromHsl(e){return be.fromHsla(e)}static fromHsla(e){return new be(be.sourceFromHsl(e))}static sourceFromHsl(e){const t=e.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!t)return;const s=(be.parseAngletoDegrees(t[1])%360+360)%360/360,r=parseFloat(t[2])/100,n=parseFloat(t[3])/100;let o,a,l;if(r===0)o=a=l=n;else{const c=n<=.5?n*(r+1):n+r-n*r,h=2*n-c;o=mn(h,c,s+1/3),a=mn(h,c,s),l=mn(h,c,s-1/3)}return[Math.round(255*o),Math.round(255*a),Math.round(255*l),Ya(t[4])]}static fromHex(e){return new be(be.sourceFromHex(e))}static sourceFromHex(e){if(e.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const t=e.slice(e.indexOf("#")+1);let s;s=t.length<=4?t.split("").map(l=>l+l):t.match(/.{2}/g);const[r,n,o,a=255]=s.map(l=>parseInt(l,16));return[r,n,o,a/255]}}static parseAngletoDegrees(e){const t=e.toLowerCase(),s=parseFloat(t);return t.includes("rad")?Zt(s):t.includes("turn")?360*s:s}}const $s=function(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ao;const t=/\D{0,2}$/.exec(i),s=parseFloat(i),r=ue.DPI;switch(t==null?void 0:t[0]){case"mm":return s*r/25.4;case"cm":return s*r/2.54;case"in":return s*r;case"pt":return s*r/72;case"pc":return s*r/72*12;case"em":return s*e;default:return s}},Kf=i=>{const[e,t]=i.trim().split(" "),[s,r]=(n=e)&&n!==rt?[n.slice(1,4),n.slice(5,8)]:n===rt?[n,n]:["Mid","Mid"];var n;return{meetOrSlice:t||"meet",alignX:s,alignY:r}},Oi=function(i,e){let t,s,r=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(e)if(e.toLive)t="url(#SVGID_".concat(e.id,")");else{const n=new be(e),o=n.getAlpha();t=n.toRgb(),o!==1&&(s=o.toString())}else t="none";return r?"".concat(i,": ").concat(t,"; ").concat(s?"".concat(i,"-opacity: ").concat(s,"; "):""):"".concat(i,'="').concat(t,'" ').concat(s?"".concat(i,'-opacity="').concat(s,'" '):"")};class th{getSvgStyles(e){const t=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):rt,n=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=this.opacity!==void 0?this.opacity:"1",h=this.visible?"":" visibility: hidden;",u=e?"":this.getSvgFilter(),d=Oi(Ve,this.fill);return[Oi(nt,this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",l,"; ",d,"fill-rule: ",t,"; ","opacity: ",c,";",u,h].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'.concat(Ti(s));return"".concat(r).concat(t,'" ')}_toSVG(e){return[""]}toSVG(e){return this._createBaseSVGMarkup(this._toSVG(e),{reviver:e})}toClipPathSVG(e){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(e),{reviver:e})}_createBaseClipPathSVGMarkup(e){let{reviver:t,additionalTransform:s=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),n=e.indexOf("COMMON_PARTS");return e[n]=r,t?t(e.join("")):e.join("")}_createBaseSVGMarkup(e){let{noStyle:t,reviver:s,withShadow:r,additionalTransform:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=t?"":'style="'.concat(this.getSvgStyles(),'" '),a=r?'style="'.concat(this.getSvgFilter(),'" '):"",l=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=l&&l.absolutePositioned,u=this.stroke,d=this.fill,g=this.shadow,p=[],y=e.indexOf("COMMON_PARTS");let v;l&&(l.clipPathId="CLIPPATH_".concat(cs()),v='<clipPath id="'.concat(l.clipPathId,`" >
`).concat(l.toClipPathSVG(s),`</clipPath>
`)),h&&p.push("<g ",a,this.getSvgCommons(),` >
`),p.push("<g ",this.getSvgTransform(!1),h?"":a+this.getSvgCommons(),` >
`);const _=[o,c,t?"":this.addPaintOrder()," ",n?'transform="'.concat(n,'" '):""].join("");return e[y]=_,ft(d)&&p.push(d.toSVG(this)),ft(u)&&p.push(u.toSVG(this)),g&&p.push(g.toSVG(this)),l&&p.push(v),p.push(e.join("")),p.push(`</g>
`),h&&p.push(`</g>
`),s?s(p.join("")):p.join("")}addPaintOrder(){return this.paintFirst!==Ve?' paint-order="'.concat(this.paintFirst,'" '):""}}function Qr(i){return new RegExp("^("+i.join("|")+")\\b","i")}const Ts="textDecorationThickness",sh=["fontSize","fontWeight","fontFamily","fontStyle"],ih=["underline","overline","linethrough"],rh=[...sh,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],nh=[...rh,...ih,"textBackgroundColor","direction",Ts],Jf=[...sh,...ih,nt,"strokeWidth",Ve,"deltaY","textBackgroundColor",Ts],Zf={_reNewline:No,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:ye,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:ye,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[Ts]:66.667},Mt="justify",Ir="justify-left",vi="justify-right",_i="justify-center";var qa,Ka,Ja;const kt=String.raw(qa||(qa=Ft(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),yn=String.raw(Ka||(Ka=Ft(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),Qf=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+kt+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+kt+"))?\\s+(.*)"),ep={cx:ye,x:ye,r:"radius",cy:it,y:it,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":Ts},bn="font-size",vn="clip-path";Qr(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);Qr(["symbol","image","marker","pattern","view","svg"]);const Za=Qr(["symbol","g","a","svg","clipPath","defs"]);new RegExp(String.raw(Ja||(Ja=Ft(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),kt,yn,kt,yn,kt,yn,kt));const tp=new O(1,0),oh=new O,ah=(i,e)=>i.rotate(e),Un=(i,e)=>new O(e).subtract(i),Xn=i=>i.distanceFrom(oh),Yn=(i,e)=>Math.atan2(wi(i,e),ip(i,e)),sp=i=>Yn(tp,i),$o=i=>i.eq(oh)?i:i.scalarDivide(Xn(i)),lh=function(i){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return $o(new O(-i.y,i.x).scalarMultiply(e?1:-1))},wi=(i,e)=>i.x*e.y-i.y*e.x,ip=(i,e)=>i.x*e.x+i.y*e.y,Qa=(i,e,t)=>{if(i.eq(e)||i.eq(t))return!0;const s=wi(e,t),r=wi(e,i),n=wi(t,i);return s>=0?r>=0&&n<=0:!(r<=0&&n>=0)},el="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",tl=new RegExp("(?:\\s|^)"+el+el+"("+kt+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Xt{constructor(e){const t=typeof e=="string"?Xt.parseShadow(e):e;Object.assign(this,Xt.ownDefaults,t),this.id=cs()}static parseShadow(e){const t=e.trim(),[,s=0,r=0,n=0]=(tl.exec(t)||[]).map(o=>parseFloat(o)||0);return{color:(t.replace(tl,"")||"rgb(0,0,0)").trim(),offsetX:s,offsetY:r,blur:n}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(e){const t=ah(new O(this.offsetX,this.offsetY),je(-e.angle)),s=new be(this.color);let r=40,n=40;return e.width&&e.height&&(r=100*Ce((Math.abs(t.x)+this.blur)/e.width,ue.NUM_FRACTION_DIGITS)+20,n=100*Ce((Math.abs(t.y)+this.blur)/e.height,ue.NUM_FRACTION_DIGITS)+20),e.flipX&&(t.x*=-1),e.flipY&&(t.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(n,'%" height="').concat(100+2*n,'%" x="-').concat(r,'%" width="').concat(100+2*r,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(Ce(this.blur?this.blur/2:0,ue.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(Ce(t.x,ue.NUM_FRACTION_DIGITS),'" dy="').concat(Ce(t.y,ue.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(s.toRgb(),'" flood-opacity="').concat(s.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const e={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},t=Xt.ownDefaults;return this.includeDefaultValues?e:Ro(e,(s,r)=>s!==t[r])}static async fromObject(e){return new this(e)}}w(Xt,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),w(Xt,"type","shadow"),$.setClass(Xt,"shadow");const Ys=(i,e,t)=>Math.max(i,Math.min(e,t)),rp=[it,ye,ot,mt,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",Zs,Qs],es=[Ve,nt,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],np={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:ye,originY:it,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:Ve,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},op=(i,e,t,s)=>-t*Math.cos(i/s*Ri)+t+e,ap=()=>!1;class Vo{constructor(e){let{startValue:t,byValue:s,duration:r=500,delay:n=0,easing:o=op,onStart:a=_r,onChange:l=_r,onComplete:c=_r,abort:h=ap,target:u}=e;w(this,"_state","pending"),w(this,"durationProgress",0),w(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=r,this.delay=n,this.easing=o,this._onStart=a,this._onChange=l,this._onComplete=c,this._abort=h,this.target=u,this.startValue=t,this.byValue=s,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const e=t=>{this._state==="pending"&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>xr(e),this.delay):xr(e)}tick(e){const t=(e||+new Date)-this.startTime,s=Math.min(t,this.duration);this.durationProgress=s/this.duration;const{value:r,valueProgress:n}=this.calculate(s);this.value=Object.freeze(r),this.valueProgress=n,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):t>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),xr(this.tick)))}register(){Nr.push(this)}unregister(){Nr.remove(this)}abort(){this._state="aborted",this.unregister()}}const lp=["startValue","endValue"];class cp extends Vo{constructor(e){let{startValue:t=0,endValue:s=100}=e;super(x(x({},ke(e,lp)),{},{startValue:t,byValue:s-t}))}calculate(e){const t=this.easing(e,this.startValue,this.byValue,this.duration);return{value:t,valueProgress:Math.abs((t-this.startValue)/this.byValue)}}}const hp=["startValue","endValue"];class up extends Vo{constructor(e){let{startValue:t=[0],endValue:s=[100]}=e;super(x(x({},ke(e,hp)),{},{startValue:t,byValue:s.map((r,n)=>r-t[n])}))}calculate(e){const t=this.startValue.map((s,r)=>this.easing(e,s,this.byValue[r],this.duration,r));return{value:t,valueProgress:Math.abs((t[0]-this.startValue[0])/this.byValue[0])}}}const dp=["startValue","endValue","easing","onChange","onComplete","abort"],gp=(i,e,t,s)=>e+t*(1-Math.cos(i/s*Ri)),_n=i=>i&&((e,t,s)=>i(new be(e).toRgba(),t,s));class fp extends Vo{constructor(e){let{startValue:t,endValue:s,easing:r=gp,onChange:n,onComplete:o,abort:a}=e,l=ke(e,dp);const c=new be(t).getSource(),h=new be(s).getSource();super(x(x({},l),{},{startValue:c,byValue:h.map((u,d)=>u-c[d]),easing:r,onChange:_n(n),onComplete:_n(o),abort:_n(a)}))}calculate(e){const[t,s,r,n]=this.startValue.map((a,l)=>this.easing(e,a,this.byValue[l],this.duration,l)),o=[...[t,s,r].map(Math.round),Ys(0,n,1)];return{value:o,valueProgress:o.map((a,l)=>this.byValue[l]!==0?Math.abs((a-this.startValue[l])/this.byValue[l]):0).find(a=>a!==0)||0}}}function ch(i){const e=(t=>Array.isArray(t.startValue)||Array.isArray(t.endValue))(i)?new up(i):new cp(i);return e.start(),e}function pp(i){const e=new fp(i);return e.start(),e}class Oe{constructor(e){this.status=e,this.points=[]}includes(e){return this.points.some(t=>t.eq(e))}append(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.points=this.points.concat(t.filter(r=>!this.includes(r))),this}static isPointContained(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(t.eq(s))return e.eq(t);if(t.x===s.x)return e.x===t.x&&(r||e.y>=Math.min(t.y,s.y)&&e.y<=Math.max(t.y,s.y));if(t.y===s.y)return e.y===t.y&&(r||e.x>=Math.min(t.x,s.x)&&e.x<=Math.max(t.x,s.x));{const n=Un(t,s),o=Un(t,e).divide(n);return r?Math.abs(o.x)===Math.abs(o.y):o.x===o.y&&o.x>=0&&o.x<=1}}static isPointInPolygon(e,t){const s=new O(e).setX(Math.min(e.x-1,...t.map(n=>n.x)));let r=0;for(let n=0;n<t.length;n++){const o=this.intersectSegmentSegment(t[n],t[(n+1)%t.length],e,s);if(o.includes(e))return!0;r+=+(o.status==="Intersection")}return r%2==1}static intersectLineLine(e,t,s,r){let n=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const a=t.x-e.x,l=t.y-e.y,c=r.x-s.x,h=r.y-s.y,u=e.x-s.x,d=e.y-s.y,g=c*d-h*u,p=a*d-l*u,y=h*a-c*l;if(y!==0){const v=g/y,_=p/y;return(n||0<=v&&v<=1)&&(o||0<=_&&_<=1)?new Oe("Intersection").append(new O(e.x+v*a,e.y+v*l)):new Oe}if(g===0||p===0){const v=n||o||Oe.isPointContained(e,s,r)||Oe.isPointContained(t,s,r)||Oe.isPointContained(s,e,t)||Oe.isPointContained(r,e,t);return new Oe(v?"Coincident":void 0)}return new Oe("Parallel")}static intersectSegmentLine(e,t,s,r){return Oe.intersectLineLine(e,t,s,r,!1,!0)}static intersectSegmentSegment(e,t,s,r){return Oe.intersectLineLine(e,t,s,r,!1,!1)}static intersectLinePolygon(e,t,s){let r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const n=new Oe,o=s.length;for(let a,l,c,h=0;h<o;h++){if(a=s[h],l=s[(h+1)%o],c=Oe.intersectLineLine(e,t,a,l,r,!1),c.status==="Coincident")return c;n.append(...c.points)}return n.points.length>0&&(n.status="Intersection"),n}static intersectSegmentPolygon(e,t,s){return Oe.intersectLinePolygon(e,t,s,!1)}static intersectPolygonPolygon(e,t){const s=new Oe,r=e.length,n=[];for(let o=0;o<r;o++){const a=e[o],l=e[(o+1)%r],c=Oe.intersectSegmentPolygon(a,l,t);c.status==="Coincident"?(n.push(c),s.append(a,l)):s.append(...c.points)}return n.length>0&&n.length===e.length?new Oe("Coincident"):(s.points.length>0&&(s.status="Intersection"),s)}static intersectPolygonRectangle(e,t,s){const r=t.min(s),n=t.max(s),o=new O(n.x,r.y),a=new O(r.x,n.y);return Oe.intersectPolygonPolygon(e,[r,o,n,a])}}class mp extends zc{getX(){return this.getXY().x}setX(e){this.setXY(this.getXY().setX(e))}getY(){return this.getXY().y}setY(e){this.setXY(this.getXY().setY(e))}getRelativeX(){return this.left}setRelativeX(e){this.left=e}getRelativeY(){return this.top}setRelativeY(e){this.top=e}getXY(){const e=this.getRelativeXY();return this.group?st(e,this.group.calcTransformMatrix()):e}setXY(e,t,s){this.group&&(e=st(e,St(this.group.calcTransformMatrix()))),this.setRelativeXY(e,t,s)}getRelativeXY(){return new O(this.left,this.top)}setRelativeXY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(e,t,s)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:e,tr:t,br:s,bl:r}=this.aCoords||(this.aCoords=this.calcACoords()),n=[e,t,s,r];if(this.group){const o=this.group.calcTransformMatrix();return n.map(a=>st(a,o))}return n}intersectsWithRect(e,t){return Oe.intersectPolygonRectangle(this.getCoords(),e,t).status==="Intersection"}intersectsWithObject(e){const t=Oe.intersectPolygonPolygon(this.getCoords(),e.getCoords());return t.status==="Intersection"||t.status==="Coincident"||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)}isContainedWithinObject(e){return this.getCoords().every(t=>e.containsPoint(t))}isContainedWithinRect(e,t){const{left:s,top:r,width:n,height:o}=this.getBoundingRect();return s>=e.x&&s+n<=t.x&&r>=e.y&&r+o<=t.y}isOverlapping(e){return this.intersectsWithObject(e)||this.isContainedWithinObject(e)||e.isContainedWithinObject(this)}containsPoint(e){return Oe.isPointInPolygon(e,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:e,br:t}=this.canvas.vptCoords;return!!this.getCoords().some(s=>s.x<=t.x&&s.x>=e.x&&s.y<=t.y&&s.y>=e.y)||!!this.intersectsWithRect(e,t)||this.containsPoint(e.midPointFrom(t))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:e,br:t}=this.canvas.vptCoords;return this.intersectsWithRect(e,t)?!0:this.getCoords().every(s=>(s.x>=t.x||s.x<=e.x)&&(s.y>=t.y||s.y<=e.y))&&this.containsPoint(e.midPointFrom(t))}getBoundingRect(){return Ut(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(e){this._set(ot,e),this._set(mt,e),this.setCoords()}scaleToWidth(e){const t=this.getBoundingRect().width/this.getScaledWidth();return this.scale(e/this.width/t)}scaleToHeight(e){const t=this.getBoundingRect().height/this.getScaledHeight();return this.scale(e/this.height/t)}getCanvasRetinaScaling(){var e;return((e=this.canvas)===null||e===void 0?void 0:e.getRetinaScaling())||1}getTotalAngle(){return this.group?Zt(Vc(this.calcTransformMatrix())):this.angle}getViewportTransform(){var e;return((e=this.canvas)===null||e===void 0?void 0:e.viewportTransform)||et.concat()}calcACoords(){const e=ei({angle:this.angle}),{x:t,y:s}=this.getRelativeCenterPoint(),r=zi(t,s),n=Ke(r,e),o=this._getTransformedDimensions(),a=o.x/2,l=o.y/2;return{tl:st({x:-a,y:-l},n),tr:st({x:a,y:-l},n),bl:st({x:-a,y:l},n),br:st({x:a,y:l},n)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=[];return!e&&this.group&&(t=this.group.transformMatrixKey(e)),t.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,Re(this.originX),Re(this.originY)),t}calcTransformMatrix(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=this.calcOwnMatrix();if(e||!this.group)return t;const s=this.transformMatrixKey(e),r=this.matrixCache;return r&&r.key.every((n,o)=>n===s[o])?r.value:(this.group&&(t=Ke(this.group.calcTransformMatrix(!1),t)),this.matrixCache={key:s,value:t},t)}calcOwnMatrix(){const e=this.transformMatrixKey(!0),t=this.ownMatrixCache;if(t&&t.key===e)return t.value;const s=this.getRelativeCenterPoint(),r={angle:this.angle,translateX:s.x,translateY:s.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},n=zf(r);return this.ownMatrixCache={key:e,value:n},n}_getNonTransformedDimensions(){return new O(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(e){return this._getTransformedDimensions(e).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=x({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},e),s=t.strokeWidth;let r=s,n=0;this.strokeUniform&&(r=0,n=s);const o=t.width+r,a=t.height+r;let l;return l=t.skewX===0&&t.skewY===0?new O(o*t.scaleX,a*t.scaleY):zo(o,a,Kr(t)),l.scalarAdd(n)}translateToGivenOrigin(e,t,s,r,n){let o=e.x,a=e.y;const l=Re(r)-Re(t),c=Re(n)-Re(s);if(l||c){const h=this._getTransformedDimensions();o+=l*h.x,a+=c*h.y}return new O(o,a)}translateToCenterPoint(e,t,s){if(t===re&&s===re)return e;const r=this.translateToGivenOrigin(e,t,s,re,re);return this.angle?r.rotate(je(this.angle),e):r}translateToOriginPoint(e,t,s){const r=this.translateToGivenOrigin(e,re,re,t,s);return this.angle?r.rotate(je(this.angle),e):r}getCenterPoint(){const e=this.getRelativeCenterPoint();return this.group?st(e,this.group.calcTransformMatrix()):e}getRelativeCenterPoint(){return this.translateToCenterPoint(new O(this.left,this.top),this.originX,this.originY)}getPointByOrigin(e,t){return this.translateToOriginPoint(this.getRelativeCenterPoint(),e,t)}setPositionByOrigin(e,t,s){const r=this.translateToCenterPoint(e,t,s),n=this.translateToOriginPoint(r,this.originX,this.originY);this.set({left:n.x,top:n.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),ye,it)}}const yp=["type"],bp=["extraParam"];let It=class Sr extends mp{static getDefaults(){return Sr.ownDefaults}get type(){const e=this.constructor.type;return e==="FabricObject"?"object":e.toLowerCase()}set type(e){ls("warn","Setting type has no effect",e)}constructor(e){super(),w(this,"_cacheContext",null),Object.assign(this,Sr.ownDefaults),this.setOptions(e)}_createCacheCanvas(){this._cacheCanvas=Jt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(e){const t=e.width,s=e.height,r=ue.maxCacheSideLimit,n=ue.minCacheSideLimit;if(t<=r&&s<=r&&t*s<=ue.perfLimitSizeTotal)return t<n&&(e.width=n),s<n&&(e.height=n),e;const o=t/s,[a,l]=bi.limitDimsByArea(o),c=Ys(n,a,r),h=Ys(n,l,r);return t>c&&(e.zoomX/=t/c,e.width=c,e.capped=!0),s>h&&(e.zoomY/=s/h,e.height=h,e.capped=!0),e}_getCacheCanvasDimensions(){const e=this.getTotalObjectScaling(),t=this._getTransformedDimensions({skewX:0,skewY:0}),s=t.x*e.x/this.scaleX,r=t.y*e.y/this.scaleY;return{width:Math.ceil(s+2),height:Math.ceil(r+2),zoomX:e.x,zoomY:e.y,x:s,y:r}}_updateCacheCanvas(){const e=this._cacheCanvas,t=this._cacheContext,{width:s,height:r,zoomX:n,zoomY:o,x:a,y:l}=this._limitCacheSize(this._getCacheCanvasDimensions()),c=s!==e.width||r!==e.height,h=this.zoomX!==n||this.zoomY!==o;if(!e||!t)return!1;if(c||h){s!==e.width||r!==e.height?(e.width=s,e.height=r):(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height));const u=a/2,d=l/2;return this.cacheTranslationX=Math.round(e.width/2-u)+u,this.cacheTranslationY=Math.round(e.height/2-d)+d,t.translate(this.cacheTranslationX,this.cacheTranslationY),t.scale(n,o),this.zoomX=n,this.zoomY=o,!0}return!1}setOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(e)}transform(e){const t=this.group&&!this.group._transformDone||this.group&&this.canvas&&e===this.canvas.contextTop,s=this.calcTransformMatrix(!t);e.transform(s[0],s[1],s[2],s[3],s[4],s[5])}getObjectScaling(){if(!this.group)return new O(Math.abs(this.scaleX),Math.abs(this.scaleY));const e=Fr(this.calcTransformMatrix());return new O(Math.abs(e.scaleX),Math.abs(e.scaleY))}getTotalObjectScaling(){const e=this.getObjectScaling();if(this.canvas){const t=this.canvas.getZoom(),s=this.getCanvasRetinaScaling();return e.scalarMultiply(t*s)}return e}getObjectOpacity(){let e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e}_constrainScale(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:e===0?1e-4:e}_set(e,t){e!==ot&&e!==mt||(t=this._constrainScale(t)),e===ot&&t<0?(this.flipX=!this.flipX,t*=-1):e==="scaleY"&&t<0?(this.flipY=!this.flipY,t*=-1):e!=="shadow"||!t||t instanceof Xt||(t=new Xt(t));const s=this[e]!==t;return this[e]=t,s&&this.constructor.cacheProperties.includes(e)&&(this.dirty=!0),this.parent&&(this.dirty||s&&this.constructor.stateProperties.includes(e))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.drawObject(e,!1,{}),this.dirty=!1),e.restore())}drawSelectionBackground(e){}renderCache(e){if(e=e||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:t,zoomY:s,cacheTranslationX:r,cacheTranslationY:n}=this,{width:o,height:a}=this._cacheCanvas;this.drawObject(this._cacheContext,e.forClipping,{zoomX:t,zoomY:s,cacheTranslationX:r,cacheTranslationY:n,width:o,height:a,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===nt&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(e,t,s){e.save(),t.inverted?e.globalCompositeOperation="destination-out":e.globalCompositeOperation="destination-in",e.setTransform(1,0,0,1,0,0),e.drawImage(s,0,0),e.restore()}drawObject(e,t,s){const r=this.fill,n=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(e)):this._renderBackground(e),this._render(e),this._drawClipPath(e,this.clipPath,s),this.fill=r,this.stroke=n}createClipPathLayer(e,t){const s=yt(t),r=s.getContext("2d");if(r.translate(t.cacheTranslationX,t.cacheTranslationY),r.scale(t.zoomX,t.zoomY),e._cacheCanvas=s,t.parentClipPaths.forEach(n=>{n.transform(r)}),t.parentClipPaths.push(e),e.absolutePositioned){const n=St(this.calcTransformMatrix());r.transform(n[0],n[1],n[2],n[3],n[4],n[5])}return e.transform(r),e.drawObject(r,!0,t),s}_drawClipPath(e,t,s){if(!t)return;t._transformDone=!0;const r=this.createClipPathLayer(t,s);this.drawClipPathOnCache(e,t,r)}drawCacheOnCanvas(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const t=this._cacheCanvas,s=this._cacheContext;return!(!t||!s||e||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(t&&s&&!e&&(s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,t.width,t.height),s.restore()),!0)}_renderBackground(e){if(!this.backgroundColor)return;const t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}_setOpacity(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity}_setStrokeStyles(e,t){const s=t.stroke;s&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineDashOffset=t.strokeDashOffset,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,ft(s)?s.gradientUnits==="percentage"||s.gradientTransform||s.patternTransform?this._applyPatternForTransformedGradient(e,s):(e.strokeStyle=s.toLive(e),this._applyPatternGradientTransform(e,s)):e.strokeStyle=t.stroke)}_setFillStyles(e,t){let{fill:s}=t;s&&(ft(s)?(e.fillStyle=s.toLive(e),this._applyPatternGradientTransform(e,s)):e.fillStyle=s)}_setClippingProperties(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"}_setLineDash(e,t){t&&t.length!==0&&e.setLineDash(t)}_setShadow(e){if(!this.shadow)return;const t=this.shadow,s=this.canvas,r=this.getCanvasRetinaScaling(),[n,,,o]=(s==null?void 0:s.viewportTransform)||et,a=n*r,l=o*r,c=t.nonScaling?new O(1,1):this.getObjectScaling();e.shadowColor=t.color,e.shadowBlur=t.blur*ue.browserShadowBlurConstant*(a+l)*(c.x+c.y)/4,e.shadowOffsetX=t.offsetX*a*c.x,e.shadowOffsetY=t.offsetY*l*c.y}_removeShadow(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)}_applyPatternGradientTransform(e,t){if(!ft(t))return{offsetX:0,offsetY:0};const s=t.gradientTransform||t.patternTransform,r=-this.width/2+t.offsetX||0,n=-this.height/2+t.offsetY||0;return t.gradientUnits==="percentage"?e.transform(this.width,0,0,this.height,r,n):e.transform(1,0,0,1,r,n),s&&e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),{offsetX:r,offsetY:n}}_renderPaintInOrder(e){this.paintFirst===nt?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))}_render(e){}_renderFill(e){this.fill&&(e.save(),this._setFillStyles(e,this),this.fillRule==="evenodd"?e.fill("evenodd"):e.fill(),e.restore())}_renderStroke(e){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform){const t=this.getObjectScaling();e.scale(1/t.x,1/t.y)}this._setLineDash(e,this.strokeDashArray),this._setStrokeStyles(e,this),e.stroke(),e.restore()}}_applyPatternForTransformedGradient(e,t){var s;const r=this._limitCacheSize(this._getCacheCanvasDimensions()),n=this.getCanvasRetinaScaling(),o=r.x/this.scaleX/n,a=r.y/this.scaleY/n,l=yt({width:Math.ceil(o),height:Math.ceil(a)}),c=l.getContext("2d");c&&(c.beginPath(),c.moveTo(0,0),c.lineTo(o,0),c.lineTo(o,a),c.lineTo(0,a),c.closePath(),c.translate(o/2,a/2),c.scale(r.zoomX/this.scaleX/n,r.zoomY/this.scaleY/n),this._applyPatternGradientTransform(c,t),c.fillStyle=t.toLive(e),c.fill(),e.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),e.scale(n*this.scaleX/r.zoomX,n*this.scaleY/r.zoomY),e.strokeStyle=(s=c.createPattern(l,"no-repeat"))!==null&&s!==void 0?s:"")}_findCenterFromElement(){return new O(this.left+this.width/2,this.top+this.height/2)}clone(e){const t=this.toObject(e);return this.constructor.fromObject(t)}cloneAsImage(e){const t=this.toCanvasElement(e);return new($.getClass("image"))(t)}toCanvasElement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Kc(this),s=this.group,r=this.shadow,n=Math.abs,o=e.enableRetinaScaling?Fc():1,a=(e.multiplier||1)*o,l=e.canvasProvider||(f=>new Bi(f,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,e.withoutTransform&&Uf(this),e.withoutShadow&&(this.shadow=null),e.viewportTransform&&Yf(this,this.getViewportTransform()),this.setCoords();const c=Jt(),h=this.getBoundingRect(),u=this.shadow,d=new O;if(u){const f=u.blur,S=u.nonScaling?new O(1,1):this.getObjectScaling();d.x=2*Math.round(n(u.offsetX)+f)*n(S.x),d.y=2*Math.round(n(u.offsetY)+f)*n(S.y)}const g=h.width+d.x,p=h.height+d.y;c.width=Math.ceil(g),c.height=Math.ceil(p);const y=l(c);e.format==="jpeg"&&(y.backgroundColor="#fff"),this.setPositionByOrigin(new O(y.width/2,y.height/2),re,re);const v=this.canvas;y._objects=[this],this.set("canvas",y),this.setCoords();const _=y.toCanvasElement(a||1,e);return this.set("canvas",v),this.shadow=r,s&&(this.group=s),this.set(t),this.setCoords(),y._objects=[],y.destroy(),_}toDataURL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Bc(this.toCanvasElement(e),e.format||"png",e.quality||1)}toBlob(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return $c(this.toCanvasElement(e),e.format||"png",e.quality||1)}isType(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.includes(this.constructor.type)||t.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(e){const{centeredRotation:t,originX:s,originY:r}=this;if(t){const{x:n,y:o}=this.getRelativeCenterPoint();this.originX=re,this.originY=re,this.left=n,this.top=o}if(this.set("angle",e),t){const{x:n,y:o}=this.translateToOriginPoint(this.getRelativeCenterPoint(),s,r);this.left=n,this.top=o,this.originX=s,this.originY=r}}setOnGroup(){}_setupCompositeOperation(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Nr.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&Nt().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(e,t){return Object.entries(e).reduce((s,r)=>{let[n,o]=r;return s[n]=this._animate(n,o,t),s},{})}_animate(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=e.split("."),n=this.constructor.colorProperties.includes(r[r.length-1]),{abort:o,startValue:a,onChange:l,onComplete:c}=s,h=x(x({},s),{},{target:this,startValue:a!=null?a:r.reduce((u,d)=>u[d],this),endValue:t,abort:o==null?void 0:o.bind(this),onChange:(u,d,g)=>{r.reduce((p,y,v)=>(v===r.length-1&&(p[y]=u),p[y]),this),l&&l(u,d,g)},onComplete:(u,d,g)=>{this.setCoords(),c&&c(u,d,g)}});return n?pp(h):ch(h)}isDescendantOf(e){const{parent:t,group:s}=this;return t===e||s===e||!!t&&t.isDescendantOf(e)||!!s&&s!==t&&s.isDescendantOf(e)}getAncestors(){const e=[];let t=this;do t=t.parent,t&&e.push(t);while(t);return e}findCommonAncestors(e){if(this===e)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const t=this.getAncestors(),s=e.getAncestors();if(t.length===0&&s.length>0&&this===s[s.length-1])return{fork:[],otherFork:[e,...s.slice(0,s.length-1)],common:[this]};for(let r,n=0;n<t.length;n++){if(r=t[n],r===e)return{fork:[this,...t.slice(0,n)],otherFork:[],common:t.slice(n)};for(let o=0;o<s.length;o++){if(this===s[o])return{fork:[],otherFork:[e,...s.slice(0,o)],common:[this,...t]};if(r===s[o])return{fork:[this,...t.slice(0,n)],otherFork:[e,...s.slice(0,o)],common:t.slice(n)}}}return{fork:[this,...t],otherFork:[e,...s],common:[]}}hasCommonAncestors(e){const t=this.findCommonAncestors(e);return t&&!!t.common.length}isInFrontOf(e){if(this===e)return;const t=this.findCommonAncestors(e);if(t.fork.includes(e))return!0;if(t.otherFork.includes(this))return!1;const s=t.common[0]||this.canvas;if(!s)return;const r=t.fork.pop(),n=t.otherFork.pop(),o=s._objects.indexOf(r),a=s._objects.indexOf(n);return o>-1&&o>a}toObject(){const e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(Sr.customProperties,this.constructor.customProperties||[]);let t;const s=ue.NUM_FRACTION_DIGITS,{clipPath:r,fill:n,stroke:o,shadow:a,strokeDashArray:l,left:c,top:h,originX:u,originY:d,width:g,height:p,strokeWidth:y,strokeLineCap:v,strokeDashOffset:_,strokeLineJoin:f,strokeUniform:S,strokeMiterLimit:C,scaleX:k,scaleY:T,angle:F,flipX:M,flipY:A,opacity:B,visible:E,backgroundColor:N,fillRule:j,paintFirst:L,globalCompositeOperation:G,skewX:X,skewY:P}=this;r&&!r.excludeFromExport&&(t=r.toObject(e.concat("inverted","absolutePositioned")));const D=Z=>Ce(Z,s),q=x(x({},ti(this,e)),{},{type:this.constructor.type,version:$n,originX:u,originY:d,left:D(c),top:D(h),width:D(g),height:D(p),fill:Ba(n)?n.toObject():n,stroke:Ba(o)?o.toObject():o,strokeWidth:D(y),strokeDashArray:l&&l.concat(),strokeLineCap:v,strokeDashOffset:_,strokeLineJoin:f,strokeUniform:S,strokeMiterLimit:D(C),scaleX:D(k),scaleY:D(T),angle:D(F),flipX:M,flipY:A,opacity:D(B),shadow:a&&a.toObject(),visible:E,backgroundColor:N,fillRule:j,paintFirst:L,globalCompositeOperation:G,skewX:D(X),skewY:D(P)},t?{clipPath:t}:null);return this.includeDefaultValues?q:this._removeDefaultValues(q)}toDatalessObject(e){return this.toObject(e)}_removeDefaultValues(e){const t=this.constructor.getDefaults(),s=Object.keys(t).length>0?t:Object.getPrototypeOf(this);return Ro(e,(r,n)=>{if(n===ye||n===it||n==="type")return!0;const o=s[n];return r!==o&&!(Array.isArray(r)&&Array.isArray(o)&&r.length===0&&o.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(e){let t=ke(e,yp),s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:r}=s,n=ke(s,bp);return Jr(t,n).then(o=>r?(delete o[r],new this(t[r],o)):new this(o))}static fromObject(e,t){return this._fromObject(e,t)}};w(It,"stateProperties",rp),w(It,"cacheProperties",es),w(It,"ownDefaults",np),w(It,"type","FabricObject"),w(It,"colorProperties",[Ve,nt,"backgroundColor"]),w(It,"customProperties",[]),$.setClass(It),$.setClass(It,"object");const si=(i,e,t)=>(s,r,n,o)=>{const a=e(s,r,n,o);return a&&Jc(i,x(x({},Qc(s,r,n,o)),t)),a};function ii(i){return(e,t,s,r)=>{const{target:n,originX:o,originY:a}=t,l=n.getRelativeCenterPoint(),c=n.translateToOriginPoint(l,o,a),h=i(e,t,s,r);return n.setPositionByOrigin(c,t.originX,t.originY),h}}const sl=si(Si,ii((i,e,t,s)=>{const r=Bo(e,e.originX,e.originY,t,s);if(Re(e.originX)===Re(re)||Re(e.originX)===Re(Fe)&&r.x<0||Re(e.originX)===Re(ye)&&r.x>0){const{target:n}=e,o=n.strokeWidth/(n.strokeUniform?n.scaleX:1),a=Zc(e)?2:1,l=n.width,c=Math.abs(r.x*a/n.scaleX)-o;return n.set("width",Math.max(c,1)),l!==n.width}return!1}));function vp(i,e,t,s,r){s=s||{};const n=this.sizeX||s.cornerSize||r.cornerSize,o=this.sizeY||s.cornerSize||r.cornerSize,a=s.transparentCorners!==void 0?s.transparentCorners:r.transparentCorners,l=a?nt:Ve,c=!a&&(s.cornerStrokeColor||r.cornerStrokeColor);let h,u=e,d=t;i.save(),i.fillStyle=s.cornerColor||r.cornerColor||"",i.strokeStyle=s.cornerStrokeColor||r.cornerStrokeColor||"",n>o?(h=n,i.scale(1,o/n),d=t*n/o):o>n?(h=o,i.scale(n/o,1),u=e*o/n):h=n,i.beginPath(),i.arc(u,d,h/2,0,Dr,!1),i[l](),c&&i.stroke(),i.restore()}function _p(i,e,t,s,r){s=s||{};const n=this.sizeX||s.cornerSize||r.cornerSize,o=this.sizeY||s.cornerSize||r.cornerSize,a=s.transparentCorners!==void 0?s.transparentCorners:r.transparentCorners,l=a?nt:Ve,c=!a&&(s.cornerStrokeColor||r.cornerStrokeColor),h=n/2,u=o/2;i.save(),i.fillStyle=s.cornerColor||r.cornerColor||"",i.strokeStyle=s.cornerStrokeColor||r.cornerStrokeColor||"",i.translate(e,t);const d=r.getTotalAngle();i.rotate(je(d)),i["".concat(l,"Rect")](-h,-u,n,o),c&&i.strokeRect(-h,-u,n,o),i.restore()}class vt{constructor(e){w(this,"visible",!0),w(this,"actionName",qr),w(this,"angle",0),w(this,"x",0),w(this,"y",0),w(this,"offsetX",0),w(this,"offsetY",0),w(this,"sizeX",0),w(this,"sizeY",0),w(this,"touchSizeX",0),w(this,"touchSizeY",0),w(this,"cursorStyle","crosshair"),w(this,"withConnection",!1),Object.assign(this,e)}shouldActivate(e,t,s,r){var n;let{tl:o,tr:a,br:l,bl:c}=r;return((n=t.canvas)===null||n===void 0?void 0:n.getActiveObject())===t&&t.isControlVisible(e)&&Oe.isPointInPolygon(s,[o,a,l,c])}getActionHandler(e,t,s){return this.actionHandler}getMouseDownHandler(e,t,s){return this.mouseDownHandler}getMouseUpHandler(e,t,s){return this.mouseUpHandler}cursorStyleHandler(e,t,s){return t.cursorStyle}getActionName(e,t,s){return t.actionName}getVisibility(e,t){var s,r;return(s=(r=e._controlsVisibility)===null||r===void 0?void 0:r[t])!==null&&s!==void 0?s:this.visible}setVisibility(e,t,s){this.visible=e}positionHandler(e,t,s,r){return new O(this.x*e.x+this.offsetX,this.y*e.y+this.offsetY).transform(t)}calcCornerCoords(e,t,s,r,n,o){const a=Lo([zi(s,r),ei({angle:e}),Io((n?this.touchSizeX:this.sizeX)||t,(n?this.touchSizeY:this.sizeY)||t)]);return{tl:new O(-.5,-.5).transform(a),tr:new O(.5,-.5).transform(a),br:new O(.5,.5).transform(a),bl:new O(-.5,.5).transform(a)}}render(e,t,s,r,n){((r=r||{}).cornerStyle||n.cornerStyle)==="circle"?vp.call(this,e,t,s,r,n):_p.call(this,e,t,s,r,n)}}const wp=(i,e,t)=>t.lockRotation?Lr:e.cursorStyle,xp=si(Lc,ii((i,e,t,s)=>{let{target:r,ex:n,ey:o,theta:a,originX:l,originY:c}=e;const h=r.translateToOriginPoint(r.getRelativeCenterPoint(),l,c);if(Ot(r,"lockRotation"))return!1;const u=Math.atan2(o-h.y,n-h.x),d=Math.atan2(s-h.y,t-h.x);let g=Zt(d-u+a);if(r.snapAngle&&r.snapAngle>0){const y=r.snapAngle,v=r.snapThreshold||y,_=Math.ceil(g/y)*y,f=Math.floor(g/y)*y;Math.abs(g-f)<v?g=f:Math.abs(g-_)<v&&(g=_)}g<0&&(g=360+g),g%=360;const p=r.angle!==g;return r.angle=g,p}));function hh(i,e){const t=e.canvas,s=i[t.uniScaleKey];return t.uniformScaling&&!s||!t.uniformScaling&&s}function uh(i,e,t){const s=Ot(i,"lockScalingX"),r=Ot(i,"lockScalingY");if(s&&r||!e&&(s||r)&&t||s&&e==="x"||r&&e==="y")return!0;const{width:n,height:o,strokeWidth:a}=i;return n===0&&a===0&&e!=="y"||o===0&&a===0&&e!=="x"}const Cp=["e","se","s","sw","w","nw","n","ne","e"],gi=(i,e,t)=>{const s=hh(i,t);if(uh(t,e.x!==0&&e.y===0?"x":e.x===0&&e.y!==0?"y":"",s))return Lr;const r=eh(t,e);return"".concat(Cp[r],"-resize")};function Wo(i,e,t,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const n=e.target,o=r.by,a=hh(i,n);let l,c,h,u,d,g;if(uh(n,o,a))return!1;if(e.gestureScale)c=e.scaleX*e.gestureScale,h=e.scaleY*e.gestureScale;else{if(l=Bo(e,e.originX,e.originY,t,s),d=o!=="y"?Math.sign(l.x||e.signX||1):1,g=o!=="x"?Math.sign(l.y||e.signY||1):1,e.signX||(e.signX=d),e.signY||(e.signY=g),Ot(n,"lockScalingFlip")&&(e.signX!==d||e.signY!==g))return!1;if(u=n._getTransformedDimensions(),a&&!o){const v=Math.abs(l.x)+Math.abs(l.y),{original:_}=e,f=v/(Math.abs(u.x*_.scaleX/n.scaleX)+Math.abs(u.y*_.scaleY/n.scaleY));c=_.scaleX*f,h=_.scaleY*f}else c=Math.abs(l.x*n.scaleX/u.x),h=Math.abs(l.y*n.scaleY/u.y);Zc(e)&&(c*=2,h*=2),e.signX!==d&&o!=="y"&&(e.originX=Ha(e.originX),c*=-1,e.signX=d),e.signY!==g&&o!=="x"&&(e.originY=Ha(e.originY),h*=-1,e.signY=g)}const p=n.scaleX,y=n.scaleY;return o?(o==="x"&&n.set(ot,c),o==="y"&&n.set(mt,h)):(!Ot(n,"lockScalingX")&&n.set(ot,c),!Ot(n,"lockScalingY")&&n.set(mt,h)),p!==n.scaleX||y!==n.scaleY}const qi=si(Gr,ii((i,e,t,s)=>Wo(i,e,t,s))),Sp=si(Gr,ii((i,e,t,s)=>Wo(i,e,t,s,{by:"x"}))),kp=si(Gr,ii((i,e,t,s)=>Wo(i,e,t,s,{by:"y"}))),Tp=["target","ex","ey","skewingSide"],wn={x:{counterAxis:"y",scale:ot,skew:Zs,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:mt,skew:Qs,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Op=["ns","nesw","ew","nwse"],Ep=(i,e,t)=>{if(e.x!==0&&Ot(t,"lockSkewingY")||e.y!==0&&Ot(t,"lockSkewingX"))return Lr;const s=eh(t,e)%4;return"".concat(Op[s],"-resize")};function dh(i,e,t,s,r){const{target:n}=t,{counterAxis:o,origin:a,lockSkewing:l,skew:c,flip:h}=wn[i];if(Ot(n,l))return!1;const{origin:u,flip:d}=wn[o],g=Re(t[u])*(n[d]?-1:1),p=-Math.sign(g)*(n[h]?-1:1),y=.5*-((n[c]===0&&Bo(t,re,re,s,r)[i]>0||n[c]>0?1:-1)*p)+.5;return si(Ic,ii((_,f,S,C)=>function(k,T,F){let{target:M,ex:A,ey:B,skewingSide:E}=T,N=ke(T,Tp);const{skew:j}=wn[k],L=F.subtract(new O(A,B)).divide(new O(M.scaleX,M.scaleY))[k],G=M[j],X=N[j],P=Math.tan(je(X)),D=k==="y"?M._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:M._getTransformedDimensions({scaleX:1,scaleY:1}).y,q=2*L*E/Math.max(D,1)+P,Z=Zt(Math.atan(q));M.set(j,Z);const R=G!==M[j];if(R&&k==="y"){const{skewX:de,scaleX:ee}=M,V=M._getTransformedDimensions({skewY:G}),U=M._getTransformedDimensions(),oe=de!==0?V.x/U.x:1;oe!==1&&M.set(ot,oe*ee)}return R}(i,f,new O(S,C))))(e,x(x({},t),{},{[a]:y,skewingSide:p}),s,r)}const Mp=(i,e,t,s)=>dh("x",i,e,t,s),Dp=(i,e,t,s)=>dh("y",i,e,t,s);function en(i,e){return i[e.canvas.altActionKey]}const Ki=(i,e,t)=>{const s=en(i,t);return e.x===0?s?Zs:mt:e.y===0?s?Qs:ot:""},Ls=(i,e,t)=>en(i,t)?Ep(0,e,t):gi(i,e,t),il=(i,e,t,s)=>en(i,e.target)?Dp(i,e,t,s):Sp(i,e,t,s),rl=(i,e,t,s)=>en(i,e.target)?Mp(i,e,t,s):kp(i,e,t,s),gh=()=>({ml:new vt({x:-.5,y:0,cursorStyleHandler:Ls,actionHandler:il,getActionName:Ki}),mr:new vt({x:.5,y:0,cursorStyleHandler:Ls,actionHandler:il,getActionName:Ki}),mb:new vt({x:0,y:.5,cursorStyleHandler:Ls,actionHandler:rl,getActionName:Ki}),mt:new vt({x:0,y:-.5,cursorStyleHandler:Ls,actionHandler:rl,getActionName:Ki}),tl:new vt({x:-.5,y:-.5,cursorStyleHandler:gi,actionHandler:qi}),tr:new vt({x:.5,y:-.5,cursorStyleHandler:gi,actionHandler:qi}),bl:new vt({x:-.5,y:.5,cursorStyleHandler:gi,actionHandler:qi}),br:new vt({x:.5,y:.5,cursorStyleHandler:gi,actionHandler:qi}),mtr:new vt({x:0,y:-.5,actionHandler:xp,cursorStyleHandler:wp,offsetY:-40,withConnection:!0,actionName:Fo})}),Pp=()=>({mr:new vt({x:.5,y:0,actionHandler:sl,cursorStyleHandler:Ls,actionName:Si}),ml:new vt({x:-.5,y:0,actionHandler:sl,cursorStyleHandler:Ls,actionName:Si})}),Ap=()=>x(x({},gh()),Pp());class Ei extends It{static getDefaults(){return x(x({},super.getDefaults()),Ei.ownDefaults)}constructor(e){super(),Object.assign(this,this.constructor.createControls(),Ei.ownDefaults),this.setOptions(e)}static createControls(){return{controls:gh()}}_updateCacheCanvas(){const e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){const t=e._currentTransform,s=t.target,r=t.action;if(this===s&&r&&r.startsWith(qr))return!1}return super._updateCacheCanvas()}getActiveControl(){const e=this.__corner;return e?{key:e,control:this.controls[e],coord:this.oCoords[e]}:void 0}findControl(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const s=Object.entries(this.oCoords);for(let r=s.length-1;r>=0;r--){const[n,o]=s[r],a=this.controls[n];if(a.shouldActivate(n,this,e,t?o.touchCorner:o.corner))return this.__corner=n,{key:n,control:a,coord:this.oCoords[n]}}}calcOCoords(){const e=this.getViewportTransform(),t=this.getCenterPoint(),s=zi(t.x,t.y),r=ei({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),n=Ke(s,r),o=Ke(e,n),a=Ke(o,[1/e[0],0,0,1/e[3],0,0]),l=this.group?Fr(this.calcTransformMatrix()):void 0;l&&(l.scaleX=Math.abs(l.scaleX),l.scaleY=Math.abs(l.scaleY));const c=this._calculateCurrentDimensions(l),h={};return this.forEachControl((u,d)=>{const g=u.positionHandler(c,a,this,u);h[d]=Object.assign(g,this._calcCornerCoords(u,g))}),h}_calcCornerCoords(e,t){const s=this.getTotalAngle();return{corner:e.calcCornerCoords(s,this.cornerSize,t.x,t.y,!1,this),touchCorner:e.calcCornerCoords(s,this.touchCornerSize,t.x,t.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(e){for(const t in this.controls)e(this.controls[t],t,this)}drawSelectionBackground(e){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;e.save();const t=this.getRelativeCenterPoint(),s=this._calculateCurrentDimensions(),r=this.getViewportTransform();e.translate(t.x,t.y),e.scale(1/r[0],1/r[3]),e.rotate(je(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-s.x/2,-s.y/2,s.x,s.y),e.restore()}strokeBorders(e,t){e.strokeRect(-t.x/2,-t.y/2,t.x,t.y)}_drawBorders(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=x({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},s);e.save(),e.strokeStyle=r.borderColor,this._setLineDash(e,r.borderDashArray),this.strokeBorders(e,t),r.hasControls&&this.drawControlsConnectingLines(e,t),e.restore()}_renderControls(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:s,hasControls:r}=this,n=x({hasBorders:s,hasControls:r},t),o=this.getViewportTransform(),a=n.hasBorders,l=n.hasControls,c=Ke(o,this.calcTransformMatrix()),h=Fr(c);e.save(),e.translate(h.translateX,h.translateY),e.lineWidth=this.borderScaleFactor,this.group===this.parent&&(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(h.angle-=180),e.rotate(je(this.group?h.angle:this.angle)),a&&this.drawBorders(e,h,t),l&&this.drawControls(e,t),e.restore()}drawBorders(e,t,s){let r;if(s&&s.forActiveSelection||this.group){const n=zo(this.width,this.height,Kr(t)),o=this.isStrokeAccountedForInDimensions()?jo:(this.strokeUniform?new O().scalarAdd(this.canvas?this.canvas.getZoom():1):new O(t.scaleX,t.scaleY)).scalarMultiply(this.strokeWidth);r=n.add(o).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else r=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(e,r,s)}drawControlsConnectingLines(e,t){let s=!1;e.beginPath(),this.forEachControl((r,n)=>{r.withConnection&&r.getVisibility(this,n)&&(s=!0,e.moveTo(r.x*t.x,r.y*t.y),e.lineTo(r.x*t.x+r.offsetX,r.y*t.y+r.offsetY))}),s&&e.stroke()}drawControls(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.save();const s=this.getCanvasRetinaScaling(),{cornerStrokeColor:r,cornerDashArray:n,cornerColor:o}=this,a=x({cornerStrokeColor:r,cornerDashArray:n,cornerColor:o},t);e.setTransform(s,0,0,s,0,0),e.strokeStyle=e.fillStyle=a.cornerColor,this.transparentCorners||(e.strokeStyle=a.cornerStrokeColor),this._setLineDash(e,a.cornerDashArray),this.forEachControl((l,c)=>{if(l.getVisibility(this,c)){const h=this.oCoords[c];l.render(e,h.x,h.y,a,this)}}),e.restore()}isControlVisible(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)}setControlVisible(e,t){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=t}setControlsVisibility(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(e).forEach(t=>{let[s,r]=t;return this.setControlVisible(s,r)})}clearContextTop(e){if(!this.canvas)return;const t=this.canvas.contextTop;if(!t)return;const s=this.canvas.viewportTransform;t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this.transform(t);const r=this.width+4,n=this.height+4;return t.clearRect(-r/2,-n/2,r,n),e||t.restore(),t}onDeselect(e){return!1}onSelect(e){return!1}shouldStartDragging(e){return!1}onDragStart(e){return!1}canDrop(e){return!1}renderDragSourceEffect(e){}renderDropTargetEffect(e){}}function fh(i,e){return e.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(s=>{s!=="constructor"&&Object.defineProperty(i.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s)||Object.create(null))})}),i}w(Ei,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Ze extends Ei{}fh(Ze,[th]),$.setClass(Ze),$.setClass(Ze,"object");const Np=(i,e,t,s)=>{const r=2*(s=Math.round(s))+1,{data:n}=i.getImageData(e-s,t-s,r,r);for(let o=3;o<n.length;o+=4)if(n[o]>0)return!1;return!0};class ph{constructor(e){this.options=e,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new O(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new O(1/this.options.scaleX,1/this.options.scaleY):new O(1,1)}createSideVector(e,t){const s=Un(e,t);return this.options.strokeUniform?s.multiply(this.scale):s}projectOrthogonally(e,t,s){return this.applySkew(e.add(this.calcOrthogonalProjection(e,t,s)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(e){const t=new O(e);return t.y+=t.x*Math.tan(je(this.options.skewY)),t.x+=t.y*Math.tan(je(this.options.skewX)),t}scaleUnitVector(e,t){return e.multiply(this.strokeUniformScalar).scalarMultiply(t)}}const Fp=new O;class Vs extends ph{static getOrthogonalRotationFactor(e,t){const s=t?Yn(e,t):sp(e);return Math.abs(s)<Ri?-1:1}constructor(e,t,s,r){super(r),w(this,"AB",void 0),w(this,"AC",void 0),w(this,"alpha",void 0),w(this,"bisector",void 0),this.A=new O(e),this.B=new O(t),this.C=new O(s),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Yn(this.AB,this.AC),this.bisector=$o(ah(this.AB.eq(Fp)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(e,t),n=lh(r),o=Vs.getOrthogonalRotationFactor(n,this.bisector);return this.scaleUnitVector(n,s*o)}projectBevel(){const e=[];return(this.alpha%Dr==0?[this.B]:[this.B,this.C]).forEach(t=>{e.push(this.projectOrthogonally(this.A,t)),e.push(this.projectOrthogonally(this.A,t,-this.strokeProjectionMagnitude))}),e}projectMiter(){const e=[],t=Math.abs(this.alpha),s=1/Math.sin(t/2),r=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*s),n=this.options.strokeUniform?Xn(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return Xn(r)/this.strokeProjectionMagnitude<=n&&e.push(this.applySkew(this.A.add(r))),e.push(...this.projectBevel()),e}projectRoundNoSkew(e,t){const s=[],r=new O(Vs.getOrthogonalRotationFactor(this.bisector),Vs.getOrthogonalRotationFactor(new O(this.bisector.y,this.bisector.x)));return[new O(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r),new O(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r)].forEach(n=>{Qa(n,e,t)&&s.push(this.A.add(n))}),s}projectRoundWithSkew(e,t){const s=[],{skewX:r,skewY:n,scaleX:o,scaleY:a,strokeUniform:l}=this.options,c=new O(Math.tan(je(r)),Math.tan(je(n))),h=this.strokeProjectionMagnitude,u=l?h/a/Math.sqrt(1/a**2+1/o**2*c.y**2):h/Math.sqrt(1+c.y**2),d=new O(Math.sqrt(Math.max(h**2-u**2,0)),u),g=l?h/Math.sqrt(1+c.x**2*(1/a)**2/(1/o+1/o*c.x*c.y)**2):h/Math.sqrt(1+c.x**2/(1+c.x*c.y)**2),p=new O(g,Math.sqrt(Math.max(h**2-g**2,0)));return[p,p.scalarMultiply(-1),d,d.scalarMultiply(-1)].map(y=>this.applySkew(l?y.multiply(this.strokeUniformScalar):y)).forEach(y=>{Qa(y,e,t)&&s.push(this.applySkew(this.A).add(y))}),s}projectRound(){const e=[];e.push(...this.projectBevel());const t=this.alpha%Dr==0,s=this.applySkew(this.A),r=e[t?0:2].subtract(s),n=e[t?1:0].subtract(s),o=t?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),a=wi(r,o)>0,l=a?r:n,c=a?n:r;return this.isSkewed()?e.push(...this.projectRoundWithSkew(l,c)):e.push(...this.projectRoundNoSkew(l,c)),e}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(e=>({originPoint:this.A,projectedPoint:e,angle:this.alpha,bisector:this.bisector}))}}class nl extends ph{constructor(e,t,s){super(s),this.A=new O(e),this.T=new O(t)}calcOrthogonalProjection(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(e,t);return this.scaleUnitVector(lh(r),s)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const e=[];if(!this.isSkewed()&&this.A.eq(this.T)){const t=new O(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.applySkew(this.A.add(t)),this.applySkew(this.A.subtract(t)))}else e.push(...new Vs(this.A,this.T,this.T,this.options).projectRound());return e}projectSquare(){const e=[];if(this.A.eq(this.T)){const t=new O(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.A.add(t),this.A.subtract(t))}else{const t=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),s=this.scaleUnitVector($o(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),r=this.A.add(s);e.push(r.add(t),r.subtract(t))}return e.map(t=>this.applySkew(t))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(e=>({originPoint:this.A,projectedPoint:e}))}}const jp=function(i,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const s=[];if(i.length===0)return s;const r=i.reduce((n,o)=>(n[n.length-1].eq(o)||n.push(new O(o)),n),[new O(i[0])]);if(r.length===1)t=!0;else if(!t){const n=r[0],o=((a,l)=>{for(let c=a.length-1;c>=0;c--)if(l(a[c],c,a))return c;return-1})(r,a=>!a.eq(n));r.splice(o+1)}return r.forEach((n,o,a)=>{let l,c;o===0?(c=a[1],l=t?n:a[a.length-1]):o===a.length-1?(l=a[o-1],c=t?n:a[0]):(l=a[o-1],c=a[o+1]),t&&a.length===1?s.push(...new nl(n,n,e).project()):!t||o!==0&&o!==a.length-1?s.push(...new Vs(n,l,c,e).project()):s.push(...new nl(n,o===0?c:l,e).project())}),s},Ho=i=>{const e={};return Object.keys(i).forEach(t=>{e[t]={},Object.keys(i[t]).forEach(s=>{e[t][s]=x({},i[t][s])})}),e},Lp=i=>i.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let li;const Uo=i=>{if(li||li||(li="Intl"in Yr()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),li){const e=li.segment(i);return Array.from(e).map(t=>{let{segment:s}=t;return s})}return Ip(i)},Ip=i=>{const e=[];for(let t,s=0;s<i.length;s++)(t=Rp(i,s))!==!1&&e.push(t);return e},Rp=(i,e)=>{const t=i.charCodeAt(e);if(isNaN(t))return"";if(t<55296||t>57343)return i.charAt(e);if(55296<=t&&t<=56319){if(i.length<=e+1)throw"High surrogate without following low surrogate";const r=i.charCodeAt(e+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return i.charAt(e)+i.charAt(e+1)}if(e===0)throw"Low surrogate without preceding high surrogate";const s=i.charCodeAt(e-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1},Xo=function(i,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return i.fill!==e.fill||i.stroke!==e.stroke||i.strokeWidth!==e.strokeWidth||i.fontSize!==e.fontSize||i.fontFamily!==e.fontFamily||i.fontWeight!==e.fontWeight||i.fontStyle!==e.fontStyle||i.textDecorationThickness!==e.textDecorationThickness||i.textBackgroundColor!==e.textBackgroundColor||i.deltaY!==e.deltaY||t&&(i.overline!==e.overline||i.underline!==e.underline||i.linethrough!==e.linethrough)},zp=(i,e)=>{const t=e.split(`
`),s=[];let r=-1,n={};i=Ho(i);for(let o=0;o<t.length;o++){const a=Uo(t[o]);if(i[o])for(let l=0;l<a.length;l++){r++;const c=i[o][l];c&&Object.keys(c).length>0&&(Xo(n,c,!0)?s.push({start:r,end:r+1,style:c}):s[s.length-1].end++),n=c||{}}else r+=a.length,n={}}return s},Bp=(i,e)=>{if(!Array.isArray(i))return Ho(i);const t=e.split(No),s={};let r=-1,n=0;for(let o=0;o<t.length;o++){const a=Uo(t[o]);for(let l=0;l<a.length;l++)r++,i[n]&&i[n].start<=r&&r<i[n].end&&(s[o]=s[o]||{},s[o][l]=x({},i[n].style),r===i[n].end-1&&n++)}return s},ds=["display","transform",Ve,"fill-opacity","fill-rule","opacity",nt,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function ol(i,e){const t=i.nodeName,s=i.getAttribute("class"),r=i.getAttribute("id"),n="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+t,"i"),e=e.replace(o,""),r&&e.length&&(o=new RegExp("#"+r+n,"i"),e=e.replace(o,"")),s&&e.length){const a=s.split(" ");for(let l=a.length;l--;)o=new RegExp("\\."+a[l]+n,"i"),e=e.replace(o,"")}return e.length===0}function $p(i,e){let t=!0;const s=ol(i,e.pop());return s&&e.length&&(t=function(r,n){let o,a=!0;for(;r.parentElement&&r.parentElement.nodeType===1&&n.length;)a&&(o=n.pop()),a=ol(r=r.parentElement,o);return n.length===0}(i,e)),s&&t&&e.length===0}const Vp=i=>{var e;return(e=ep[i])!==null&&e!==void 0?e:i},Wp=new RegExp("(".concat(kt,")"),"gi"),Hp=i=>i.replace(Wp," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var al,ll,cl,hl,ul,dl,gl;const Qe="(".concat(kt,")"),Up=String.raw(al||(al=Ft(["(skewX)(",")"],["(skewX)\\(","\\)"])),Qe),Xp=String.raw(ll||(ll=Ft(["(skewY)(",")"],["(skewY)\\(","\\)"])),Qe),Yp=String.raw(cl||(cl=Ft(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),Qe,Qe,Qe),Gp=String.raw(hl||(hl=Ft(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),Qe,Qe),qp=String.raw(ul||(ul=Ft(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),Qe,Qe),Kp=String.raw(dl||(dl=Ft(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),Qe,Qe,Qe,Qe,Qe,Qe),Yo="(?:".concat(Kp,"|").concat(qp,"|").concat(Yp,"|").concat(Gp,"|").concat(Up,"|").concat(Xp,")"),Jp="(?:".concat(Yo,"*)"),Zp=String.raw(gl||(gl=Ft(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),Jp),Qp=new RegExp(Zp),em=new RegExp(Yo),tm=new RegExp(Yo,"g");function Gn(i){const e=[];if(!(i=Hp(i).replace(/\s*([()])\s*/gi,"$1"))||i&&!Qp.test(i))return[...et];for(const t of i.matchAll(tm)){const s=em.exec(t[0]);if(!s)continue;let r=et;const n=s.filter(p=>!!p),[,o,...a]=n,[l,c,h,u,d,g]=a.map(p=>parseFloat(p));switch(o){case"translate":r=zi(l,c);break;case Fo:r=ei({angle:l},{x:c,y:h});break;case qr:r=Io(l,c);break;case Zs:r=Hc(l);break;case Qs:r=Uc(l);break;case"matrix":r=[l,c,h,u,d,g]}e.push(r)}return Lo(e)}function sm(i,e,t,s){const r=Array.isArray(e);let n,o=e;if(i!==Ve&&i!==nt||e!==rt){if(i==="strokeUniform")return e==="non-scaling-stroke";if(i==="strokeDashArray")o=e===rt?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(i==="transformMatrix")o=t&&t.transformMatrix?Ke(t.transformMatrix,Gn(e)):Gn(e);else if(i==="visible")o=e!==rt&&e!=="hidden",t&&t.visible===!1&&(o=!1);else if(i==="opacity")o=parseFloat(e),t&&t.opacity!==void 0&&(o*=t.opacity);else if(i==="textAnchor")o=e==="start"?ye:e==="end"?Fe:re;else if(i==="charSpacing"||i===Ts)n=$s(e,s)/s*1e3;else if(i==="paintFirst"){const a=e.indexOf(Ve),l=e.indexOf(nt);o=Ve,(a>-1&&l>-1&&l<a||a===-1&&l>-1)&&(o=nt)}else{if(i==="href"||i==="xlink:href"||i==="font"||i==="id")return e;if(i==="imageSmoothing")return e==="optimizeQuality";n=r?e.map($s):$s(e,s)}}else o="";return!r&&isNaN(n)?o:n}function im(i,e){const t=i.match(Qf);if(!t)return;const s=t[1],r=t[3],n=t[4],o=t[5],a=t[6];s&&(e.fontStyle=s),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),n&&(e.fontSize=$s(n)),a&&(e.fontFamily=a),o&&(e.lineHeight=o==="normal"?1:o)}function rm(i,e){i.replace(/;\s*$/,"").split(";").forEach(t=>{if(!t)return;const[s,r]=t.split(":");e[s.trim().toLowerCase()]=r.trim()})}function nm(i){const e={},t=i.getAttribute("style");return t&&(typeof t=="string"?rm(t,e):function(s,r){Object.entries(s).forEach(n=>{let[o,a]=n;a!==void 0&&(r[o.toLowerCase()]=a)})}(t,e)),e}const om={stroke:"strokeOpacity",fill:"fillOpacity"};function ts(i,e,t){if(!i)return{};let s,r={},n=Ao;i.parentNode&&Za.test(i.parentNode.nodeName)&&(r=ts(i.parentElement,e,t),r.fontSize&&(s=n=$s(r.fontSize)));const o=x(x(x({},e.reduce((c,h)=>{const u=i.getAttribute(h);return u&&(c[h]=u),c},{})),function(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u={};for(const d in h)$p(c,d.split(" "))&&(u=x(x({},u),h[d]));return u}(i,t)),nm(i));o[vn]&&i.setAttribute(vn,o[vn]),o[bn]&&(s=$s(o[bn],n),o[bn]="".concat(s));const a={};for(const c in o){const h=Vp(c),u=sm(h,o[c],r,s);a[h]=u}a&&a.font&&im(a.font,a);const l=x(x({},r),a);return Za.test(i.nodeName)?l:function(c){const h=Ze.getDefaults();return Object.entries(om).forEach(u=>{let[d,g]=u;if(c[g]===void 0||c[d]==="")return;if(c[d]===void 0){if(!h[d])return;c[d]=h[d]}if(c[d].indexOf("url(")===0)return;const p=new be(c[d]);c[d]=p.setAlpha(Ce(p.getAlpha()*c[g],2)).toRgba()}),c}(l)}const am=["left","top","width","height","visible"],mh=["rx","ry"];class Ye extends Ze{static getDefaults(){return x(x({},super.getDefaults()),Ye.ownDefaults)}constructor(e){super(),Object.assign(this,Ye.ownDefaults),this.setOptions(e),this._initRxRy()}_initRxRy(){const{rx:e,ry:t}=this;e&&!t?this.ry=e:t&&!e&&(this.rx=t)}_render(e){const{width:t,height:s}=this,r=-t/2,n=-s/2,o=this.rx?Math.min(this.rx,t/2):0,a=this.ry?Math.min(this.ry,s/2):0,l=o!==0||a!==0;e.beginPath(),e.moveTo(r+o,n),e.lineTo(r+t-o,n),l&&e.bezierCurveTo(r+t-rs*o,n,r+t,n+rs*a,r+t,n+a),e.lineTo(r+t,n+s-a),l&&e.bezierCurveTo(r+t,n+s-rs*a,r+t-rs*o,n+s,r+t-o,n+s),e.lineTo(r+o,n+s),l&&e.bezierCurveTo(r+rs*o,n+s,r,n+s-rs*a,r,n+s-a),e.lineTo(r,n+a),l&&e.bezierCurveTo(r,n+rs*a,r+rs*o,n,r+o,n),e.closePath(),this._renderPaintInOrder(e)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...mh,...e])}_toSVG(){const{width:e,height:t,rx:s,ry:r}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-e/2,'" y="').concat(-t/2,'" rx="').concat(s,'" ry="').concat(r,'" width="').concat(e,'" height="').concat(t,`" />
`)]}static async fromElement(e,t,s){const r=ts(e,this.ATTRIBUTE_NAMES,s),{left:n=0,top:o=0,width:a=0,height:l=0,visible:c=!0}=r,h=ke(r,am);return new this(x(x(x({},t),h),{},{left:n,top:o,width:a,height:l,visible:!!(c&&a&&l)}))}}w(Ye,"type","Rect"),w(Ye,"cacheProperties",[...es,...mh]),w(Ye,"ownDefaults",{rx:0,ry:0}),w(Ye,"ATTRIBUTE_NAMES",[...ds,"x","y","rx","ry","width","height"]),$.setClass(Ye),$.setSVGClass(Ye);const $t="initialization",Rr="added",Go="removed",zr="imperative",yh=(i,e)=>{const{strokeUniform:t,strokeWidth:s,width:r,height:n,group:o}=e,a=o&&o!==i?Zr(o.calcTransformMatrix(),i.calcTransformMatrix()):null,l=a?e.getRelativeCenterPoint().transform(a):e.getRelativeCenterPoint(),c=!e.isStrokeAccountedForInDimensions(),h=t&&c?Xf(new O(s,s),void 0,i.calcTransformMatrix()):jo,u=!t&&c?s:0,d=zo(r+u,n+u,Lo([a,e.calcOwnMatrix()],!0)).add(h).scalarDivide(2);return[l.subtract(d),l.add(d)]};class tn{calcLayoutResult(e,t){if(this.shouldPerformLayout(e))return this.calcBoundingBox(t,e)}shouldPerformLayout(e){let{type:t,prevStrategy:s,strategy:r}=e;return t===$t||t===zr||!!s&&r!==s}shouldLayoutClipPath(e){let{type:t,target:{clipPath:s}}=e;return t!==$t&&s&&!s.absolutePositioned}getInitialSize(e,t){return t.size}calcBoundingBox(e,t){const{type:s,target:r}=t;if(s===zr&&t.overrides)return t.overrides;if(e.length===0)return;const{left:n,top:o,width:a,height:l}=Ut(e.map(u=>yh(r,u)).reduce((u,d)=>u.concat(d),[])),c=new O(a,l),h=new O(n,o).add(c.scalarDivide(2));if(s===$t){const u=this.getInitialSize(t,{size:c,center:h});return{center:h,relativeCorrection:new O(0,0),size:u}}return{center:h.transform(r.calcOwnMatrix()),size:c}}}w(tn,"type","strategy");class qn extends tn{shouldPerformLayout(e){return!0}}w(qn,"type","fit-content"),$.setClass(qn);const lm=["strategy"],cm=["target","strategy","bubbles","prevStrategy"],bh="layoutManager";class Mi{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new qn;w(this,"strategy",void 0),this.strategy=e,this._subscriptions=new Map}performLayout(e){const t=x(x({bubbles:!0,strategy:this.strategy},e),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(t);const s=this.getLayoutResult(t);s&&this.commitLayout(t,s),this.onAfterLayout(t,s),this._prevLayoutStrategy=t.strategy}attachHandlers(e,t){const{target:s}=t;return[Ar,jc,Si,Lc,Gr,Ic,Pr,Af,Nf].map(r=>e.on(r,n=>this.performLayout(r===Ar?{type:"object_modified",trigger:r,e:n,target:s}:{type:"object_modifying",trigger:r,e:n,target:s})))}subscribe(e,t){this.unsubscribe(e,t);const s=this.attachHandlers(e,t);this._subscriptions.set(e,s)}unsubscribe(e,t){(this._subscriptions.get(e)||[]).forEach(s=>s()),this._subscriptions.delete(e)}unsubscribeTargets(e){e.targets.forEach(t=>this.unsubscribe(t,e))}subscribeTargets(e){e.targets.forEach(t=>this.subscribe(t,e))}onBeforeLayout(e){const{target:t,type:s}=e,{canvas:r}=t;if(s===$t||s===Rr?this.subscribeTargets(e):s===Go&&this.unsubscribeTargets(e),t.fire("layout:before",{context:e}),r&&r.fire("object:layout:before",{target:t,context:e}),s===zr&&e.deep){const n=ke(e,lm);t.forEachObject(o=>o.layoutManager&&o.layoutManager.performLayout(x(x({},n),{},{bubbles:!1,target:o})))}}getLayoutResult(e){const{target:t,strategy:s,type:r}=e,n=s.calcLayoutResult(e,t.getObjects());if(!n)return;const o=r===$t?new O:t.getRelativeCenterPoint(),{center:a,correction:l=new O,relativeCorrection:c=new O}=n,h=o.subtract(a).add(l).transform(r===$t?et:St(t.calcOwnMatrix()),!0).add(c);return{result:n,prevCenter:o,nextCenter:a,offset:h}}commitLayout(e,t){const{target:s}=e,{result:{size:r},nextCenter:n}=t;var o,a;s.set({width:r.x,height:r.y}),this.layoutObjects(e,t),e.type===$t?s.set({left:(o=e.x)!==null&&o!==void 0?o:n.x+r.x*Re(s.originX),top:(a=e.y)!==null&&a!==void 0?a:n.y+r.y*Re(s.originY)}):(s.setPositionByOrigin(n,re,re),s.setCoords(),s.set("dirty",!0))}layoutObjects(e,t){const{target:s}=e;s.forEachObject(r=>{r.group===s&&this.layoutObject(e,t,r)}),e.strategy.shouldLayoutClipPath(e)&&this.layoutObject(e,t,s.clipPath)}layoutObject(e,t,s){let{offset:r}=t;s.set({left:s.left+r.x,top:s.top+r.y})}onAfterLayout(e,t){const{target:s,strategy:r,bubbles:n,prevStrategy:o}=e,a=ke(e,cm),{canvas:l}=s;s.fire("layout:after",{context:e,result:t}),l&&l.fire("object:layout:after",{context:e,result:t,target:s});const c=s.parent;n&&c!=null&&c.layoutManager&&((a.path||(a.path=[])).push(s),c.layoutManager.performLayout(x(x({},a),{},{target:c}))),s.set("dirty",!0)}dispose(){const{_subscriptions:e}=this;e.forEach(t=>t.forEach(s=>s())),e.clear()}toObject(){return{type:bh,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}$.setClass(Mi,bh);const hm=["type","objects","layoutManager"];class um extends Mi{performLayout(){}}class ks extends Rc(Ze){static getDefaults(){return x(x({},super.getDefaults()),ks.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),w(this,"_activeObjects",[]),w(this,"__objectSelectionTracker",void 0),w(this,"__objectSelectionDisposer",void 0),Object.assign(this,ks.ownDefaults),this.setOptions(t),this.groupInit(e,t)}groupInit(e,t){var s;this._objects=[...e],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(r=>{this.enterGroup(r,!1)}),this.layoutManager=(s=t.layoutManager)!==null&&s!==void 0?s:new Mi,this.layoutManager.performLayout({type:$t,target:this,targets:[...e],x:t.left,y:t.top})}canEnterGroup(e){return e===this||this.isDescendantOf(e)?(ls("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(e)===-1||(ls("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(e){return e.filter((t,s,r)=>this.canEnterGroup(t)&&r.indexOf(t)===s)}add(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=this._filterObjectsBeforeEnteringGroup(t),n=super.add(...r);return this._onAfterObjectsChange(Rr,r),n}insertAt(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];const n=this._filterObjectsBeforeEnteringGroup(s),o=super.insertAt(e,...n);return this._onAfterObjectsChange(Rr,n),o}remove(){const e=super.remove(...arguments);return this._onAfterObjectsChange(Go,e),e}_onObjectAdded(e){this.enterGroup(e,!0),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e,t){this.exitGroup(e,t),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onAfterObjectsChange(e,t){this.layoutManager.performLayout({type:e,targets:t,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(e,t){const s=this[e];return super._set(e,t),e==="canvas"&&s!==t&&(this._objects||[]).forEach(r=>{r._set(e,t)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(e,t){let{target:s}=t;const r=this._activeObjects;if(e)r.push(s),this._set("dirty",!0);else if(r.length>0){const n=r.indexOf(s);n>-1&&(r.splice(n,1),this._set("dirty",!0))}}_watchObject(e,t){e&&this._watchObject(!1,t),e?(t.on("selected",this.__objectSelectionTracker),t.on("deselected",this.__objectSelectionDisposer)):(t.off("selected",this.__objectSelectionTracker),t.off("deselected",this.__objectSelectionDisposer))}enterGroup(e,t){e.group&&e.group.remove(e),e._set("parent",this),this._enterGroup(e,t)}_enterGroup(e,t){t&&jr(e,Ke(St(this.calcTransformMatrix()),e.calcTransformMatrix())),this._shouldSetNestedCoords()&&e.setCoords(),e._set("group",this),e._set("canvas",this.canvas),this._watchObject(!0,e);const s=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();s&&(s===e||e.isDescendantOf(s))&&this._activeObjects.push(e)}exitGroup(e,t){this._exitGroup(e,t),e._set("parent",void 0),e._set("canvas",void 0)}_exitGroup(e,t){e._set("group",void 0),t||(jr(e,Ke(this.calcTransformMatrix(),e.calcTransformMatrix())),e.setCoords()),this._watchObject(!1,e);const s=this._activeObjects.length>0?this._activeObjects.indexOf(e):-1;s>-1&&this._activeObjects.splice(s,1)}shouldCache(){const e=Ze.prototype.shouldCache.call(this);if(e){for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return this.ownCaching=!1,!1}return e}willDrawShadow(){if(super.willDrawShadow())return!0;for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(e,t,s){this._renderBackground(e);for(let n=0;n<this._objects.length;n++){var r;const o=this._objects[n];(r=this.canvas)!==null&&r!==void 0&&r.preserveObjectStacking&&o.group!==this?(e.save(),e.transform(...St(this.calcTransformMatrix())),o.render(e),e.restore()):o.group===this&&o.render(e)}this._drawClipPath(e,this.clipPath,s)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(e=>e.setCoords())}triggerLayout(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(x({target:this,type:zr},e))}render(e){this._transformDone=!0,super.render(e),this._transformDone=!1}__serializeObjects(e,t){const s=this.includeDefaultValues;return this._objects.filter(function(r){return!r.excludeFromExport}).map(function(r){const n=r.includeDefaultValues;r.includeDefaultValues=s;const o=r[e||"toObject"](t);return r.includeDefaultValues=n,o})}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.layoutManager.toObject();return x(x(x({},super.toObject(["subTargetCheck","interactive",...e])),t.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:t}:{}),{},{objects:this.__serializeObjects("toObject",e)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(e=>{this._watchObject(!1,e),e.dispose()}),super.dispose()}_createSVGBgRect(e){if(!this.backgroundColor)return"";const t=Ye.prototype._toSVG.call(this),s=t.indexOf("COMMON_PARTS");t[s]='for="group" ';const r=t.join("");return e?e(r):r}_toSVG(e){const t=["<g ","COMMON_PARTS",` >
`],s=this._createSVGBgRect(e);s&&t.push("		",s);for(let r=0;r<this._objects.length;r++)t.push("		",this._objects[r].toSVG(e));return t.push(`</g>
`),t}getSvgStyles(){const e=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",t=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),t].join("")}toClipPathSVG(e){const t=[],s=this._createSVGBgRect(e);s&&t.push("	",s);for(let r=0;r<this._objects.length;r++)t.push("	",this._objects[r].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(t,{reviver:e})}static fromObject(e,t){let{type:s,objects:r=[],layoutManager:n}=e,o=ke(e,hm);return Promise.all([ki(r,t),Jr(o,t)]).then(a=>{let[l,c]=a;const h=new this(l,x(x(x({},o),c),{},{layoutManager:new um}));if(n){const u=$.getClass(n.type),d=$.getClass(n.strategy);h.layoutManager=new u(new d)}else h.layoutManager=new Mi;return h.layoutManager.subscribeTargets({type:$t,target:h,targets:h.getObjects()}),h.setCoords(),h})}}w(ks,"type","Group"),w(ks,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),$.setClass(ks);const dm=(i,e)=>Math.min(e.width/i.width,e.height/i.height),gm=(i,e)=>Math.max(e.width/i.width,e.height/i.height),Kn="\\s*,?\\s*",ci="".concat(Kn,"(").concat(kt,")"),fm="".concat(ci).concat(ci).concat(ci).concat(Kn,"([01])").concat(Kn,"([01])").concat(ci).concat(ci),pm={m:"l",M:"L"},mm=(i,e,t,s,r,n,o,a,l,c,h)=>{const u=qt(i),d=Kt(i),g=qt(e),p=Kt(e),y=t*r*g-s*n*p+o,v=s*r*g+t*n*p+a;return["C",c+l*(-t*r*d-s*n*u),h+l*(-s*r*d+t*n*u),y+l*(t*r*p+s*n*g),v+l*(s*r*p-t*n*g),y,v]},fl=(i,e,t,s)=>{const r=Math.atan2(e,i),n=Math.atan2(s,t);return n>=r?n-r:2*Math.PI-(r-n)};function pl(i,e,t,s,r,n,o,a){let l;if(ue.cachesBoundsOfCurve&&(l=[...arguments].join(),bi.boundsOfCurveCache[l]))return bi.boundsOfCurveCache[l];const c=Math.sqrt,h=Math.abs,u=[],d=[[0,0],[0,0]];let g=6*i-12*t+6*r,p=-3*i+9*t-9*r+3*o,y=3*t-3*i;for(let C=0;C<2;++C){if(C>0&&(g=6*e-12*s+6*n,p=-3*e+9*s-9*n+3*a,y=3*s-3*e),h(p)<1e-12){if(h(g)<1e-12)continue;const A=-y/g;0<A&&A<1&&u.push(A);continue}const k=g*g-4*y*p;if(k<0)continue;const T=c(k),F=(-g+T)/(2*p);0<F&&F<1&&u.push(F);const M=(-g-T)/(2*p);0<M&&M<1&&u.push(M)}let v=u.length;const _=v,f=vh(i,e,t,s,r,n,o,a);for(;v--;){const{x:C,y:k}=f(u[v]);d[0][v]=C,d[1][v]=k}d[0][_]=i,d[1][_]=e,d[0][_+1]=o,d[1][_+1]=a;const S=[new O(Math.min(...d[0]),Math.min(...d[1])),new O(Math.max(...d[0]),Math.max(...d[1]))];return ue.cachesBoundsOfCurve&&(bi.boundsOfCurveCache[l]=S),S}const ym=(i,e,t)=>{let[s,r,n,o,a,l,c,h]=t;const u=((d,g,p,y,v,_,f)=>{if(p===0||y===0)return[];let S=0,C=0,k=0;const T=Math.PI,F=f*Po,M=Kt(F),A=qt(F),B=.5*(-A*d-M*g),E=.5*(-A*g+M*d),N=p**2,j=y**2,L=E**2,G=B**2,X=N*j-N*L-j*G;let P=Math.abs(p),D=Math.abs(y);if(X<0){const xe=Math.sqrt(1-X/(N*j));P*=xe,D*=xe}else k=(v===_?-1:1)*Math.sqrt(X/(N*L+j*G));const q=k*P*E/D,Z=-k*D*B/P,R=A*q-M*Z+.5*d,de=M*q+A*Z+.5*g;let ee=fl(1,0,(B-q)/P,(E-Z)/D),V=fl((B-q)/P,(E-Z)/D,(-B-q)/P,(-E-Z)/D);_===0&&V>0?V-=2*T:_===1&&V<0&&(V+=2*T);const U=Math.ceil(Math.abs(V/T*2)),oe=[],ne=V/U,De=8/3*Math.sin(ne/4)*Math.sin(ne/4)/Math.sin(ne/2);let Se=ee+ne;for(let xe=0;xe<U;xe++)oe[xe]=mm(ee,Se,A,M,P,D,R,de,De,S,C),S=oe[xe][5],C=oe[xe][6],ee=Se,Se+=ne;return oe})(c-i,h-e,r,n,a,l,o);for(let d=0,g=u.length;d<g;d++)u[d][1]+=i,u[d][2]+=e,u[d][3]+=i,u[d][4]+=e,u[d][5]+=i,u[d][6]+=e;return u},bm=i=>{let e=0,t=0,s=0,r=0;const n=[];let o,a=0,l=0;for(const c of i){const h=[...c];let u;switch(h[0]){case"l":h[1]+=e,h[2]+=t;case"L":e=h[1],t=h[2],u=["L",e,t];break;case"h":h[1]+=e;case"H":e=h[1],u=["L",e,t];break;case"v":h[1]+=t;case"V":t=h[1],u=["L",e,t];break;case"m":h[1]+=e,h[2]+=t;case"M":e=h[1],t=h[2],s=h[1],r=h[2],u=["M",e,t];break;case"c":h[1]+=e,h[2]+=t,h[3]+=e,h[4]+=t,h[5]+=e,h[6]+=t;case"C":a=h[3],l=h[4],e=h[5],t=h[6],u=["C",h[1],h[2],a,l,e,t];break;case"s":h[1]+=e,h[2]+=t,h[3]+=e,h[4]+=t;case"S":o==="C"?(a=2*e-a,l=2*t-l):(a=e,l=t),e=h[3],t=h[4],u=["C",a,l,h[1],h[2],e,t],a=u[3],l=u[4];break;case"q":h[1]+=e,h[2]+=t,h[3]+=e,h[4]+=t;case"Q":a=h[1],l=h[2],e=h[3],t=h[4],u=["Q",a,l,e,t];break;case"t":h[1]+=e,h[2]+=t;case"T":o==="Q"?(a=2*e-a,l=2*t-l):(a=e,l=t),e=h[1],t=h[2],u=["Q",a,l,e,t];break;case"a":h[6]+=e,h[7]+=t;case"A":ym(e,t,h).forEach(d=>n.push(d)),e=h[6],t=h[7];break;case"z":case"Z":e=s,t=r,u=["Z"]}u?(n.push(u),o=u[0]):o=""}return n},Br=(i,e,t,s)=>Math.sqrt((t-i)**2+(s-e)**2),vh=(i,e,t,s,r,n,o,a)=>l=>{const c=l**3,h=(g=>3*g**2*(1-g))(l),u=(g=>3*g*(1-g)**2)(l),d=(g=>(1-g)**3)(l);return new O(o*c+r*h+t*u+i*d,a*c+n*h+s*u+e*d)},_h=i=>i**2,wh=i=>2*i*(1-i),xh=i=>(1-i)**2,vm=(i,e,t,s,r,n,o,a)=>l=>{const c=_h(l),h=wh(l),u=xh(l),d=3*(u*(t-i)+h*(r-t)+c*(o-r)),g=3*(u*(s-e)+h*(n-s)+c*(a-n));return Math.atan2(g,d)},_m=(i,e,t,s,r,n)=>o=>{const a=_h(o),l=wh(o),c=xh(o);return new O(r*a+t*l+i*c,n*a+s*l+e*c)},wm=(i,e,t,s,r,n)=>o=>{const a=1-o,l=2*(a*(t-i)+o*(r-t)),c=2*(a*(s-e)+o*(n-s));return Math.atan2(c,l)},ml=(i,e,t)=>{let s=new O(e,t),r=0;for(let n=1;n<=100;n+=1){const o=i(n/100);r+=Br(s.x,s.y,o.x,o.y),s=o}return r},xm=(i,e)=>{let t,s=0,r=0,n={x:i.x,y:i.y},o=x({},n),a=.01,l=0;const c=i.iterator,h=i.angleFinder;for(;r<e&&a>1e-4;)o=c(s),l=s,t=Br(n.x,n.y,o.x,o.y),t+r>e?(s-=a,a/=2):(n=o,s+=a,r+=t);return x(x({},o),{},{angle:h(l)})},Ch=i=>{let e,t,s=0,r=0,n=0,o=0,a=0;const l=[];for(const c of i){const h={x:r,y:n,command:c[0],length:0};switch(c[0]){case"M":t=h,t.x=o=r=c[1],t.y=a=n=c[2];break;case"L":t=h,t.length=Br(r,n,c[1],c[2]),r=c[1],n=c[2];break;case"C":e=vh(r,n,c[1],c[2],c[3],c[4],c[5],c[6]),t=h,t.iterator=e,t.angleFinder=vm(r,n,c[1],c[2],c[3],c[4],c[5],c[6]),t.length=ml(e,r,n),r=c[5],n=c[6];break;case"Q":e=_m(r,n,c[1],c[2],c[3],c[4]),t=h,t.iterator=e,t.angleFinder=wm(r,n,c[1],c[2],c[3],c[4]),t.length=ml(e,r,n),r=c[3],n=c[4];break;case"Z":t=h,t.destX=o,t.destY=a,t.length=Br(r,n,o,a),r=o,n=a}s+=t.length,l.push(t)}return l.push({length:s,x:r,y:n}),l},Cm=function(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ch(i),s=0;for(;e-t[s].length>0&&s<t.length-2;)e-=t[s].length,s++;const r=t[s],n=e/r.length,o=i[s];switch(r.command){case"M":return{x:r.x,y:r.y,angle:0};case"Z":return x(x({},new O(r.x,r.y).lerp(new O(r.destX,r.destY),n)),{},{angle:Math.atan2(r.destY-r.y,r.destX-r.x)});case"L":return x(x({},new O(r.x,r.y).lerp(new O(o[1],o[2]),n)),{},{angle:Math.atan2(o[2]-r.y,o[1]-r.x)});case"C":case"Q":return xm(r,e)}},Sm=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),yl=new RegExp(fm,"g"),km=new RegExp(kt,"gi"),Tm={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Om=i=>{var e;const t=[],s=(e=i.match(Sm))!==null&&e!==void 0?e:[];for(const r of s){const n=r[0];if(n==="z"||n==="Z"){t.push([n]);continue}const o=Tm[n.toLowerCase()];let a=[];if(n==="a"||n==="A"){yl.lastIndex=0;for(let l=null;l=yl.exec(r);)a.push(...l.slice(1))}else a=r.match(km)||[];for(let l=0;l<a.length;l+=o){const c=new Array(o),h=pm[n];c[0]=l>0&&h?h:n;for(let u=0;u<o;u++)c[u+1]=parseFloat(a[l+u]);t.push(c)}}return t},Em=(i,e)=>i.map(t=>t.map((s,r)=>r===0||e===void 0?s:Ce(s,e)).join(" ")).join(" ");function Jn(i,e){const t=i.style;t&&e&&(typeof e=="string"?t.cssText+=";"+e:Object.entries(e).forEach(s=>{let[r,n]=s;return t.setProperty(r,n)}))}class Mm extends qc{constructor(e){let{allowTouchScrolling:t=!1,containerClass:s=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),w(this,"upper",void 0),w(this,"container",void 0);const{el:r}=this.lower,n=this.createUpperCanvas();this.upper={el:n,ctx:n.getContext("2d")},this.applyCanvasStyle(r,{allowTouchScrolling:t}),this.applyCanvasStyle(n,{allowTouchScrolling:t,styles:{position:"absolute",left:"0",top:"0"}});const o=this.createContainerElement();o.classList.add(s),r.parentNode&&r.parentNode.replaceChild(o,r),o.append(r,n),this.container=o}createUpperCanvas(){const{el:e}=this.lower,t=Jt();return t.className=e.className,t.classList.remove("lower-canvas"),t.classList.add("upper-canvas"),t.setAttribute("data-fabric","top"),t.style.cssText=e.style.cssText,t.setAttribute("draggable","true"),t}createContainerElement(){const e=Js().createElement("div");return e.setAttribute("data-fabric","wrapper"),Jn(e,{position:"relative"}),Va(e),e}applyCanvasStyle(e,t){const{styles:s,allowTouchScrolling:r}=t;Jn(e,x(x({},s),{},{"touch-action":r?"manipulation":rt})),Va(e)}setDimensions(e,t){super.setDimensions(e,t);const{el:s,ctx:r}=this.upper;Gc(s,r,e,t)}setCSSDimensions(e){super.setCSSDimensions(e),Wn(this.upper.el,e),Wn(this.container,e)}cleanupDOM(e){const t=this.container,{el:s}=this.lower,{el:r}=this.upper;super.cleanupDOM(e),t.removeChild(r),t.removeChild(s),t.parentNode&&t.parentNode.replaceChild(s,t)}dispose(){super.dispose(),Nt().dispose(this.upper.el),delete this.upper,delete this.container}}class sn extends Bi{constructor(){super(...arguments),w(this,"targets",[]),w(this,"_hoveredTargets",[]),w(this,"_objectsToRender",void 0),w(this,"_currentTransform",null),w(this,"_groupSelector",null),w(this,"contextTopDirty",!1)}static getDefaults(){return x(x({},super.getDefaults()),sn.ownDefaults)}get upperCanvasEl(){var e;return(e=this.elements.upper)===null||e===void 0?void 0:e.el}get contextTop(){var e;return(e=this.elements.upper)===null||e===void 0?void 0:e.ctx}get wrapperEl(){return this.elements.container}initElements(e){this.elements=new Mm(e,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(e){this._objectsToRender=void 0,super._onObjectAdded(e)}_onObjectRemoved(e){this._objectsToRender=void 0,e===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[e]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[e]}),e.fire("deselected",{target:e})),e===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(e)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const e=this._activeObject;return!this.preserveObjectStacking&&e?this._objects.filter(t=>!t.group&&t!==e).concat(e):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()}renderTop(){const e=this.contextTop;this.clearContext(e),this.renderTopLayer(e),this.fire("after:render",{ctx:e})}setTargetFindTolerance(e){e=Math.round(e),this.targetFindTolerance=e;const t=this.getRetinaScaling(),s=Math.ceil((2*e+1)*t);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=s,this.pixelFindContext.scale(t,t)}isTargetTransparent(e,t,s){const r=this.targetFindTolerance,n=this.pixelFindContext;this.clearContext(n),n.save(),n.translate(-t+r,-s+r),n.transform(...this.viewportTransform);const o=e.selectionBackgroundColor;e.selectionBackgroundColor="",e.render(n),e.selectionBackgroundColor=o,n.restore();const a=Math.round(r*this.getRetinaScaling());return Np(n,a,a,a)}_isSelectionKeyPressed(e){const t=this.selectionKey;return!!t&&(Array.isArray(t)?!!t.find(s=>!!s&&e[s]===!0):e[t])}_shouldClearSelection(e,t){const s=this.getActiveObjects(),r=this._activeObject;return!!(!t||t&&r&&s.length>1&&s.indexOf(t)===-1&&r!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&r&&r!==t)}_shouldCenterTransform(e,t,s){if(!e)return;let r;return t===qr||t===ot||t===mt||t===Si?r=this.centeredScaling||e.centeredScaling:t===Fo&&(r=this.centeredRotation||e.centeredRotation),r?!s:s}_getOriginFromCorner(e,t){const s={x:e.originX,y:e.originY};return t&&(["ml","tl","bl"].includes(t)?s.x=Fe:["mr","tr","br"].includes(t)&&(s.x=ye),["tl","mt","tr"].includes(t)?s.y=Vn:["bl","mb","br"].includes(t)&&(s.y=it)),s}_setupCurrentTransform(e,t,s){var r;const n=t.group?Bs(this.getScenePoint(e),void 0,t.group.calcTransformMatrix()):this.getScenePoint(e),{key:o="",control:a}=t.getActiveControl()||{},l=s&&a?(r=a.getActionHandler(e,t,a))===null||r===void 0?void 0:r.bind(a):qf,c=((g,p,y,v)=>{if(!p||!g)return"drag";const _=v.controls[p];return _.getActionName(y,_,v)})(s,o,e,t),h=e[this.centeredKey],u=this._shouldCenterTransform(t,c,h)?{x:re,y:re}:this._getOriginFromCorner(t,o),d={target:t,action:c,actionHandler:l,actionPerformed:!1,corner:o,scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,offsetX:n.x-t.left,offsetY:n.y-t.top,originX:u.x,originY:u.y,ex:n.x,ey:n.y,lastX:n.x,lastY:n.y,theta:je(t.angle),width:t.width,height:t.height,shiftKey:e.shiftKey,altKey:h,original:x(x({},Kc(t)),{},{originX:u.x,originY:u.y})};this._currentTransform=d,this.fire("before:transform",{e,transform:d})}setCursor(e){this.upperCanvasEl.style.cursor=e}_drawSelection(e){const{x:t,y:s,deltaX:r,deltaY:n}=this._groupSelector,o=new O(t,s).transform(this.viewportTransform),a=new O(t+r,s+n).transform(this.viewportTransform),l=this.selectionLineWidth/2;let c=Math.min(o.x,a.x),h=Math.min(o.y,a.y),u=Math.max(o.x,a.x),d=Math.max(o.y,a.y);this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(c,h,u-c,d-h)),this.selectionLineWidth&&this.selectionBorderColor&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,c+=l,h+=l,u-=l,d-=l,Ze.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(c,h,u-c,d-h))}findTarget(e){if(this.skipTargetFind)return;const t=this.getViewportPoint(e),s=this._activeObject,r=this.getActiveObjects();if(this.targets=[],s&&r.length>=1){if(s.findControl(t,Hn(e))||r.length>1&&this.searchPossibleTargets([s],t))return s;if(s===this.searchPossibleTargets([s],t)){if(this.preserveObjectStacking){const n=this.targets;this.targets=[];const o=this.searchPossibleTargets(this._objects,t);return e[this.altSelectionKey]&&o&&o!==s?(this.targets=n,s):o}return s}}return this.searchPossibleTargets(this._objects,t)}_pointIsInObjectSelectionArea(e,t){let s=e.getCoords();const r=this.getZoom(),n=e.padding/r;if(n){const[o,a,l,c]=s,h=Math.atan2(a.y-o.y,a.x-o.x),u=qt(h)*n,d=Kt(h)*n,g=u+d,p=u-d;s=[new O(o.x-p,o.y-g),new O(a.x+g,a.y-p),new O(l.x+p,l.y+g),new O(c.x-g,c.y+p)]}return Oe.isPointInPolygon(t,s)}_checkTarget(e,t){return!!(e&&e.visible&&e.evented&&this._pointIsInObjectSelectionArea(e,Bs(t,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing||!this.isTargetTransparent(e,t.x,t.y)))}_searchPossibleTargets(e,t){let s=e.length;for(;s--;){const r=e[s];if(this._checkTarget(r,t)){if(wr(r)&&r.subTargetCheck){const n=this._searchPossibleTargets(r._objects,t);n&&this.targets.push(n)}return r}}}searchPossibleTargets(e,t){const s=this._searchPossibleTargets(e,t);if(s&&wr(s)&&s.interactive&&this.targets[0]){const r=this.targets;for(let n=r.length-1;n>0;n--){const o=r[n];if(!wr(o)||!o.interactive)return o}return r[0]}return s}getViewportPoint(e){return this._pointer?this._pointer:this.getPointer(e,!0)}getScenePoint(e){return this._absolutePointer?this._absolutePointer:this.getPointer(e)}getPointer(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=this.upperCanvasEl,r=s.getBoundingClientRect();let n=Vf(e),o=r.width||0,a=r.height||0;o&&a||(it in r&&Vn in r&&(a=Math.abs(r.top-r.bottom)),Fe in r&&ye in r&&(o=Math.abs(r.right-r.left))),this.calcOffset(),n.x=n.x-this._offset.left,n.y=n.y-this._offset.top,t||(n=Bs(n,void 0,this.viewportTransform));const l=this.getRetinaScaling();l!==1&&(n.x/=l,n.y/=l);const c=o===0||a===0?new O(1,1):new O(s.width/o,s.height/a);return n.multiply(c)}_setDimensionsImpl(e,t){this._resetTransformEventData(),super._setDimensionsImpl(e,t),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=Jt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const e=this._activeObject;return bs(e)?e.getObjects():e?[e]:[]}_fireSelectionEvents(e,t){let s=!1,r=!1;const n=this.getActiveObjects(),o=[],a=[];e.forEach(l=>{n.includes(l)||(s=!0,l.fire("deselected",{e:t,target:l}),a.push(l))}),n.forEach(l=>{e.includes(l)||(s=!0,l.fire("selected",{e:t,target:l}),o.push(l))}),e.length>0&&n.length>0?(r=!0,s&&this.fire("selection:updated",{e:t,selected:o,deselected:a})):n.length>0?(r=!0,this.fire("selection:created",{e:t,selected:o})):e.length>0&&(r=!0,this.fire("selection:cleared",{e:t,deselected:a})),r&&(this._objectsToRender=void 0)}setActiveObject(e,t){const s=this.getActiveObjects(),r=this._setActiveObject(e,t);return this._fireSelectionEvents(s,t),r}_setActiveObject(e,t){const s=this._activeObject;return s!==e&&!(!this._discardActiveObject(t,e)&&this._activeObject)&&!e.onSelect({e:t})&&(this._activeObject=e,bs(e)&&s!==e&&e.set("canvas",this),e.setCoords(),!0)}_discardActiveObject(e,t){const s=this._activeObject;return!!s&&!s.onDeselect({e,object:t})&&(this._currentTransform&&this._currentTransform.target===s&&this.endCurrentTransform(e),bs(s)&&s===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(e){const t=this.getActiveObjects(),s=this.getActiveObject();t.length&&this.fire("before:selection:cleared",{e,deselected:[s]});const r=this._discardActiveObject(e);return this._fireSelectionEvents(t,e),r}endCurrentTransform(e){const t=this._currentTransform;this._finalizeCurrentTransform(e),t&&t.target&&(t.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(e){const t=this._currentTransform,s=t.target,r={e,target:s,transform:t,action:t.action};s._scaling&&(s._scaling=!1),s.setCoords(),t.actionPerformed&&(this.fire("object:modified",r),s.fire(Ar,r))}setViewportTransform(e){super.setViewportTransform(e);const t=this._activeObject;t&&t.setCoords()}destroy(){const e=this._activeObject;bs(e)&&(e.removeAll(),e.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(e){const t=this._activeObject;t&&t._renderControls(e)}_toObject(e,t,s){const r=this._realizeGroupTransformOnObject(e),n=super._toObject(e,t,s);return e.set(r),n}_realizeGroupTransformOnObject(e){const{group:t}=e;if(t&&bs(t)&&this._activeObject===t){const s=ti(e,["angle","flipX","flipY",ye,ot,mt,Zs,Qs,it]);return Hf(e,t.calcOwnMatrix()),s}return{}}_setSVGObject(e,t,s){const r=this._realizeGroupTransformOnObject(t);super._setSVGObject(e,t,s),t.set(r)}}w(sn,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class Dm{constructor(e){w(this,"targets",[]),w(this,"__disposer",void 0);const t=()=>{const{hiddenTextarea:r}=e.getActiveObject()||{};r&&r.focus()},s=e.upperCanvasEl;s.addEventListener("click",t),this.__disposer=()=>s.removeEventListener("click",t)}exitTextEditing(){this.target=void 0,this.targets.forEach(e=>{e.isEditing&&e.exitEditing()})}add(e){this.targets.push(e)}remove(e){this.unregister(e),Fs(this.targets,e)}register(e){this.target=e}unregister(e){e===this.target&&(this.target=void 0)}onMouseMove(e){var t;!((t=this.target)===null||t===void 0)&&t.isEditing&&this.target.updateSelectionOnMouseMove(e)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const Pm=["target","oldTarget","fireCanvas","e"],ct={passive:!1},As=(i,e)=>{const t=i.getViewportPoint(e),s=i.getScenePoint(e);return{viewportPoint:t,scenePoint:s,pointer:t,absolutePointer:s}},ns=function(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return i.addEventListener(...t)},ut=function(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return i.removeEventListener(...t)},Am={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Zn extends sn{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),w(this,"_isClick",void 0),w(this,"textEditingManager",new Dm(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(t=>{this[t]=this[t].bind(this)}),this.addOrRemove(ns,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(e,t){const s=this.upperCanvasEl,r=this._getEventPrefix();e(Yc(s),"resize",this._onResize),e(s,r+"down",this._onMouseDown),e(s,"".concat(r,"move"),this._onMouseMove,ct),e(s,"".concat(r,"out"),this._onMouseOut),e(s,"".concat(r,"enter"),this._onMouseEnter),e(s,"wheel",this._onMouseWheel),e(s,"contextmenu",this._onContextMenu),e(s,"click",this._onClick),e(s,"dblclick",this._onClick),e(s,"dragstart",this._onDragStart),e(s,"dragend",this._onDragEnd),e(s,"dragover",this._onDragOver),e(s,"dragenter",this._onDragEnter),e(s,"dragleave",this._onDragLeave),e(s,"drop",this._onDrop),this.enablePointerEvents||e(s,"touchstart",this._onTouchStart,ct)}removeListeners(){this.addOrRemove(ut,"remove");const e=this._getEventPrefix(),t=Ct(this.upperCanvasEl);ut(t,"".concat(e,"up"),this._onMouseUp),ut(t,"touchend",this._onTouchEnd,ct),ut(t,"".concat(e,"move"),this._onMouseMove,ct),ut(t,"touchmove",this._onMouseMove,ct),clearTimeout(this._willAddMouseDown)}_onMouseWheel(e){this.__onMouseWheel(e)}_onMouseOut(e){const t=this._hoveredTarget,s=x({e},As(this,e));this.fire("mouse:out",x(x({},s),{},{target:t})),this._hoveredTarget=void 0,t&&t.fire("mouseout",x({},s)),this._hoveredTargets.forEach(r=>{this.fire("mouse:out",x(x({},s),{},{target:r})),r&&r.fire("mouseout",x({},s))}),this._hoveredTargets=[]}_onMouseEnter(e){this._currentTransform||this.findTarget(e)||(this.fire("mouse:over",x({e},As(this,e))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(e){this._isClick=!1;const t=this.getActiveObject();if(t&&t.onDragStart(e)){this._dragSource=t;const s={e,target:t};return this.fire("dragstart",s),t.fire("dragstart",s),void ns(this.upperCanvasEl,"drag",this._onDragProgress)}Wa(e)}_renderDragEffects(e,t,s){let r=!1;const n=this._dropTarget;n&&n!==t&&n!==s&&(n.clearContextTop(),r=!0),t==null||t.clearContextTop(),s!==t&&(s==null||s.clearContextTop());const o=this.contextTop;o.save(),o.transform(...this.viewportTransform),t&&(o.save(),t.transform(o),t.renderDragSourceEffect(e),o.restore(),r=!0),s&&(o.save(),s.transform(o),s.renderDropTargetEffect(e),o.restore(),r=!0),o.restore(),r&&(this.contextTopDirty=!0)}_onDragEnd(e){const t=!!e.dataTransfer&&e.dataTransfer.dropEffect!==rt,s=t?this._activeObject:void 0,r={e,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:t,dropTarget:s};ut(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",r),this._dragSource&&this._dragSource.fire("dragend",r),delete this._dragSource,this._onMouseUp(e)}_onDragProgress(e){const t={e,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",t),this._dragSource&&this._dragSource.fire("drag",t)}findDragTargets(e){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(e)),targets:[...this.targets]}}_onDragOver(e){const t="dragover",{target:s,targets:r}=this.findDragTargets(e),n=this._dragSource,o={e,target:s,subTargets:r,dragSource:n,canDrop:!1,dropTarget:void 0};let a;this.fire(t,o),this._fireEnterLeaveEvents(s,o),s&&(s.canDrop(e)&&(a=s),s.fire(t,o));for(let l=0;l<r.length;l++){const c=r[l];c.canDrop(e)&&(a=c),c.fire(t,o)}this._renderDragEffects(e,n,a),this._dropTarget=a}_onDragEnter(e){const{target:t,targets:s}=this.findDragTargets(e),r={e,target:t,subTargets:s,dragSource:this._dragSource};this.fire("dragenter",r),this._fireEnterLeaveEvents(t,r)}_onDragLeave(e){const t={e,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",t),this._fireEnterLeaveEvents(void 0,t),this._renderDragEffects(e,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(e){const{target:t,targets:s}=this.findDragTargets(e),r=this._basicEventHandler("drop:before",x({e,target:t,subTargets:s,dragSource:this._dragSource},As(this,e)));r.didDrop=!1,r.dropTarget=void 0,this._basicEventHandler("drop",r),this.fire("drop:after",r)}_onContextMenu(e){const t=this.findTarget(e),s=this.targets||[],r=this._basicEventHandler("contextmenu:before",{e,target:t,subTargets:s});return this.stopContextMenu&&Wa(e),this._basicEventHandler("contextmenu",r),!1}_onClick(e){const t=e.detail;t>3||t<2||(this._cacheTransformEventData(e),t==2&&e.type==="dblclick"&&this._handleEvent(e,"dblclick"),t==3&&this._handleEvent(e,"tripleclick"),this._resetTransformEventData())}getPointerId(e){const t=e.changedTouches;return t?t[0]&&t[0].identifier:this.enablePointerEvents?e.pointerId:-1}_isMainEvent(e){return e.isPrimary===!0||e.isPrimary!==!1&&(e.type==="touchend"&&e.touches.length===0||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(e){let t=!this.allowTouchScrolling;const s=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(e)),this.__onMouseDown(e),(this.isDrawingMode||s&&this._target===s)&&(t=!0),t&&e.preventDefault(),this._resetTransformEventData();const r=this.upperCanvasEl,n=this._getEventPrefix(),o=Ct(r);ns(o,"touchend",this._onTouchEnd,ct),t&&ns(o,"touchmove",this._onMouseMove,ct),ut(r,"".concat(n,"down"),this._onMouseDown)}_onMouseDown(e){this.__onMouseDown(e),this._resetTransformEventData();const t=this.upperCanvasEl,s=this._getEventPrefix();ut(t,"".concat(s,"move"),this._onMouseMove,ct);const r=Ct(t);ns(r,"".concat(s,"up"),this._onMouseUp),ns(r,"".concat(s,"move"),this._onMouseMove,ct)}_onTouchEnd(e){if(e.touches.length>0)return;this.__onMouseUp(e),this._resetTransformEventData(),delete this.mainTouchId;const t=this._getEventPrefix(),s=Ct(this.upperCanvasEl);ut(s,"touchend",this._onTouchEnd,ct),ut(s,"touchmove",this._onMouseMove,ct),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{ns(this.upperCanvasEl,"".concat(t,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(e){this.__onMouseUp(e),this._resetTransformEventData();const t=this.upperCanvasEl,s=this._getEventPrefix();if(this._isMainEvent(e)){const r=Ct(this.upperCanvasEl);ut(r,"".concat(s,"up"),this._onMouseUp),ut(r,"".concat(s,"move"),this._onMouseMove,ct),ns(t,"".concat(s,"move"),this._onMouseMove,ct)}}_onMouseMove(e){const t=this.getActiveObject();!this.allowTouchScrolling&&(!t||!t.shouldStartDragging(e))&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(e){const t=this.getActiveObject();return!!t!=!!e||t&&e&&t!==e}__onMouseUp(e){var t;this._cacheTransformEventData(e),this._handleEvent(e,"up:before");const s=this._currentTransform,r=this._isClick,n=this._target,{button:o}=e;if(o)return(this.fireMiddleClick&&o===1||this.fireRightClick&&o===2)&&this._handleEvent(e,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(e);if(!this._isMainEvent(e))return;let a,l,c=!1;if(s&&(this._finalizeCurrentTransform(e),c=s.actionPerformed),!r){const h=n===this._activeObject;this.handleSelection(e),c||(c=this._shouldRender(n)||!h&&n===this._activeObject)}if(n){const h=n.findControl(this.getViewportPoint(e),Hn(e)),{key:u,control:d}=h||{};if(l=u,n.selectable&&n!==this._activeObject&&n.activeOn==="up")this.setActiveObject(n,e),c=!0;else if(d){const g=d.getMouseUpHandler(e,n,d);g&&(a=this.getScenePoint(e),g.call(d,e,s,a.x,a.y))}n.isMoving=!1}if(s&&(s.target!==n||s.corner!==l)){const h=s.target&&s.target.controls[s.corner],u=h&&h.getMouseUpHandler(e,s.target,h);a=a||this.getScenePoint(e),u&&u.call(h,e,s,a.x,a.y)}this._setCursorFromEvent(e,n),this._handleEvent(e,"up"),this._groupSelector=null,this._currentTransform=null,n&&(n.__corner=void 0),c?this.requestRenderAll():r||(t=this._activeObject)!==null&&t!==void 0&&t.isEditing||this.renderTop()}_basicEventHandler(e,t){const{target:s,subTargets:r=[]}=t;this.fire(e,t),s&&s.fire(e,t);for(let n=0;n<r.length;n++)r[n]!==s&&r[n].fire(e,t);return t}_handleEvent(e,t,s){const r=this._target,n=this.targets||[],o=x(x(x({e,target:r,subTargets:n},As(this,e)),{},{transform:this._currentTransform},t==="up:before"||t==="up"?{isClick:this._isClick,currentTarget:this.findTarget(e),currentSubTargets:this.targets}:{}),t==="down:before"||t==="down"?s:{});this.fire("mouse:".concat(t),o),r&&r.fire("mouse".concat(t),o);for(let a=0;a<n.length;a++)n[a]!==r&&n[a].fire("mouse".concat(t),o)}_onMouseDownInDrawingMode(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(e),this.requestRenderAll());const t=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(t,{e,pointer:t}),this._handleEvent(e,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(e){if(this._isCurrentlyDrawing){const t=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(t,{e,pointer:t})}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")}_onMouseUpInDrawingMode(e){const t=this.getScenePoint(e);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e,pointer:t}):this._isCurrentlyDrawing=!1,this._handleEvent(e,"up")}__onMouseDown(e){this._isClick=!0,this._cacheTransformEventData(e),this._handleEvent(e,"down:before");let t=this._target,s=!!t&&t===this._activeObject;const{button:r}=e;if(r)return(this.fireMiddleClick&&r===1||this.fireRightClick&&r===2)&&this._handleEvent(e,"down",{alreadySelected:s}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(e);if(!this._isMainEvent(e)||this._currentTransform)return;let n=this._shouldRender(t),o=!1;if(this.handleMultiSelection(e,t)?(t=this._activeObject,o=!0,n=!0):this._shouldClearSelection(e,t)&&this.discardActiveObject(e),this.selection&&(!t||!t.selectable&&!t.isEditing&&t!==this._activeObject)){const a=this.getScenePoint(e);this._groupSelector={x:a.x,y:a.y,deltaY:0,deltaX:0}}if(s=!!t&&t===this._activeObject,t){t.selectable&&t.activeOn==="down"&&this.setActiveObject(t,e);const a=t.findControl(this.getViewportPoint(e),Hn(e));if(t===this._activeObject&&(a||!o)){this._setupCurrentTransform(e,t,s);const l=a?a.control:void 0,c=this.getScenePoint(e),h=l&&l.getMouseDownHandler(e,t,l);h&&h.call(l,e,this._currentTransform,c.x,c.y)}}n&&(this._objectsToRender=void 0),this._handleEvent(e,"down",{alreadySelected:s}),n&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(e){this._resetTransformEventData(),this._pointer=this.getViewportPoint(e),this._absolutePointer=Bs(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)}__onMouseMove(e){if(this._isClick=!1,this._cacheTransformEventData(e),this._handleEvent(e,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(e);if(!this._isMainEvent(e))return;const t=this._groupSelector;if(t){const s=this.getScenePoint(e);t.deltaX=s.x-t.x,t.deltaY=s.y-t.y,this.renderTop()}else if(this._currentTransform)this._transformObject(e);else{const s=this.findTarget(e);this._setCursorFromEvent(e,s),this._fireOverOutEvents(e,s)}this.textEditingManager.onMouseMove(e),this._handleEvent(e,"move"),this._resetTransformEventData()}_fireOverOutEvents(e,t){const s=this._hoveredTarget,r=this._hoveredTargets,n=this.targets,o=Math.max(r.length,n.length);this.fireSyntheticInOutEvents("mouse",{e,target:t,oldTarget:s,fireCanvas:!0});for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("mouse",{e,target:n[a],oldTarget:r[a]});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(e,t){const s=this._draggedoverTarget,r=this._hoveredTargets,n=this.targets,o=Math.max(r.length,n.length);this.fireSyntheticInOutEvents("drag",x(x({},t),{},{target:e,oldTarget:s,fireCanvas:!0}));for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("drag",x(x({},t),{},{target:n[a],oldTarget:r[a]}));this._draggedoverTarget=e}fireSyntheticInOutEvents(e,t){let{target:s,oldTarget:r,fireCanvas:n,e:o}=t,a=ke(t,Pm);const{targetIn:l,targetOut:c,canvasIn:h,canvasOut:u}=Am[e],d=r!==s;if(r&&d){const g=x(x({},a),{},{e:o,target:r,nextTarget:s},As(this,o));n&&this.fire(u,g),r.fire(c,g)}if(s&&d){const g=x(x({},a),{},{e:o,target:s,previousTarget:r},As(this,o));n&&this.fire(h,g),s.fire(l,g)}}__onMouseWheel(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()}_transformObject(e){const t=this.getScenePoint(e),s=this._currentTransform,r=s.target,n=r.group?Bs(t,void 0,r.group.calcTransformMatrix()):t;s.shiftKey=e.shiftKey,s.altKey=!!this.centeredKey&&e[this.centeredKey],this._performTransformAction(e,s,n),s.actionPerformed&&this.requestRenderAll()}_performTransformAction(e,t,s){const{action:r,actionHandler:n,target:o}=t,a=!!n&&n(e,t,s.x,s.y);a&&o.setCoords(),r==="drag"&&a&&(t.target.isMoving=!0,this.setCursor(t.target.moveCursor||this.moveCursor)),t.actionPerformed=t.actionPerformed||a}_setCursorFromEvent(e,t){if(!t)return void this.setCursor(this.defaultCursor);let s=t.hoverCursor||this.hoverCursor;const r=bs(this._activeObject)?this._activeObject:null,n=(!r||t.group!==r)&&t.findControl(this.getViewportPoint(e));if(n){const o=n.control;this.setCursor(o.cursorStyleHandler(e,o,t))}else t.subTargetCheck&&this.targets.concat().reverse().map(o=>{s=o.hoverCursor||s}),this.setCursor(s)}handleMultiSelection(e,t){const s=this._activeObject,r=bs(s);if(s&&this._isSelectionKeyPressed(e)&&this.selection&&t&&t.selectable&&(s!==t||r)&&(r||!t.isDescendantOf(s)&&!s.isDescendantOf(t))&&!t.onSelect({e})&&!s.getActiveControl()){if(r){const n=s.getObjects();if(t===s){const o=this.getViewportPoint(e);if(!(t=this.searchPossibleTargets(n,o)||this.searchPossibleTargets(this._objects,o))||!t.selectable)return!1}t.group===s?(s.remove(t),this._hoveredTarget=t,this._hoveredTargets=[...this.targets],s.size()===1&&this._setActiveObject(s.item(0),e)):(s.multiSelectAdd(t),this._hoveredTarget=s,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(n,e)}else{s.isEditing&&s.exitEditing();const n=new($.getClass("ActiveSelection"))([],{canvas:this});n.multiSelectAdd(s,t),this._hoveredTarget=n,this._setActiveObject(n,e),this._fireSelectionEvents([s],e)}return!0}return!1}handleSelection(e){if(!this.selection||!this._groupSelector)return!1;const{x:t,y:s,deltaX:r,deltaY:n}=this._groupSelector,o=new O(t,s),a=o.add(new O(r,n)),l=o.min(a),c=o.max(a).subtract(l),h=this.collectObjects({left:l.x,top:l.y,width:c.x,height:c.y},{includeIntersecting:!this.selectionFullyContained}),u=o.eq(a)?h[0]?[h[0]]:[]:h.length>1?h.filter(d=>!d.onSelect({e})).reverse():h;if(u.length===1)this.setActiveObject(u[0],e);else if(u.length>1){const d=$.getClass("ActiveSelection");this.setActiveObject(new d(u,{canvas:this}),e)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const Sh={x1:0,y1:0,x2:0,y2:0},Nm=x(x({},Sh),{},{r1:0,r2:0}),Is=(i,e)=>isNaN(i)&&typeof e=="number"?e:i,Fm=/^(\d+\.\d+)%|(\d+)%$/;function kh(i){return i&&Fm.test(i)}function Th(i,e){const t=typeof i=="number"?i:typeof i=="string"?parseFloat(i)/(kh(i)?100:1):NaN;return Ys(0,Is(t,e),1)}const jm=/\s*;\s*/,Lm=/\s*:\s*/;function Im(i,e){let t,s;const r=i.getAttribute("style");if(r){const o=r.split(jm);o[o.length-1]===""&&o.pop();for(let a=o.length;a--;){const[l,c]=o[a].split(Lm).map(h=>h.trim());l==="stop-color"?t=c:l==="stop-opacity"&&(s=c)}}const n=new be(t||i.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:Th(i.getAttribute("offset"),0),color:n.toRgb(),opacity:Is(parseFloat(s||i.getAttribute("stop-opacity")||""),1)*n.getAlpha()*e}}function Rm(i,e){const t=[],s=i.getElementsByTagName("stop"),r=Th(e,1);for(let n=s.length;n--;)t.push(Im(s[n],r));return t}function Oh(i){return i.nodeName==="linearGradient"||i.nodeName==="LINEARGRADIENT"?"linear":"radial"}function Eh(i){return i.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function bt(i,e){return i.getAttribute(e)}function zm(i,e){return function(t,s){let r,{width:n,height:o,gradientUnits:a}=s;return Object.keys(t).reduce((l,c)=>{const h=t[c];return h==="Infinity"?r=1:h==="-Infinity"?r=0:(r=typeof h=="string"?parseFloat(h):h,typeof h=="string"&&kh(h)&&(r*=.01,a==="pixels"&&(c!=="x1"&&c!=="x2"&&c!=="r2"||(r*=n),c!=="y1"&&c!=="y2"||(r*=o)))),l[c]=r,l},{})}(Oh(i)==="linear"?function(t){return{x1:bt(t,"x1")||0,y1:bt(t,"y1")||0,x2:bt(t,"x2")||"100%",y2:bt(t,"y2")||0}}(i):function(t){return{x1:bt(t,"fx")||bt(t,"cx")||"50%",y1:bt(t,"fy")||bt(t,"cy")||"50%",r1:0,x2:bt(t,"cx")||"50%",y2:bt(t,"cy")||"50%",r2:bt(t,"r")||"50%"}}(i),x(x({},e),{},{gradientUnits:Eh(i)}))}class Ji{constructor(e){const{type:t="linear",gradientUnits:s="pixels",coords:r={},colorStops:n=[],offsetX:o=0,offsetY:a=0,gradientTransform:l,id:c}=e||{};Object.assign(this,{type:t,gradientUnits:s,coords:x(x({},t==="radial"?Nm:Sh),r),colorStops:n,offsetX:o,offsetY:a,gradientTransform:l,id:c?"".concat(c,"_").concat(cs()):cs()})}addColorStop(e){for(const t in e){const s=new be(e[t]);this.colorStops.push({offset:parseFloat(t),color:s.toRgb(),opacity:s.getAlpha()})}return this}toObject(e){return x(x({},ti(this,e)),{},{type:this.type,coords:x({},this.coords),colorStops:this.colorStops.map(t=>x({},t)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(e){let{additionalTransform:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=[],r=this.gradientTransform?this.gradientTransform.concat():et.concat(),n=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",o=this.colorStops.map(u=>x({},u)).sort((u,d)=>u.offset-d.offset);let a=-this.offsetX,l=-this.offsetY;var c;n==="objectBoundingBox"?(a/=e.width,l/=e.height):(a+=e.width/2,l+=e.height/2),(c=e)&&typeof c._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(a-=e.pathOffset.x,l-=e.pathOffset.y),r[4]-=a,r[5]-=l;const h=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(n,'"'),'gradientTransform="'.concat(t?t+" ":"").concat(Ti(r),'"'),""].join(" ");if(this.type==="linear"){const{x1:u,y1:d,x2:g,y2:p}=this.coords;s.push("<linearGradient ",h,' x1="',u,'" y1="',d,'" x2="',g,'" y2="',p,`">
`)}else if(this.type==="radial"){const{x1:u,y1:d,x2:g,y2:p,r1:y,r2:v}=this.coords,_=y>v;s.push("<radialGradient ",h,' cx="',_?u:g,'" cy="',_?d:p,'" r="',_?y:v,'" fx="',_?g:u,'" fy="',_?p:d,`">
`),_&&(o.reverse(),o.forEach(S=>{S.offset=1-S.offset}));const f=Math.min(y,v);if(f>0){const S=f/Math.max(y,v);o.forEach(C=>{C.offset+=S*(1-C.offset)})}}return o.forEach(u=>{let{color:d,offset:g,opacity:p}=u;s.push("<stop ",'offset="',100*g+"%",'" style="stop-color:',d,p!==void 0?";stop-opacity: "+p:";",`"/>
`)}),s.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),s.join("")}toLive(e){const{x1:t,y1:s,x2:r,y2:n,r1:o,r2:a}=this.coords,l=this.type==="linear"?e.createLinearGradient(t,s,r,n):e.createRadialGradient(t,s,o,r,n,a);return this.colorStops.forEach(c=>{let{color:h,opacity:u,offset:d}=c;l.addColorStop(d,u!==void 0?new be(h).setAlpha(u).toRgba():h)}),l}static async fromObject(e){const{colorStops:t,gradientTransform:s}=e;return new this(x(x({},e),{},{colorStops:t?t.map(r=>x({},r)):void 0,gradientTransform:s?[...s]:void 0}))}static fromElement(e,t,s){const r=Eh(e),n=t._findCenterFromElement();return new this(x({id:e.getAttribute("id")||void 0,type:Oh(e),coords:zm(e,{width:s.viewBoxWidth||s.width,height:s.viewBoxHeight||s.height}),colorStops:Rm(e,s.opacity),gradientUnits:r,gradientTransform:Gn(e.getAttribute("gradientTransform")||"")},r==="pixels"?{offsetX:t.width/2-n.x,offsetY:t.height/2-n.y}:{offsetX:0,offsetY:0}))}}w(Ji,"type","Gradient"),$.setClass(Ji,"gradient"),$.setClass(Ji,"linear"),$.setClass(Ji,"radial");const Bm=["type","source","patternTransform"];class xn{get type(){return"pattern"}set type(e){ls("warn","Setting type has no effect",e)}constructor(e){w(this,"repeat","repeat"),w(this,"offsetX",0),w(this,"offsetY",0),w(this,"crossOrigin",""),this.id=cs(),Object.assign(this,e)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(e){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?e.createPattern(this.source,this.repeat):null}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:t,crossOrigin:s}=this;return x(x({},ti(this,e)),{},{type:"pattern",source:this.sourceToString(),repeat:t,crossOrigin:s,offsetX:Ce(this.offsetX,ue.NUM_FRACTION_DIGITS),offsetY:Ce(this.offsetY,ue.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(e){let{width:t,height:s}=e;const{source:r,repeat:n,id:o}=this,a=Is(this.offsetX/t,0),l=Is(this.offsetY/s,0),c=n==="repeat-y"||n==="no-repeat"?1+Math.abs(a||0):Is(r.width/t,0),h=n==="repeat-x"||n==="no-repeat"?1+Math.abs(l||0):Is(r.height/s,0);return['<pattern id="SVGID_'.concat(o,'" x="').concat(a,'" y="').concat(l,'" width="').concat(c,'" height="').concat(h,'">'),'<image x="0" y="0" width="'.concat(r.width,'" height="').concat(r.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(e,t){let{type:s,source:r,patternTransform:n}=e,o=ke(e,Bm);const a=await Cr(r,x(x({},t),{},{crossOrigin:o.crossOrigin}));return new this(x(x({},o),{},{patternTransform:n&&n.slice(0),source:a}))}}w(xn,"type","Pattern"),$.setClass(xn),$.setClass(xn,"pattern");const $m=["path","left","top"],Vm=["d"];class vs extends Ze{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:s,left:r,top:n}=t,o=ke(t,$m);super(),Object.assign(this,vs.ownDefaults),this.setOptions(o),this._setPath(e||[],!0),typeof r=="number"&&this.set(ye,r),typeof n=="number"&&this.set(it,n)}_setPath(e,t){this.path=bm(Array.isArray(e)?e:Om(e)),this.setBoundingBox(t)}_findCenterFromElement(){const e=this._calcBoundsFromPath();return new O(e.left+e.width/2,e.top+e.height/2)}_renderPathCommands(e){const t=-this.pathOffset.x,s=-this.pathOffset.y;e.beginPath();for(const r of this.path)switch(r[0]){case"L":e.lineTo(r[1]+t,r[2]+s);break;case"M":e.moveTo(r[1]+t,r[2]+s);break;case"C":e.bezierCurveTo(r[1]+t,r[2]+s,r[3]+t,r[4]+s,r[5]+t,r[6]+s);break;case"Q":e.quadraticCurveTo(r[1]+t,r[2]+s,r[3]+t,r[4]+s);break;case"Z":e.closePath()}}_render(e){this._renderPathCommands(e),this._renderPaintInOrder(e)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return x(x({},super.toObject(e)),{},{path:this.path.map(t=>t.slice())})}toDatalessObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.toObject(e);return this.sourcePath&&(delete t.path,t.sourcePath=this.sourcePath),t}_toSVG(){const e=Em(this.path,ue.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(e,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const e=ue.NUM_FRACTION_DIGITS;return" translate(".concat(Ce(-this.pathOffset.x,e),", ").concat(Ce(-this.pathOffset.y,e),")")}toClipPathSVG(e){const t=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})}toSVG(e){const t=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{width:t,height:s,pathOffset:r}=this._calcDimensions();this.set({width:t,height:s,pathOffset:r}),e&&this.setPositionByOrigin(r,re,re)}_calcBoundsFromPath(){const e=[];let t=0,s=0,r=0,n=0;for(const o of this.path)switch(o[0]){case"L":r=o[1],n=o[2],e.push({x:t,y:s},{x:r,y:n});break;case"M":r=o[1],n=o[2],t=r,s=n;break;case"C":e.push(...pl(r,n,o[1],o[2],o[3],o[4],o[5],o[6])),r=o[5],n=o[6];break;case"Q":e.push(...pl(r,n,o[1],o[2],o[1],o[2],o[3],o[4])),r=o[3],n=o[4];break;case"Z":r=t,n=s}return Ut(e)}_calcDimensions(){const e=this._calcBoundsFromPath();return x(x({},e),{},{pathOffset:new O(e.left+e.width/2,e.top+e.height/2)})}static fromObject(e){return this._fromObject(e,{extraParam:"path"})}static async fromElement(e,t,s){const r=ts(e,this.ATTRIBUTE_NAMES,s),{d:n}=r;return new this(n,x(x(x({},ke(r,Vm)),t),{},{left:void 0,top:void 0}))}}w(vs,"type","Path"),w(vs,"cacheProperties",[...es,"path","fillRule"]),w(vs,"ATTRIBUTE_NAMES",[...ds,"d"]),$.setClass(vs),$.setSVGClass(vs);const Wm=["left","top","radius"],Mh=["radius","startAngle","endAngle","counterClockwise"];class Rt extends Ze{static getDefaults(){return x(x({},super.getDefaults()),Rt.ownDefaults)}constructor(e){super(),Object.assign(this,Rt.ownDefaults),this.setOptions(e)}_set(e,t){return super._set(e,t),e==="radius"&&this.setRadius(t),this}_render(e){e.beginPath(),e.arc(0,0,this.radius,je(this.startAngle),je(this.endAngle),this.counterClockwise),this._renderPaintInOrder(e)}getRadiusX(){return this.get("radius")*this.get(ot)}getRadiusY(){return this.get("radius")*this.get(mt)}setRadius(e){this.radius=e,this.set({width:2*e,height:2*e})}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...Mh,...e])}_toSVG(){const e=(this.endAngle-this.startAngle)%360;if(e===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:t}=this,s=je(this.startAngle),r=je(this.endAngle),n=qt(s)*t,o=Kt(s)*t,a=qt(r)*t,l=Kt(r)*t,c=e>180?1:0,h=this.counterClockwise?0:1;return['<path d="M '.concat(n," ").concat(o," A ").concat(t," ").concat(t," 0 ").concat(c," ").concat(h," ").concat(a," ").concat(l,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(e,t,s){const r=ts(e,this.ATTRIBUTE_NAMES,s),{left:n=0,top:o=0,radius:a=0}=r;return new this(x(x({},ke(r,Wm)),{},{radius:a,left:n-a,top:o-a}))}static fromObject(e){return super._fromObject(e)}}w(Rt,"type","Circle"),w(Rt,"cacheProperties",[...es,...Mh]),w(Rt,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),w(Rt,"ATTRIBUTE_NAMES",["cx","cy","r",...ds]),$.setClass(Rt),$.setSVGClass(Rt);const Hm=["x1","y1","x2","y2"],Um=["x1","y1","x2","y2"],Qn=["x1","x2","y1","y2"];class Bt extends Ze{constructor(){let[e,t,s,r]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Bt.ownDefaults),this.setOptions(n),this.x1=e,this.x2=s,this.y1=t,this.y2=r,this._setWidthHeight();const{left:o,top:a}=n;typeof o=="number"&&this.set(ye,o),typeof a=="number"&&this.set(it,a)}_setWidthHeight(){const{x1:e,y1:t,x2:s,y2:r}=this;this.width=Math.abs(s-e),this.height=Math.abs(r-t);const{left:n,top:o,width:a,height:l}=Ut([{x:e,y:t},{x:s,y:r}]),c=new O(n+a/2,o+l/2);this.setPositionByOrigin(c,re,re)}_set(e,t){return super._set(e,t),Qn.includes(e)&&this._setWidthHeight(),this}_render(e){e.beginPath();const t=this.calcLinePoints();e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2),e.lineWidth=this.strokeWidth;const s=e.strokeStyle;var r;ft(this.stroke)?e.strokeStyle=this.stroke.toLive(e):e.strokeStyle=(r=this.stroke)!==null&&r!==void 0?r:e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=s}_findCenterFromElement(){return new O((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return x(x({},super.toObject(e)),this.calcLinePoints())}_getNonTransformedDimensions(){const e=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(e.y-=this.strokeWidth),this.height===0&&(e.x-=this.strokeWidth)),e}calcLinePoints(){const{x1:e,x2:t,y1:s,y2:r,width:n,height:o}=this,a=e<=t?-1:1,l=s<=r?-1:1;return{x1:a*n/2,x2:a*-n/2,y1:l*o/2,y2:l*-o/2}}_toSVG(){const{x1:e,x2:t,y1:s,y2:r}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(e,'" y1="').concat(s,'" x2="').concat(t,'" y2="').concat(r,`" />
`)]}static async fromElement(e,t,s){const r=ts(e,this.ATTRIBUTE_NAMES,s),{x1:n=0,y1:o=0,x2:a=0,y2:l=0}=r;return new this([n,o,a,l],ke(r,Hm))}static fromObject(e){let{x1:t,y1:s,x2:r,y2:n}=e,o=ke(e,Um);return this._fromObject(x(x({},o),{},{points:[t,s,r,n]}),{extraParam:"points"})}}w(Bt,"type","Line"),w(Bt,"cacheProperties",[...es,...Qn]),w(Bt,"ATTRIBUTE_NAMES",ds.concat(Qn)),$.setClass(Bt),$.setSVGClass(Bt);class _s extends Ze{static getDefaults(){return x(x({},super.getDefaults()),_s.ownDefaults)}constructor(e){super(),Object.assign(this,_s.ownDefaults),this.setOptions(e)}_render(e){const t=this.width/2,s=this.height/2;e.beginPath(),e.moveTo(-t,s),e.lineTo(0,-s),e.lineTo(t,s),e.closePath(),this._renderPaintInOrder(e)}_toSVG(){const e=this.width/2,t=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-e," ").concat(t,",0 ").concat(-t,",").concat(e," ").concat(t),'" />']}}w(_s,"type","Triangle"),w(_s,"ownDefaults",{width:100,height:100}),$.setClass(_s),$.setSVGClass(_s);const Dh=["rx","ry"];class zt extends Ze{static getDefaults(){return x(x({},super.getDefaults()),zt.ownDefaults)}constructor(e){super(),Object.assign(this,zt.ownDefaults),this.setOptions(e)}_set(e,t){switch(super._set(e,t),e){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t)}return this}getRx(){return this.get("rx")*this.get(ot)}getRy(){return this.get("ry")*this.get(mt)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...Dh,...e])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,Dr,!1),e.restore(),this._renderPaintInOrder(e)}static async fromElement(e,t,s){const r=ts(e,this.ATTRIBUTE_NAMES,s);return r.left=(r.left||0)-r.rx,r.top=(r.top||0)-r.ry,new this(r)}}function Xm(i){if(!i)return[];const e=i.replace(/,/g," ").trim().split(/\s+/),t=[];for(let s=0;s<e.length;s+=2)t.push({x:parseFloat(e[s]),y:parseFloat(e[s+1])});return t}w(zt,"type","Ellipse"),w(zt,"cacheProperties",[...es,...Dh]),w(zt,"ownDefaults",{rx:0,ry:0}),w(zt,"ATTRIBUTE_NAMES",[...ds,"cx","cy","rx","ry"]),$.setClass(zt),$.setSVGClass(zt);const Ym=["left","top"],Ph={exactBoundingBox:!1};class wt extends Ze{static getDefaults(){return x(x({},super.getDefaults()),wt.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),w(this,"strokeDiff",void 0),Object.assign(this,wt.ownDefaults),this.setOptions(t),this.points=e;const{left:s,top:r}=t;this.initialized=!0,this.setBoundingBox(!0),typeof s=="number"&&this.set(ye,s),typeof r=="number"&&this.set(it,r)}isOpen(){return!0}_projectStrokeOnPoints(e){return jp(this.points,e,this.isOpen())}_calcDimensions(e){e=x({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},e||{});const t=this.exactBoundingBox?this._projectStrokeOnPoints(e).map(c=>c.projectedPoint):this.points;if(t.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new O,strokeOffset:new O,strokeDiff:new O};const s=Ut(t),r=Kr(x(x({},e),{},{scaleX:1,scaleY:1})),n=Ut(this.points.map(c=>st(c,r,!0))),o=new O(this.scaleX,this.scaleY);let a=s.left+s.width/2,l=s.top+s.height/2;return this.exactBoundingBox&&(a-=l*Math.tan(je(this.skewX)),l-=a*Math.tan(je(this.skewY))),x(x({},s),{},{pathOffset:new O(a,l),strokeOffset:new O(n.left,n.top).subtract(new O(s.left,s.top)).multiply(o),strokeDiff:new O(s.width,s.height).subtract(new O(n.width,n.height)).multiply(o)})}_findCenterFromElement(){const e=Ut(this.points);return new O(e.left+e.width/2,e.top+e.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{left:t,top:s,width:r,height:n,pathOffset:o,strokeOffset:a,strokeDiff:l}=this._calcDimensions();this.set({width:r,height:n,pathOffset:o,strokeOffset:a,strokeDiff:l}),e&&this.setPositionByOrigin(new O(t+r/2,s+n/2),re,re)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new O(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let o;if(Object.keys(e).some(a=>this.strokeUniform||this.constructor.layoutProperties.includes(a))){var t,s;const{width:a,height:l}=this._calcDimensions(e);o=new O((t=e.width)!==null&&t!==void 0?t:a,(s=e.height)!==null&&s!==void 0?s:l)}else{var r,n;o=new O((r=e.width)!==null&&r!==void 0?r:this.width,(n=e.height)!==null&&n!==void 0?n:this.height)}return o.multiply(new O(e.scaleX||this.scaleX,e.scaleY||this.scaleY))}return super._getTransformedDimensions(e)}_set(e,t){const s=this.initialized&&this[e]!==t,r=super._set(e,t);return this.exactBoundingBox&&s&&((e===ot||e===mt)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(e))&&this.setDimensions(),r}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return x(x({},super.toObject(e)),{},{points:this.points.map(t=>{let{x:s,y:r}=t;return{x:s,y:r}})})}_toSVG(){const e=[],t=this.pathOffset.x,s=this.pathOffset.y,r=ue.NUM_FRACTION_DIGITS;for(let n=0,o=this.points.length;n<o;n++)e.push(Ce(this.points[n].x-t,r),",",Ce(this.points[n].y-s,r)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(e.join(""),`" />
`)]}_render(e){const t=this.points.length,s=this.pathOffset.x,r=this.pathOffset.y;if(t&&!isNaN(this.points[t-1].y)){e.beginPath(),e.moveTo(this.points[0].x-s,this.points[0].y-r);for(let n=0;n<t;n++){const o=this.points[n];e.lineTo(o.x-s,o.y-r)}!this.isOpen()&&e.closePath(),this._renderPaintInOrder(e)}}complexity(){return this.points.length}static async fromElement(e,t,s){return new this(Xm(e.getAttribute("points")),x(x({},ke(ts(e,this.ATTRIBUTE_NAMES,s),Ym)),t))}static fromObject(e){return this._fromObject(e,{extraParam:"points"})}}w(wt,"ownDefaults",Ph),w(wt,"type","Polyline"),w(wt,"layoutProperties",[Zs,Qs,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),w(wt,"cacheProperties",[...es,"points"]),w(wt,"ATTRIBUTE_NAMES",[...ds]),$.setClass(wt),$.setSVGClass(wt);class Zi extends wt{isOpen(){return!1}}w(Zi,"ownDefaults",Ph),w(Zi,"type","Polygon"),$.setClass(Zi),$.setSVGClass(Zi);class Ah extends Ze{isEmptyStyles(e){if(!this.styles||e!==void 0&&!this.styles[e])return!0;const t=e===void 0?this.styles:{line:this.styles[e]};for(const s in t)for(const r in t[s])for(const n in t[s][r])return!1;return!0}styleHas(e,t){if(!this.styles||t!==void 0&&!this.styles[t])return!1;const s=t===void 0?this.styles:{0:this.styles[t]};for(const r in s)for(const n in s[r])if(s[r][n][e]!==void 0)return!0;return!1}cleanStyle(e){if(!this.styles)return!1;const t=this.styles;let s,r,n=0,o=!0,a=0;for(const l in t){s=0;for(const c in t[l]){const h=t[l][c]||{};n++,h[e]!==void 0?(r?h[e]!==r&&(o=!1):r=h[e],h[e]===this[e]&&delete h[e]):o=!1,Object.keys(h).length!==0?s++:delete t[l][c]}s===0&&delete t[l]}for(let l=0;l<this._textLines.length;l++)a+=this._textLines[l].length;o&&n===a&&(this[e]=r,this.removeStyle(e))}removeStyle(e){if(!this.styles)return;const t=this.styles;let s,r,n;for(r in t){for(n in s=t[r],s)delete s[n][e],Object.keys(s[n]).length===0&&delete s[n];Object.keys(s).length===0&&delete t[r]}}_extendStyles(e,t){const{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e);this._getLineStyle(s)||this._setLineStyle(s);const n=Ro(x(x({},this._getStyleDeclaration(s,r)),t),o=>o!==void 0);this._setStyleDeclaration(s,r,n)}getSelectionStyles(e,t,s){const r=[];for(let n=e;n<(t||e);n++)r.push(this.getStyleAtPosition(n,s));return r}getStyleAtPosition(e,t){const{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e);return t?this.getCompleteStyleDeclaration(s,r):this._getStyleDeclaration(s,r)}setSelectionStyles(e,t,s){for(let r=t;r<(s||t);r++)this._extendStyles(r,e);this._forceClearCache=!0}_getStyleDeclaration(e,t){var s;const r=this.styles&&this.styles[e];return r&&(s=r[t])!==null&&s!==void 0?s:{}}getCompleteStyleDeclaration(e,t){return x(x({},ti(this,this.constructor._styleProperties)),this._getStyleDeclaration(e,t))}_setStyleDeclaration(e,t,s){this.styles[e][t]=s}_deleteStyleDeclaration(e,t){delete this.styles[e][t]}_getLineStyle(e){return!!this.styles[e]}_setLineStyle(e){this.styles[e]={}}_deleteLineStyle(e){delete this.styles[e]}}w(Ah,"_styleProperties",Jf);const Gm=/  +/g,qm=/"/g;function Cn(i,e,t,s,r){return"		".concat(function(n,o){let{left:a,top:l,width:c,height:h}=o,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ue.NUM_FRACTION_DIGITS;const d=Oi(Ve,n,!1),[g,p,y,v]=[a,l,c,h].map(_=>Ce(_,u));return"<rect ".concat(d,' x="').concat(g,'" y="').concat(p,'" width="').concat(y,'" height="').concat(v,'"></rect>')}(i,{left:e,top:t,width:s,height:r}),`
`)}const Km=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Sn;class Xe extends Ah{static getDefaults(){return x(x({},super.getDefaults()),Xe.ownDefaults)}constructor(e,t){super(),w(this,"__charBounds",[]),Object.assign(this,Xe.ownDefaults),this.setOptions(t),this.styles||(this.styles={}),this.text=e,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const e=this.path;e&&(e.segmentsInfo=Ch(e.path))}_splitText(){const e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(Mt)&&this.enlargeSpaces()}enlargeSpaces(){let e,t,s,r,n,o,a;for(let l=0,c=this._textLines.length;l<c;l++)if((this.textAlign===Mt||l!==c-1&&!this.isEndOfWrapping(l))&&(r=0,n=this._textLines[l],t=this.getLineWidth(l),t<this.width&&(a=this.textLines[l].match(this._reSpacesAndTabs)))){s=a.length,e=(this.width-t)/s;for(let h=0;h<=n.length;h++)o=this.__charBounds[l][h],this._reSpaceAndTab.test(n[h])?(o.width+=e,o.kernedWidth+=e,o.left+=r,r+=e):o.left+=r}}isEndOfWrapping(e){return e===this._textLines.length-1}missingNewlineOffset(e){return 1}get2DCursorLocation(e,t){const s=t?this._unwrappedTextLines:this._textLines;let r;for(r=0;r<s.length;r++){if(e<=s[r].length)return{lineIndex:r,charIndex:e};e-=s[r].length+this.missingNewlineOffset(r,t)}return{lineIndex:r-1,charIndex:s[r-1].length<e?s[r-1].length:e}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const e=super._getCacheCanvasDimensions(),t=this.fontSize;return e.width+=t*e.zoomX,e.height+=t*e.zoomY,e}_render(e){const t=this.path;t&&!t.isNotVisible()&&t._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")}_renderText(e){this.paintFirst===nt?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))}_setTextStyles(e,t,s){if(e.textBaseline="alphabetic",this.path)switch(this.pathAlign){case re:e.textBaseline="middle";break;case"ascender":e.textBaseline=it;break;case"descender":e.textBaseline=Vn}e.font=this._getFontDeclaration(t,s)}calcTextWidth(){let e=this.getLineWidth(0);for(let t=1,s=this._textLines.length;t<s;t++){const r=this.getLineWidth(t);r>e&&(e=r)}return e}_renderTextLine(e,t,s,r,n,o){this._renderChars(e,t,s,r,n,o)}_renderTextLinesBackground(e){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const t=e.fillStyle,s=this._getLeftOffset();let r=this._getTopOffset();for(let n=0,o=this._textLines.length;n<o;n++){const a=this.getHeightOfLine(n);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",n)){r+=a;continue}const l=this._textLines[n].length,c=this._getLineLeftOffset(n);let h,u,d=0,g=0,p=this.getValueOfPropertyAt(n,0,"textBackgroundColor");for(let y=0;y<l;y++){const v=this.__charBounds[n][y];u=this.getValueOfPropertyAt(n,y,"textBackgroundColor"),this.path?(e.save(),e.translate(v.renderLeft,v.renderTop),e.rotate(v.angle),e.fillStyle=u,u&&e.fillRect(-v.width/2,-a/this.lineHeight*(1-this._fontSizeFraction),v.width,a/this.lineHeight),e.restore()):u!==p?(h=s+c+g,this.direction==="rtl"&&(h=this.width-h-d),e.fillStyle=p,p&&e.fillRect(h,r,d,a/this.lineHeight),g=v.left,d=v.width,p=u):d+=v.kernedWidth}u&&!this.path&&(h=s+c+g,this.direction==="rtl"&&(h=this.width-h-d),e.fillStyle=u,e.fillRect(h,r,d,a/this.lineHeight)),r+=a}e.fillStyle=t,this._removeShadow(e)}_measureChar(e,t,s,r){const n=bi.getFontCache(t),o=this._getFontDeclaration(t),a=s+e,l=s&&o===this._getFontDeclaration(r),c=t.fontSize/this.CACHE_FONT_SIZE;let h,u,d,g;if(s&&n[s]!==void 0&&(d=n[s]),n[e]!==void 0&&(g=h=n[e]),l&&n[a]!==void 0&&(u=n[a],g=u-d),h===void 0||d===void 0||u===void 0){const p=function(){return Sn||(Sn=yt({width:0,height:0}).getContext("2d")),Sn}();this._setTextStyles(p,t,!0),h===void 0&&(g=h=p.measureText(e).width,n[e]=h),d===void 0&&l&&s&&(d=p.measureText(s).width,n[s]=d),l&&u===void 0&&(u=p.measureText(a).width,n[a]=u,g=u-d)}return{width:h*c,kernedWidth:g*c}}getHeightOfChar(e,t){return this.getValueOfPropertyAt(e,t,"fontSize")}measureLine(e){const t=this._measureLine(e);return this.charSpacing!==0&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t}_measureLine(e){let t,s,r=0;const n=this.pathSide===Fe,o=this.path,a=this._textLines[e],l=a.length,c=new Array(l);this.__charBounds[e]=c;for(let h=0;h<l;h++){const u=a[h];s=this._getGraphemeBox(u,e,h,t),c[h]=s,r+=s.kernedWidth,t=u}if(c[l]={left:s?s.left+s.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},o&&o.segmentsInfo){let h=0;const u=o.segmentsInfo[o.segmentsInfo.length-1].length;switch(this.textAlign){case ye:h=n?u-r:0;break;case re:h=(u-r)/2;break;case Fe:h=n?0:u-r}h+=this.pathStartOffset*(n?-1:1);for(let d=n?l-1:0;n?d>=0:d<l;n?d--:d++)s=c[d],h>u?h%=u:h<0&&(h+=u),this._setGraphemeOnPath(h,s),h+=s.kernedWidth}return{width:r,numOfSpaces:0}}_setGraphemeOnPath(e,t){const s=e+t.kernedWidth/2,r=this.path,n=Cm(r.path,s,r.segmentsInfo);t.renderLeft=n.x-r.pathOffset.x,t.renderTop=n.y-r.pathOffset.y,t.angle=n.angle+(this.pathSide===Fe?Math.PI:0)}_getGraphemeBox(e,t,s,r,n){const o=this.getCompleteStyleDeclaration(t,s),a=r?this.getCompleteStyleDeclaration(t,s-1):{},l=this._measureChar(e,o,r,a);let c,h=l.kernedWidth,u=l.width;this.charSpacing!==0&&(c=this._getWidthOfCharSpacing(),u+=c,h+=c);const d={width:u,left:0,height:o.fontSize,kernedWidth:h,deltaY:o.deltaY};if(s>0&&!n){const g=this.__charBounds[t][s-1];d.left=g.left+g.width+l.kernedWidth-l.width}return d}getHeightOfLine(e){if(this.__lineHeights[e])return this.__lineHeights[e];let t=this.getHeightOfChar(e,0);for(let s=1,r=this._textLines[e].length;s<r;s++)t=Math.max(this.getHeightOfChar(e,s),t);return this.__lineHeights[e]=t*this.lineHeight*this._fontSizeMult}calcTextHeight(){let e,t=0;for(let s=0,r=this._textLines.length;s<r;s++)e=this.getHeightOfLine(s),t+=s===r-1?e/this.lineHeight:e;return t}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(e,t){e.save();let s=0;const r=this._getLeftOffset(),n=this._getTopOffset();for(let o=0,a=this._textLines.length;o<a;o++){const l=this.getHeightOfLine(o),c=l/this.lineHeight,h=this._getLineLeftOffset(o);this._renderTextLine(t,e,this._textLines[o],r+h,n+s+c,o),s+=l}e.restore()}_renderTextFill(e){(this.fill||this.styleHas(Ve))&&this._renderTextCommon(e,"fillText")}_renderTextStroke(e){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())}_renderChars(e,t,s,r,n,o){const a=this.getHeightOfLine(o),l=this.textAlign.includes(Mt),c=this.path,h=!l&&this.charSpacing===0&&this.isEmptyStyles(o)&&!c,u=this.direction==="ltr",d=this.direction==="ltr"?1:-1,g=t.direction;let p,y,v,_,f,S="",C=0;if(t.save(),g!==this.direction&&(t.canvas.setAttribute("dir",u?"ltr":"rtl"),t.direction=u?"ltr":"rtl",t.textAlign=u?ye:Fe),n-=a*this._fontSizeFraction/this.lineHeight,h)return this._renderChar(e,t,o,0,s.join(""),r,n),void t.restore();for(let k=0,T=s.length-1;k<=T;k++)_=k===T||this.charSpacing||c,S+=s[k],v=this.__charBounds[o][k],C===0?(r+=d*(v.kernedWidth-v.width),C+=v.width):C+=v.kernedWidth,l&&!_&&this._reSpaceAndTab.test(s[k])&&(_=!0),_||(p=p||this.getCompleteStyleDeclaration(o,k),y=this.getCompleteStyleDeclaration(o,k+1),_=Xo(p,y,!1)),_&&(c?(t.save(),t.translate(v.renderLeft,v.renderTop),t.rotate(v.angle),this._renderChar(e,t,o,k,S,-C/2,0),t.restore()):(f=r,this._renderChar(e,t,o,k,S,f,n)),S="",p=y,r+=d*C,C=0);t.restore()}_applyPatternGradientTransformText(e){const t=this.width+this.strokeWidth,s=this.height+this.strokeWidth,r=yt({width:t,height:s}),n=r.getContext("2d");return r.width=t,r.height=s,n.beginPath(),n.moveTo(0,0),n.lineTo(t,0),n.lineTo(t,s),n.lineTo(0,s),n.closePath(),n.translate(t/2,s/2),n.fillStyle=e.toLive(n),this._applyPatternGradientTransform(n,e),n.fill(),n.createPattern(r,"no-repeat")}handleFiller(e,t,s){let r,n;return ft(s)?s.gradientUnits==="percentage"||s.gradientTransform||s.patternTransform?(r=-this.width/2,n=-this.height/2,e.translate(r,n),e[t]=this._applyPatternGradientTransformText(s),{offsetX:r,offsetY:n}):(e[t]=s.toLive(e),this._applyPatternGradientTransform(e,s)):(e[t]=s,{offsetX:0,offsetY:0})}_setStrokeStyles(e,t){let{stroke:s,strokeWidth:r}=t;return e.lineWidth=r,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",s)}_setFillStyles(e,t){let{fill:s}=t;return this.handleFiller(e,"fillStyle",s)}_renderChar(e,t,s,r,n,o,a){const l=this._getStyleDeclaration(s,r),c=this.getCompleteStyleDeclaration(s,r),h=e==="fillText"&&c.fill,u=e==="strokeText"&&c.stroke&&c.strokeWidth;if(u||h){if(t.save(),t.font=this._getFontDeclaration(c),l.textBackgroundColor&&this._removeShadow(t),l.deltaY&&(a+=l.deltaY),h){const d=this._setFillStyles(t,c);t.fillText(n,o-d.offsetX,a-d.offsetY)}if(u){const d=this._setStrokeStyles(t,c);t.strokeText(n,o-d.offsetX,a-d.offsetY)}t.restore()}}setSuperscript(e,t){this._setScript(e,t,this.superscript)}setSubscript(e,t){this._setScript(e,t,this.subscript)}_setScript(e,t,s){const r=this.get2DCursorLocation(e,!0),n=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"fontSize"),o=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"deltaY"),a={fontSize:n*s.size,deltaY:o+n*s.baseline};this.setSelectionStyles(a,e,t)}_getLineLeftOffset(e){const t=this.getLineWidth(e),s=this.width-t,r=this.textAlign,n=this.direction,o=this.isEndOfWrapping(e);let a=0;return r===Mt||r===_i&&!o||r===vi&&!o||r===Ir&&!o?0:(r===re&&(a=s/2),r===Fe&&(a=s),r===_i&&(a=s/2),r===vi&&(a=s),n==="rtl"&&(r===Fe||r===Mt||r===vi?a=0:r===ye||r===Ir?a=-s:r!==re&&r!==_i||(a=-s/2)),a)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(e){if(this.__lineWidths[e]!==void 0)return this.__lineWidths[e];const{width:t}=this.measureLine(e);return this.__lineWidths[e]=t,t}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(e,t,s){var r;return(r=this._getStyleDeclaration(e,t)[s])!==null&&r!==void 0?r:this[s]}_renderTextDecoration(e,t){if(!this[t]&&!this.styleHas(t))return;let s=this._getTopOffset();const r=this._getLeftOffset(),n=this.path,o=this._getWidthOfCharSpacing(),a=t==="linethrough"?.5:t==="overline"?1:0,l=this.offsets[t];for(let c=0,h=this._textLines.length;c<h;c++){const u=this.getHeightOfLine(c);if(!this[t]&&!this.styleHas(t,c)){s+=u;continue}const d=this._textLines[c],g=u/this.lineHeight,p=this._getLineLeftOffset(c);let y=0,v=0,_=this.getValueOfPropertyAt(c,0,t),f=this.getValueOfPropertyAt(c,0,Ve),S=this.getValueOfPropertyAt(c,0,Ts),C=_,k=f,T=S;const F=s+g*(1-this._fontSizeFraction);let M=this.getHeightOfChar(c,0),A=this.getValueOfPropertyAt(c,0,"deltaY");for(let N=0,j=d.length;N<j;N++){const L=this.__charBounds[c][N];C=this.getValueOfPropertyAt(c,N,t),k=this.getValueOfPropertyAt(c,N,Ve),T=this.getValueOfPropertyAt(c,N,Ts);const G=this.getHeightOfChar(c,N),X=this.getValueOfPropertyAt(c,N,"deltaY");if(n&&C&&k){const P=this.fontSize*T/1e3;e.save(),e.fillStyle=f,e.translate(L.renderLeft,L.renderTop),e.rotate(L.angle),e.fillRect(-L.kernedWidth/2,l*G+X-a*P,L.kernedWidth,P),e.restore()}else if((C!==_||k!==f||G!==M||T!==S||X!==A)&&v>0){const P=this.fontSize*S/1e3;let D=r+p+y;this.direction==="rtl"&&(D=this.width-D-v),_&&f&&S&&(e.fillStyle=f,e.fillRect(D,F+l*M+A-a*P,v,P)),y=L.left,v=L.width,_=C,S=T,f=k,M=G,A=X}else v+=L.kernedWidth}let B=r+p+y;this.direction==="rtl"&&(B=this.width-B-v),e.fillStyle=k;const E=this.fontSize*T/1e3;C&&k&&T&&e.fillRect(B,F+l*M+A-a*E,v-o,E),s+=u}this._removeShadow(e)}_getFontDeclaration(){let{fontFamily:e=this.fontFamily,fontStyle:t=this.fontStyle,fontWeight:s=this.fontWeight,fontSize:r=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;const o=e.includes("'")||e.includes('"')||e.includes(",")||Xe.genericFonts.includes(e.toLowerCase())?e:'"'.concat(e,'"');return[t,s,"".concat(n?this.CACHE_FONT_SIZE:r,"px"),o].join(" ")}render(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(e)))}graphemeSplit(e){return Uo(e)}_splitTextIntoLines(e){const t=e.split(this._reNewline),s=new Array(t.length),r=[`
`];let n=[];for(let o=0;o<t.length;o++)s[o]=this.graphemeSplit(t[o]),n=n.concat(s[o],r);return n.pop(),{_unwrappedLines:s,lines:t,graphemeText:n,graphemeLines:s}}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return x(x({},super.toObject([...nh,...e])),{},{styles:zp(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(e,t){const{textLayoutProperties:s}=this.constructor;super.set(e,t);let r=!1,n=!1;if(typeof e=="object")for(const o in e)o==="path"&&this.setPathInfo(),r=r||s.includes(o),n=n||o==="path";else r=s.includes(e),n=e==="path";return n&&this.setPathInfo(),r&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(e,t,s){const r=ts(e,Xe.ATTRIBUTE_NAMES,s),n=x(x({},t),r),{textAnchor:o=ye,textDecoration:a="",dx:l=0,dy:c=0,top:h=0,left:u=0,fontSize:d=Ao,strokeWidth:g=1}=n,p=ke(n,Km),y=new this((e.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),x({left:u+l,top:h+c,underline:a.includes("underline"),overline:a.includes("overline"),linethrough:a.includes("line-through"),strokeWidth:0,fontSize:d},p)),v=y.getScaledHeight()/y.height,_=((y.height+y.strokeWidth)*y.lineHeight-y.height)*v,f=y.getScaledHeight()+_;let S=0;return o===re&&(S=y.getScaledWidth()/2),o===Fe&&(S=y.getScaledWidth()),y.set({left:y.left-S,top:y.top-(f-y.fontSize*(.07+y._fontSizeFraction))/y.lineHeight,strokeWidth:g}),y}static fromObject(e){return this._fromObject(x(x({},e),{},{styles:Bp(e.styles||{},e.text)}),{extraParam:"text"})}}w(Xe,"textLayoutProperties",rh),w(Xe,"cacheProperties",[...es,...nh]),w(Xe,"ownDefaults",Zf),w(Xe,"type","Text"),w(Xe,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),w(Xe,"ATTRIBUTE_NAMES",ds.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),fh(Xe,[class extends th{_toSVG(){const i=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(i.textTop,i.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(i){const e=this._createBaseSVGMarkup(this._toSVG(),{reviver:i,noStyle:!0,withShadow:!0}),t=this.path;return t?e+t._createBaseSVGMarkup(t._toSVG(),{reviver:i,withShadow:!0,additionalTransform:Ti(this.calcOwnMatrix())}):e}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(i){let{textBgRects:e,textSpans:t}=i;const s=this.getSvgTextDecoration(this);return[e.join(""),'		<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(qm,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",s?'text-decoration="'.concat(s,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",t.join(""),`</text>
`]}_getSVGTextAndBg(i,e){const t=[],s=[];let r,n=i;this.backgroundColor&&s.push(...Cn(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,a=this._textLines.length;o<a;o++)r=this._getLineLeftOffset(o),this.direction==="rtl"&&(r+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(s,o,e+r,n),this._setSVGTextLineText(t,o,e+r,n),n+=this.getHeightOfLine(o);return{textSpans:t,textBgRects:s}}_createTextCharSpan(i,e,t,s,r){const n=ue.NUM_FRACTION_DIGITS,o=this.getSvgSpanStyles(e,i!==i.trim()||!!i.match(Gm)),a=o?'style="'.concat(o,'"'):"",l=e.deltaY,c=l?' dy="'.concat(Ce(l,n),'" '):"",{angle:h,renderLeft:u,renderTop:d,width:g}=r;let p="";if(u!==void 0){const y=g/2;h&&(p=' rotate="'.concat(Ce(Zt(h),n),'"'));const v=ei({angle:Zt(h)});v[4]=u,v[5]=d;const _=new O(-y,0).transform(v);t=_.x,s=_.y}return'<tspan x="'.concat(Ce(t,n),'" y="').concat(Ce(s,n),'" ').concat(c).concat(p).concat(a,">").concat(Lp(i),"</tspan>")}_setSVGTextLineText(i,e,t,s){const r=this.getHeightOfLine(e),n=this.textAlign.includes(Mt),o=this._textLines[e];let a,l,c,h,u,d="",g=0;s+=r*(1-this._fontSizeFraction)/this.lineHeight;for(let p=0,y=o.length-1;p<=y;p++)u=p===y||this.charSpacing||this.path,d+=o[p],c=this.__charBounds[e][p],g===0?(t+=c.kernedWidth-c.width,g+=c.width):g+=c.kernedWidth,n&&!u&&this._reSpaceAndTab.test(o[p])&&(u=!0),u||(a=a||this.getCompleteStyleDeclaration(e,p),l=this.getCompleteStyleDeclaration(e,p+1),u=Xo(a,l,!0)),u&&(h=this._getStyleDeclaration(e,p),i.push(this._createTextCharSpan(d,h,t,s,c)),d="",a=l,this.direction==="rtl"?t-=g:t+=g,g=0)}_setSVGTextLineBg(i,e,t,s){const r=this._textLines[e],n=this.getHeightOfLine(e)/this.lineHeight;let o,a=0,l=0,c=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let h=0;h<r.length;h++){const{left:u,width:d,kernedWidth:g}=this.__charBounds[e][h];o=this.getValueOfPropertyAt(e,h,"textBackgroundColor"),o!==c?(c&&i.push(...Cn(c,t+l,s,a,n)),l=u,a=d,c=o):a+=g}o&&i.push(...Cn(c,t+l,s,a,n))}_getSVGLineTopOffset(i){let e,t=0;for(e=0;e<i;e++)t+=this.getHeightOfLine(e);const s=this.getHeightOfLine(e);return{lineTop:t,offset:(this._fontSizeMult-this._fontSizeFraction)*s/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(i){return"".concat(super.getSvgStyles(i)," text-decoration-thickness: ").concat(Ce(this.textDecorationThickness*this.getObjectScaling().y/10,ue.NUM_FRACTION_DIGITS),"%; white-space: pre;")}getSvgSpanStyles(i,e){const{fontFamily:t,strokeWidth:s,stroke:r,fill:n,fontSize:o,fontStyle:a,fontWeight:l,deltaY:c,textDecorationThickness:h,linethrough:u,overline:d,underline:g}=i,p=this.getSvgTextDecoration({underline:g!=null?g:this.underline,overline:d!=null?d:this.overline,linethrough:u!=null?u:this.linethrough}),y=h||this.textDecorationThickness;return[r?Oi(nt,r):"",s?"stroke-width: ".concat(s,"; "):"",t?"font-family: ".concat(t.includes("'")||t.includes('"')?t:"'".concat(t,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",a?"font-style: ".concat(a,"; "):"",l?"font-weight: ".concat(l,"; "):"",p?"text-decoration: ".concat(p,"; text-decoration-thickness: ").concat(Ce(y*this.getObjectScaling().y/10,ue.NUM_FRACTION_DIGITS),"%; "):"",n?Oi(Ve,n):"",c?"baseline-shift: ".concat(-c,"; "):"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(i){return["overline","underline","line-through"].filter(e=>i[e.replace("-","")]).join(" ")}}]),$.setClass(Xe),$.setSVGClass(Xe);class Jm{constructor(e){w(this,"target",void 0),w(this,"__mouseDownInPlace",!1),w(this,"__dragStartFired",!1),w(this,"__isDraggingOver",!1),w(this,"__dragStartSelection",void 0),w(this,"__dragImageDisposer",void 0),w(this,"_dispose",void 0),this.target=e;const t=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{t.forEach(s=>s()),this._dispose=void 0}}isPointerOverSelection(e){const t=this.target,s=t.getSelectionStartFromPointer(e);return t.isEditing&&s>=t.selectionStart&&s<=t.selectionEnd&&t.selectionStart<t.selectionEnd}start(e){return this.__mouseDownInPlace=this.isPointerOverSelection(e)}isActive(){return this.__mouseDownInPlace}end(e){const t=this.isActive();return t&&!this.__dragStartFired&&(this.target.setCursorByClick(e),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,t}getDragStartSelection(){return this.__dragStartSelection}setDragImage(e,t){var s;let{selectionStart:r,selectionEnd:n}=t;const o=this.target,a=o.canvas,l=new O(o.flipX?-1:1,o.flipY?-1:1),c=o._getCursorBoundaries(r),h=new O(c.left+c.leftOffset,c.top+c.topOffset).multiply(l).transform(o.calcTransformMatrix()),u=a.getScenePoint(e).subtract(h),d=o.getCanvasRetinaScaling(),g=o.getBoundingRect(),p=h.subtract(new O(g.left,g.top)),y=a.viewportTransform,v=p.add(u).transform(y,!0),_=o.backgroundColor,f=Ho(o.styles);o.backgroundColor="";const S={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};o.setSelectionStyles(S,0,r),o.setSelectionStyles(S,n,o.text.length),o.dirty=!0;const C=o.toCanvasElement({enableRetinaScaling:a.enableRetinaScaling,viewportTransform:!0});o.backgroundColor=_,o.styles=f,o.dirty=!0,Jn(C,{position:"fixed",left:"".concat(-C.width,"px"),border:rt,width:"".concat(C.width/d,"px"),height:"".concat(C.height/d,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{C.remove()},Ct(e.target||this.target.hiddenTextarea).body.appendChild(C),(s=e.dataTransfer)===null||s===void 0||s.setDragImage(C,v.x,v.y)}onDragStart(e){this.__dragStartFired=!0;const t=this.target,s=this.isActive();if(s&&e.dataTransfer){const r=this.__dragStartSelection={selectionStart:t.selectionStart,selectionEnd:t.selectionEnd},n=t._text.slice(r.selectionStart,r.selectionEnd).join(""),o=x({text:t.text,value:n},r);e.dataTransfer.setData("text/plain",n),e.dataTransfer.setData("application/fabric",JSON.stringify({value:n,styles:t.getSelectionStyles(r.selectionStart,r.selectionEnd,!0)})),e.dataTransfer.effectAllowed="copyMove",this.setDragImage(e,o)}return t.abortCursorAnimation(),s}canDrop(e){if(this.target.editable&&!this.target.getActiveControl()&&!e.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const t=this.target.getSelectionStartFromPointer(e),s=this.__dragStartSelection;return t<s.selectionStart||t>s.selectionEnd}return!0}return!1}targetCanDrop(e){return this.target.canDrop(e)}dragEnterHandler(e){let{e:t}=e;const s=this.targetCanDrop(t);!this.__isDraggingOver&&s&&(this.__isDraggingOver=!0)}dragOverHandler(e){const{e:t}=e,s=this.targetCanDrop(t);!this.__isDraggingOver&&s?this.__isDraggingOver=!0:this.__isDraggingOver&&!s&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(t.preventDefault(),e.canDrop=!0,e.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(e){var t;const{e:s}=e,r=s.defaultPrevented;this.__isDraggingOver=!1,s.preventDefault();let n=(t=s.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain");if(n&&!r){const o=this.target,a=o.canvas;let l=o.getSelectionStartFromPointer(s);const{styles:c}=s.dataTransfer.types.includes("application/fabric")?JSON.parse(s.dataTransfer.getData("application/fabric")):{},h=n[Math.max(0,n.length-1)],u=0;if(this.__dragStartSelection){const d=this.__dragStartSelection.selectionStart,g=this.__dragStartSelection.selectionEnd;l>d&&l<=g?l=d:l>g&&(l-=g-d),o.removeChars(d,g),delete this.__dragStartSelection}o._reNewline.test(h)&&(o._reNewline.test(o._text[l])||l===o._text.length)&&(n=n.trimEnd()),e.didDrop=!0,e.dropTarget=o,o.insertChars(n,c,l),a.setActiveObject(o),o.enterEditing(s),o.selectionStart=Math.min(l+u,o._text.length),o.selectionEnd=Math.min(o.selectionStart+n.length,o._text.length),o.hiddenTextarea.value=o.text,o._updateTextarea(),o.hiddenTextarea.focus(),o.fire(Pr,{index:l+u,action:"drop"}),a.fire("text:changed",{target:o}),a.contextTopDirty=!0,a.requestRenderAll()}}dragEndHandler(e){let{e:t}=e;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var s;const r=this.target,n=this.target.canvas,{selectionStart:o,selectionEnd:a}=this.__dragStartSelection,l=((s=t.dataTransfer)===null||s===void 0?void 0:s.dropEffect)||rt;l===rt?(r.selectionStart=o,r.selectionEnd=a,r._updateTextarea(),r.hiddenTextarea.focus()):(r.clearContextTop(),l==="move"&&(r.removeChars(o,a),r.selectionStart=r.selectionEnd=o,r.hiddenTextarea&&(r.hiddenTextarea.value=r.text),r._updateTextarea(),r.fire(Pr,{index:o,action:"dragend"}),n.fire("text:changed",{target:r}),n.requestRenderAll()),r.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const bl=/[ \n\.,;!\?\-]/;class Zm extends Xe{constructor(){super(...arguments),w(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(e){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(e)}_animateCursor(e){let{toValue:t,duration:s,delay:r,onComplete:n}=e;return ch({startValue:this._currentCursorOpacity,endValue:t,duration:s,delay:r,onComplete:n,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:o=>{this._currentCursorOpacity=o,this.renderCursorOrSelection()}})}_tick(e){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(e||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var e;(e=this._currentTickCompleteState)===null||e===void 0||e.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(e){this.abortCursorAnimation(),this._tick(e?0:this.cursorDelay)}abortCursorAnimation(){let e=!1;[this._currentTickState,this._currentTickCompleteState].forEach(t=>{t&&!t.isDone()&&(e=!0,t.abort())}),this._currentCursorOpacity=1,e&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(e=>!e||e.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(e){let t=0,s=e-1;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)t++,s--;for(;/\S/.test(this._text[s])&&s>-1;)t++,s--;return e-t}findWordBoundaryRight(e){let t=0,s=e;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)t++,s++;for(;/\S/.test(this._text[s])&&s<this._text.length;)t++,s++;return e+t}findLineBoundaryLeft(e){let t=0,s=e-1;for(;!/\n/.test(this._text[s])&&s>-1;)t++,s--;return e-t}findLineBoundaryRight(e){let t=0,s=e;for(;!/\n/.test(this._text[s])&&s<this._text.length;)t++,s++;return e+t}searchWordBoundary(e,t){const s=this._text;let r=e>0&&this._reSpace.test(s[e])&&(t===-1||!No.test(s[e-1]))?e-1:e,n=s[r];for(;r>0&&r<s.length&&!bl.test(n);)r+=t,n=s[r];return t===-1&&bl.test(n)&&r++,r}selectWord(e){var t;e=(t=e)!==null&&t!==void 0?t:this.selectionStart;const s=this.searchWordBoundary(e,-1),r=Math.max(s,this.searchWordBoundary(e,1));this.selectionStart=s,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(e){var t;e=(t=e)!==null&&t!==void 0?t:this.selectionStart;const s=this.findLineBoundaryLeft(e),r=this.findLineBoundaryRight(e);this.selectionStart=s,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(e){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",e?{e}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(e){if(this.getActiveControl())return;const t=this.hiddenTextarea;Ct(t).activeElement!==t&&t.focus();const s=this.getSelectionStartFromPointer(e),r=this.selectionStart,n=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&r!==n||r!==s&&n!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===r&&this.selectionEnd===n||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(e,t,s){const r=s.slice(0,e),n=this.graphemeSplit(r).length;if(e===t)return{selectionStart:n,selectionEnd:n};const o=s.slice(e,t);return{selectionStart:n,selectionEnd:n+this.graphemeSplit(o).length}}fromGraphemeToStringSelection(e,t,s){const r=s.slice(0,e).join("").length;return e===t?{selectionStart:r,selectionEnd:r}:{selectionStart:r,selectionEnd:r+s.slice(e,t).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const e=this.hiddenTextarea;this.text=e.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const t=this.fromStringToGraphemeSelection(e.selectionStart,e.selectionEnd,e.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const e=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(e),s=this.get2DCursorLocation(e),r=s.lineIndex,n=s.charIndex,o=this.getValueOfPropertyAt(r,n,"fontSize")*this.lineHeight,a=t.leftOffset,l=this.getCanvasRetinaScaling(),c=this.canvas.upperCanvasEl,h=c.width/l,u=c.height/l,d=h-o,g=u-o,p=new O(t.left+a,t.top+t.topOffset+o).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new O(c.clientWidth/h,c.clientHeight/u));return p.x<0&&(p.x=0),p.x>d&&(p.x=d),p.y<0&&(p.y=0),p.y>g&&(p.y=g),p.x+=this.canvas._offset.left,p.y+=this.canvas._offset.top,{left:"".concat(p.x,"px"),top:"".concat(p.y,"px"),fontSize:"".concat(o,"px"),charHeight:o}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const e=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,e&&(e.blur&&e.blur(),e.parentNode&&e.parentNode.removeChild(e)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const e=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),e&&this.fire(Ar),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const e in this.styles)this._textLines[e]||delete this.styles[e]}removeStyleFromTo(e,t){const{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e,!0),{lineIndex:n,charIndex:o}=this.get2DCursorLocation(t,!0);if(s!==n){if(this.styles[s])for(let a=r;a<this._unwrappedTextLines[s].length;a++)delete this.styles[s][a];if(this.styles[n])for(let a=o;a<this._unwrappedTextLines[n].length;a++){const l=this.styles[n][a];l&&(this.styles[s]||(this.styles[s]={}),this.styles[s][r+a-o]=l)}for(let a=s+1;a<=n;a++)delete this.styles[a];this.shiftLineStyles(n,s-n)}else if(this.styles[s]){const a=this.styles[s],l=o-r;for(let c=r;c<o;c++)delete a[c];for(const c in this.styles[s]){const h=parseInt(c,10);h>=o&&(a[h-l]=a[c],delete a[c])}}}shiftLineStyles(e,t){const s=Object.assign({},this.styles);for(const r in this.styles){const n=parseInt(r,10);n>e&&(this.styles[n+t]=s[n],s[n-t]||delete this.styles[n])}}insertNewlineStyleObject(e,t,s,r){const n={},o=this._unwrappedTextLines[e].length,a=o===t;let l=!1;s||(s=1),this.shiftLineStyles(e,s);const c=this.styles[e]?this.styles[e][t===0?t:t-1]:void 0;for(const u in this.styles[e]){const d=parseInt(u,10);d>=t&&(l=!0,n[d-t]=this.styles[e][u],a&&t===0||delete this.styles[e][u])}let h=!1;for(l&&!a&&(this.styles[e+s]=n,h=!0),(h||o>t)&&s--;s>0;)r&&r[s-1]?this.styles[e+s]={0:x({},r[s-1])}:c?this.styles[e+s]={0:x({},c)}:delete this.styles[e+s],s--;this._forceClearCache=!0}insertCharStyleObject(e,t,s,r){this.styles||(this.styles={});const n=this.styles[e],o=n?x({},n):{};s||(s=1);for(const l in o){const c=parseInt(l,10);c>=t&&(n[c+s]=o[c],o[c-s]||delete n[c])}if(this._forceClearCache=!0,r){for(;s--;)Object.keys(r[s]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][t+s]=x({},r[s]));return}if(!n)return;const a=n[t?t-1:1];for(;a&&s--;)this.styles[e][t+s]=x({},a)}insertNewStyleBlock(e,t,s){const r=this.get2DCursorLocation(t,!0),n=[0];let o,a=0;for(let l=0;l<e.length;l++)e[l]===`
`?(a++,n[a]=0):n[a]++;for(n[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,n[0],s),s=s&&s.slice(n[0]+1)),a&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+n[0],a),o=1;o<a;o++)n[o]>0?this.insertCharStyleObject(r.lineIndex+o,0,n[o],s):s&&this.styles[r.lineIndex+o]&&s[0]&&(this.styles[r.lineIndex+o][0]=s[0]),s=s&&s.slice(n[o]+1);n[o]>0&&this.insertCharStyleObject(r.lineIndex+o,0,n[o],s)}removeChars(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e+1;this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s;r>s&&this.removeStyleFromTo(s,r);const n=this.graphemeSplit(e);this.insertNewStyleBlock(n,s,t),this._text=[...this._text.slice(0,s),...n,...this._text.slice(r)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(e,t,s){s<=e?(t===e?this._selectionDirection=ye:this._selectionDirection===Fe&&(this._selectionDirection=ye,this.selectionEnd=e),this.selectionStart=s):s>e&&s<t?this._selectionDirection===Fe?this.selectionEnd=s:this.selectionStart=s:(t===e?this._selectionDirection=Fe:this._selectionDirection===ye&&(this._selectionDirection=Fe,this.selectionStart=t),this.selectionEnd=s)}}class Qm extends Zm{initHiddenTextarea(){const e=this.canvas&&Ct(this.canvas.getElement())||Js(),t=e.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(o=>{let[a,l]=o;return t.setAttribute(a,l)});const{top:s,left:r,fontSize:n}=this._calcTextareaPosition();t.style.cssText="position: absolute; top: ".concat(s,"; left: ").concat(r,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(n,";"),(this.hiddenTextareaContainer||e.body).appendChild(t),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(o=>{let[a,l]=o;return t.addEventListener(a,this[l].bind(this))}),this.hiddenTextarea=t}blur(){this.abortCursorAnimation()}onKeyDown(e){if(!this.isEditing)return;const t=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(e.keyCode in t)this[t[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown)||!e.ctrlKey&&!e.metaKey)return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(e){const t=this.fromPaste,{value:s,selectionStart:r,selectionEnd:n}=this.hiddenTextarea;if(this.fromPaste=!1,e&&e.stopPropagation(),!this.isEditing)return;const o=()=>{this.updateFromTextArea(),this.fire(Pr),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void o();const a=this._splitTextIntoLines(s).graphemeText,l=this._text.length,c=a.length,h=this.selectionStart,u=this.selectionEnd,d=h!==u;let g,p,y,v,_=c-l;const f=this.fromStringToGraphemeSelection(r,n,s),S=h>f.selectionStart;d?(p=this._text.slice(h,u),_+=u-h):c<l&&(p=S?this._text.slice(u+_,u):this._text.slice(h,h-_));const C=a.slice(f.selectionEnd-_,f.selectionEnd);if(p&&p.length&&(C.length&&(g=this.getSelectionStyles(h,h+1,!1),g=C.map(()=>g[0])),d?(y=h,v=u):S?(y=u-p.length,v=u):(y=u,v=u+p.length),this.removeStyleFromTo(y,v)),C.length){const{copyPasteData:k}=Nt();t&&C.join("")===k.copiedText&&!ue.disableStyleCopyPaste&&(g=k.copiedTextStyle),this.insertNewStyleBlock(C,h,g)}o()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(e){let{target:t}=e;const{selectionStart:s,selectionEnd:r}=t;this.compositionStart=s,this.compositionEnd=r,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:e}=Nt();e.copiedText=this.getSelectedText(),ue.disableStyleCopyPaste?e.copiedTextStyle=void 0:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(e,t){let s,r=this._getLineLeftOffset(e);return t>0&&(s=this.__charBounds[e][t-1],r+=s.left+s.width),r}getDownCursorOffset(e,t){const s=this._getSelectionForOffset(e,t),r=this.get2DCursorLocation(s),n=r.lineIndex;if(n===this._textLines.length-1||e.metaKey||e.keyCode===34)return this._text.length-s;const o=r.charIndex,a=this._getWidthBeforeCursor(n,o),l=this._getIndexOnLine(n+1,a);return this._textLines[n].slice(o).length+l+1+this.missingNewlineOffset(n)}_getSelectionForOffset(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart}getUpCursorOffset(e,t){const s=this._getSelectionForOffset(e,t),r=this.get2DCursorLocation(s),n=r.lineIndex;if(n===0||e.metaKey||e.keyCode===33)return-s;const o=r.charIndex,a=this._getWidthBeforeCursor(n,o),l=this._getIndexOnLine(n-1,a),c=this._textLines[n].slice(0,o),h=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+l-c.length+(1-h)}_getIndexOnLine(e,t){const s=this._textLines[e];let r,n,o=this._getLineLeftOffset(e),a=0;for(let l=0,c=s.length;l<c;l++)if(r=this.__charBounds[e][l].width,o+=r,o>t){n=!0;const h=o-r,u=o,d=Math.abs(h-t);a=Math.abs(u-t)<d?l:l-1;break}return n||(a=s.length-1),a}moveCursorDown(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)}moveCursorUp(e){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",e)}_moveCursorUpOrDown(e,t){const s=this["get".concat(e,"CursorOffset")](t,this._selectionDirection===Fe);if(t.shiftKey?this.moveCursorWithShift(s):this.moveCursorWithoutShift(s),s!==0){const r=this.text.length;this.selectionStart=Ys(0,this.selectionStart,r),this.selectionEnd=Ys(0,this.selectionEnd,r),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(e){const t=this._selectionDirection===ye?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),e!==0}moveCursorWithoutShift(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),e!==0}moveCursorLeft(e){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",e)}_move(e,t,s){let r;if(e.altKey)r=this["findWordBoundary".concat(s)](this[t]);else{if(!e.metaKey&&e.keyCode!==35&&e.keyCode!==36)return this[t]+=s==="Left"?-1:1,!0;r=this["findLineBoundary".concat(s)](this[t])}return r!==void 0&&this[t]!==r&&(this[t]=r,!0)}_moveLeft(e,t){return this._move(e,t,"Left")}_moveRight(e,t){return this._move(e,t,"Right")}moveCursorLeftWithoutShift(e){let t=!0;return this._selectionDirection=ye,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t}moveCursorLeftWithShift(e){return this._selectionDirection===Fe&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=ye,this._moveLeft(e,"selectionStart")):void 0}moveCursorRight(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)}_moveCursorLeftOrRight(e,t){const s="moveCursor".concat(e).concat(t.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[s](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(e){return this._selectionDirection===ye&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=Fe,this._moveRight(e,"selectionEnd")):void 0}moveCursorRightWithoutShift(e){let t=!0;return this._selectionDirection=Fe,this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t}}const vl=i=>!!i.button;class ey extends Qm{constructor(){super(...arguments),w(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new Jm(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(e){return this.draggableTextDelegate.onDragStart(e)}canDrop(e){return this.draggableTextDelegate.canDrop(e)}doubleClickHandler(e){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}tripleClickHandler(e){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}_mouseDownHandler(e){let{e:t,alreadySelected:s}=e;this.canvas&&this.editable&&!vl(t)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(t)||(this.canvas.textEditingManager.register(this),s&&(this.inCompositionMode=!1,this.setCursorByClick(t)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=s||this.isEditing)))}mouseUpHandler(e){let{e:t,transform:s}=e;const r=this.draggableTextDelegate.end(t);if(this.canvas){this.canvas.textEditingManager.unregister(this);const n=this.canvas._activeObject;if(n&&n!==this)return}!this.editable||this.group&&!this.group.interactive||s&&s.actionPerformed||vl(t)||r||this.selected&&!this.getActiveControl()&&(this.enterEditing(t),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(e){const t=this.getSelectionStartFromPointer(e),s=this.selectionStart,r=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(s,r,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(e){const t=this.canvas.getScenePoint(e).transform(St(this.calcTransformMatrix())).add(new O(-this._getLeftOffset(),-this._getTopOffset()));let s=0,r=0,n=0;for(let c=0;c<this._textLines.length&&s<=t.y;c++)s+=this.getHeightOfLine(c),n=c,c>0&&(r+=this._textLines[c-1].length+this.missingNewlineOffset(c-1));let o=Math.abs(this._getLineLeftOffset(n));const a=this._textLines[n].length,l=this.__charBounds[n];for(let c=0;c<a;c++){const h=o+l[c].kernedWidth;if(t.x<=h){Math.abs(t.x-h)<=Math.abs(t.x-o)&&r++;break}o=h,r++}return Math.min(this.flipX?a-r:r,this._text.length)}}const Qi="moveCursorUp",er="moveCursorDown",tr="moveCursorLeft",sr="moveCursorRight",ir="exitEditing",_l=(i,e)=>{const t=e.getRetinaScaling();i.setTransform(t,0,0,t,0,0);const s=e.viewportTransform;i.transform(s[0],s[1],s[2],s[3],s[4],s[5])},ty=x({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:ir,27:ir,33:Qi,34:er,35:sr,36:tr,37:tr,38:Qi,39:sr,40:er},keysMapRtl:{9:ir,27:ir,33:Qi,34:er,35:tr,36:sr,37:sr,38:Qi,39:tr,40:er},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class Vt extends ey{static getDefaults(){return x(x({},super.getDefaults()),Vt.ownDefaults)}get type(){const e=super.type;return e==="itext"?"i-text":e}constructor(e,t){super(e,x(x({},Vt.ownDefaults),t)),this.initBehavior()}_set(e,t){return this.isEditing&&this._savedProps&&e in this._savedProps?(this._savedProps[e]=t,this):(e==="canvas"&&(this.canvas instanceof Zn&&this.canvas.textEditingManager.remove(this),t instanceof Zn&&t.textEditingManager.add(this)),super._set(e,t))}setSelectionStart(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)}setSelectionEnd(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)}_updateAndFire(e,t){this[e]!==t&&(this._fireSelectionChanged(),this[e]=t),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,s=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(e,t,s)}setSelectionStyles(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(e,t,s)}get2DCursorLocation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,t=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(e,t)}render(e){super.render(e),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(e){const t=this.isEditing;this.isEditing=!1;const s=super.toCanvasElement(e);return this.isEditing=t,s}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const e=this.clearContextTop(!0);if(!e)return;const t=this._getCursorBoundaries(),s=this.findAncestorsWithClipPath(),r=s.length>0;let n,o=e;if(r){n=yt(e.canvas),o=n.getContext("2d"),_l(o,this.canvas);const a=this.calcTransformMatrix();o.transform(a[0],a[1],a[2],a[3],a[4],a[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(o,t):this.renderCursor(o,t),r)for(const a of s){const l=a.clipPath,c=yt(e.canvas),h=c.getContext("2d");if(_l(h,this.canvas),!l.absolutePositioned){const u=a.calcTransformMatrix();h.transform(u[0],u[1],u[2],u[3],u[4],u[5])}l.transform(h),l.drawObject(h,!0,{}),this.drawClipPathOnCache(o,l,c)}r&&(e.setTransform(1,0,0,1,0,0),e.drawImage(n,0,0)),this.canvas.contextTopDirty=!0,e.restore()}findAncestorsWithClipPath(){const e=[];let t=this;for(;t;)t.clipPath&&e.push(t),t=t.parent;return e}_getCursorBoundaries(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,t=arguments.length>1?arguments[1]:void 0;const s=this._getLeftOffset(),r=this._getTopOffset(),n=this._getCursorBoundariesOffsets(e,t);return{left:s,top:r,leftOffset:n.left,topOffset:n.top}}_getCursorBoundariesOffsets(e,t){return t?this.__getCursorBoundariesOffsets(e):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(e)}__getCursorBoundariesOffsets(e){let t=0,s=0;const{charIndex:r,lineIndex:n}=this.get2DCursorLocation(e);for(let c=0;c<n;c++)t+=this.getHeightOfLine(c);const o=this._getLineLeftOffset(n),a=this.__charBounds[n][r];a&&(s=a.left),this.charSpacing!==0&&r===this._textLines[n].length&&(s-=this._getWidthOfCharSpacing());const l={top:t,left:o+(s>0?s:0)};return this.direction==="rtl"&&(this.textAlign===Fe||this.textAlign===Mt||this.textAlign===vi?l.left*=-1:this.textAlign===ye||this.textAlign===Ir?l.left=o-(s>0?s:0):this.textAlign!==re&&this.textAlign!==_i||(l.left=o-(s>0?s:0))),l}renderCursorAt(e){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(e,!0),e)}renderCursor(e,t){this._renderCursor(e,t,this.selectionStart)}getCursorRenderingData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(e);const s=this.get2DCursorLocation(e),r=s.lineIndex,n=s.charIndex>0?s.charIndex-1:0,o=this.getValueOfPropertyAt(r,n,"fontSize"),a=this.getObjectScaling().x*this.canvas.getZoom(),l=this.cursorWidth/a,c=this.getValueOfPropertyAt(r,n,"deltaY"),h=t.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-o*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(r,n,"fill"),opacity:this._currentCursorOpacity,left:t.left+t.leftOffset-l/2,top:h+t.top+c,width:l,height:o}}_renderCursor(e,t,s){const{color:r,opacity:n,left:o,top:a,width:l,height:c}=this.getCursorRenderingData(s,t);e.fillStyle=r,e.globalAlpha=n,e.fillRect(o,a,l,c)}renderSelection(e,t){const s={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(e,s,t)}renderDragSourceEffect(){const e=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,e,this._getCursorBoundaries(e.selectionStart,!0))}renderDropTargetEffect(e){const t=this.getSelectionStartFromPointer(e);this.renderCursorAt(t)}_renderSelection(e,t,s){const r=t.selectionStart,n=t.selectionEnd,o=this.textAlign.includes(Mt),a=this.get2DCursorLocation(r),l=this.get2DCursorLocation(n),c=a.lineIndex,h=l.lineIndex,u=a.charIndex<0?0:a.charIndex,d=l.charIndex<0?0:l.charIndex;for(let g=c;g<=h;g++){const p=this._getLineLeftOffset(g)||0;let y=this.getHeightOfLine(g),v=0,_=0,f=0;if(g===c&&(_=this.__charBounds[c][u].left),g>=c&&g<h)f=o&&!this.isEndOfWrapping(g)?this.width:this.getLineWidth(g)||5;else if(g===h)if(d===0)f=this.__charBounds[h][d].left;else{const F=this._getWidthOfCharSpacing();f=this.__charBounds[h][d-1].left+this.__charBounds[h][d-1].width-F}v=y,(this.lineHeight<1||g===h&&this.lineHeight>1)&&(y/=this.lineHeight);let S=s.left+p+_,C=y,k=0;const T=f-_;this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",C=1,k=y):e.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===Fe||this.textAlign===Mt||this.textAlign===vi?S=this.width-S-T:this.textAlign===ye||this.textAlign===Ir?S=s.left+p-f:this.textAlign!==re&&this.textAlign!==_i||(S=s.left+p-f)),e.fillRect(S,s.top+s.topOffset+k,T,C),s.topOffset+=v}}getCurrentCharFontSize(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")}getCurrentCharColor(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,Ve)}_getCurrentCharIndex(){const e=this.get2DCursorLocation(this.selectionStart,!0),t=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:t}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}w(Vt,"ownDefaults",ty),w(Vt,"type","IText"),$.setClass(Vt),$.setClass(Vt,"i-text");class ws extends Vt{static getDefaults(){return x(x({},super.getDefaults()),ws.ownDefaults)}constructor(e,t){super(e,x(x({},ws.ownDefaults),t))}static createControls(){return{controls:Ap()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(Mt)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(e){let t=0,s=0,r=0;const n={};for(let o=0;o<e.graphemeLines.length;o++)e.graphemeText[r]===`
`&&o>0?(s=0,r++,t++):!this.splitByGrapheme&&this._reSpaceAndTab.test(e.graphemeText[r])&&o>0&&(s++,r++),n[o]={line:t,offset:s},r+=e.graphemeLines[o].length,s+=e.graphemeLines[o].length;return n}styleHas(e,t){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[t];s&&(t=s.line)}return super.styleHas(e,t)}isEmptyStyles(e){if(!this.styles)return!0;let t,s=0,r=e+1,n=!1;const o=this._styleMap[e],a=this._styleMap[e+1];o&&(e=o.line,s=o.offset),a&&(r=a.line,n=r===e,t=a.offset);const l=e===void 0?this.styles:{line:this.styles[e]};for(const c in l)for(const h in l[c]){const u=parseInt(h,10);if(u>=s&&(!n||u<t))for(const d in l[c][h])return!1}return!0}_getStyleDeclaration(e,t){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[e];if(!s)return{};e=s.line,t=s.offset+t}return super._getStyleDeclaration(e,t)}_setStyleDeclaration(e,t,s){const r=this._styleMap[e];super._setStyleDeclaration(r.line,r.offset+t,s)}_deleteStyleDeclaration(e,t){const s=this._styleMap[e];super._deleteStyleDeclaration(s.line,s.offset+t)}_getLineStyle(e){const t=this._styleMap[e];return!!this.styles[t.line]}_setLineStyle(e){const t=this._styleMap[e];super._setLineStyle(t.line)}_wrapText(e,t){this.isWrapping=!0;const s=this.getGraphemeDataForRender(e),r=[];for(let n=0;n<s.wordsData.length;n++)r.push(...this._wrapLine(n,t,s));return this.isWrapping=!1,r}getGraphemeDataForRender(e){const t=this.splitByGrapheme,s=t?"":" ";let r=0;return{wordsData:e.map((n,o)=>{let a=0;const l=t?this.graphemeSplit(n):this.wordSplit(n);return l.length===0?[{word:[],width:0}]:l.map(c=>{const h=t?[c]:this.graphemeSplit(c),u=this._measureWord(h,o,a);return r=Math.max(u,r),a+=h.length+s.length,{word:h,width:u}})}),largestWordWidth:r}}_measureWord(e,t){let s,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=0;for(let o=0,a=e.length;o<a;o++)n+=this._getGraphemeBox(e[o],t,o+r,s,!0).kernedWidth,s=e[o];return n}wordSplit(e){return e.split(this._wordJoiners)}_wrapLine(e,t,s){let{largestWordWidth:r,wordsData:n}=s,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const a=this._getWidthOfCharSpacing(),l=this.splitByGrapheme,c=[],h=l?"":" ";let u=0,d=[],g=0,p=0,y=!0;t-=o;const v=Math.max(t,r,this.dynamicMinWidth),_=n[e];let f;for(g=0,f=0;f<_.length;f++){const{word:S,width:C}=_[f];g+=S.length,u+=p+C-a,u>v&&!y?(c.push(d),d=[],u=C,y=!0):u+=a,y||l||d.push(h),d=d.concat(S),p=l?0:this._measureWord([h],e,g),g++,y=!1}return f&&c.push(d),r+o>this.dynamicMinWidth&&(this.dynamicMinWidth=r-a+o),c}isEndOfWrapping(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line}missingNewlineOffset(e,t){return this.splitByGrapheme&&!t?this.isEndOfWrapping(e)?1:0:1}_splitTextIntoLines(e){const t=super._splitTextIntoLines(e),s=this._wrapText(t.lines,this.width),r=new Array(s.length);for(let n=0;n<s.length;n++)r[n]=s[n].join("");return t.lines=r,t.graphemeLines=s,t}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const e=new Map;for(const t in this._styleMap){const s=parseInt(t,10);if(this._textLines[s]){const r=this._styleMap[t].line;e.set("".concat(r),!0)}}for(const t in this.styles)e.has(t)||delete this.styles[t]}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...e])}}w(ws,"type","Textbox"),w(ws,"textLayoutProperties",[...Vt.textLayoutProperties,"width"]),w(ws,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),$.setClass(ws);class wl extends tn{shouldPerformLayout(e){return!!e.target.clipPath&&super.shouldPerformLayout(e)}shouldLayoutClipPath(){return!1}calcLayoutResult(e,t){const{target:s}=e,{clipPath:r,group:n}=s;if(!r||!this.shouldPerformLayout(e))return;const{width:o,height:a}=Ut(yh(s,r)),l=new O(o,a);if(r.absolutePositioned)return{center:Bs(r.getRelativeCenterPoint(),void 0,n?n.calcTransformMatrix():void 0),size:l};{const c=r.getRelativeCenterPoint().transform(s.calcOwnMatrix(),!0);if(this.shouldPerformLayout(e)){const{center:h=new O,correction:u=new O}=this.calcBoundingBox(t,e)||{};return{center:h.add(c),correction:u.subtract(c),size:l}}return{center:s.getRelativeCenterPoint().add(c),size:l}}}}w(wl,"type","clip-path"),$.setClass(wl);class xl extends tn{getInitialSize(e,t){let{target:s}=e,{size:r}=t;return new O(s.width||r.x,s.height||r.y)}}w(xl,"type","fixed"),$.setClass(xl);class sy extends Mi{subscribeTargets(e){const t=e.target;e.targets.reduce((s,r)=>(r.parent&&s.add(r.parent),s),new Set).forEach(s=>{s.layoutManager.subscribeTargets({target:s,targets:[t]})})}unsubscribeTargets(e){const t=e.target,s=t.getObjects();e.targets.reduce((r,n)=>(n.parent&&r.add(n.parent),r),new Set).forEach(r=>{!s.some(n=>n.parent===r)&&r.layoutManager.unsubscribeTargets({target:r,targets:[t]})})}}class xs extends ks{static getDefaults(){return x(x({},super.getDefaults()),xs.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,xs.ownDefaults),this.setOptions(t);const{left:s,top:r,layoutManager:n}=t;this.groupInit(e,{left:s,top:r,layoutManager:n!=null?n:new sy})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.multiSelectionStacking==="selection-order"?this.add(...t):t.forEach(r=>{const n=this._objects.findIndex(a=>a.isInFrontOf(r)),o=n===-1?this.size():n;this.insertAt(o,r)})}canEnterGroup(e){return this.getObjects().some(t=>t.isDescendantOf(e)||e.isDescendantOf(t))?(ls("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(e)}enterGroup(e,t){e.parent&&e.parent===e.group?e.parent._exitGroup(e):e.group&&e.parent!==e.group&&e.group.remove(e),this._enterGroup(e,t)}exitGroup(e,t){this._exitGroup(e,t),e.parent&&e.parent._enterGroup(e,!0)}_onAfterObjectsChange(e,t){super._onAfterObjectsChange(e,t);const s=new Set;t.forEach(r=>{const{parent:n}=r;n&&s.add(n)}),e===Go?s.forEach(r=>{r._onAfterObjectsChange(Rr,t)}):s.forEach(r=>{r._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(e,t,s){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const r=x(x({hasControls:!1},s),{},{forActiveSelection:!0});for(let n=0;n<this._objects.length;n++)this._objects[n]._renderControls(e,r);super._renderControls(e,t),e.restore()}}w(xs,"type","ActiveSelection"),w(xs,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),$.setClass(xs),$.setClass(xs,"activeSelection");class iy{constructor(){w(this,"resources",{})}applyFilters(e,t,s,r,n){const o=n.getContext("2d");if(!o)return;o.drawImage(t,0,0,s,r);const a={sourceWidth:s,sourceHeight:r,imageData:o.getImageData(0,0,s,r),originalEl:t,originalImageData:o.getImageData(0,0,s,r),canvasEl:n,ctx:o,filterBackend:this};e.forEach(c=>{c.applyTo(a)});const{imageData:l}=a;return l.width===s&&l.height===r||(n.width=l.width,n.height=l.height),o.putImageData(l,0,0),a}}class Nh{constructor(){let{tileSize:e=ue.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};w(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),w(this,"resources",{}),this.tileSize=e,this.setupGLContext(e,e),this.captureGPUInfo()}setupGLContext(e,t){this.dispose(),this.createWebGLCanvas(e,t)}createWebGLCanvas(e,t){const s=yt({width:e,height:t}),r=s.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});r&&(r.clearColor(0,0,0,0),this.canvas=s,this.gl=r)}applyFilters(e,t,s,r,n,o){const a=this.gl,l=n.getContext("2d");if(!a||!l)return;let c;o&&(c=this.getCachedTexture(o,t));const h={originalWidth:t.width||t.naturalWidth||0,originalHeight:t.height||t.naturalHeight||0,sourceWidth:s,sourceHeight:r,destinationWidth:s,destinationHeight:r,context:a,sourceTexture:this.createTexture(a,s,r,c?void 0:t),targetTexture:this.createTexture(a,s,r),originalTexture:c||this.createTexture(a,s,r,c?void 0:t),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:n},u=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,u),e.forEach(d=>{d&&d.applyTo(h)}),function(d){const g=d.targetCanvas,p=g.width,y=g.height,v=d.destinationWidth,_=d.destinationHeight;p===v&&y===_||(g.width=v,g.height=_)}(h),this.copyGLTo2D(a,h),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(h.sourceTexture),a.deleteTexture(h.targetTexture),a.deleteFramebuffer(u),l.setTransform(1,0,0,1,0,0),h}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(e,t,s,r,n){const{NEAREST:o,TEXTURE_2D:a,RGBA:l,UNSIGNED_BYTE:c,CLAMP_TO_EDGE:h,TEXTURE_MAG_FILTER:u,TEXTURE_MIN_FILTER:d,TEXTURE_WRAP_S:g,TEXTURE_WRAP_T:p}=e,y=e.createTexture();return e.bindTexture(a,y),e.texParameteri(a,u,n||o),e.texParameteri(a,d,n||o),e.texParameteri(a,g,h),e.texParameteri(a,p,h),r?e.texImage2D(a,0,l,l,c,r):e.texImage2D(a,0,l,t,s,0,l,c,null),y}getCachedTexture(e,t,s){const{textureCache:r}=this;if(r[e])return r[e];{const n=this.createTexture(this.gl,t.width,t.height,t,s);return n&&(r[e]=n),n}}evictCachesForKey(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])}copyGLTo2D(e,t){const s=e.canvas,r=t.targetCanvas,n=r.getContext("2d");if(!n)return;n.translate(0,r.height),n.scale(1,-1);const o=s.height-r.height;n.drawImage(s,0,o,r.width,r.height,0,0,r.width,r.height)}copyGLTo2DPutImageData(e,t){const s=t.targetCanvas.getContext("2d"),r=t.destinationWidth,n=t.destinationHeight,o=r*n*4;if(!s)return;const a=new Uint8Array(this.imageBuffer,0,o),l=new Uint8ClampedArray(this.imageBuffer,0,o);e.readPixels(0,0,r,n,e.RGBA,e.UNSIGNED_BYTE,a);const c=new ImageData(l,r,n);s.putImageData(c,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const e=this.gl,t={renderer:"",vendor:""};if(!e)return t;const s=e.getExtension("WEBGL_debug_renderer_info");if(s){const r=e.getParameter(s.UNMASKED_RENDERER_WEBGL),n=e.getParameter(s.UNMASKED_VENDOR_WEBGL);r&&(t.renderer=r.toLowerCase()),n&&(t.vendor=n.toLowerCase())}return this.gpuInfo=t,t}}let kn;function ry(){const{WebGLProbe:i}=Nt();return i.queryWebGL(Jt()),ue.enableGLFiltering&&i.isSupported(ue.textureSize)?new Nh({tileSize:ue.textureSize}):new iy}function Tn(){return!kn&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(kn=ry()),kn}const ny=["filters","resizeFilter","src","crossOrigin","type"],Fh=["cropX","cropY"];class gt extends Ze{static getDefaults(){return x(x({},super.getDefaults()),gt.ownDefaults)}constructor(e,t){super(),w(this,"_lastScaleX",1),w(this,"_lastScaleY",1),w(this,"_filterScalingX",1),w(this,"_filterScalingY",1),this.filters=[],Object.assign(this,gt.ownDefaults),this.setOptions(t),this.cacheKey="texture".concat(cs()),this.setElement(typeof e=="string"?(this.canvas&&Ct(this.canvas.getElement())||Js()).getElementById(e):e,t)}getElement(){return this._element}setElement(e){var t;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=e,this._originalElement=e,this._setWidthHeight(s),(t=e.classList)===null||t===void 0||t.add(gt.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(e){const t=Tn(!1);t instanceof Nh&&t.evictCachesForKey(e)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(e=>{const t=this[e];t&&Nt().dispose(t),this[e]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const e=this.getElement();return e?{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}:{width:0,height:0}}_stroke(e){if(!this.stroke||this.strokeWidth===0)return;const t=this.width/2,s=this.height/2;e.beginPath(),e.moveTo(-t,-s),e.lineTo(t,-s),e.lineTo(t,s),e.lineTo(-t,s),e.lineTo(-t,-s),e.closePath()}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=[];return this.filters.forEach(s=>{s&&t.push(s.toObject())}),x(x({},super.toObject([...Fh,...e])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:t},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const e=[],t=this._element,s=-this.width/2,r=-this.height/2;let n=[],o=[],a="",l="";if(!t)return[];if(this.hasCrop()){const c=cs();n.push('<clipPath id="imageCrop_'+c+`">
`,'	<rect x="'+s+'" y="'+r+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),a=' clip-path="url(#imageCrop_'+c+')" '}if(this.imageSmoothing||(l=' image-rendering="optimizeSpeed"'),e.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(s-this.cropX,'" y="').concat(r-this.cropY,'" width="').concat(t.width||t.naturalWidth,'" height="').concat(t.height||t.naturalHeight,'"').concat(l).concat(a,`></image>
`)),this.stroke||this.strokeDashArray){const c=this.fill;this.fill=null,o=['	<rect x="'.concat(s,'" y="').concat(r,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=c}return n=this.paintFirst!==Ve?n.concat(o,e):n.concat(e,o),n}getSrc(e){const t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():this.srcFromAttribute?t.getAttribute("src")||"":t.src:this.src||""}getSvgSrc(e){return this.getSrc(e)}setSrc(e){let{crossOrigin:t,signal:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Cr(e,{crossOrigin:t,signal:s}).then(r=>{t!==void 0&&this.set({crossOrigin:t}),this.setElement(r)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const e=this.resizeFilter,t=this.minimumScaleTrigger,s=this.getTotalObjectScaling(),r=s.x,n=s.y,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||r>t&&n>t)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,void(this._lastScaleY=n);const a=yt(o),{width:l,height:c}=o;this._element=a,this._lastScaleX=e.scaleX=r,this._lastScaleY=e.scaleY=n,Tn().applyFilters([e],o,l,c,this._element),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height}applyFilters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(e=e.filter(n=>n&&!n.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),e.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const t=this._originalElement,s=t.naturalWidth||t.width,r=t.naturalHeight||t.height;if(this._element===this._originalElement){const n=yt({width:s,height:r});this._element=n,this._filteredEl=n}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,s,r),this._lastScaleX=1,this._lastScaleY=1);Tn().applyFilters(e,this._originalElement,s,r,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(e){e.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)}drawCacheOnCanvas(e){e.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(e)}shouldCache(){return this.needsItsOwnCache()}_renderFill(e){const t=this._element;if(!t)return;const s=this._filterScalingX,r=this._filterScalingY,n=this.width,o=this.height,a=Math.max(this.cropX,0),l=Math.max(this.cropY,0),c=t.naturalWidth||t.width,h=t.naturalHeight||t.height,u=a*s,d=l*r,g=Math.min(n*s,c-u),p=Math.min(o*r,h-d),y=-n/2,v=-o/2,_=Math.min(n,c/s-a),f=Math.min(o,h/r-l);t&&e.drawImage(t,u,d,g,p,y,v,_,f)}_needsResize(){const e=this.getTotalObjectScaling();return e.x!==this._lastScaleX||e.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:e,height:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=this.getOriginalSize();this.width=e||s.width,this.height=t||s.height}parsePreserveAspectRatioAttribute(){const e=Kf(this.preserveAspectRatio||""),t=this.width,s=this.height,r={width:t,height:s};let n,o=this._element.width,a=this._element.height,l=1,c=1,h=0,u=0,d=0,g=0;return!e||e.alignX===rt&&e.alignY===rt?(l=t/o,c=s/a):(e.meetOrSlice==="meet"&&(l=c=dm(this._element,r),n=(t-o*l)/2,e.alignX==="Min"&&(h=-n),e.alignX==="Max"&&(h=n),n=(s-a*c)/2,e.alignY==="Min"&&(u=-n),e.alignY==="Max"&&(u=n)),e.meetOrSlice==="slice"&&(l=c=gm(this._element,r),n=o-t/l,e.alignX==="Mid"&&(d=n/2),e.alignX==="Max"&&(d=n),n=a-s/c,e.alignY==="Mid"&&(g=n/2),e.alignY==="Max"&&(g=n),o=t/l,a=s/c)),{width:o,height:a,scaleX:l,scaleY:c,offsetLeft:h,offsetTop:u,cropX:d,cropY:g}}static fromObject(e,t){let{filters:s,resizeFilter:r,src:n,crossOrigin:o,type:a}=e,l=ke(e,ny);return Promise.all([Cr(n,x(x({},t),{},{crossOrigin:o})),s&&ki(s,t),r&&ki([r],t),Jr(l,t)]).then(c=>{let[h,u=[],[d]=[],g={}]=c;return new this(h,x(x({},l),{},{src:n,filters:u,resizeFilter:d},g))})}static fromURL(e){let{crossOrigin:t=null,signal:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return Cr(e,{crossOrigin:t,signal:s}).then(n=>new this(n,r))}static async fromElement(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const r=ts(e,this.ATTRIBUTE_NAMES,s);return this.fromURL(r["xlink:href"]||r.href,t,r).catch(n=>(ls("log","Unable to parse Image",n),null))}}w(gt,"type","Image"),w(gt,"cacheProperties",[...es,...Fh]),w(gt,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),w(gt,"CSS_CANVAS","canvas-img"),w(gt,"ATTRIBUTE_NAMES",[...ds,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),$.setClass(gt),$.setSVGClass(gt);Qr(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const rn=i=>i.webgl!==void 0,qo="precision highp float",oy=`
    `.concat(qo,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),ay=["type"],ly=["type"],cy=new RegExp(qo,"g");class We{get type(){return this.constructor.type}constructor(){let e=ke(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ay);Object.assign(this,this.constructor.defaults,e)}getFragmentSource(){return oy}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:r="highp"}}=Nt();r!=="highp"&&(t=t.replace(cy,qo.replace("highp",r)));const n=e.createShader(e.VERTEX_SHADER),o=e.createShader(e.FRAGMENT_SHADER),a=e.createProgram();if(!n||!o||!a)throw new At("Vertex, fragment shader or program creation error");if(e.shaderSource(n,s),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new At("Vertex shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(n)));if(e.shaderSource(o,t),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new At("Fragment shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(o)));if(e.attachShader(a,n),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new At('Shader link error for "'.concat(this.type,'" ').concat(e.getProgramInfoLog(a)));const l=this.getUniformLocations(e,a)||{};return l.uStepW=e.getUniformLocation(a,"uStepW"),l.uStepH=e.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:this.getAttributeLocations(e,a),uniformLocations:l}}getAttributeLocations(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}}getUniformLocations(e,t){const s=this.constructor.uniformLocations,r={};for(let n=0;n<s.length;n++)r[s[n]]=e.getUniformLocation(t,s[n]);return r}sendAttributeData(e,t,s){const r=t.aPosition,n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW)}_setupFrameBuffer(e){const t=e.context;if(e.passes>1){const s=e.destinationWidth,r=e.destinationHeight;e.sourceWidth===s&&e.sourceHeight===r||(t.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(t,s,r)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.targetTexture,0)}else t.bindFramebuffer(t.FRAMEBUFFER,null),t.finish()}_swapTextures(e){e.passes--,e.pass++;const t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t}isNeutralState(e){return!1}applyTo(e){rn(e)?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){}getCacheKey(){return this.type}retrieveShader(e){const t=this.getCacheKey();return e.programCache[t]||(e.programCache[t]=this.createProgram(e.context)),e.programCache[t]}applyToWebGL(e){const t=e.context,s=this.retrieveShader(e);e.pass===0&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(s.program),this.sendAttributeData(t,s.attributeLocations,e.aPosition),t.uniform1f(s.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(s.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,s.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(e,t,s){e.activeTexture(s),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)}unbindAdditionalTexture(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)}sendUniformData(e,t){}createHelpLayer(e){if(!e.helpLayer){const{sourceWidth:t,sourceHeight:s}=e,r=yt({width:t,height:s});e.helpLayer=r}}toObject(){const e=Object.keys(this.constructor.defaults||{});return x({type:this.type},e.reduce((t,s)=>(t[s]=this[s],t),{}))}toJSON(){return this.toObject()}static async fromObject(e,t){return new this(ke(e,ly))}}w(We,"type","BaseFilter"),w(We,"uniformLocations",[]);const hy={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class rr extends We{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(hy[this.mode],`
        }
      }
      `)}applyTo2d(e){let{imageData:{data:t}}=e;const s=new be(this.color).getSource(),r=this.alpha,n=s[0]*r,o=s[1]*r,a=s[2]*r,l=1-r;for(let c=0;c<t.length;c+=4){const h=t[c],u=t[c+1],d=t[c+2];let g,p,y;switch(this.mode){case"multiply":g=h*n/255,p=u*o/255,y=d*a/255;break;case"screen":g=255-(255-h)*(255-n)/255,p=255-(255-u)*(255-o)/255,y=255-(255-d)*(255-a)/255;break;case"add":g=h+n,p=u+o,y=d+a;break;case"difference":g=Math.abs(h-n),p=Math.abs(u-o),y=Math.abs(d-a);break;case"subtract":g=h-n,p=u-o,y=d-a;break;case"darken":g=Math.min(h,n),p=Math.min(u,o),y=Math.min(d,a);break;case"lighten":g=Math.max(h,n),p=Math.max(u,o),y=Math.max(d,a);break;case"overlay":g=n<128?2*h*n/255:255-2*(255-h)*(255-n)/255,p=o<128?2*u*o/255:255-2*(255-u)*(255-o)/255,y=a<128?2*d*a/255:255-2*(255-d)*(255-a)/255;break;case"exclusion":g=n+h-2*n*h/255,p=o+u-2*o*u/255,y=a+d-2*a*d/255;break;case"tint":g=n+h*l,p=o+u*l,y=a+d*l}t[c]=g,t[c+1]=p,t[c+2]=y}}sendUniformData(e,t){const s=new be(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,e.uniform4fv(t.uColor,s)}}w(rr,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),w(rr,"type","BlendColor"),w(rr,"uniformLocations",["uColor"]),$.setClass(rr);const uy={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},dy=["type","image"];class nr extends We{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return uy[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(e){const t=e.context,s=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(t,s,t.TEXTURE1),super.applyToWebGL(e),this.unbindAdditionalTexture(t,t.TEXTURE1)}createTexture(e,t){return e.getCachedTexture(t.cacheKey,t.getElement())}calculateMatrix(){const e=this.image,{width:t,height:s}=e.getElement();return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/t,-e.top/s,1]}applyTo2d(e){let{imageData:{data:t,width:s,height:r},filterBackend:{resources:n}}=e;const o=this.image;n.blendImage||(n.blendImage=Jt());const a=n.blendImage,l=a.getContext("2d");a.width!==s||a.height!==r?(a.width=s,a.height=r):l.clearRect(0,0,s,r),l.setTransform(o.scaleX,0,0,o.scaleY,o.left,o.top),l.drawImage(o.getElement(),0,0,s,r);const c=l.getImageData(0,0,s,r).data;for(let h=0;h<t.length;h+=4){const u=t[h],d=t[h+1],g=t[h+2],p=t[h+3],y=c[h],v=c[h+1],_=c[h+2],f=c[h+3];switch(this.mode){case"multiply":t[h]=u*y/255,t[h+1]=d*v/255,t[h+2]=g*_/255,t[h+3]=p*f/255;break;case"mask":t[h+3]=f}}}sendUniformData(e,t){const s=this.calculateMatrix();e.uniform1i(t.uImage,1),e.uniformMatrix3fv(t.uTransformMatrix,!1,s)}toObject(){return x(x({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(e,t){let{type:s,image:r}=e,n=ke(e,dy);return gt.fromObject(r,t).then(o=>new this(x(x({},n),{},{image:o})))}}w(nr,"type","BlendImage"),w(nr,"defaults",{mode:"multiply",alpha:1}),w(nr,"uniformLocations",["uTransformMatrix","uImage"]),$.setClass(nr);class or extends We{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float totalC = 0.0;
      float totalA = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);
        float weight = 1.0 - abs(percent);
        float alpha = weight * sample.a;
        color.rgb += sample.rgb * alpha;
        color.a += alpha;
        totalA += weight;
        totalC += alpha;
      }
      gl_FragColor.rgb = color.rgb / totalC;
      gl_FragColor.a = color.a / totalA;
    }
  `}applyTo(e){rn(e)?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){let{imageData:{data:t,width:s,height:r}}=e;this.aspectRatio=s/r,this.horizontal=!0;let n=this.getBlurValue()*s;const o=new Uint8ClampedArray(t),a=15,l=4*s;for(let c=0;c<t.length;c+=4){let h=0,u=0,d=0,g=0,p=0;const y=c-c%l,v=y+l;for(let _=-14;_<a;_++){const f=_/a,S=4*Math.floor(n*f),C=1-Math.abs(f);let k=c+S;k<y?k=y:k>v&&(k=v);const T=t[k+3]*C;h+=t[k]*T,u+=t[k+1]*T,d+=t[k+2]*T,g+=T,p+=C}o[c]=h/g,o[c+1]=u/g,o[c+2]=d/g,o[c+3]=g/p}this.horizontal=!1,n=this.getBlurValue()*r;for(let c=0;c<o.length;c+=4){let h=0,u=0,d=0,g=0,p=0;const y=c%l,v=o.length-l+y;for(let _=-14;_<a;_++){const f=_/a,S=Math.floor(n*f)*l,C=1-Math.abs(f);let k=c+S;k<y?k=y:k>v&&(k=v);const T=o[k+3]*C;h+=o[k]*T,u+=o[k+1]*T,d+=o[k+2]*T,g+=T,p+=C}t[c]=h/g,t[c+1]=u/g,t[c+2]=d/g,t[c+3]=g/p}}sendUniformData(e,t){const s=this.chooseRightDelta();e.uniform2fv(t.uDelta,s)}isNeutralState(){return this.blur===0}getBlurValue(){let e=1;const{horizontal:t,aspectRatio:s}=this;return t?s>1&&(e=1/s):s<1&&(e=s),e*this.blur*.12}chooseRightDelta(){const e=this.getBlurValue();return this.horizontal?[e,0]:[0,e]}}w(or,"type","Blur"),w(or,"defaults",{blur:0}),w(or,"uniformLocations",["uDelta"]),$.setClass(or);class ar extends We{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=Math.round(255*this.brightness);for(let r=0;r<t.length;r+=4)t[r]+=s,t[r+1]+=s,t[r+2]+=s}isNeutralState(){return this.brightness===0}sendUniformData(e,t){e.uniform1f(t.uBrightness,this.brightness)}}w(ar,"type","Brightness"),w(ar,"defaults",{brightness:0}),w(ar,"uniformLocations",["uBrightness"]),$.setClass(ar);const jh={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Rs extends We{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(e){const t=e.imageData.data,s=this.matrix,r=this.colorsOnly;for(let n=0;n<t.length;n+=4){const o=t[n],a=t[n+1],l=t[n+2];if(t[n]=o*s[0]+a*s[1]+l*s[2]+255*s[4],t[n+1]=o*s[5]+a*s[6]+l*s[7]+255*s[9],t[n+2]=o*s[10]+a*s[11]+l*s[12]+255*s[14],!r){const c=t[n+3];t[n]+=c*s[3],t[n+1]+=c*s[8],t[n+2]+=c*s[13],t[n+3]=o*s[15]+a*s[16]+l*s[17]+c*s[18]+255*s[19]}}}sendUniformData(e,t){const s=this.matrix,r=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],n=[s[4],s[9],s[14],s[19]];e.uniformMatrix4fv(t.uColorMatrix,!1,r),e.uniform4fv(t.uConstants,n)}toObject(){return x(x({},super.toObject()),{},{matrix:[...this.matrix]})}}function Ms(i,e){var t;const s=(w(t=class extends Rs{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",i),w(t,"defaults",{colorsOnly:!1,matrix:e}),t);return $.setClass(s,i),s}w(Rs,"type","ColorMatrix"),w(Rs,"defaults",jh),w(Rs,"uniformLocations",["uColorMatrix","uConstants"]),$.setClass(Rs);Ms("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);Ms("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);Ms("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);Ms("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);Ms("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);Ms("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);Ms("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class Cl extends We{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),this.subFilters=e.subFilters||[]}applyTo(e){rn(e)&&(e.passes+=this.subFilters.length-1),this.subFilters.forEach(t=>{t.applyTo(e)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(e=>e.toObject())}}isNeutralState(){return!this.subFilters.some(e=>!e.isNeutralState())}static fromObject(e,t){return Promise.all((e.subFilters||[]).map(s=>$.getClass(s.type).fromObject(s,t))).then(s=>new this({subFilters:s}))}}w(Cl,"type","Composed"),$.setClass(Cl);class lr extends We{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(e){let{imageData:{data:t}}=e;const s=Math.floor(255*this.contrast),r=259*(s+255)/(255*(259-s));for(let n=0;n<t.length;n+=4)t[n]=r*(t[n]-128)+128,t[n+1]=r*(t[n+1]-128)+128,t[n+2]=r*(t[n+2]-128)+128}sendUniformData(e,t){e.uniform1f(t.uContrast,this.contrast)}}w(lr,"type","Contrast"),w(lr,"defaults",{contrast:0}),w(lr,"uniformLocations",["uContrast"]),$.setClass(lr);const gy={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class cr extends We{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return gy[this.getCacheKey()]}applyTo2d(e){const t=e.imageData,s=t.data,r=this.matrix,n=Math.round(Math.sqrt(r.length)),o=Math.floor(n/2),a=t.width,l=t.height,c=e.ctx.createImageData(a,l),h=c.data,u=this.opaque?1:0;let d,g,p,y,v,_,f,S,C,k,T,F,M;for(T=0;T<l;T++)for(k=0;k<a;k++){for(v=4*(T*a+k),d=0,g=0,p=0,y=0,M=0;M<n;M++)for(F=0;F<n;F++)f=T+M-o,_=k+F-o,f<0||f>=l||_<0||_>=a||(S=4*(f*a+_),C=r[M*n+F],d+=s[S]*C,g+=s[S+1]*C,p+=s[S+2]*C,u||(y+=s[S+3]*C));h[v]=d,h[v+1]=g,h[v+2]=p,h[v+3]=u?s[v+3]:y}e.imageData=c}sendUniformData(e,t){e.uniform1fv(t.uMatrix,this.matrix)}toObject(){return x(x({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}w(cr,"type","Convolute"),w(cr,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),w(cr,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),$.setClass(cr);const Lh="Gamma";class hr extends We{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),this.gamma=e.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(e){let{imageData:{data:t}}=e;const s=this.gamma,r=1/s[0],n=1/s[1],o=1/s[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const a=this.rgbValues;for(let l=0;l<256;l++)a.r[l]=255*Math.pow(l/255,r),a.g[l]=255*Math.pow(l/255,n),a.b[l]=255*Math.pow(l/255,o);for(let l=0;l<t.length;l+=4)t[l]=a.r[t[l]],t[l+1]=a.g[t[l+1]],t[l+2]=a.b[t[l+2]]}sendUniformData(e,t){e.uniform3fv(t.uGamma,this.gamma)}isNeutralState(){const{gamma:e}=this;return e[0]===1&&e[1]===1&&e[2]===1}toObject(){return{type:Lh,gamma:this.gamma.concat()}}}w(hr,"type",Lh),w(hr,"defaults",{gamma:[1,1,1]}),w(hr,"uniformLocations",["uGamma"]),$.setClass(hr);const fy={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class ur extends We{applyTo2d(e){let{imageData:{data:t}}=e;for(let s,r=0;r<t.length;r+=4){const n=t[r],o=t[r+1],a=t[r+2];switch(this.mode){case"average":s=(n+o+a)/3;break;case"lightness":s=(Math.min(n,o,a)+Math.max(n,o,a))/2;break;case"luminosity":s=.21*n+.72*o+.07*a}t[r+2]=t[r+1]=t[r]=s}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return fy[this.mode]}sendUniformData(e,t){e.uniform1i(t.uMode,1)}isNeutralState(){return!1}}w(ur,"type","Grayscale"),w(ur,"defaults",{mode:"average"}),w(ur,"uniformLocations",["uMode"]),$.setClass(ur);const py=x(x({},jh),{},{rotation:0});class On extends Rs{calculateMatrix(){const e=this.rotation*Math.PI,t=qt(e),s=Kt(e),r=1/3,n=Math.sqrt(r)*s,o=1-t;this.matrix=[t+o/3,r*o-n,r*o+n,0,0,r*o+n,t+r*o,r*o-n,0,0,r*o-n,r*o+n,t+r*o,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(e){this.calculateMatrix(),super.applyTo(e)}toObject(){return{type:this.type,rotation:this.rotation}}}w(On,"type","HueRotation"),w(On,"defaults",py),$.setClass(On);class dr extends We{applyTo2d(e){let{imageData:{data:t}}=e;for(let s=0;s<t.length;s+=4)t[s]=255-t[s],t[s+1]=255-t[s+1],t[s+2]=255-t[s+2],this.alpha&&(t[s+3]=255-t[s+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(e,t){e.uniform1i(t.uInvert,Number(this.invert)),e.uniform1i(t.uAlpha,Number(this.alpha))}}w(dr,"type","Invert"),w(dr,"defaults",{alpha:!1,invert:!0}),w(dr,"uniformLocations",["uInvert","uAlpha"]),$.setClass(dr);class gr extends We{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=this.noise;for(let r=0;r<t.length;r+=4){const n=(.5-Math.random())*s;t[r]+=n,t[r+1]+=n,t[r+2]+=n}}sendUniformData(e,t){e.uniform1f(t.uNoise,this.noise/255),e.uniform1f(t.uSeed,Math.random())}isNeutralState(){return this.noise===0}}w(gr,"type","Noise"),w(gr,"defaults",{noise:0}),w(gr,"uniformLocations",["uNoise","uSeed"]),$.setClass(gr);class fr extends We{applyTo2d(e){let{imageData:{data:t,width:s,height:r}}=e;for(let n=0;n<r;n+=this.blocksize)for(let o=0;o<s;o+=this.blocksize){const a=4*n*s+4*o,l=t[a],c=t[a+1],h=t[a+2],u=t[a+3];for(let d=n;d<Math.min(n+this.blocksize,r);d++)for(let g=o;g<Math.min(o+this.blocksize,s);g++){const p=4*d*s+4*g;t[p]=l,t[p+1]=c,t[p+2]=h,t[p+3]=u}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(e,t){e.uniform1f(t.uBlocksize,this.blocksize)}}w(fr,"type","Pixelate"),w(fr,"defaults",{blocksize:4}),w(fr,"uniformLocations",["uBlocksize"]),$.setClass(fr);class pr extends We{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=255*this.distance,r=new be(this.color).getSource(),n=[r[0]-s,r[1]-s,r[2]-s],o=[r[0]+s,r[1]+s,r[2]+s];for(let a=0;a<t.length;a+=4){const l=t[a],c=t[a+1],h=t[a+2];l>n[0]&&c>n[1]&&h>n[2]&&l<o[0]&&c<o[1]&&h<o[2]&&(t[a+3]=0)}}sendUniformData(e,t){const s=new be(this.color).getSource(),r=this.distance,n=[0+s[0]/255-r,0+s[1]/255-r,0+s[2]/255-r,1],o=[s[0]/255+r,s[1]/255+r,s[2]/255+r,1];e.uniform4fv(t.uLow,n),e.uniform4fv(t.uHigh,o)}}w(pr,"type","RemoveColor"),w(pr,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),w(pr,"uniformLocations",["uLow","uHigh"]),$.setClass(pr);class mr extends We{sendUniformData(e,t){e.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(t.uTaps,this.taps)}getFilterWindow(){const e=this.tempScale;return Math.ceil(this.lanczosLobes/e)}getCacheKey(){const e=this.getFilterWindow();return"".concat(this.type,"_").concat(e)}getFragmentSource(){const e=this.getFilterWindow();return this.generateShader(e)}getTaps(){const e=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,s=this.getFilterWindow(),r=new Array(s);for(let n=1;n<=s;n++)r[n-1]=e(n*t);return r}generateShader(e){const t=new Array(e);for(let s=1;s<=e;s++)t[s-1]="".concat(s,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(e,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(t.map((s,r)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(s,") * uTaps[").concat(r,"] + texture2D(uTexture, vTexCoord - ").concat(s,") * uTaps[").concat(r,`];
              sum += 2.0 * uTaps[`).concat(r,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(e){e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,super.applyTo(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,super.applyTo(e),e.sourceHeight=e.destinationHeight}applyTo(e){rn(e)?this.applyToForWebgl(e):this.applyTo2d(e)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(e){return t=>{if(t>=e||t<=-e)return 0;if(t<11920929e-14&&t>-11920929e-14)return 1;const s=(t*=Math.PI)/e;return Math.sin(t)/t*Math.sin(s)/s}}applyTo2d(e){const t=e.imageData,s=this.scaleX,r=this.scaleY;this.rcpScaleX=1/s,this.rcpScaleY=1/r;const n=t.width,o=t.height,a=Math.round(n*s),l=Math.round(o*r);let c;c=this.resizeType==="sliceHack"?this.sliceByTwo(e,n,o,a,l):this.resizeType==="hermite"?this.hermiteFastResize(e,n,o,a,l):this.resizeType==="bilinear"?this.bilinearFiltering(e,n,o,a,l):this.resizeType==="lanczos"?this.lanczosResize(e,n,o,a,l):new ImageData(a,l),e.imageData=c}sliceByTwo(e,t,s,r,n){const o=e.imageData,a=.5;let l=!1,c=!1,h=t*a,u=s*a;const d=e.filterBackend.resources;let g=0,p=0;const y=t;let v=0;d.sliceByTwo||(d.sliceByTwo=Jt());const _=d.sliceByTwo;(_.width<1.5*t||_.height<s)&&(_.width=1.5*t,_.height=s);const f=_.getContext("2d");for(f.clearRect(0,0,1.5*t,s),f.putImageData(o,0,0),r=Math.floor(r),n=Math.floor(n);!l||!c;)t=h,s=u,r<Math.floor(h*a)?h=Math.floor(h*a):(h=r,l=!0),n<Math.floor(u*a)?u=Math.floor(u*a):(u=n,c=!0),f.drawImage(_,g,p,t,s,y,v,h,u),g=y,p=v,v+=u;return f.getImageData(g,p,r,n)}lanczosResize(e,t,s,r,n){const o=e.imageData.data,a=e.ctx.createImageData(r,n),l=a.data,c=this.lanczosCreate(this.lanczosLobes),h=this.rcpScaleX,u=this.rcpScaleY,d=2/this.rcpScaleX,g=2/this.rcpScaleY,p=Math.ceil(h*this.lanczosLobes/2),y=Math.ceil(u*this.lanczosLobes/2),v={},_={x:0,y:0},f={x:0,y:0};return function S(C){let k,T,F,M,A,B,E,N,j,L,G;for(_.x=(C+.5)*h,f.x=Math.floor(_.x),k=0;k<n;k++){for(_.y=(k+.5)*u,f.y=Math.floor(_.y),A=0,B=0,E=0,N=0,j=0,T=f.x-p;T<=f.x+p;T++)if(!(T<0||T>=t)){L=Math.floor(1e3*Math.abs(T-_.x)),v[L]||(v[L]={});for(let X=f.y-y;X<=f.y+y;X++)X<0||X>=s||(G=Math.floor(1e3*Math.abs(X-_.y)),v[L][G]||(v[L][G]=c(Math.sqrt(Math.pow(L*d,2)+Math.pow(G*g,2))/1e3)),F=v[L][G],F>0&&(M=4*(X*t+T),A+=F,B+=F*o[M],E+=F*o[M+1],N+=F*o[M+2],j+=F*o[M+3]))}M=4*(k*r+C),l[M]=B/A,l[M+1]=E/A,l[M+2]=N/A,l[M+3]=j/A}return++C<r?S(C):a}(0)}bilinearFiltering(e,t,s,r,n){let o,a,l,c,h,u,d,g,p,y,v,_,f,S=0;const C=this.rcpScaleX,k=this.rcpScaleY,T=4*(t-1),F=e.imageData.data,M=e.ctx.createImageData(r,n),A=M.data;for(d=0;d<n;d++)for(g=0;g<r;g++)for(h=Math.floor(C*g),u=Math.floor(k*d),p=C*g-h,y=k*d-u,f=4*(u*t+h),v=0;v<4;v++)o=F[f+v],a=F[f+4+v],l=F[f+T+v],c=F[f+T+4+v],_=o*(1-p)*(1-y)+a*p*(1-y)+l*y*(1-p)+c*p*y,A[S++]=_;return M}hermiteFastResize(e,t,s,r,n){const o=this.rcpScaleX,a=this.rcpScaleY,l=Math.ceil(o/2),c=Math.ceil(a/2),h=e.imageData.data,u=e.ctx.createImageData(r,n),d=u.data;for(let g=0;g<n;g++)for(let p=0;p<r;p++){const y=4*(p+g*r);let v=0,_=0,f=0,S=0,C=0,k=0,T=0;const F=(g+.5)*a;for(let M=Math.floor(g*a);M<(g+1)*a;M++){const A=Math.abs(F-(M+.5))/c,B=(p+.5)*o,E=A*A;for(let N=Math.floor(p*o);N<(p+1)*o;N++){let j=Math.abs(B-(N+.5))/l;const L=Math.sqrt(E+j*j);L>1&&L<-1||(v=2*L*L*L-3*L*L+1,v>0&&(j=4*(N+M*t),T+=v*h[j+3],f+=v,h[j+3]<255&&(v=v*h[j+3]/250),S+=v*h[j],C+=v*h[j+1],k+=v*h[j+2],_+=v))}}d[y]=S/_,d[y+1]=C/_,d[y+2]=k/_,d[y+3]=T/f}return u}}w(mr,"type","Resize"),w(mr,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),w(mr,"uniformLocations",["uDelta","uTaps"]),$.setClass(mr);class yr extends We{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=-this.saturation;for(let r=0;r<t.length;r+=4){const n=t[r],o=t[r+1],a=t[r+2],l=Math.max(n,o,a);t[r]+=l!==n?(l-n)*s:0,t[r+1]+=l!==o?(l-o)*s:0,t[r+2]+=l!==a?(l-a)*s:0}}sendUniformData(e,t){e.uniform1f(t.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}w(yr,"type","Saturation"),w(yr,"defaults",{saturation:0}),w(yr,"uniformLocations",["uSaturation"]),$.setClass(yr);class br extends We{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=-this.vibrance;for(let r=0;r<t.length;r+=4){const n=t[r],o=t[r+1],a=t[r+2],l=Math.max(n,o,a),c=(n+o+a)/3,h=2*Math.abs(l-c)/255*s;t[r]+=l!==n?(l-n)*h:0,t[r+1]+=l!==o?(l-o)*h:0,t[r+2]+=l!==a?(l-a)*h:0}}sendUniformData(e,t){e.uniform1f(t.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}w(br,"type","Vibrance"),w(br,"defaults",{vibrance:0}),w(br,"uniformLocations",["uVibrance"]),$.setClass(br);const fi=3,tt=80,Ih=10,Rh=5,pi=40,He=60,Ns=pi+fi*(tt+Rh)+Ih*2;function my(){const i=we(null),e=we(null),t=we(!1),s=we(!1),r=we({x:0,scrollOffset:0}),[n,o]=te(0),{clips:a,playhead:l,setPlayhead:c,zoom:h,scrollOffset:u,setScrollOffset:d,selectedClipId:g,setSelectedClip:p,updateClip:y,trimClip:v,deleteClip:_,autoFitZoom:f}=qe(),S=we(null);Me(()=>{if(!i.current)return;const E=i.current.parentElement,N=(E==null?void 0:E.offsetWidth)||800;console.log("[Timeline] Initializing canvas - parent width:",N);const j=new Zn(i.current,{width:N,height:Ns,backgroundColor:"#18181b",selection:!1});e.current=j;const L=()=>{var q,Z;const P=((Z=(q=i.current)==null?void 0:q.parentElement)==null?void 0:Z.offsetWidth)||800,D=j.getWidth();P!==D&&(console.log("[Timeline] Resizing canvas from",D,"to",P),j.setDimensions({width:P,height:Ns}),o(R=>R+1))},G=()=>{console.log("[Timeline] Window resize event fired"),L()};window.addEventListener("resize",G);const X=setInterval(()=>{if(!i.current)return;const P=i.current.offsetWidth,D=j.getWidth();P!==D&&P>0&&(console.log("[Timeline] Syncing Fabric canvas dimensions from",D,"to",P),j.setDimensions({width:P,height:Ns}),o(q=>q+1))},100);return()=>{window.removeEventListener("resize",G),clearInterval(X),e.current&&e.current.dispose()}},[]),Me(()=>{const E=e.current;if(!E||a.length===0)return;const N=E.width||800;f(N)},[a.length,JSON.stringify(a.map(E=>({id:E.id,duration:E.duration})))]),Me(()=>{if(!g||!i.current||S.current===g)return;S.current=g;const E=e.current;if(!E)return;const N=a.find(D=>D.id===g);if(!N)return;const L=(l>=N.start&&l<N.end?l:N.start)*h,X=(E.width||800)/2,P=Math.max(0,L-X+He);console.log("[Timeline] Clip selection changed to:",N.name,"adjusting scroll from",u,"to",P),d(P)},[g,a,l,h,u,d]);const C=E=>pi+Ih+E*(tt+Rh);Me(()=>{const E=e.current;if(!E||t.current)return;if(i.current){const P=i.current.offsetWidth;P>0&&P!==E.getWidth()&&(console.log("[Timeline] Syncing width before render:",P),E.setDimensions({width:P,height:Ns}))}E.clear(),E.backgroundColor="#18181b",E.clipPath=new Ye({left:He,top:0,width:(E.width||800)-He,height:Ns,absolutePositioned:!0});for(let P=0;P<fi;P++){const D=C(P),q=new Xe(`Track ${P+1}`,{left:8,top:D+tt/2-8,fontSize:12,fill:"#71717a",selectable:!1,evented:!1});E.add(q);const Z=new Ye({left:He,top:D,width:(E.width||800)-He,height:tt,fill:P%2===0?"#27272a":"#1f1f23",stroke:"#3f3f46",strokeWidth:1,selectable:!1,evented:!1});E.add(Z)}E.width;const N=a.length>0?Math.max(...a.map(P=>P.end)):60,j=Math.max(N*1.2,60);let L,G=!1;h<5?(L=60,G=!0):h<10?L=10:h<20?L=5:L=1;for(let P=0;P<=j;P+=L){const D=P*h-u+He;if(D<He)continue;if(D>E.width)break;const q=new Bt([D,pi-10,D,pi],{stroke:"#52525b",strokeWidth:1,selectable:!1,evented:!1});E.add(q);const Z=G?`${Math.floor(P/60)}m${P%60===0?"":` ${P%60}s`}`:`${P}s`,R=new Xe(Z,{left:D+4,top:pi-30,fontSize:11,fill:"#a1a1aa",selectable:!1,evented:!1});E.add(R)}a.forEach(P=>{const D=P.start*h-u+He,q=(P.end-P.start)*h;if(D+q<He||D>E.width)return;const Z=P.trimStart*h,R=P.trimEnd*h,de=R-Z,ee=P.id===g,V=C(P.track),U=10,oe=a.some(le=>le.id!==P.id&&le.track===P.track&&(P.start>=le.start&&P.start<le.end||P.end>le.start&&P.end<=le.end||P.start<=le.start&&P.end>=le.end)),ne=new Ye({left:D,top:V+U,width:q,height:tt-U*2,fill:ee?"#1e3a8a":"#312e81",stroke:ee?"#60a5fa":"#818cf8",strokeWidth:1,rx:4,ry:4,opacity:.4,selectable:!1,evented:!1}),De=new Ye({left:D+Z,top:V+U,width:de,height:tt-U*2,fill:oe?"#dc2626":ee?"#3b82f6":"#6366f1",stroke:oe?"#ef4444":ee?"#60a5fa":"#818cf8",strokeWidth:oe?3:2,rx:4,ry:4,shadow:oe?"0 4px 12px rgba(220, 38, 38, 0.6)":ee?"0 4px 12px rgba(59, 130, 246, 0.4)":"0 2px 8px rgba(0, 0, 0, 0.3)"}),Se=new Xe(P.name,{left:D+Z+8,top:V+U+8,fontSize:13,fill:"#ffffff",selectable:!1,evented:!1}),xe=new Ye({left:D+Z,top:V+U,width:12,height:tt-U*2,fill:"#ffffff",stroke:"#3b82f6",strokeWidth:2,rx:3,ry:3,opacity:.9,hoverCursor:"ew-resize",selectable:!0,evented:!0}),Y=new Ye({left:D+R-12,top:V+U,width:12,height:tt-U*2,fill:"#ffffff",stroke:"#3b82f6",strokeWidth:2,rx:3,ry:3,opacity:.9,hoverCursor:"ew-resize",selectable:!0,evented:!0});De.on("mousedown",()=>{t.current=!0,p(P.id),console.log("[Timeline] Clip selected:",P.name,"- playhead will show frame relative to clip start")}),De.on("moving",le=>{const ce=le.target;if(!ce)return;const se=He;(ce.left||0)<se&&(ce.left=se);const Pe=ce.top||0;let gs=0,jt=1/0;for(let ss=0;ss<fi;ss++){const at=C(ss)+tt/2,fs=Math.abs(Pe-at+U+tt/2);fs<jt&&(jt=fs,gs=ss)}ce.top=C(gs)+U}),De.on("mouseup",le=>{const ce=le.target;if(ce){const se=Math.max(0,((ce.left||0)-He-Z)/h),Pe=P.end-P.start,gs=ce.top||0;let jt=P.track;for(let pe=0;pe<fi;pe++){const lt=C(pe)+tt/2;if(Math.abs(gs-lt+U+tt/2)<tt/2){jt=pe;break}}const at=[...a.filter(pe=>pe.id!==P.id&&pe.track===jt)].sort((pe,lt)=>pe.start-lt.start),fs=at.some(pe=>se>=pe.start&&se<pe.end||se+Pe>pe.start&&se+Pe<=pe.end||se<=pe.start&&se+Pe>pe.start);let fe=se;if(fs){const pe=at.filter(lt=>se>=lt.start&&se<lt.end||se+Pe>lt.start&&se+Pe<=lt.end||se<=lt.start&&se+Pe>lt.start);if(pe.length>0){const ni=pe[pe.length-1].end,cn=at.find(sa=>sa.start>=ni);cn?cn.start-ni>=Pe?fe=ni:fe=cn.end:fe=ni}}y(P.id,{start:fe,end:fe+Pe,track:jt})}t.current=!1,o(se=>se+1)}),xe.on("mousedown",()=>{t.current=!0,p(P.id)}),xe.on("moving",le=>{const ce=le.target;if(!ce)return;const se=D,Pe=D+R-12-.1*h;(ce.left||0)<se?ce.left=se:(ce.left||0)>Pe&&(ce.left=Pe)}),xe.on("mouseup",le=>{const ce=le.target;if(ce){const se=Math.max(0,Math.min(P.trimEnd-.1,((ce.left||0)-D)/h));console.log("[ClipForge] Left handle released:",{newTrimStart:se,targetLeft:ce.left,x:D,zoom:h}),y(P.id,{trimStart:se}),c(P.start+se)}t.current=!1,o(se=>se+1)}),Y.on("mousedown",()=>{t.current=!0,p(P.id)}),Y.on("moving",le=>{const ce=le.target;if(!ce)return;const se=D+Z+.1*h,Pe=D+P.duration*h-12;(ce.left||0)<se?ce.left=se:(ce.left||0)>Pe&&(ce.left=Pe)}),Y.on("mouseup",le=>{const ce=le.target;if(ce){const se=Math.max(P.trimStart+.1,Math.min(P.duration,((ce.left||0)+12-D)/h));console.log("[ClipForge] Right handle released:",{newTrimEnd:se,targetLeft:ce.left,x:D,zoom:h}),y(P.id,{trimEnd:se}),c(P.start+se)}t.current=!1,o(se=>se+1)}),De.set({hoverCursor:"move"}),xe.set({lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,hasControls:!1}),Y.set({lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,hasControls:!1}),E.add(ne,De,Se),E.add(xe,Y)});const X=l*h-u+He;if(X>=He&&X<=E.width){const P=new Bt([X,0,X,Ns],{stroke:"#ef4444",strokeWidth:2,selectable:!1,evented:!1}),D=new Ye({left:X-6,top:0,width:12,height:12,fill:"#ef4444",rx:2,ry:2});D.on("mousedown",()=>{t.current=!0}),D.on("moving",q=>{const Z=q.target;if(!Z)return;const R=He-6;(Z.left||0)<R&&(Z.left=R)}),D.on("mouseup",q=>{const Z=q.target;if(Z){const R=Math.max(0,((Z.left||0)+6-He)/h);c(R)}t.current=!1,o(R=>R+1)}),D.set({lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0}),E.add(P,D)}E.on("mouse:down",P=>{if(!P.target){const D=E.getPointer(P.e),q=Math.max(0,(D.x-He+u)/h);console.log("[ClipForge] 🖱️ Timeline click: pointer.x=",D.x,"TRACK_LABEL_WIDTH=",He,"scrollOffset=",u,"zoom=",h,"→ TIME=",q),c(q)}}),E.renderAll()},[a,l,h,u,g,c,p,y,v,_,n]);const k=E=>{E.preventDefault(),E.dataTransfer.dropEffect="copy"},T=E=>{var N;E.preventDefault();try{const j=JSON.parse(E.dataTransfer.getData("application/json"));if(!e.current)return;const G=(N=i.current)==null?void 0:N.getBoundingClientRect();if(!G)return;const X=E.clientX-G.left,P=E.clientY-G.top,D=Math.max(0,(X-He)/h);let q=0;for(let U=0;U<fi;U++){const oe=C(U);if(P>=oe&&P<=oe+tt){q=U;break}}const Z=a.filter(U=>U.track===q);let R=D;const de=[...Z].sort((U,oe)=>U.start-oe.start),ee=de.some(U=>R>=U.start&&R<U.end||R+j.duration>U.start&&R+j.duration<=U.end||R<=U.start&&R+j.duration>U.start);if(ee){const U=de.filter(oe=>R>=oe.start&&R<oe.end||R+j.duration>oe.start&&R+j.duration<=oe.end||R<=oe.start&&R+j.duration>oe.start);if(U.length>0){const ne=U[U.length-1].end,De=de.find(Se=>Se.start>=ne);De?De.start-ne>=j.duration?R=ne:R=De.end:R=ne}}const V={...j,id:`${j.id}-${Date.now()}`,start:R,end:R+j.duration,trimStart:j.trimStart||0,trimEnd:j.trimEnd||j.duration,track:q};qe.getState().addClip(V),c(R),p(V.id),console.log("[ClipForge] Clip dropped on timeline:",{dropTime:D,startTime:R,targetTrack:q,hasOverlap:ee,clip:V})}catch(j){console.error("[ClipForge] Failed to drop clip:",j)}},F=E=>{if(Math.abs(E.deltaX)>Math.abs(E.deltaY)||E.shiftKey){E.preventDefault();const N=E.deltaX!==0?E.deltaX:E.deltaY;d(u+N)}},M=E=>{(E.button===1||E.spaceKey)&&(E.preventDefault(),s.current=!0,r.current={x:E.clientX,scrollOffset:u})},A=E=>{if(s.current){E.preventDefault();const N=r.current.x-E.clientX;d(r.current.scrollOffset+N)}},B=()=>{s.current=!1};return m("div",{className:"relative w-full border-t border-zinc-800 bg-zinc-900 overflow-hidden",onDragOver:k,onDrop:T,onWheel:F,children:m("canvas",{ref:i,style:{width:"100%",display:"block",cursor:s.current?"grabbing":"default"},onMouseDown:M,onMouseMove:A,onMouseUp:B,onMouseLeave:B})})}function yy(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Sl(i,e){for(var t=0;t<e.length;t++){var s=e[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function by(i,e,t){return e&&Sl(i.prototype,e),t&&Sl(i,t),i}function vy(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function kl(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,s)}return t}function Tl(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?kl(Object(t),!0).forEach(function(s){vy(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):kl(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}var Ol={addCSS:!0,thumbWidth:15,watch:!0};function _y(i,e){return(function(){return Array.from(document.querySelectorAll(e)).includes(this)}).call(i,e)}function wy(i,e){if(i&&e){var t=new Event(e,{bubbles:!0});i.dispatchEvent(t)}}var $i=function(i){return i!=null?i.constructor:null},Ko=function(i,e){return!!(i&&e&&i instanceof e)},zh=function(i){return i==null},Bh=function(i){return $i(i)===Object},xy=function(i){return $i(i)===Number&&!Number.isNaN(i)},$h=function(i){return $i(i)===String},Cy=function(i){return $i(i)===Boolean},Sy=function(i){return $i(i)===Function},Vh=function(i){return Array.isArray(i)},Wh=function(i){return Ko(i,NodeList)},ky=function(i){return Ko(i,Element)},Ty=function(i){return Ko(i,Event)},Oy=function(i){return zh(i)||($h(i)||Vh(i)||Wh(i))&&!i.length||Bh(i)&&!Object.keys(i).length},Je={nullOrUndefined:zh,object:Bh,number:xy,string:$h,boolean:Cy,function:Sy,array:Vh,nodeList:Wh,element:ky,event:Ty,empty:Oy};function Ey(i){var e="".concat(i).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0}function My(i,e){if(1>e){var t=Ey(e);return parseFloat(i.toFixed(t))}return Math.round(i/e)*e}var Dy=function(){function i(e,t){yy(this,i),Je.element(e)?this.element=e:Je.string(e)&&(this.element=document.querySelector(e)),Je.element(this.element)&&Je.empty(this.element.rangeTouch)&&(this.config=Tl({},Ol,{},t),this.init())}return by(i,[{key:"init",value:function(){i.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){i.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(e){var t=this,s=e?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach(function(r){t.element[s](r,function(n){return t.set(n)},!1)})}},{key:"get",value:function(e){if(!i.enabled||!Je.event(e))return null;var t,s=e.target,r=e.changedTouches[0],n=parseFloat(s.getAttribute("min"))||0,o=parseFloat(s.getAttribute("max"))||100,a=parseFloat(s.getAttribute("step"))||1,l=s.getBoundingClientRect(),c=100/l.width*(this.config.thumbWidth/2)/100;return 0>(t=100/l.width*(r.clientX-l.left))?t=0:100<t&&(t=100),50>t?t-=(100-2*t)*c:50<t&&(t+=2*(t-50)*c),n+My(t/100*(o-n),a)}},{key:"set",value:function(e){i.enabled&&Je.event(e)&&!e.target.disabled&&(e.preventDefault(),e.target.value=this.get(e),wy(e.target,e.type==="touchend"?"change":"input"))}}],[{key:"setup",value:function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},s=null;if(Je.empty(e)||Je.string(e)?s=Array.from(document.querySelectorAll(Je.string(e)?e:'input[type="range"]')):Je.element(e)?s=[e]:Je.nodeList(e)?s=Array.from(e):Je.array(e)&&(s=e.filter(Je.element)),Je.empty(s))return null;var r=Tl({},Ol,{},t);if(Je.string(e)&&r.watch){var n=new MutationObserver(function(o){Array.from(o).forEach(function(a){Array.from(a.addedNodes).forEach(function(l){Je.element(l)&&_y(l,e)&&new i(l,r)})})});n.observe(document.body,{childList:!0,subtree:!0})}return s.map(function(o){return new i(o,t)})}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),i}();const Vi=i=>i!==null&&typeof i<"u"?i.constructor:null,Qt=(i,e)=>!!(i&&e&&i instanceof e),Jo=i=>i===null||typeof i>"u",Hh=i=>Vi(i)===Object,Py=i=>Vi(i)===Number&&!Number.isNaN(i),nn=i=>Vi(i)===String,Ay=i=>Vi(i)===Boolean,Uh=i=>typeof i=="function",Xh=i=>Array.isArray(i),Ny=i=>Qt(i,WeakMap),Yh=i=>Qt(i,NodeList),Fy=i=>Vi(i)===Text,jy=i=>Qt(i,Event),Ly=i=>Qt(i,KeyboardEvent),Iy=i=>Qt(i,window.TextTrackCue)||Qt(i,window.VTTCue),Ry=i=>Qt(i,TextTrack)||!Jo(i)&&nn(i.kind),zy=i=>Qt(i,Promise)&&Uh(i.then);function By(i){return i!==null&&typeof i=="object"&&i.nodeType===1&&typeof i.style=="object"&&typeof i.ownerDocument=="object"}function Gh(i){return Jo(i)||(nn(i)||Xh(i)||Yh(i))&&!i.length||Hh(i)&&!Object.keys(i).length}function $y(i){if(Qt(i,window.URL))return!0;if(!nn(i))return!1;let e=i;(!i.startsWith("http://")||!i.startsWith("https://"))&&(e=`http://${i}`);try{return!Gh(new URL(e).hostname)}catch{return!1}}const b={nullOrUndefined:Jo,object:Hh,number:Py,string:nn,boolean:Ay,function:Uh,array:Xh,weakMap:Ny,nodeList:Yh,element:By,textNode:Fy,event:jy,keyboardEvent:Ly,cue:Iy,track:Ry,promise:zy,url:$y,empty:Gh},eo=(()=>{const i=document.createElement("span"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},t=Object.keys(e).find(s=>i.style[s]!==void 0);return b.string(t)?e[t]:!1})();function qh(i,e){setTimeout(()=>{try{i.hidden=!0,i.offsetHeight,i.hidden=!1}catch{}},e)}function Vy(i){return JSON.parse(JSON.stringify(i))}function Kh(i,e){return e.split(".").reduce((t,s)=>t&&t[s],i)}function Ae(i={},...e){if(!e.length)return i;const t=e.shift();return b.object(t)?(Object.keys(t).forEach(s=>{b.object(t[s])?(Object.keys(i).includes(s)||Object.assign(i,{[s]:{}}),Ae(i[s],t[s])):Object.assign(i,{[s]:t[s]})}),Ae(i,...e)):i}function Jh(i,e){const t=i.length?i:[i];Array.from(t).reverse().forEach((s,r)=>{const n=r>0?e.cloneNode(!0):e,o=s.parentNode,a=s.nextSibling;n.appendChild(s),a?o.insertBefore(n,a):o.appendChild(n)})}function to(i,e){!b.element(i)||b.empty(e)||Object.entries(e).filter(([,t])=>!b.nullOrUndefined(t)).forEach(([t,s])=>i.setAttribute(t,s))}function K(i,e,t){const s=document.createElement(i);return b.object(e)&&to(s,e),b.string(t)&&(s.textContent=t),s}function Wy(i,e){!b.element(i)||!b.element(e)||e.parentNode.insertBefore(i,e.nextSibling)}function El(i,e,t,s){b.element(e)&&e.appendChild(K(i,t,s))}function Wt(i){if(b.nodeList(i)||b.array(i)){Array.from(i).forEach(Wt);return}!b.element(i)||!b.element(i.parentNode)||i.parentNode.removeChild(i)}function kr(i){if(!b.element(i))return;let{length:e}=i.childNodes;for(;e>0;)i.removeChild(i.lastChild),e-=1}function $r(i,e){return!b.element(e)||!b.element(e.parentNode)||!b.element(i)?null:(e.parentNode.replaceChild(i,e),i)}function Et(i,e){if(!b.string(i)||b.empty(i))return{};const t={},s=Ae({},e);return i.split(",").forEach(r=>{const n=r.trim(),o=n.replace(".",""),l=n.replace(/[[\]]/g,"").split("="),[c]=l,h=l.length>1?l[1].replace(/["']/g,""):"";switch(n.charAt(0)){case".":b.string(s.class)?t.class=`${s.class} ${o}`:t.class=o;break;case"#":t.id=n.replace("#","");break;case"[":t[c]=h;break}}),Ae(s,t)}function ms(i,e){if(!b.element(i))return;let t=e;b.boolean(t)||(t=!i.hidden),i.hidden=t}function me(i,e,t){if(b.nodeList(i))return Array.from(i).map(s=>me(s,e,t));if(b.element(i)){let s="toggle";return typeof t<"u"&&(s=t?"add":"remove"),i.classList[s](e),i.classList.contains(e)}return!1}function Vr(i,e){return b.element(i)&&i.classList.contains(e)}function Cs(i,e){const{prototype:t}=Element;function s(){return Array.from(document.querySelectorAll(e)).includes(this)}return(t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||s).call(i,e)}function Hy(i,e){const{prototype:t}=Element;function s(){let n=this;do{if(Cs.matches(n,e))return n;n=n.parentElement||n.parentNode}while(n!==null&&n.nodeType===1);return null}return(t.closest||s).call(i,e)}function Di(i){return this.elements.container.querySelectorAll(i)}function Be(i){return this.elements.container.querySelector(i)}function En(i=null,e=!1){b.element(i)&&i.focus({preventScroll:!0,focusVisible:e})}const Ml={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},Ne={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(i,e){const t=Ne[i]||e!=="html5",s=t&&Ne.rangeInput;return{api:t,ui:s}},pip:document.pictureInPictureEnabled&&!K("video").disablePictureInPicture,airplay:b.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(i){if(b.empty(i))return!1;const[e]=i.split("/");let t=i;if(!this.isHTML5||e!==this.type)return!1;Object.keys(Ml).includes(t)&&(t+=`; codecs="${Ml[i]}"`);try{return!!(t&&this.media.canPlayType(t).replace(/no/,""))}catch{return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const i=document.createElement("input");return i.type="range",i.type==="range"})(),touch:"ontouchstart"in document.documentElement,transitions:eo!==!1,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},Uy=(()=>{let i=!1;try{const e=Object.defineProperty({},"passive",{get(){return i=!0,null}});window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch{}return i})();function Pi(i,e,t,s=!1,r=!0,n=!1){if(!i||!("addEventListener"in i)||b.empty(e)||!b.function(t))return;const o=e.split(" ");let a=n;Uy&&(a={passive:r,capture:n}),o.forEach(l=>{this&&this.eventListeners&&s&&this.eventListeners.push({element:i,type:l,callback:t,options:a}),i[s?"addEventListener":"removeEventListener"](l,t,a)})}function he(i,e="",t,s=!0,r=!1){Pi.call(this,i,e,t,!0,s,r)}function on(i,e="",t,s=!0,r=!1){Pi.call(this,i,e,t,!1,s,r)}function Zo(i,e="",t,s=!0,r=!1){const n=(...o)=>{on(i,e,n,s,r),t.apply(this,o)};Pi.call(this,i,e,n,!0,s,r)}function J(i,e="",t=!1,s={}){if(!b.element(i)||b.empty(e))return;const r=new CustomEvent(e,{bubbles:t,detail:{...s,plyr:this}});i.dispatchEvent(r)}function Xy(){this&&this.eventListeners&&(this.eventListeners.forEach(i=>{const{element:e,type:t,callback:s,options:r}=i;e.removeEventListener(t,s,r)}),this.eventListeners=[])}function Yy(){return new Promise(i=>this.ready?setTimeout(i,0):he.call(this,this.elements.container,"ready",i)).then(()=>{})}function Dt(i){b.promise(i)&&i.then(null,()=>{})}function so(i){return b.array(i)?i.filter((e,t)=>i.indexOf(e)===t):i}function Zh(i,e){return!b.array(i)||!i.length?null:i.reduce((t,s)=>Math.abs(s-e)<Math.abs(t-e)?s:t)}function Qh(i){return!window||!window.CSS?!1:window.CSS.supports(i)}const Dl=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce((i,[e,t])=>({...i,[e/t]:[e,t]}),{});function eu(i){return!b.array(i)&&(!b.string(i)||!i.includes(":"))?!1:(b.array(i)?i:i.split(":")).map(Number).every(b.number)}function Wr(i){if(!b.array(i)||!i.every(b.number))return null;const[e,t]=i,s=(n,o)=>o===0?n:s(o,n%o),r=s(e,t);return[e/r,t/r]}function Qo(i){const e=s=>eu(s)?s.split(":").map(Number):null;let t=e(i);if(t===null&&(t=e(this.config.ratio)),t===null&&!b.empty(this.embed)&&b.array(this.embed.ratio)&&({ratio:t}=this.embed),t===null&&this.isHTML5){const{videoWidth:s,videoHeight:r}=this.media;t=[s,r]}return Wr(t)}function Gs(i){if(!this.isVideo)return{};const{wrapper:e}=this.elements,t=Qo.call(this,i);if(!b.array(t))return{};const[s,r]=Wr(t),n=Qh(`aspect-ratio: ${s}/${r}`),o=100/s*r;if(n?e.style.aspectRatio=`${s}/${r}`:e.style.paddingBottom=`${o}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const a=100/this.media.offsetWidth*Number.parseInt(window.getComputedStyle(this.media).paddingBottom,10),l=(a-o)/(a/50);this.fullscreen.active?e.style.paddingBottom=null:this.media.style.transform=`translateY(-${l}%)`}else this.isHTML5&&e.classList.add(this.config.classNames.videoFixedRatio);return{padding:o,ratio:t}}function tu(i,e,t=.05){const s=i/e,r=Zh(Object.keys(Dl),s);return Math.abs(r-s)<=t?Dl[r]:[i,e]}function Gy(){const i=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);return[i,e]}const as={getSources(){return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter(e=>{const t=e.getAttribute("type");return b.empty(t)?!0:Ne.mime.call(this,t)}):[]},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:as.getSources.call(this).map(i=>Number(i.getAttribute("size"))).filter(Boolean)},setup(){if(!this.isHTML5)return;const i=this;i.options.speed=i.config.speed.options,b.empty(this.config.ratio)||Gs.call(i),Object.defineProperty(i.media,"quality",{get(){const t=as.getSources.call(i).find(s=>s.getAttribute("src")===i.source);return t&&Number(t.getAttribute("size"))},set(e){if(i.quality!==e){if(i.config.quality.forced&&b.function(i.config.quality.onChange))i.config.quality.onChange(e);else{const s=as.getSources.call(i).find(c=>Number(c.getAttribute("size"))===e);if(!s)return;const{currentTime:r,paused:n,preload:o,readyState:a,playbackRate:l}=i.media;i.media.src=s.getAttribute("src"),(o!=="none"||a)&&(i.once("loadedmetadata",()=>{i.speed=l,i.currentTime=r,n||Dt(i.play())}),i.media.load())}J.call(i,i.media,"qualitychange",!1,{quality:e})}}})},cancelRequests(){this.isHTML5&&(Wt(as.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}},qy=!!window.document.documentMode,Ky=/Edge/.test(navigator.userAgent),Jy="WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),Zy=navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,Qy=/iPad|iPhone|iPod/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1,Ge={isIE:qy,isEdge:Ky,isWebKit:Jy,isIPadOS:Zy,isIos:Qy};function e0(i){return`${i}-${Math.floor(Math.random()*1e4)}`}function io(i,...e){return b.empty(i)?i:i.toString().replace(/\{(\d+)\}/g,(t,s)=>e[s].toString())}function t0(i,e){return i===0||e===0||Number.isNaN(i)||Number.isNaN(e)?0:(i/e*100).toFixed(2)}function xi(i="",e="",t=""){return i.replace(new RegExp(e.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),t.toString())}function su(i=""){return i.toString().replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())}function s0(i=""){let e=i.toString();return e=xi(e,"-"," "),e=xi(e,"_"," "),e=su(e),xi(e," ","")}function i0(i=""){let e=i.toString();return e=s0(e),e.charAt(0).toLowerCase()+e.slice(1)}function r0(i){const e=document.createDocumentFragment(),t=document.createElement("div");return e.appendChild(t),t.innerHTML=i,e.firstChild.textContent}function n0(i){const e=document.createElement("div");return e.appendChild(i),e.innerHTML}const Pl={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},Ue={get(i="",e={}){if(b.empty(i)||b.empty(e))return"";let t=Kh(e.i18n,i);if(b.empty(t))return Object.keys(Pl).includes(i)?Pl[i]:"";const s={"{seektime}":e.seekTime,"{title}":e.title};return Object.entries(s).forEach(([r,n])=>{t=xi(t,r,n)}),t}};class Ai{constructor(e){z(this,"get",e=>{if(!Ai.supported||!this.enabled)return null;const t=window.localStorage.getItem(this.key);if(b.empty(t))return null;const s=JSON.parse(t);return b.string(e)&&e.length?s[e]:s});z(this,"set",e=>{if(!Ai.supported||!this.enabled||!b.object(e))return;let t=this.get();b.empty(t)&&(t={}),Ae(t,e);try{window.localStorage.setItem(this.key,JSON.stringify(t))}catch{}});this.enabled=e.config.storage.enabled,this.key=e.config.storage.key}static get supported(){try{if(!("localStorage"in window))return!1;const e="___test";return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}}function Wi(i,e="text",t=!1){return new Promise((s,r)=>{try{const n=new XMLHttpRequest;if(!("withCredentials"in n))return;t&&(n.withCredentials=!0),n.addEventListener("load",()=>{if(e==="text")try{s(JSON.parse(n.responseText))}catch{s(n.responseText)}else s(n.response)}),n.addEventListener("error",()=>{throw new Error(n.status)}),n.open("GET",i,!0),n.responseType=e,n.send()}catch(n){r(n)}})}function iu(i,e){if(!b.string(i))return;const t="cache",s=b.string(e);let r=!1;const n=()=>document.getElementById(e)!==null,o=(a,l)=>{a.innerHTML=l,!(s&&n())&&document.body.insertAdjacentElement("afterbegin",a)};if(!s||!n()){const a=Ai.supported,l=document.createElement("div");if(l.setAttribute("hidden",""),s&&l.setAttribute("id",e),a){const c=window.localStorage.getItem(`${t}-${e}`);if(r=c!==null,r){const h=JSON.parse(c);o(l,h.content)}}Wi(i).then(c=>{if(!b.empty(c)){if(a)try{window.localStorage.setItem(`${t}-${e}`,JSON.stringify({content:c}))}catch{}o(l,c)}}).catch(()=>{})}}const ru=i=>Math.trunc(i/60/60%60,10),o0=i=>Math.trunc(i/60%60,10),a0=i=>Math.trunc(i%60,10);function an(i=0,e=!1,t=!1){if(!b.number(i))return an(void 0,e,t);const s=a=>`0${a}`.slice(-2);let r=ru(i);const n=o0(i),o=a0(i);return e||r>0?r=`${r}:`:r="",`${t&&i>0?"-":""}${r}${s(n)}:${s(o)}`}const I={getIconUrl(){const i=new URL(this.config.iconUrl,window.location),e=window.location.host?window.location.host:window.top.location.host,t=i.host!==e||Ge.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:t}},findElements(){try{return this.elements.controls=Be.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:Di.call(this,this.config.selectors.buttons.play),pause:Be.call(this,this.config.selectors.buttons.pause),restart:Be.call(this,this.config.selectors.buttons.restart),rewind:Be.call(this,this.config.selectors.buttons.rewind),fastForward:Be.call(this,this.config.selectors.buttons.fastForward),mute:Be.call(this,this.config.selectors.buttons.mute),pip:Be.call(this,this.config.selectors.buttons.pip),airplay:Be.call(this,this.config.selectors.buttons.airplay),settings:Be.call(this,this.config.selectors.buttons.settings),captions:Be.call(this,this.config.selectors.buttons.captions),fullscreen:Be.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=Be.call(this,this.config.selectors.progress),this.elements.inputs={seek:Be.call(this,this.config.selectors.inputs.seek),volume:Be.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:Be.call(this,this.config.selectors.display.buffer),currentTime:Be.call(this,this.config.selectors.display.currentTime),duration:Be.call(this,this.config.selectors.display.duration)},b.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(i){return this.debug.warn("It looks like there is a problem with your custom controls HTML",i),this.toggleNativeControls(!0),!1}},createIcon(i,e){const t="http://www.w3.org/2000/svg",s=I.getIconUrl.call(this),r=`${s.cors?"":s.url}#${this.config.iconPrefix}`,n=document.createElementNS(t,"svg");to(n,Ae(e,{"aria-hidden":"true",focusable:"false"}));const o=document.createElementNS(t,"use"),a=`${r}-${i}`;return"href"in o&&o.setAttributeNS("http://www.w3.org/1999/xlink","href",a),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a),n.appendChild(o),n},createLabel(i,e={}){const t=Ue.get(i,this.config),s={...e,class:[e.class,this.config.classNames.hidden].filter(Boolean).join(" ")};return K("span",s,t)},createBadge(i){if(b.empty(i))return null;const e=K("span",{class:this.config.classNames.menu.value});return e.appendChild(K("span",{class:this.config.classNames.menu.badge},i)),e},createButton(i,e){const t=Ae({},e);let s=i0(i);const r={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach(o=>{Object.keys(t).includes(o)&&(r[o]=t[o],delete t[o])}),r.element==="button"&&!Object.keys(t).includes("type")&&(t.type="button"),Object.keys(t).includes("class")?t.class.split(" ").includes(this.config.classNames.control)||Ae(t,{class:`${t.class} ${this.config.classNames.control}`}):t.class=this.config.classNames.control,i){case"play":r.toggle=!0,r.label="play",r.labelPressed="pause",r.icon="play",r.iconPressed="pause";break;case"mute":r.toggle=!0,r.label="mute",r.labelPressed="unmute",r.icon="volume",r.iconPressed="muted";break;case"captions":r.toggle=!0,r.label="enableCaptions",r.labelPressed="disableCaptions",r.icon="captions-off",r.iconPressed="captions-on";break;case"fullscreen":r.toggle=!0,r.label="enterFullscreen",r.labelPressed="exitFullscreen",r.icon="enter-fullscreen",r.iconPressed="exit-fullscreen";break;case"play-large":t.class+=` ${this.config.classNames.control}--overlaid`,s="play",r.label="play",r.icon="play";break;default:b.empty(r.label)&&(r.label=s),b.empty(r.icon)&&(r.icon=i)}const n=K(r.element);return r.toggle?(n.appendChild(I.createIcon.call(this,r.iconPressed,{class:"icon--pressed"})),n.appendChild(I.createIcon.call(this,r.icon,{class:"icon--not-pressed"})),n.appendChild(I.createLabel.call(this,r.labelPressed,{class:"label--pressed"})),n.appendChild(I.createLabel.call(this,r.label,{class:"label--not-pressed"}))):(n.appendChild(I.createIcon.call(this,r.icon)),n.appendChild(I.createLabel.call(this,r.label))),Ae(t,Et(this.config.selectors.buttons[s],t)),to(n,t),s==="play"?(b.array(this.elements.buttons[s])||(this.elements.buttons[s]=[]),this.elements.buttons[s].push(n)):this.elements.buttons[s]=n,n},createRange(i,e){const t=K("input",Ae(Et(this.config.selectors.inputs[i]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":Ue.get(i,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},e));return this.elements.inputs[i]=t,I.updateRangeFill.call(this,t),Dy.setup(t),t},createProgress(i,e){const t=K("progress",Ae(Et(this.config.selectors.display[i]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},e));if(i!=="volume"){t.appendChild(K("span",null,"0"));const s={played:"played",buffer:"buffered"}[i],r=s?Ue.get(s,this.config):"";t.textContent=`% ${r.toLowerCase()}`}return this.elements.display[i]=t,t},createTime(i,e){const t=Et(this.config.selectors.display[i],e),s=K("div",Ae(t,{class:`${t.class?t.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":Ue.get(i,this.config),role:"timer"}),"00:00");return this.elements.display[i]=s,s},bindMenuItemShortcuts(i,e){he.call(this,i,"keydown keyup",t=>{if(![" ","ArrowUp","ArrowDown","ArrowRight"].includes(t.key)||(t.preventDefault(),t.stopPropagation(),t.type==="keydown"))return;const s=Cs(i,'[role="menuitemradio"]');if(!s&&[" ","ArrowRight"].includes(t.key))I.showMenuPanel.call(this,e,!0);else{let r;t.key!==" "&&(t.key==="ArrowDown"||s&&t.key==="ArrowRight"?(r=i.nextElementSibling,b.element(r)||(r=i.parentNode.firstElementChild)):(r=i.previousElementSibling,b.element(r)||(r=i.parentNode.lastElementChild)),En.call(this,r,!0))}},!1),he.call(this,i,"keyup",t=>{t.key==="Return"&&I.focusFirstMenuItem.call(this,null,!0)})},createMenuItem({value:i,list:e,type:t,title:s,badge:r=null,checked:n=!1}){const o=Et(this.config.selectors.inputs[t]),a=K("button",Ae(o,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${o.class?o.class:""}`.trim(),"aria-checked":n,value:i})),l=K("span");l.innerHTML=s,b.element(r)&&l.appendChild(r),a.appendChild(l),Object.defineProperty(a,"checked",{enumerable:!0,get(){return a.getAttribute("aria-checked")==="true"},set(c){c&&Array.from(a.parentNode.children).filter(h=>Cs(h,'[role="menuitemradio"]')).forEach(h=>h.setAttribute("aria-checked","false")),a.setAttribute("aria-checked",c?"true":"false")}}),this.listeners.bind(a,"click keyup",c=>{if(!(b.keyboardEvent(c)&&c.key!==" ")){switch(c.preventDefault(),c.stopPropagation(),a.checked=!0,t){case"language":this.currentTrack=Number(i);break;case"quality":this.quality=i;break;case"speed":this.speed=Number.parseFloat(i);break}I.showMenuPanel.call(this,"home",b.keyboardEvent(c))}},t,!1),I.bindMenuItemShortcuts.call(this,a,t),e.appendChild(a)},formatTime(i=0,e=!1){if(!b.number(i))return i;const t=ru(this.duration)>0;return an(i,t,e)},updateTimeDisplay(i=null,e=0,t=!1){!b.element(i)||!b.number(e)||(i.textContent=I.formatTime(e,t))},updateVolume(){this.supported.ui&&(b.element(this.elements.inputs.volume)&&I.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),b.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||this.volume===0))},setRange(i,e=0){b.element(i)&&(i.value=e,I.updateRangeFill.call(this,i))},updateProgress(i){if(!this.supported.ui||!b.event(i))return;let e=0;const t=(s,r)=>{const n=b.number(r)?r:0,o=b.element(s)?s:this.elements.display.buffer;if(b.element(o)){o.value=n;const a=o.getElementsByTagName("span")[0];b.element(a)&&(a.childNodes[0].nodeValue=n)}};if(i)switch(i.type){case"timeupdate":case"seeking":case"seeked":e=t0(this.currentTime,this.duration),i.type==="timeupdate"&&I.setRange.call(this,this.elements.inputs.seek,e);break;case"playing":case"progress":t(this.elements.display.buffer,this.buffered*100);break}},updateRangeFill(i){const e=b.event(i)?i.target:i;if(!(!b.element(e)||e.getAttribute("type")!=="range")){if(Cs(e,this.config.selectors.inputs.seek)){e.setAttribute("aria-valuenow",this.currentTime);const t=I.formatTime(this.currentTime),s=I.formatTime(this.duration),r=Ue.get("seekLabel",this.config);e.setAttribute("aria-valuetext",r.replace("{currentTime}",t).replace("{duration}",s))}else if(Cs(e,this.config.selectors.inputs.volume)){const t=e.value*100;e.setAttribute("aria-valuenow",t),e.setAttribute("aria-valuetext",`${t.toFixed(1)}%`)}else e.setAttribute("aria-valuenow",e.value);!Ge.isWebKit&&!Ge.isIPadOS||e.style.setProperty("--value",`${e.value/e.max*100}%`)}},updateSeekTooltip(i){var l,c;if(!this.config.tooltips.seek||!b.element(this.elements.inputs.seek)||!b.element(this.elements.display.seekTooltip)||this.duration===0)return;const e=this.elements.display.seekTooltip,t=`${this.config.classNames.tooltip}--visible`,s=h=>me(e,t,h);if(this.touch){s(!1);return}let r=0;const n=this.elements.progress.getBoundingClientRect();if(b.event(i)){const h=i.pageX-i.clientX;r=100/n.width*(i.pageX-n.left-h)}else if(Vr(e,t))r=Number.parseFloat(e.style.left,10);else return;r<0?r=0:r>100&&(r=100);const o=this.duration/100*r;e.textContent=I.formatTime(o);const a=(c=(l=this.config.markers)==null?void 0:l.points)==null?void 0:c.find(({time:h})=>h===Math.round(o));a&&e.insertAdjacentHTML("afterbegin",`${a.label}<br>`),e.style.left=`${r}%`,b.event(i)&&["mouseenter","mouseleave"].includes(i.type)&&s(i.type==="mouseenter")},timeUpdate(i){const e=!b.element(this.elements.display.duration)&&this.config.invertTime;I.updateTimeDisplay.call(this,this.elements.display.currentTime,e?this.duration-this.currentTime:this.currentTime,e),!(i&&i.type==="timeupdate"&&this.media.seeking)&&I.updateProgress.call(this,i)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32){ms(this.elements.display.currentTime,!0),ms(this.elements.progress,!0);return}b.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);const i=b.element(this.elements.display.duration);!i&&this.config.displayDuration&&this.paused&&I.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),i&&I.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),this.config.markers.enabled&&I.setMarkers.call(this),I.updateSeekTooltip.call(this)},toggleMenuButton(i,e){ms(this.elements.settings.buttons[i],!e)},updateSetting(i,e,t){const s=this.elements.settings.panels[i];let r=null,n=e;if(i==="captions")r=this.currentTrack;else{if(r=b.empty(t)?this[i]:t,b.empty(r)&&(r=this.config[i].default),!b.empty(this.options[i])&&!this.options[i].includes(r)){this.debug.warn(`Unsupported value of '${r}' for ${i}`);return}if(!this.config[i].options.includes(r)){this.debug.warn(`Disabled value of '${r}' for ${i}`);return}}if(b.element(n)||(n=s&&s.querySelector('[role="menu"]')),!b.element(n))return;const o=this.elements.settings.buttons[i].querySelector(`.${this.config.classNames.menu.value}`);o.innerHTML=I.getLabel.call(this,i,r);const a=n&&n.querySelector(`[value="${r}"]`);b.element(a)&&(a.checked=!0)},getLabel(i,e){switch(i){case"speed":return e===1?Ue.get("normal",this.config):`${e}&times;`;case"quality":if(b.number(e)){const t=Ue.get(`qualityLabel.${e}`,this.config);return t.length?t:`${e}p`}return su(e);case"captions":return ge.getLabel.call(this);default:return null}},setQualityMenu(i){if(!b.element(this.elements.settings.panels.quality))return;const e="quality",t=this.elements.settings.panels.quality.querySelector('[role="menu"]');b.array(i)&&(this.options.quality=so(i).filter(n=>this.config.quality.options.includes(n)));const s=!b.empty(this.options.quality)&&this.options.quality.length>1;if(I.toggleMenuButton.call(this,e,s),kr(t),I.checkMenu.call(this),!s)return;const r=n=>{const o=Ue.get(`qualityBadge.${n}`,this.config);return o.length?I.createBadge.call(this,o):null};this.options.quality.sort((n,o)=>{const a=this.config.quality.options;return a.indexOf(n)>a.indexOf(o)?1:-1}).forEach(n=>{I.createMenuItem.call(this,{value:n,list:t,type:e,title:I.getLabel.call(this,"quality",n),badge:r(n)})}),I.updateSetting.call(this,e,t)},setCaptionsMenu(){if(!b.element(this.elements.settings.panels.captions))return;const i="captions",e=this.elements.settings.panels.captions.querySelector('[role="menu"]'),t=ge.getTracks.call(this),s=!!t.length;if(I.toggleMenuButton.call(this,i,s),kr(e),I.checkMenu.call(this),!s)return;const r=t.map((n,o)=>({value:o,checked:this.captions.toggled&&this.currentTrack===o,title:ge.getLabel.call(this,n),badge:n.language&&I.createBadge.call(this,n.language.toUpperCase()),list:e,type:"language"}));r.unshift({value:-1,checked:!this.captions.toggled,title:Ue.get("disabled",this.config),list:e,type:"language"}),r.forEach(I.createMenuItem.bind(this)),I.updateSetting.call(this,i,e)},setSpeedMenu(){if(!b.element(this.elements.settings.panels.speed))return;const i="speed",e=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter(s=>s>=this.minimumSpeed&&s<=this.maximumSpeed);const t=!b.empty(this.options.speed)&&this.options.speed.length>1;I.toggleMenuButton.call(this,i,t),kr(e),I.checkMenu.call(this),t&&(this.options.speed.forEach(s=>{I.createMenuItem.call(this,{value:s,list:e,type:i,title:I.getLabel.call(this,"speed",s)})}),I.updateSetting.call(this,i,e))},checkMenu(){const{buttons:i}=this.elements.settings,e=!b.empty(i)&&Object.values(i).some(t=>!t.hidden);ms(this.elements.settings.menu,!e)},focusFirstMenuItem(i,e=!1){if(this.elements.settings.popup.hidden)return;let t=i;b.element(t)||(t=Object.values(this.elements.settings.panels).find(r=>!r.hidden));const s=t.querySelector('[role^="menuitem"]');En.call(this,s,e)},toggleMenu(i){const{popup:e}=this.elements.settings,t=this.elements.buttons.settings;if(!b.element(e)||!b.element(t))return;const{hidden:s}=e;let r=s;if(b.boolean(i))r=i;else if(b.keyboardEvent(i)&&i.key==="Escape")r=!1;else if(b.event(i)){const n=b.function(i.composedPath)?i.composedPath()[0]:i.target,o=e.contains(n);if(o||!o&&i.target!==t&&r)return}t.setAttribute("aria-expanded",r),ms(e,!r),me(this.elements.container,this.config.classNames.menu.open,r),r&&b.keyboardEvent(i)?I.focusFirstMenuItem.call(this,null,!0):!r&&!s&&En.call(this,t,b.keyboardEvent(i))},getMenuSize(i){const e=i.cloneNode(!0);e.style.position="absolute",e.style.opacity=0,e.removeAttribute("hidden"),i.parentNode.appendChild(e);const t=e.scrollWidth,s=e.scrollHeight;return Wt(e),{width:t,height:s}},showMenuPanel(i="",e=!1){const t=this.elements.container.querySelector(`#plyr-settings-${this.id}-${i}`);if(!b.element(t))return;const s=t.parentNode,r=Array.from(s.children).find(n=>!n.hidden);if(Ne.transitions&&!Ne.reducedMotion){s.style.width=`${r.scrollWidth}px`,s.style.height=`${r.scrollHeight}px`;const n=I.getMenuSize.call(this,t),o=a=>{a.target!==s||!["width","height"].includes(a.propertyName)||(s.style.width="",s.style.height="",on.call(this,s,eo,o))};he.call(this,s,eo,o),s.style.width=`${n.width}px`,s.style.height=`${n.height}px`}ms(r,!0),ms(t,!1),I.focusFirstMenuItem.call(this,t,e)},setDownloadUrl(){const i=this.elements.buttons.download;b.element(i)&&i.setAttribute("href",this.download)},create(i){const{bindMenuItemShortcuts:e,createButton:t,createProgress:s,createRange:r,createTime:n,setQualityMenu:o,setSpeedMenu:a,showMenuPanel:l}=I;this.elements.controls=null,b.array(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(t.call(this,"play-large"));const c=K("div",Et(this.config.selectors.controls.wrapper));this.elements.controls=c;const h={class:"plyr__controls__item"};return so(b.array(this.config.controls)?this.config.controls:[]).forEach(u=>{if(u==="restart"&&c.appendChild(t.call(this,"restart",h)),u==="rewind"&&c.appendChild(t.call(this,"rewind",h)),u==="play"&&c.appendChild(t.call(this,"play",h)),u==="fast-forward"&&c.appendChild(t.call(this,"fast-forward",h)),u==="progress"){const d=K("div",{class:`${h.class} plyr__progress__container`}),g=K("div",Et(this.config.selectors.progress));if(g.appendChild(r.call(this,"seek",{id:`plyr-seek-${i.id}`})),g.appendChild(s.call(this,"buffer")),this.config.tooltips.seek){const p=K("span",{class:this.config.classNames.tooltip},"00:00");g.appendChild(p),this.elements.display.seekTooltip=p}this.elements.progress=g,d.appendChild(this.elements.progress),c.appendChild(d)}if(u==="current-time"&&c.appendChild(n.call(this,"currentTime",h)),u==="duration"&&c.appendChild(n.call(this,"duration",h)),u==="mute"||u==="volume"){let{volume:d}=this.elements;if((!b.element(d)||!c.contains(d))&&(d=K("div",Ae({},h,{class:`${h.class} plyr__volume`.trim()})),this.elements.volume=d,c.appendChild(d)),u==="mute"&&d.appendChild(t.call(this,"mute")),u==="volume"&&!Ge.isIos&&!Ge.isIPadOS){const g={max:1,step:.05,value:this.config.volume};d.appendChild(r.call(this,"volume",Ae(g,{id:`plyr-volume-${i.id}`})))}}if(u==="captions"&&c.appendChild(t.call(this,"captions",h)),u==="settings"&&!b.empty(this.config.settings)){const d=K("div",Ae({},h,{class:`${h.class} plyr__menu`.trim(),hidden:""}));d.appendChild(t.call(this,"settings",{"aria-haspopup":!0,"aria-controls":`plyr-settings-${i.id}`,"aria-expanded":!1}));const g=K("div",{class:"plyr__menu__container",id:`plyr-settings-${i.id}`,hidden:""}),p=K("div"),y=K("div",{id:`plyr-settings-${i.id}-home`}),v=K("div",{role:"menu"});y.appendChild(v),p.appendChild(y),this.elements.settings.panels.home=y,this.config.settings.forEach(_=>{const f=K("button",Ae(Et(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":!0,hidden:""}));e.call(this,f,_),he.call(this,f,"click",()=>{l.call(this,_,!1)});const S=K("span",null,Ue.get(_,this.config)),C=K("span",{class:this.config.classNames.menu.value});C.innerHTML=i[_],S.appendChild(C),f.appendChild(S),v.appendChild(f);const k=K("div",{id:`plyr-settings-${i.id}-${_}`,hidden:""}),T=K("button",{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});T.appendChild(K("span",{"aria-hidden":!0},Ue.get(_,this.config))),T.appendChild(K("span",{class:this.config.classNames.hidden},Ue.get("menuBack",this.config))),he.call(this,k,"keydown",F=>{F.key==="ArrowLeft"&&(F.preventDefault(),F.stopPropagation(),l.call(this,"home",!0))},!1),he.call(this,T,"click",()=>{l.call(this,"home",!1)}),k.appendChild(T),k.appendChild(K("div",{role:"menu"})),p.appendChild(k),this.elements.settings.buttons[_]=f,this.elements.settings.panels[_]=k}),g.appendChild(p),d.appendChild(g),c.appendChild(d),this.elements.settings.popup=g,this.elements.settings.menu=d}if(u==="pip"&&Ne.pip&&c.appendChild(t.call(this,"pip",h)),u==="airplay"&&Ne.airplay&&c.appendChild(t.call(this,"airplay",h)),u==="download"){const d=Ae({},h,{element:"a",href:this.download,target:"_blank"});this.isHTML5&&(d.download="");const{download:g}=this.config.urls;!b.url(g)&&this.isEmbed&&Ae(d,{icon:`logo-${this.provider}`,label:this.provider}),c.appendChild(t.call(this,"download",d))}u==="fullscreen"&&c.appendChild(t.call(this,"fullscreen",h))}),this.isHTML5&&o.call(this,as.getQualityOptions.call(this)),a.call(this),c},inject(){if(this.config.loadSprite){const o=I.getIconUrl.call(this);o.cors&&iu(o.url,"sprite-plyr")}this.id=Math.floor(Math.random()*1e4);let i=null;this.elements.controls=null;const e={id:this.id,seektime:this.config.seekTime,title:this.config.title};let t=!0;b.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this,e)),this.config.controls||(this.config.controls=[]),b.element(this.config.controls)||b.string(this.config.controls)?i=this.config.controls:(i=I.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:ge.getLabel.call(this)}),t=!1);const s=o=>{let a=o;return Object.entries(e).forEach(([l,c])=>{a=xi(a,`{${l}}`,c)}),a};t&&b.string(this.config.controls)&&(i=s(i));let r;b.string(this.config.selectors.controls.container)&&(r=document.querySelector(this.config.selectors.controls.container)),b.element(r)||(r=this.elements.container);const n=b.element(i)?"insertAdjacentElement":"insertAdjacentHTML";if(r[n]("afterbegin",i),b.element(this.elements.controls)||I.findElements.call(this),!b.empty(this.elements.buttons)){const o=a=>{const l=this.config.classNames.controlPressed;a.setAttribute("aria-pressed","false"),Object.defineProperty(a,"pressed",{configurable:!0,enumerable:!0,get(){return Vr(a,l)},set(c=!1){me(a,l,c),a.setAttribute("aria-pressed",c?"true":"false")}})};Object.values(this.elements.buttons).filter(Boolean).forEach(a=>{b.array(a)||b.nodeList(a)?Array.from(a).filter(Boolean).forEach(o):o(a)})}if(Ge.isEdge&&qh(r),this.config.tooltips.controls){const{classNames:o,selectors:a}=this.config,l=`${a.controls.wrapper} ${a.labels} .${o.hidden}`,c=Di.call(this,l);Array.from(c).forEach(h=>{me(h,this.config.classNames.hidden,!1),me(h,this.config.classNames.tooltip,!0)})}},setMediaMetadata(){try{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork}))}catch{}},setMarkers(){var o,a;if(!this.duration||this.elements.markers)return;const i=(a=(o=this.config.markers)==null?void 0:o.points)==null?void 0:a.filter(({time:l})=>l>0&&l<this.duration);if(!(i!=null&&i.length))return;const e=document.createDocumentFragment(),t=document.createDocumentFragment();let s=null;const r=`${this.config.classNames.tooltip}--visible`,n=l=>me(s,r,l);i.forEach(l=>{const c=K("span",{class:this.config.classNames.marker},""),h=`${l.time/this.duration*100}%`;s&&(c.addEventListener("mouseenter",()=>{l.label||(s.style.left=h,s.innerHTML=l.label,n(!0))}),c.addEventListener("mouseleave",()=>{n(!1)})),c.addEventListener("click",()=>{this.currentTime=l.time}),c.style.left=h,t.appendChild(c)}),e.appendChild(t),this.config.tooltips.seek||(s=K("span",{class:this.config.classNames.tooltip},""),e.appendChild(s)),this.elements.markers={points:t,tip:s},this.elements.progress.appendChild(e)}};function nu(i,e=!0){let t=i;if(e){const s=document.createElement("a");s.href=t,t=s.href}try{return new URL(t)}catch{return null}}function ou(i){const e=new URLSearchParams;return b.object(i)&&Object.entries(i).forEach(([t,s])=>{e.set(t,s)}),e}const ge={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!Ne.textTracks){b.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&I.setCaptionsMenu.call(this);return}if(b.element(this.elements.captions)||(this.elements.captions=K("div",Et(this.config.selectors.captions)),this.elements.captions.setAttribute("dir","auto"),Wy(this.elements.captions,this.elements.wrapper)),Ge.isIE&&window.URL){const r=this.media.querySelectorAll("track");Array.from(r).forEach(n=>{const o=n.getAttribute("src"),a=nu(o);a!==null&&a.hostname!==window.location.href.hostname&&["http:","https:"].includes(a.protocol)&&Wi(o,"blob").then(l=>{n.setAttribute("src",window.URL.createObjectURL(l))}).catch(()=>{Wt(n)})})}const i=navigator.languages||[navigator.language||navigator.userLanguage||"en"],e=so(i.map(r=>r.split("-")[0]));let t=(this.storage.get("language")||this.captions.language||this.config.captions.language||"auto").toLowerCase();t==="auto"&&([t]=e);let s=this.storage.get("captions")||this.captions.active;if(b.boolean(s)||({active:s}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:s,language:t,languages:e}),this.isHTML5){const r=this.config.captions.update?"addtrack removetrack":"removetrack";he.call(this,this.media.textTracks,r,ge.update.bind(this))}setTimeout(ge.update.bind(this),0)},update(){const i=ge.getTracks.call(this,!0),{active:e,language:t,meta:s,currentTrackNode:r}=this.captions,n=!!i.find(o=>o.language===t);this.isHTML5&&this.isVideo&&i.filter(o=>!s.get(o)).forEach(o=>{this.debug.log("Track added",o),s.set(o,{default:o.mode==="showing"}),o.mode==="showing"&&(o.mode="hidden"),he.call(this,o,"cuechange",()=>ge.updateCues.call(this))}),(n&&this.language!==t||!i.includes(r))&&(ge.setLanguage.call(this,t),ge.toggle.call(this,e&&n)),this.elements&&me(this.elements.container,this.config.classNames.captions.enabled,!b.empty(i)),b.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&I.setCaptionsMenu.call(this)},toggle(i,e=!0){if(!this.supported.ui)return;const{toggled:t}=this.captions,s=this.config.classNames.captions.active,r=b.nullOrUndefined(i)?!t:i;if(r!==t){if(e||(this.captions.active=r,this.storage.set({captions:r})),!this.language&&r&&!e){const n=ge.getTracks.call(this),o=ge.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);this.captions.language=o.language,ge.set.call(this,n.indexOf(o));return}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=r),me(this.elements.container,s,r),this.captions.toggled=r,I.updateSetting.call(this,"captions"),J.call(this,this.media,r?"captionsenabled":"captionsdisabled")}setTimeout(()=>{r&&this.captions.toggled&&(this.captions.currentTrackNode.mode="hidden")})},set(i,e=!0){const t=ge.getTracks.call(this);if(i===-1){ge.toggle.call(this,!1,e);return}if(!b.number(i)){this.debug.warn("Invalid caption argument",i);return}if(!(i in t)){this.debug.warn("Track not found",i);return}if(this.captions.currentTrack!==i){this.captions.currentTrack=i;const s=t[i],{language:r}=s||{};this.captions.currentTrackNode=s,I.updateSetting.call(this,"captions"),e||(this.captions.language=r,this.storage.set({language:r})),this.isVimeo&&this.embed.enableTextTrack(r),J.call(this,this.media,"languagechange")}ge.toggle.call(this,!0,e),this.isHTML5&&this.isVideo&&ge.updateCues.call(this)},setLanguage(i,e=!0){if(!b.string(i)){this.debug.warn("Invalid language argument",i);return}const t=i.toLowerCase();this.captions.language=t;const s=ge.getTracks.call(this),r=ge.findTrack.call(this,[t]);ge.set.call(this,s.indexOf(r),e)},getTracks(i=!1){return Array.from((this.media||{}).textTracks||[]).filter(t=>!this.isHTML5||i||this.captions.meta.has(t)).filter(t=>["captions","subtitles"].includes(t.kind))},findTrack(i,e=!1){const t=ge.getTracks.call(this),s=o=>Number((this.captions.meta.get(o)||{}).default),r=Array.from(t).sort((o,a)=>s(a)-s(o));let n;return i.every(o=>(n=r.find(a=>a.language===o),!n)),n||(e?r[0]:void 0)},getCurrentTrack(){return ge.getTracks.call(this)[this.currentTrack]},getLabel(i){let e=i;return!b.track(e)&&Ne.textTracks&&this.captions.toggled&&(e=ge.getCurrentTrack.call(this)),b.track(e)?b.empty(e.label)?b.empty(e.language)?Ue.get("enabled",this.config):i.language.toUpperCase():e.label:Ue.get("disabled",this.config)},updateCues(i){if(!this.supported.ui)return;if(!b.element(this.elements.captions)){this.debug.warn("No captions element to render to");return}if(!b.nullOrUndefined(i)&&!Array.isArray(i)){this.debug.warn("updateCues: Invalid input",i);return}let e=i;if(!e){const r=ge.getCurrentTrack.call(this);e=Array.from((r||{}).activeCues||[]).map(n=>n.getCueAsHTML()).map(n0)}const t=e.map(r=>r.trim()).join(`
`);if(t!==this.elements.captions.innerHTML){kr(this.elements.captions);const r=K("span",Et(this.config.selectors.caption));r.innerHTML=t,this.elements.captions.appendChild(r),J.call(this,this.media,"cuechange")}}},au={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.8.3/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",marker:"plyr__progress__marker",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id",hash:"data-plyr-embed-hash"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:"",withCredentials:!1},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1},mediaMetadata:{title:"",artist:"",album:"",artwork:[]},markers:{enabled:!1,points:[]}},Mn={active:"picture-in-picture",inactive:"inline"},os={html5:"html5",youtube:"youtube",vimeo:"vimeo"},Dn={audio:"audio",video:"video"};function l0(i){return/^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(i)?os.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(i)?os.vimeo:null}function Pn(){}class c0{constructor(e=!1){this.enabled=window.console&&e,this.enabled&&this.log("Debugging enabled")}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):Pn}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):Pn}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):Pn}}class _t{constructor(e){z(this,"onChange",()=>{if(!this.supported)return;const e=this.player.elements.buttons.fullscreen;b.element(e)&&(e.pressed=this.active);const t=this.target===this.player.media?this.target:this.player.elements.container;J.call(this.player,t,this.active?"enterfullscreen":"exitfullscreen",!0)});z(this,"toggleFallback",(e=!1)=>{var t,s;if(e?this.scrollPosition={x:(t=window.scrollX)!=null?t:0,y:(s=window.scrollY)!=null?s:0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=e?"hidden":"",me(this.target,this.player.config.classNames.fullscreen.fallback,e),Ge.isIos){let r=document.head.querySelector('meta[name="viewport"]');const n="viewport-fit=cover";r||(r=document.createElement("meta"),r.setAttribute("name","viewport"));const o=b.string(r.content)&&r.content.includes(n);e?(this.cleanupViewport=!o,o||(r.content+=`,${n}`)):this.cleanupViewport&&(r.content=r.content.split(",").filter(a=>a.trim()!==n).join(","))}this.onChange()});z(this,"trapFocus",e=>{if(Ge.isIos||Ge.isIPadOS||!this.active||e.key!=="Tab")return;const t=document.activeElement,s=Di.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),[r]=s,n=s[s.length-1];t===n&&!e.shiftKey?(r.focus(),e.preventDefault()):t===r&&e.shiftKey&&(n.focus(),e.preventDefault())});z(this,"update",()=>{if(this.supported){let e;this.forceFallback?e="Fallback (forced)":_t.nativeSupported?e="Native":e="Fallback",this.player.debug.log(`${e} fullscreen enabled`)}else this.player.debug.log("Fullscreen not supported and fallback disabled");me(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.supported)});z(this,"enter",()=>{this.supported&&(Ge.isIos&&this.player.config.fullscreen.iosNative?this.player.isVimeo?this.player.embed.requestFullscreen():this.target.webkitEnterFullscreen():!_t.nativeSupported||this.forceFallback?this.toggleFallback(!0):this.prefix?b.empty(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:"hide"}))});z(this,"exit",()=>{if(this.supported){if(Ge.isIos&&this.player.config.fullscreen.iosNative)this.player.isVimeo?this.player.embed.exitFullscreen():this.target.webkitEnterFullscreen(),Dt(this.player.play());else if(!_t.nativeSupported||this.forceFallback)this.toggleFallback(!1);else if(!this.prefix)(document.cancelFullScreen||document.exitFullscreen).call(document);else if(!b.empty(this.prefix)){const e=this.prefix==="moz"?"Cancel":"Exit";document[`${this.prefix}${e}${this.property}`]()}}});z(this,"toggle",()=>{this.active?this.exit():this.enter()});this.player=e,this.prefix=_t.prefix,this.property=_t.property,this.scrollPosition={x:0,y:0},this.forceFallback=e.config.fullscreen.fallback==="force",this.player.elements.fullscreen=e.config.fullscreen.container&&Hy(this.player.elements.container,e.config.fullscreen.container),he.call(this.player,document,this.prefix==="ms"?"MSFullscreenChange":`${this.prefix}fullscreenchange`,()=>{this.onChange()}),he.call(this.player,this.player.elements.container,"dblclick",t=>{b.element(this.player.elements.controls)&&this.player.elements.controls.contains(t.target)||this.player.listeners.proxy(t,this.toggle,"fullscreen")}),he.call(this,this.player.elements.container,"keydown",t=>this.trapFocus(t)),this.update()}static get nativeSupported(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get useNative(){return _t.nativeSupported&&!this.forceFallback}static get prefix(){if(b.function(document.exitFullscreen))return"";let e="";return["webkit","moz","ms"].some(s=>b.function(document[`${s}ExitFullscreen`])||b.function(document[`${s}CancelFullScreen`])?(e=s,!0):!1),e}static get property(){return this.prefix==="moz"?"FullScreen":"Fullscreen"}get supported(){return[this.player.config.fullscreen.enabled,this.player.isVideo,_t.nativeSupported||this.player.config.fullscreen.fallback,!this.player.isYouTube||_t.nativeSupported||!Ge.isIos||this.player.config.playsinline&&!this.player.config.fullscreen.iosNative].every(Boolean)}get active(){if(!this.supported)return!1;if(!_t.nativeSupported||this.forceFallback)return Vr(this.target,this.player.config.classNames.fullscreen.fallback);const e=this.prefix?this.target.getRootNode()[`${this.prefix}${this.property}Element`]:this.target.getRootNode().fullscreenElement;return e&&e.shadowRoot?e===this.target.getRootNode().host:e===this.target}get target(){var e;return Ge.isIos&&this.player.config.fullscreen.iosNative?this.player.media:(e=this.player.elements.fullscreen)!=null?e:this.player.elements.container}}function Tr(i,e=1){return new Promise((t,s)=>{const r=new Image,n=()=>{delete r.onload,delete r.onerror,(r.naturalWidth>=e?t:s)(r)};Object.assign(r,{onload:n,onerror:n,src:i})})}const ve={addStyleHook(){me(this.elements.container,this.config.selectors.container.replace(".",""),!0),me(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(i=!1){i&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build(){if(this.listeners.media(),!this.supported.ui){this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),ve.toggleNativeControls.call(this,!0);return}b.element(this.elements.controls)||(I.inject.call(this),this.listeners.controls()),ve.toggleNativeControls.call(this),this.isHTML5&&ge.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,I.updateVolume.call(this),I.timeUpdate.call(this),I.durationUpdate.call(this),ve.checkPlaying.call(this),me(this.elements.container,this.config.classNames.pip.supported,Ne.pip&&this.isHTML5&&this.isVideo),me(this.elements.container,this.config.classNames.airplay.supported,Ne.airplay&&this.isHTML5),me(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(()=>{J.call(this,this.media,"ready")},0),ve.setTitle.call(this),this.poster&&ve.setPoster.call(this,this.poster,!1).catch(()=>{}),this.config.duration&&I.durationUpdate.call(this),this.config.mediaMetadata&&I.setMediaMetadata.call(this)},setTitle(){let i=Ue.get("play",this.config);if(b.string(this.config.title)&&!b.empty(this.config.title)&&(i+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach(e=>{e.setAttribute("aria-label",i)}),this.isEmbed){const e=Be.call(this,"iframe");if(!b.element(e))return;const t=b.empty(this.config.title)?"video":this.config.title,s=Ue.get("frameTitle",this.config);e.setAttribute("title",s.replace("{title}",t))}},togglePoster(i){me(this.elements.container,this.config.classNames.posterEnabled,i)},setPoster(i,e=!0){return e&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",i),this.elements.poster.removeAttribute("hidden"),Yy.call(this).then(()=>Tr(i)).catch(t=>{throw i===this.poster&&ve.togglePoster.call(this,!1),t}).then(()=>{if(i!==this.poster)throw new Error("setPoster cancelled by later call to setPoster")}).then(()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${i}')`,backgroundSize:""}),ve.togglePoster.call(this,!0),i)))},checkPlaying(i){me(this.elements.container,this.config.classNames.playing,this.playing),me(this.elements.container,this.config.classNames.paused,this.paused),me(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(e=>{Object.assign(e,{pressed:this.playing}),e.setAttribute("aria-label",Ue.get(this.playing?"pause":"play",this.config))}),!(b.event(i)&&i.type==="timeupdate")&&ve.toggleControls.call(this)},checkLoading(i){this.loading=["stalled","waiting"].includes(i.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(()=>{me(this.elements.container,this.config.classNames.loading,this.loading),ve.toggleControls.call(this)},this.loading?250:0)},toggleControls(i){const{controls:e}=this.elements;if(e&&this.config.hideControls){const t=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(!!(i||this.loading||this.paused||e.pressed||e.hover||t))}},migrateStyles(){Object.values({...this.media.style}).filter(i=>!b.empty(i)&&b.string(i)&&i.startsWith("--plyr")).forEach(i=>{this.elements.container.style.setProperty(i,this.media.style.getPropertyValue(i)),this.media.style.removeProperty(i)}),b.empty(this.media.style)&&this.media.removeAttribute("style")}};class h0{constructor(e){z(this,"firstTouch",()=>{const{player:e}=this,{elements:t}=e;e.touch=!0,me(t.container,e.config.classNames.isTouch,!0)});z(this,"global",(e=!0)=>{const{player:t}=this;t.config.keyboard.global&&Pi.call(t,window,"keydown keyup",this.handleKey,e,!1),Pi.call(t,document.body,"click",this.toggleMenu,e),Zo.call(t,document.body,"touchstart",this.firstTouch)});z(this,"container",()=>{const{player:e}=this,{config:t,elements:s,timers:r}=e;!t.keyboard.global&&t.keyboard.focused&&he.call(e,s.container,"keydown keyup",this.handleKey,!1),he.call(e,s.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",a=>{const{controls:l}=s;l&&a.type==="enterfullscreen"&&(l.pressed=!1,l.hover=!1);const c=["touchstart","touchmove","mousemove"].includes(a.type);let h=0;c&&(ve.toggleControls.call(e,!0),h=e.touch?3e3:2e3),clearTimeout(r.controls),r.controls=setTimeout(()=>ve.toggleControls.call(e,!1),h)});const n=()=>{if(!e.isVimeo||e.config.vimeo.premium)return;const a=s.wrapper,{active:l}=e.fullscreen,[c,h]=Qo.call(e),u=Qh(`aspect-ratio: ${c} / ${h}`);if(!l){u?(a.style.width=null,a.style.height=null):(a.style.maxWidth=null,a.style.margin=null);return}const[d,g]=Gy(),p=d/g>c/h;u?(a.style.width=p?"auto":"100%",a.style.height=p?"100%":"auto"):(a.style.maxWidth=p?`${g/h*c}px`:null,a.style.margin=p?"0 auto":null)},o=()=>{clearTimeout(r.resized),r.resized=setTimeout(n,50)};he.call(e,s.container,"enterfullscreen exitfullscreen",a=>{const{target:l}=e.fullscreen;if(l!==s.container||!e.isEmbed&&b.empty(e.config.ratio))return;n(),(a.type==="enterfullscreen"?he:on).call(e,window,"resize",o)})});z(this,"media",()=>{const{player:e}=this,{elements:t}=e;if(he.call(e,e.media,"timeupdate seeking seeked",r=>I.timeUpdate.call(e,r)),he.call(e,e.media,"durationchange loadeddata loadedmetadata",r=>I.durationUpdate.call(e,r)),he.call(e,e.media,"ended",()=>{e.isHTML5&&e.isVideo&&e.config.resetOnEnd&&(e.restart(),e.pause())}),he.call(e,e.media,"progress playing seeking seeked",r=>I.updateProgress.call(e,r)),he.call(e,e.media,"volumechange",r=>I.updateVolume.call(e,r)),he.call(e,e.media,"playing play pause ended emptied timeupdate",r=>ve.checkPlaying.call(e,r)),he.call(e,e.media,"waiting canplay seeked playing",r=>ve.checkLoading.call(e,r)),e.supported.ui&&e.config.clickToPlay&&!e.isAudio){const r=Be.call(e,`.${e.config.classNames.video}`);if(!b.element(r))return;he.call(e,t.container,"click",n=>{![t.container,r].includes(n.target)&&!r.contains(n.target)||e.touch&&e.config.hideControls||(e.ended?(this.proxy(n,e.restart,"restart"),this.proxy(n,()=>{Dt(e.play())},"play")):this.proxy(n,()=>{Dt(e.togglePlay())},"play"))})}e.supported.ui&&e.config.disableContextMenu&&he.call(e,t.wrapper,"contextmenu",r=>{r.preventDefault()},!1),he.call(e,e.media,"volumechange",()=>{e.storage.set({volume:e.volume,muted:e.muted})}),he.call(e,e.media,"ratechange",()=>{I.updateSetting.call(e,"speed"),e.storage.set({speed:e.speed})}),he.call(e,e.media,"qualitychange",r=>{I.updateSetting.call(e,"quality",null,r.detail.quality)}),he.call(e,e.media,"ready qualitychange",()=>{I.setDownloadUrl.call(e)});const s=e.config.events.concat(["keyup","keydown"]).join(" ");he.call(e,e.media,s,r=>{let{detail:n={}}=r;r.type==="error"&&(n=e.media.error),J.call(e,t.container,r.type,!0,n)})});z(this,"proxy",(e,t,s)=>{const{player:r}=this,n=r.config.listeners[s],o=b.function(n);let a=!0;o&&(a=n.call(r,e)),a!==!1&&b.function(t)&&t.call(r,e)});z(this,"bind",(e,t,s,r,n=!0)=>{const{player:o}=this,a=o.config.listeners[r],l=b.function(a);he.call(o,e,t,c=>this.proxy(c,s,r),n&&!l)});z(this,"controls",()=>{const{player:e}=this,{elements:t}=e,s=Ge.isIE?"change":"input";if(t.buttons.play&&Array.from(t.buttons.play).forEach(r=>{this.bind(r,"click",()=>{Dt(e.togglePlay())},"play")}),this.bind(t.buttons.restart,"click",e.restart,"restart"),this.bind(t.buttons.rewind,"click",()=>{e.lastSeekTime=Date.now(),e.rewind()},"rewind"),this.bind(t.buttons.fastForward,"click",()=>{e.lastSeekTime=Date.now(),e.forward()},"fastForward"),this.bind(t.buttons.mute,"click",()=>{e.muted=!e.muted},"mute"),this.bind(t.buttons.captions,"click",()=>e.toggleCaptions()),this.bind(t.buttons.download,"click",()=>{J.call(e,e.media,"download")},"download"),this.bind(t.buttons.fullscreen,"click",()=>{e.fullscreen.toggle()},"fullscreen"),this.bind(t.buttons.pip,"click",()=>{e.pip="toggle"},"pip"),this.bind(t.buttons.airplay,"click",e.airplay,"airplay"),this.bind(t.buttons.settings,"click",r=>{r.stopPropagation(),r.preventDefault(),I.toggleMenu.call(e,r)},null,!1),this.bind(t.buttons.settings,"keyup",r=>{if([" ","Enter"].includes(r.key)){if(r.key==="Enter"){I.focusFirstMenuItem.call(e,null,!0);return}r.preventDefault(),r.stopPropagation(),I.toggleMenu.call(e,r)}},null,!1),this.bind(t.settings.menu,"keydown",r=>{r.key==="Escape"&&I.toggleMenu.call(e,r)}),this.bind(t.inputs.seek,"mousedown mousemove",r=>{const n=t.progress.getBoundingClientRect(),o=r.pageX-r.clientX,a=100/n.width*(r.pageX-n.left-o);r.currentTarget.setAttribute("seek-value",a)}),this.bind(t.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",r=>{const n=r.currentTarget,o="play-on-seeked";if(b.keyboardEvent(r)&&!["ArrowLeft","ArrowRight"].includes(r.key))return;e.lastSeekTime=Date.now();const a=n.hasAttribute(o),l=["mouseup","touchend","keyup"].includes(r.type);a&&l?(n.removeAttribute(o),Dt(e.play())):!l&&e.playing&&(n.setAttribute(o,""),e.pause())}),Ge.isIos){const r=Di.call(e,'input[type="range"]');Array.from(r).forEach(n=>this.bind(n,s,o=>qh(o.target)))}this.bind(t.inputs.seek,s,r=>{const n=r.currentTarget;let o=n.getAttribute("seek-value");b.empty(o)&&(o=n.value),n.removeAttribute("seek-value"),e.currentTime=o/n.max*e.duration},"seek"),this.bind(t.progress,"mouseenter mouseleave mousemove",r=>I.updateSeekTooltip.call(e,r)),this.bind(t.progress,"mousemove touchmove",r=>{const{previewThumbnails:n}=e;n&&n.loaded&&n.startMove(r)}),this.bind(t.progress,"mouseleave touchend click",()=>{const{previewThumbnails:r}=e;r&&r.loaded&&r.endMove(!1,!0)}),this.bind(t.progress,"mousedown touchstart",r=>{const{previewThumbnails:n}=e;n&&n.loaded&&n.startScrubbing(r)}),this.bind(t.progress,"mouseup touchend",r=>{const{previewThumbnails:n}=e;n&&n.loaded&&n.endScrubbing(r)}),Ge.isWebKit&&Array.from(Di.call(e,'input[type="range"]')).forEach(r=>{this.bind(r,"input",n=>I.updateRangeFill.call(e,n.target))}),e.config.toggleInvert&&!b.element(t.display.duration)&&this.bind(t.display.currentTime,"click",()=>{e.currentTime!==0&&(e.config.invertTime=!e.config.invertTime,I.timeUpdate.call(e))}),this.bind(t.inputs.volume,s,r=>{e.volume=r.target.value},"volume"),this.bind(t.controls,"mouseenter mouseleave",r=>{t.controls.hover=!e.touch&&r.type==="mouseenter"}),t.fullscreen&&Array.from(t.fullscreen.children).filter(r=>!r.contains(t.container)).forEach(r=>{this.bind(r,"mouseenter mouseleave",n=>{t.controls&&(t.controls.hover=!e.touch&&n.type==="mouseenter")})}),this.bind(t.controls,"mousedown mouseup touchstart touchend touchcancel",r=>{t.controls.pressed=["mousedown","touchstart"].includes(r.type)}),this.bind(t.controls,"focusin",()=>{const{config:r,timers:n}=e;me(t.controls,r.classNames.noTransition,!0),ve.toggleControls.call(e,!0),setTimeout(()=>{me(t.controls,r.classNames.noTransition,!1)},0);const o=this.touch?3e3:4e3;clearTimeout(n.controls),n.controls=setTimeout(()=>ve.toggleControls.call(e,!1),o)}),this.bind(t.inputs.volume,"wheel",r=>{const n=r.webkitDirectionInvertedFromDevice,[o,a]=[r.deltaX,-r.deltaY].map(h=>n?-h:h),l=Math.sign(Math.abs(o)>Math.abs(a)?o:a);e.increaseVolume(l/50);const{volume:c}=e.media;(l===1&&c<1||l===-1&&c>0)&&r.preventDefault()},"volume",!1)});this.player=e,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(e){const{player:t}=this,{elements:s}=t,{key:r,type:n,altKey:o,ctrlKey:a,metaKey:l,shiftKey:c}=e,h=n==="keydown",u=h&&r===this.lastKey;if(o||a||l||c||!r)return;const d=g=>{t.currentTime=t.duration/10*g};if(h){const g=document.activeElement;if(b.element(g)){const{editable:y}=t.config.selectors,{seek:v}=s.inputs;if(g!==v&&Cs(g,y)||e.key===" "&&Cs(g,'button, [role^="menuitem"]'))return}switch([" ","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","0","1","2","3","4","5","6","7","8","9","c","f","k","l","m"].includes(r)&&(e.preventDefault(),e.stopPropagation()),r){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":u||d(Number.parseInt(r,10));break;case" ":case"k":u||Dt(t.togglePlay());break;case"ArrowUp":t.increaseVolume(.1);break;case"ArrowDown":t.decreaseVolume(.1);break;case"m":u||(t.muted=!t.muted);break;case"ArrowRight":t.forward();break;case"ArrowLeft":t.rewind();break;case"f":t.fullscreen.toggle();break;case"c":u||t.toggleCaptions();break;case"l":t.loop=!t.loop;break}r==="Escape"&&!t.fullscreen.usingNative&&t.fullscreen.active&&t.fullscreen.toggle(),this.lastKey=r}else this.lastKey=null}toggleMenu(e){I.toggleMenu.call(this.player,e)}}var u0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function d0(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var lu={exports:{}};(function(i,e){(function(t,s){i.exports=s()})(u0,function(){var t=function(){},s={},r={},n={};function o(d,g){d=d.push?d:[d];var p=[],y=d.length,v=y,_,f,S,C;for(_=function(k,T){T.length&&p.push(k),v--,v||g(p)};y--;){if(f=d[y],S=r[f],S){_(f,S);continue}C=n[f]=n[f]||[],C.push(_)}}function a(d,g){if(d){var p=n[d];if(r[d]=g,!!p)for(;p.length;)p[0](d,g),p.splice(0,1)}}function l(d,g){d.call&&(d={success:d}),g.length?(d.error||t)(g):(d.success||t)(d)}function c(d,g,p,y){var v=document,_=p.async,f=(p.numRetries||0)+1,S=p.before||t,C=d.replace(/[\?|#].*$/,""),k=d.replace(/^(css|img|module|nomodule)!/,""),T,F,M;if(y=y||0,/(^css!|\.css$)/.test(C))M=v.createElement("link"),M.rel="stylesheet",M.href=k,T="hideFocus"in M,T&&M.relList&&(T=0,M.rel="preload",M.as="style");else if(/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(C))M=v.createElement("img"),M.src=k;else if(M=v.createElement("script"),M.src=k,M.async=_===void 0?!0:_,F="noModule"in M,/^module!/.test(C)){if(!F)return g(d,"l");M.type="module"}else if(/^nomodule!/.test(C)&&F)return g(d,"l");M.onload=M.onerror=M.onbeforeload=function(A){var B=A.type[0];if(T)try{M.sheet.cssText.length||(B="e")}catch(E){E.code!=18&&(B="e")}if(B=="e"){if(y+=1,y<f)return c(d,g,p,y)}else if(M.rel=="preload"&&M.as=="style")return M.rel="stylesheet";g(d,B,A.defaultPrevented)},S(d,M)!==!1&&v.head.appendChild(M)}function h(d,g,p){d=d.push?d:[d];var y=d.length,v=y,_=[],f,S;for(f=function(C,k,T){if(k=="e"&&_.push(C),k=="b")if(T)_.push(C);else return;y--,y||g(_)},S=0;S<v;S++)c(d[S],f,p)}function u(d,g,p){var y,v;if(g&&g.trim&&(y=g),v=(y?p:g)||{},y){if(y in s)throw"LoadJS";s[y]=!0}function _(f,S){h(d,function(C){l(v,C),f&&l({success:f,error:S},C),a(y,C)},v)}if(v.returnPromise)return new Promise(_);_()}return u.ready=function(g,p){return o(g,function(y){l(p,y)}),u},u.done=function(g){a(g,[])},u.reset=function(){s={},r={},n={}},u.isDefined=function(g){return g in s},u})})(lu);var g0=lu.exports;const f0=d0(g0);function ea(i){return new Promise((e,t)=>{f0(i,{success:e,error:t})})}function p0(i){if(b.empty(i))return null;if(b.number(Number(i)))return i;const e=/^.*(vimeo.com\/|video\/)(\d+).*/,t=i.match(e);return t?t[2]:i}function m0(i){const e=/^.*(vimeo.com\/|video\/)(\d+)(\?.*h=|\/)+([\d,a-f]+)/,t=i.match(e);return t&&t.length===5?t[4]:null}function hi(i){i&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===i&&(this.media.paused=!i,J.call(this,this.media,i?"play":"pause"))}const ro={setup(){const i=this;me(i.elements.wrapper,i.config.classNames.embed,!0),i.options.speed=i.config.speed.options,Gs.call(i),b.object(window.Vimeo)?ro.ready.call(i):ea(i.config.urls.vimeo.sdk).then(()=>{ro.ready.call(i)}).catch(e=>{i.debug.warn("Vimeo SDK (player.js) failed to load",e)})},ready(){const i=this,e=i.config.vimeo,{premium:t,referrerPolicy:s,...r}=e;let n=i.media.getAttribute("src"),o="";b.empty(n)?(n=i.media.getAttribute(i.config.attributes.embed.id),o=i.media.getAttribute(i.config.attributes.embed.hash)):o=m0(n);const a=o?{h:o}:{};t&&Object.assign(r,{controls:!1,sidedock:!1});const l=ou({loop:i.config.loop.active,autoplay:i.autoplay,muted:i.muted,gesture:"media",playsinline:i.config.playsinline,...a,...r}),c=p0(n),h=K("iframe"),u=io(i.config.urls.vimeo.iframe,c,l);if(h.setAttribute("src",u),h.setAttribute("allowfullscreen",""),h.setAttribute("allow",["autoplay","fullscreen","picture-in-picture","encrypted-media","accelerometer","gyroscope"].join("; ")),b.empty(s)||h.setAttribute("referrerPolicy",s),t||!e.customControls)h.setAttribute("data-poster",i.poster),i.media=$r(h,i.media);else{const f=K("div",{class:i.config.classNames.embedContainer,"data-poster":i.poster});f.appendChild(h),i.media=$r(f,i.media)}e.customControls||Wi(io(i.config.urls.vimeo.api,u)).then(f=>{b.empty(f)||!f.thumbnail_url||ve.setPoster.call(i,f.thumbnail_url).catch(()=>{})}),i.embed=new window.Vimeo.Player(h,{autopause:i.config.autopause,muted:i.muted}),i.media.paused=!0,i.media.currentTime=0,i.supported.ui&&i.embed.disableTextTrack(),i.media.play=()=>(hi.call(i,!0),i.embed.play()),i.media.pause=()=>(hi.call(i,!1),i.embed.pause()),i.media.stop=()=>{i.pause(),i.currentTime=0};let{currentTime:d}=i.media;Object.defineProperty(i.media,"currentTime",{get(){return d},set(f){const{embed:S,media:C,paused:k,volume:T}=i,F=k&&!S.hasPlayed;C.seeking=!0,J.call(i,C,"seeking"),Promise.resolve(F&&S.setVolume(0)).then(()=>S.setCurrentTime(f)).then(()=>F&&S.pause()).then(()=>F&&S.setVolume(T)).catch(()=>{})}});let g=i.config.speed.selected;Object.defineProperty(i.media,"playbackRate",{get(){return g},set(f){i.embed.setPlaybackRate(f).then(()=>{g=f,J.call(i,i.media,"ratechange")}).catch(()=>{i.options.speed=[1]})}});let{volume:p}=i.config;Object.defineProperty(i.media,"volume",{get(){return p},set(f){i.embed.setVolume(f).then(()=>{p=f,J.call(i,i.media,"volumechange")})}});let{muted:y}=i.config;Object.defineProperty(i.media,"muted",{get(){return y},set(f){const S=b.boolean(f)?f:!1;i.embed.setMuted(S?!0:i.config.muted).then(()=>{y=S,J.call(i,i.media,"volumechange")})}});let{loop:v}=i.config;Object.defineProperty(i.media,"loop",{get(){return v},set(f){const S=b.boolean(f)?f:i.config.loop.active;i.embed.setLoop(S).then(()=>{v=S})}});let _;i.embed.getVideoUrl().then(f=>{_=f,I.setDownloadUrl.call(i)}).catch(f=>{this.debug.warn(f)}),Object.defineProperty(i.media,"currentSrc",{get(){return _}}),Object.defineProperty(i.media,"ended",{get(){return i.currentTime===i.duration}}),Promise.all([i.embed.getVideoWidth(),i.embed.getVideoHeight()]).then(f=>{const[S,C]=f;i.embed.ratio=tu(S,C),Gs.call(this)}),i.embed.setAutopause(i.config.autopause).then(f=>{i.config.autopause=f}),i.embed.getVideoTitle().then(f=>{i.config.title=f,ve.setTitle.call(this)}),i.embed.getCurrentTime().then(f=>{d=f,J.call(i,i.media,"timeupdate")}),i.embed.getDuration().then(f=>{i.media.duration=f,J.call(i,i.media,"durationchange")}),i.embed.getTextTracks().then(f=>{i.media.textTracks=f,ge.setup.call(i)}),i.embed.on("cuechange",({cues:f=[]})=>{const S=f.map(C=>r0(C.text));ge.updateCues.call(i,S)}),i.embed.on("loaded",()=>{i.embed.getPaused().then(f=>{hi.call(i,!f),f||J.call(i,i.media,"playing")}),b.element(i.embed.element)&&i.supported.ui&&i.embed.element.setAttribute("tabindex",-1)}),i.embed.on("bufferstart",()=>{J.call(i,i.media,"waiting")}),i.embed.on("bufferend",()=>{J.call(i,i.media,"playing")}),i.embed.on("play",()=>{hi.call(i,!0),J.call(i,i.media,"playing")}),i.embed.on("pause",()=>{hi.call(i,!1)}),i.embed.on("timeupdate",f=>{i.media.seeking=!1,d=f.seconds,J.call(i,i.media,"timeupdate")}),i.embed.on("progress",f=>{i.media.buffered=f.percent,J.call(i,i.media,"progress"),Number.parseInt(f.percent,10)===1&&J.call(i,i.media,"canplaythrough"),i.embed.getDuration().then(S=>{S!==i.media.duration&&(i.media.duration=S,J.call(i,i.media,"durationchange"))})}),i.embed.on("seeked",()=>{i.media.seeking=!1,J.call(i,i.media,"seeked")}),i.embed.on("ended",()=>{i.media.paused=!0,J.call(i,i.media,"ended")}),i.embed.on("error",f=>{i.media.error=f,J.call(i,i.media,"error")}),e.customControls&&setTimeout(()=>ve.build.call(i),0)}};function y0(i){if(b.empty(i))return null;const e=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,t=i.match(e);return t&&t[2]?t[2]:i}function ui(i){i&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===i&&(this.media.paused=!i,J.call(this,this.media,i?"play":"pause"))}function b0(i){if(i.noCookie)return"https://www.youtube-nocookie.com";if(window.location.protocol==="http:")return"http://www.youtube.com"}const Or={setup(){if(me(this.elements.wrapper,this.config.classNames.embed,!0),b.object(window.YT)&&b.function(window.YT.Player))Or.ready.call(this);else{const i=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{b.function(i)&&i(),Or.ready.call(this)},ea(this.config.urls.youtube.sdk).catch(e=>{this.debug.warn("YouTube API failed to load",e)})}},getTitle(i){const e=io(this.config.urls.youtube.api,i);Wi(e).then(t=>{if(b.object(t)){const{title:s,height:r,width:n}=t;this.config.title=s,ve.setTitle.call(this),this.embed.ratio=tu(n,r)}Gs.call(this)}).catch(()=>{Gs.call(this)})},ready(){const i=this,e=i.config.youtube,t=i.media&&i.media.getAttribute("id");if(!b.empty(t)&&t.startsWith("youtube-"))return;let s=i.media.getAttribute("src");b.empty(s)&&(s=i.media.getAttribute(this.config.attributes.embed.id));const r=y0(s),n=e0(i.provider),o=K("div",{id:n,"data-poster":e.customControls?i.poster:void 0});if(i.media=$r(o,i.media),e.customControls){const a=l=>`https://i.ytimg.com/vi/${r}/${l}default.jpg`;Tr(a("maxres"),121).catch(()=>Tr(a("sd"),121)).catch(()=>Tr(a("hq"))).then(l=>ve.setPoster.call(i,l.src)).then(l=>{l.includes("maxres")||(i.elements.poster.style.backgroundSize="cover")}).catch(()=>{})}i.embed=new window.YT.Player(i.media,{videoId:r,host:b0(e),playerVars:Ae({},{autoplay:i.config.autoplay?1:0,hl:i.config.hl,controls:i.supported.ui&&e.customControls?0:1,disablekb:1,playsinline:i.config.playsinline&&!i.config.fullscreen.iosNative?1:0,cc_load_policy:i.captions.active?1:0,cc_lang_pref:i.config.captions.language,widget_referrer:window?window.location.href:null},e),events:{onError(a){if(!i.media.error){const l=a.data,c={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[l]||"An unknown error occurred";i.media.error={code:l,message:c},J.call(i,i.media,"error")}},onPlaybackRateChange(a){const l=a.target;i.media.playbackRate=l.getPlaybackRate(),J.call(i,i.media,"ratechange")},onReady(a){if(b.function(i.media.play))return;const l=a.target;Or.getTitle.call(i,r),i.media.play=()=>{ui.call(i,!0),l.playVideo()},i.media.pause=()=>{ui.call(i,!1),l.pauseVideo()},i.media.stop=()=>{l.stopVideo()},i.media.duration=l.getDuration(),i.media.paused=!0,i.media.currentTime=0,Object.defineProperty(i.media,"currentTime",{get(){return Number(l.getCurrentTime())},set(d){i.paused&&!i.embed.hasPlayed&&i.embed.mute(),i.media.seeking=!0,J.call(i,i.media,"seeking"),l.seekTo(d)}}),Object.defineProperty(i.media,"playbackRate",{get(){return l.getPlaybackRate()},set(d){l.setPlaybackRate(d)}});let{volume:c}=i.config;Object.defineProperty(i.media,"volume",{get(){return c},set(d){c=d,l.setVolume(c*100),J.call(i,i.media,"volumechange")}});let{muted:h}=i.config;Object.defineProperty(i.media,"muted",{get(){return h},set(d){const g=b.boolean(d)?d:h;h=g,l[g?"mute":"unMute"](),l.setVolume(c*100),J.call(i,i.media,"volumechange")}}),Object.defineProperty(i.media,"currentSrc",{get(){return l.getVideoUrl()}}),Object.defineProperty(i.media,"ended",{get(){return i.currentTime===i.duration}});const u=l.getAvailablePlaybackRates();i.options.speed=u.filter(d=>i.config.speed.options.includes(d)),i.supported.ui&&e.customControls&&i.media.setAttribute("tabindex",-1),J.call(i,i.media,"timeupdate"),J.call(i,i.media,"durationchange"),clearInterval(i.timers.buffering),i.timers.buffering=setInterval(()=>{i.media.buffered=l.getVideoLoadedFraction(),(i.media.lastBuffered===null||i.media.lastBuffered<i.media.buffered)&&J.call(i,i.media,"progress"),i.media.lastBuffered=i.media.buffered,i.media.buffered===1&&(clearInterval(i.timers.buffering),J.call(i,i.media,"canplaythrough"))},200),e.customControls&&setTimeout(()=>ve.build.call(i),50)},onStateChange(a){const l=a.target;switch(clearInterval(i.timers.playing),i.media.seeking&&[1,2].includes(a.data)&&(i.media.seeking=!1,J.call(i,i.media,"seeked")),a.data){case-1:J.call(i,i.media,"timeupdate"),i.media.buffered=l.getVideoLoadedFraction(),J.call(i,i.media,"progress");break;case 0:ui.call(i,!1),i.media.loop?(l.stopVideo(),l.playVideo()):J.call(i,i.media,"ended");break;case 1:e.customControls&&!i.config.autoplay&&i.media.paused&&!i.embed.hasPlayed?i.media.pause():(ui.call(i,!0),J.call(i,i.media,"playing"),i.timers.playing=setInterval(()=>{J.call(i,i.media,"timeupdate")},50),i.media.duration!==l.getDuration()&&(i.media.duration=l.getDuration(),J.call(i,i.media,"durationchange")));break;case 2:i.muted||i.embed.unMute(),ui.call(i,!1);break;case 3:J.call(i,i.media,"waiting");break}J.call(i,i.elements.container,"statechange",!1,{code:a.data})}}})}},cu={setup(){if(!this.media){this.debug.warn("No media element found!");return}me(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),me(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&me(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=K("div",{class:this.config.classNames.video}),Jh(this.media,this.elements.wrapper),this.elements.poster=K("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?as.setup.call(this):this.isYouTube?Or.setup.call(this):this.isVimeo&&ro.setup.call(this)}};function v0(i){i.manager&&i.manager.destroy(),i.elements.displayContainer&&i.elements.displayContainer.destroy(),i.elements.container.remove()}class _0{constructor(e){z(this,"load",()=>{this.enabled&&(!b.object(window.google)||!b.object(window.google.ima)?ea(this.player.config.urls.googleIMA.sdk).then(()=>{this.ready()}).catch(()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))}):this.ready())});z(this,"ready",()=>{this.enabled||v0(this),this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then(()=>{this.clearSafetyTimer("onAdsManagerLoaded()")}),this.listeners(),this.setupIMA()});z(this,"setupIMA",()=>{this.elements.container=K("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,e=>this.onAdsManagerLoaded(e),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,e=>this.onAdError(e),!1),this.requestAds()});z(this,"requestAds",()=>{const{container:e}=this.player.elements;try{const t=new google.ima.AdsRequest;t.adTagUrl=this.tagUrl,t.linearAdSlotWidth=e.offsetWidth,t.linearAdSlotHeight=e.offsetHeight,t.nonLinearAdSlotWidth=e.offsetWidth,t.nonLinearAdSlotHeight=e.offsetHeight,t.forceNonLinearFullSlot=!1,t.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(t)}catch(t){this.onAdError(t)}});z(this,"pollCountdown",(e=!1)=>{if(!e){clearInterval(this.countdownTimer),this.elements.container.removeAttribute("data-badge-text");return}const t=()=>{const s=an(Math.max(this.manager.getRemainingTime(),0)),r=`${Ue.get("advertisement",this.player.config)} - ${s}`;this.elements.container.setAttribute("data-badge-text",r)};this.countdownTimer=setInterval(t,100)});z(this,"onAdsManagerLoaded",e=>{if(!this.enabled)return;const t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.enablePreloading=!0,this.manager=e.getAdsManager(this.player,t),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,s=>this.onAdError(s)),Object.keys(google.ima.AdEvent.Type).forEach(s=>{this.manager.addEventListener(google.ima.AdEvent.Type[s],r=>this.onAdEvent(r))}),this.trigger("loaded")});z(this,"addCuePoints",()=>{b.empty(this.cuePoints)||this.cuePoints.forEach(e=>{if(e!==0&&e!==-1&&e<this.player.duration){const t=this.player.elements.progress;if(b.element(t)){const s=100/this.player.duration*e,r=K("span",{class:this.player.config.classNames.cues});r.style.left=`${s.toString()}%`,t.appendChild(r)}}})});z(this,"onAdEvent",e=>{const{container:t}=this.player.elements,s=e.getAd(),r=e.getAdData();switch((o=>{J.call(this.player,this.player.media,`ads${o.replace(/_/g,"").toLowerCase()}`)})(e.type),e.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),this.pollCountdown(!0),s.isLinear()||(s.width=t.offsetWidth,s.height=t.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:r.adError&&this.player.debug.warn(`Non-fatal ad error: ${r.adError.getMessage()}`);break}});z(this,"onAdError",e=>{this.cancel(),this.player.debug.warn("Ads error",e)});z(this,"listeners",()=>{const{container:e}=this.player.elements;let t;this.player.on("canplay",()=>{this.addCuePoints()}),this.player.on("ended",()=>{this.loader.contentComplete()}),this.player.on("timeupdate",()=>{t=this.player.currentTime}),this.player.on("seeked",()=>{const s=this.player.currentTime;b.empty(this.cuePoints)||this.cuePoints.forEach((r,n)=>{t<r&&r<s&&(this.manager.discardAdBreak(),this.cuePoints.splice(n,1))})}),window.addEventListener("resize",()=>{this.manager&&this.manager.resize(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL)})});z(this,"play",()=>{const{container:e}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then(()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(t){this.onAdError(t)}}).catch(()=>{})});z(this,"resumeContent",()=>{this.elements.container.style.zIndex="",this.playing=!1,Dt(this.player.media.play())});z(this,"pauseContent",()=>{this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()});z(this,"cancel",()=>{this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()});z(this,"loadAds",()=>{this.managerPromise.then(()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise(e=>{this.on("loaded",e),this.player.debug.log(this.manager)}),this.initialized=!1,this.requestAds()}).catch(()=>{})});z(this,"trigger",(e,...t)=>{const s=this.events[e];b.array(s)&&s.forEach(r=>{b.function(r)&&r.apply(this,t)})});z(this,"on",(e,t)=>(b.array(this.events[e])||(this.events[e]=[]),this.events[e].push(t),this));z(this,"startSafetyTimer",(e,t)=>{this.player.debug.log(`Safety timer invoked from: ${t}`),this.safetyTimer=setTimeout(()=>{this.cancel(),this.clearSafetyTimer("startSafetyTimer()")},e)});z(this,"clearSafetyTimer",e=>{b.nullOrUndefined(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${e}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)});this.player=e,this.config=e.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise((t,s)=>{this.on("loaded",t),this.on("error",s)}),this.load()}get enabled(){const{config:e}=this;return this.player.isHTML5&&this.player.isVideo&&e.enabled&&(!b.empty(e.publisherId)||b.url(e.tagUrl))}get tagUrl(){const{config:e}=this;if(b.url(e.tagUrl))return e.tagUrl;const t={AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:e.publisherId};return`https://go.aniview.com/api/adserver6/vast/?${ou(t)}`}}function hu(i=0,e=0,t=255){return Math.min(Math.max(i,e),t)}function w0(i){const e=[];return i.split(/\r\n\r\n|\n\n|\r\r/).forEach(s=>{const r={};s.split(/\r\n|\n|\r/).forEach(o=>{if(b.number(r.startTime)){if(!b.empty(o.trim())&&b.empty(r.text)){const a=o.trim().split("#xywh=");[r.text]=a,a[1]&&([r.x,r.y,r.w,r.h]=a[1].split(","))}}else{const a=o.match(/(\d{2})?:?(\d{2}):(\d{2}).(\d{2,3})( ?--> ?)(\d{2})?:?(\d{2}):(\d{2}).(\d{2,3})/);a&&(r.startTime=Number(a[1]||0)*60*60+Number(a[2])*60+Number(a[3])+ +`0.${a[4]}`,r.endTime=Number(a[6]||0)*60*60+Number(a[7])*60+Number(a[8])+ +`0.${a[9]}`)}}),r.text&&e.push(r)}),e}function Al(i,e){const t=e.width/e.height,s={};return i>t?(s.width=e.width,s.height=1/i*e.width):(s.height=e.height,s.width=i*e.height),s}class no{constructor(e){z(this,"load",()=>{this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then(()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.listeners(),this.loaded=!0)})});z(this,"getThumbnails",()=>new Promise(e=>{const{src:t}=this.player.config.previewThumbnails;if(b.empty(t))throw new Error("Missing previewThumbnails.src config attribute");const s=()=>{this.thumbnails.sort((r,n)=>r.height-n.height),this.player.debug.log("Preview thumbnails",this.thumbnails),e()};if(b.function(t))t(r=>{this.thumbnails=r,s()});else{const n=(b.string(t)?[t]:t).map(o=>this.getThumbnail(o));Promise.all(n).then(s)}}));z(this,"getThumbnail",e=>new Promise(t=>{Wi(e,void 0,this.player.config.previewThumbnails.withCredentials).then(s=>{const r={frames:w0(s),height:null,urlPrefix:""};!r.frames[0].text.startsWith("/")&&!r.frames[0].text.startsWith("http://")&&!r.frames[0].text.startsWith("https://")&&(r.urlPrefix=e.substring(0,e.lastIndexOf("/")+1));const n=new Image;n.onload=()=>{r.height=n.naturalHeight,r.width=n.naturalWidth,this.thumbnails.push(r),t()},n.src=r.urlPrefix+r.frames[0].text})}));z(this,"startMove",e=>{var t,s;if(this.loaded&&!(!b.event(e)||!["touchmove","mousemove"].includes(e.type))&&this.player.media.duration){if(e.type==="touchmove")this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{const r=this.player.elements.progress.getBoundingClientRect(),n=100/r.width*(e.pageX-r.left);this.seekTime=this.player.media.duration*(n/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=e.pageX,this.elements.thumb.time.textContent=an(this.seekTime);const o=(s=(t=this.player.config.markers)==null?void 0:t.points)==null?void 0:s.find(({time:a})=>a===Math.round(this.seekTime));o&&this.elements.thumb.time.insertAdjacentHTML("afterbegin",`${o.label}<br>`)}this.showImageAtCurrentTime()}});z(this,"endMove",()=>{this.toggleThumbContainer(!1,!0)});z(this,"startScrubbing",e=>{(b.nullOrUndefined(e.button)||e.button===!1||e.button===0)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))});z(this,"endScrubbing",()=>{this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):Zo.call(this.player,this.player.media,"timeupdate",()=>{this.mouseDown||this.toggleScrubbingContainer(!1)})});z(this,"listeners",()=>{this.player.on("play",()=>{this.toggleThumbContainer(!1,!0)}),this.player.on("seeked",()=>{this.toggleThumbContainer(!1)}),this.player.on("timeupdate",()=>{this.lastTime=this.player.media.currentTime})});z(this,"render",()=>{this.elements.thumb.container=K("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=K("div",{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const e=K("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=K("span",{},"00:00"),e.appendChild(this.elements.thumb.time),this.elements.thumb.imageContainer.appendChild(e),b.element(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=K("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)});z(this,"destroy",()=>{this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()});z(this,"showImageAtCurrentTime",()=>{this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();const e=this.thumbnails[0].frames.findIndex(r=>this.seekTime>=r.startTime&&this.seekTime<=r.endTime),t=e>=0;let s=0;this.mouseDown||this.toggleThumbContainer(t),t&&(this.thumbnails.forEach((r,n)=>{this.loadedImages.includes(r.frames[e].text)&&(s=n)}),e!==this.showingThumb&&(this.showingThumb=e,this.loadImage(s)))});z(this,"loadImage",(e=0)=>{const t=this.showingThumb,s=this.thumbnails[e],{urlPrefix:r}=s,n=s.frames[t],o=s.frames[t].text,a=r+o;if(!this.currentImageElement||this.currentImageElement.dataset.filename!==o){this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);const l=new Image;l.src=a,l.dataset.index=t,l.dataset.filename=o,this.showingThumbFilename=o,this.player.debug.log(`Loading image: ${a}`),l.onload=()=>this.showImage(l,n,e,t,o,!0),this.loadingImage=l,this.removeOldImages(l)}else this.showImage(this.currentImageElement,n,e,t,o,!1),this.currentImageElement.dataset.index=t,this.removeOldImages(this.currentImageElement)});z(this,"showImage",(e,t,s,r,n,o=!0)=>{this.player.debug.log(`Showing thumb: ${n}. num: ${r}. qual: ${s}. newimg: ${o}`),this.setImageSizeAndOffset(e,t),o&&(this.currentImageContainer.appendChild(e),this.currentImageElement=e,this.loadedImages.includes(n)||this.loadedImages.push(n)),this.preloadNearby(r,!0).then(this.preloadNearby(r,!1)).then(this.getHigherQuality(s,e,t,n))});z(this,"removeOldImages",e=>{Array.from(this.currentImageContainer.children).forEach(t=>{if(t.tagName.toLowerCase()!=="img")return;const s=this.usingSprites?500:1e3;if(t.dataset.index!==e.dataset.index&&!t.dataset.deleting){t.dataset.deleting=!0;const{currentImageContainer:r}=this;setTimeout(()=>{r.removeChild(t),this.player.debug.log(`Removing thumb: ${t.dataset.filename}`)},s)}})});z(this,"preloadNearby",(e,t=!0)=>new Promise(s=>{setTimeout(()=>{const r=this.thumbnails[0].frames[e].text;if(this.showingThumbFilename===r){let n;t?n=this.thumbnails[0].frames.slice(e):n=this.thumbnails[0].frames.slice(0,e).reverse();let o=!1;n.forEach(a=>{const l=a.text;if(l!==r&&!this.loadedImages.includes(l)){o=!0,this.player.debug.log(`Preloading thumb filename: ${l}`);const{urlPrefix:c}=this.thumbnails[0],h=c+l,u=new Image;u.src=h,u.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${l}`),this.loadedImages.includes(l)||this.loadedImages.push(l),s()}}}),o||s()}},300)}));z(this,"getHigherQuality",(e,t,s,r)=>{if(e<this.thumbnails.length-1){let n=t.naturalHeight;this.usingSprites&&(n=s.h),n<this.thumbContainerHeight&&setTimeout(()=>{this.showingThumbFilename===r&&(this.player.debug.log(`Showing higher quality thumb for: ${r}`),this.loadImage(e+1))},300)}});z(this,"toggleThumbContainer",(e=!1,t=!1)=>{const s=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(s,e),!e&&t&&(this.showingThumb=null,this.showingThumbFilename=null)});z(this,"toggleScrubbingContainer",(e=!1)=>{const t=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(t,e),e||(this.showingThumb=null,this.showingThumbFilename=null)});z(this,"determineContainerAutoSizing",()=>{(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)});z(this,"setThumbContainerSizeAndPos",()=>{const{imageContainer:e}=this.elements.thumb;if(this.sizeSpecifiedInCSS){if(e.clientHeight>20&&e.clientWidth<20){const t=Math.floor(e.clientHeight*this.thumbAspectRatio);e.style.width=`${t}px`}else if(e.clientHeight<20&&e.clientWidth>20){const t=Math.floor(e.clientWidth/this.thumbAspectRatio);e.style.height=`${t}px`}}else{const t=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);e.style.height=`${this.thumbContainerHeight}px`,e.style.width=`${t}px`}this.setThumbContainerPos()});z(this,"setThumbContainerPos",()=>{const e=this.player.elements.progress.getBoundingClientRect(),t=this.player.elements.container.getBoundingClientRect(),{container:s}=this.elements.thumb,r=t.left-e.left+10,n=t.right-e.left-s.clientWidth-10,o=this.mousePosX-e.left-s.clientWidth/2,a=hu(o,r,n);s.style.left=`${a}px`,s.style.setProperty("--preview-arrow-offset",`${o-a}px`)});z(this,"setScrubbingContainerSize",()=>{const{width:e,height:t}=Al(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${e}px`,this.elements.scrubbing.container.style.height=`${t}px`});z(this,"setImageSizeAndOffset",(e,t)=>{if(!this.usingSprites)return;const s=this.thumbContainerHeight/t.h;e.style.height=`${e.naturalHeight*s}px`,e.style.width=`${e.naturalWidth*s}px`,e.style.left=`-${t.x*s}px`,e.style.top=`-${t.y*s}px`});this.player=e,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:e}=Al(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return e}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(e){this.mouseDown?this.currentScrubbingImageElement=e:this.currentThumbnailImageElement=e}}const oo={insertElements(i,e){b.string(e)?El(i,this.media,{src:e}):b.array(e)&&e.forEach(t=>{El(i,this.media,t)})},change(i){if(!Kh(i,"sources.length")){this.debug.warn("Invalid source format");return}as.cancelRequests.call(this),this.destroy(()=>{this.options.quality=[],Wt(this.media),this.media=null,b.element(this.elements.container)&&this.elements.container.removeAttribute("class");const{sources:e,type:t}=i,[{provider:s=os.html5,src:r}]=e,n=s==="html5"?t:"div",o=s==="html5"?{}:{src:r};Object.assign(this,{provider:s,type:t,supported:Ne.check(t,s,this.config.playsinline),media:K(n,o)}),this.elements.container.appendChild(this.media),b.boolean(i.autoplay)&&(this.config.autoplay=i.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute("crossorigin",""),this.config.autoplay&&this.media.setAttribute("autoplay",""),b.empty(i.poster)||(this.poster=i.poster),this.config.loop.active&&this.media.setAttribute("loop",""),this.config.muted&&this.media.setAttribute("muted",""),this.config.playsinline&&this.media.setAttribute("playsinline","")),ve.addStyleHook.call(this),this.isHTML5&&oo.insertElements.call(this,"source",e),this.config.title=i.title,cu.setup.call(this),this.isHTML5&&Object.keys(i).includes("tracks")&&oo.insertElements.call(this,"track",i.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&ve.build.call(this),this.isHTML5&&this.media.load(),b.empty(i.previewThumbnails)||(Object.assign(this.config.previewThumbnails,i.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new no(this))),this.fullscreen.update()},!0)}};class Ni{constructor(e,t){z(this,"play",()=>b.function(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then(()=>this.ads.play()).catch(()=>Dt(this.media.play())),this.media.play()):null);z(this,"pause",()=>!this.playing||!b.function(this.media.pause)?null:this.media.pause());z(this,"togglePlay",e=>(b.boolean(e)?e:!this.playing)?this.play():this.pause());z(this,"stop",()=>{this.isHTML5?(this.pause(),this.restart()):b.function(this.media.stop)&&this.media.stop()});z(this,"restart",()=>{this.currentTime=0});z(this,"rewind",e=>{this.currentTime-=b.number(e)?e:this.config.seekTime});z(this,"forward",e=>{this.currentTime+=b.number(e)?e:this.config.seekTime});z(this,"increaseVolume",e=>{const t=this.media.muted?0:this.volume;this.volume=t+(b.number(e)?e:0)});z(this,"decreaseVolume",e=>{this.increaseVolume(-e)});z(this,"airplay",()=>{Ne.airplay&&this.media.webkitShowPlaybackTargetPicker()});z(this,"toggleControls",e=>{if(this.supported.ui&&!this.isAudio){const t=Vr(this.elements.container,this.config.classNames.hideControls),s=typeof e>"u"?void 0:!e,r=me(this.elements.container,this.config.classNames.hideControls,s);if(r&&b.array(this.config.controls)&&this.config.controls.includes("settings")&&!b.empty(this.config.settings)&&I.toggleMenu.call(this,!1),r!==t){const n=r?"controlshidden":"controlsshown";J.call(this,this.media,n)}return!r}return!1});z(this,"on",(e,t)=>{he.call(this,this.elements.container,e,t)});z(this,"once",(e,t)=>{Zo.call(this,this.elements.container,e,t)});z(this,"off",(e,t)=>{on(this.elements.container,e,t)});z(this,"destroy",(e,t=!1)=>{if(!this.ready)return;const s=()=>{document.body.style.overflow="",this.embed=null,t?(Object.keys(this.elements).length&&(Wt(this.elements.buttons.play),Wt(this.elements.captions),Wt(this.elements.controls),Wt(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),b.function(e)&&e()):(Xy.call(this),as.cancelRequests.call(this),$r(this.elements.original,this.elements.container),J.call(this,this.elements.original,"destroyed",!0),b.function(e)&&e.call(this.elements.original),this.ready=!1,setTimeout(()=>{this.elements=null,this.media=null},200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(ve.toggleNativeControls.call(this,!0),s()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),this.embed!==null&&b.function(this.embed.destroy)&&this.embed.destroy(),s()):this.isVimeo&&(this.embed!==null&&this.embed.unload().then(s),setTimeout(s,200))});z(this,"supports",e=>Ne.mime.call(this,e));if(this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=Ne.touch,this.media=e,b.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||b.nodeList(this.media)||b.array(this.media))&&(this.media=this.media[0]),this.config=Ae({},au,Ni.defaults,t||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch{return{}}})()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new c0(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",Ne),b.nullOrUndefined(this.media)||!b.element(this.media)){this.debug.error("Setup failed: no suitable element passed");return}if(this.media.plyr){this.debug.warn("Target already setup");return}if(!this.config.enabled){this.debug.error("Setup failed: disabled by config");return}if(!Ne.check().api){this.debug.error("Setup failed: no support");return}const s=this.media.cloneNode(!0);s.autoplay=!1,this.elements.original=s;const r=this.media.tagName.toLowerCase();let n=null,o=null;switch(r){case"div":if(n=this.media.querySelector("iframe"),b.element(n)){if(o=nu(n.getAttribute("src")),this.provider=l0(o.toString()),this.elements.container=this.media,this.media=n,this.elements.container.className="",o.search.length){const a=["1","true"];a.includes(o.searchParams.get("autoplay"))&&(this.config.autoplay=!0),a.includes(o.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=a.includes(o.searchParams.get("playsinline")),this.config.youtube.hl=o.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(b.empty(this.provider)||!Object.values(os).includes(this.provider)){this.debug.error("Setup failed: Invalid provider");return}this.type=Dn.video;break;case"video":case"audio":this.type=r,this.provider=os.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:this.debug.error("Setup failed: unsupported type");return}if(this.supported=Ne.check(this.type,this.provider),!this.supported.api){this.debug.error("Setup failed: no support");return}this.eventListeners=[],this.listeners=new h0(this),this.storage=new Ai(this),this.media.plyr=this,b.element(this.elements.container)||(this.elements.container=K("div"),Jh(this.media,this.elements.container)),ve.migrateStyles.call(this),ve.addStyleHook.call(this),cu.setup.call(this),this.config.debug&&he.call(this,this.elements.container,this.config.events.join(" "),a=>{this.debug.log(`event: ${a.type}`)}),this.fullscreen=new _t(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&ve.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new _0(this)),this.isHTML5&&this.config.autoplay&&this.once("canplay",()=>Dt(this.play())),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new no(this))}get isHTML5(){return this.provider===os.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===os.youtube}get isVimeo(){return this.provider===os.vimeo}get isVideo(){return this.type===Dn.video}get isAudio(){return this.type===Dn.audio}get playing(){return!!(this.ready&&!this.paused&&!this.ended)}get paused(){return!!this.media.paused}get stopped(){return!!(this.paused&&this.currentTime===0)}get ended(){return!!this.media.ended}set currentTime(e){if(!this.duration)return;const t=b.number(e)&&e>0;this.media.currentTime=t?Math.min(e,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:e}=this.media;return b.number(e)?e:e&&e.length&&this.duration>0?e.end(0)/this.duration:0}get seeking(){return!!this.media.seeking}get duration(){const e=Number.parseFloat(this.config.duration),t=(this.media||{}).duration,s=!b.number(t)||t===1/0?0:t;return e||s}set volume(e){let t=e;const s=1,r=0;b.string(t)&&(t=Number(t)),b.number(t)||(t=this.storage.get("volume")),b.number(t)||({volume:t}=this.config),t>s&&(t=s),t<r&&(t=r),this.config.volume=t,this.media.volume=t,!b.empty(e)&&this.muted&&t>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}set muted(e){let t=e;b.boolean(t)||(t=this.storage.get("muted")),b.boolean(t)||(t=this.config.muted),this.config.muted=t,this.media.muted=t}get muted(){return!!this.media.muted}get hasAudio(){return!this.isHTML5||this.isAudio?!0:!!this.media.mozHasAudio||!!this.media.webkitAudioDecodedByteCount||!!(this.media.audioTracks&&this.media.audioTracks.length)}set speed(e){let t=null;b.number(e)&&(t=e),b.number(t)||(t=this.storage.get("speed")),b.number(t)||(t=this.config.speed.selected);const{minimumSpeed:s,maximumSpeed:r}=this;t=hu(t,s,r),this.config.speed.selected=t,setTimeout(()=>{this.media&&(this.media.playbackRate=t)},0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(e){const t=this.config.quality,s=this.options.quality;if(!s.length)return;let r=[!b.empty(e)&&Number(e),this.storage.get("quality"),t.selected,t.default].find(b.number),n=!0;if(!s.includes(r)){const o=Zh(s,r);this.debug.warn(`Unsupported quality option: ${r}, using ${o} instead`),r=o,n=!1}t.selected=r,this.media.quality=r,n&&this.storage.set({quality:r})}get quality(){return this.media.quality}set loop(e){const t=b.boolean(e)?e:this.config.loop.active;this.config.loop.active=t,this.media.loop=t}get loop(){return!!this.media.loop}set source(e){oo.change.call(this,e)}get source(){return this.media.currentSrc}get download(){const{download:e}=this.config.urls;return b.url(e)?e:this.source}set download(e){b.url(e)&&(this.config.urls.download=e,I.setDownloadUrl.call(this))}set poster(e){if(!this.isVideo){this.debug.warn("Poster can only be set for video");return}ve.setPoster.call(this,e,!1).catch(()=>{})}get poster(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}get ratio(){if(!this.isVideo)return null;const e=Wr(Qo.call(this));return b.array(e)?e.join(":"):e}set ratio(e){if(!this.isVideo){this.debug.warn("Aspect ratio can only be set for video");return}if(!b.string(e)||!eu(e)){this.debug.error(`Invalid aspect ratio specified (${e})`);return}this.config.ratio=Wr(e),Gs.call(this)}set autoplay(e){this.config.autoplay=b.boolean(e)?e:this.config.autoplay}get autoplay(){return!!this.config.autoplay}toggleCaptions(e){ge.toggle.call(this,e,!1)}set currentTrack(e){ge.set.call(this,e,!1),ge.setup.call(this)}get currentTrack(){const{toggled:e,currentTrack:t}=this.captions;return e?t:-1}set language(e){ge.setLanguage.call(this,e,!1)}get language(){return(ge.getCurrentTrack.call(this)||{}).language}set pip(e){if(!Ne.pip)return;const t=b.boolean(e)?e:!this.pip;b.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(t?Mn.active:Mn.inactive),b.function(this.media.requestPictureInPicture)&&(!this.pip&&t?this.media.requestPictureInPicture():this.pip&&!t&&document.exitPictureInPicture())}get pip(){return Ne.pip?b.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===Mn.active:null}setPreviewThumbnails(e){this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),Object.assign(this.config.previewThumbnails,e),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new no(this))}static supported(e,t){return Ne.check(e,t)}static loadSprite(e,t){return iu(e,t)}static setup(e,t={}){let s=null;return b.string(e)?s=Array.from(document.querySelectorAll(e)):b.nodeList(e)?s=Array.from(e):b.array(e)&&(s=e.filter(b.element)),b.empty(s)?null:s.map(r=>new Ni(r,t))}}Ni.defaults=Vy(au);function x0(){const i=we(null),e=we(null),t=we(!1),s=we(!1),[r,n]=te(!1),[o,a]=te(!1),[l,c]=te(!1),{clips:h,playhead:u,isPlaying:d,setPlayhead:g,setIsPlaying:p,addClip:y,selectedClipId:v,updateClip:_}=qe(),f=pt(()=>{if(v){const T=h.find(F=>F.id===v);return console.log("[ClipForge] Showing selected clip:",(T==null?void 0:T.name)||"NOT FOUND","ID:",T==null?void 0:T.id,"Path:",T==null?void 0:T.path),T}const k=h.filter(T=>u>=T.start&&u<T.end).sort((T,F)=>T.track-F.track)[0];return k?console.log("[ClipForge] No selection, showing clip at playhead:",k.name):console.log("[ClipForge] No clip at playhead"),k},[v,h,u]);return Me(()=>{if(!i.current){console.log("[ClipForge] Plyr init skipped - no videoRef");return}console.log("[ClipForge] Initializing Plyr player...");const C=new Ni(i.current,{controls:["play","progress","current-time","mute","volume","fullscreen"],keyboard:{focused:!0,global:!0}});return e.current=C,c(!0),console.log("[ClipForge] Plyr player initialized and ready!"),C.on("timeupdate",()=>{if(t.current)return;const k=qe.getState(),T=k.selectedClipId?k.clips.find(A=>A.id===k.selectedClipId):k.clips.filter(A=>k.playhead>=A.start&&k.playhead<A.end).sort((A,B)=>A.track-B.track)[0];if(!T)return;const F=C.currentTime;F<T.trimStart?C.currentTime=T.trimStart:F>T.trimEnd&&(C.currentTime=T.trimStart,C.pause());const M=T.start+(F-T.trimStart);console.log("[ClipForge] 🎬 TIMEUPDATE: video_time=",F,"clip.start=",T.start,"trimStart=",T.trimStart,"→ timeline_pos=",M),t.current=!0,g(M),setTimeout(()=>{t.current=!1},50)}),C.on("play",()=>{s.current||(s.current=!0,p(!0),setTimeout(()=>{s.current=!1},100))}),C.on("pause",()=>{s.current||(s.current=!0,p(!1),setTimeout(()=>{s.current=!1},100))}),C.on("volumechange",()=>{const k=qe.getState(),T=k.selectedClipId?k.clips.find(F=>F.id===k.selectedClipId):k.clips.filter(F=>k.playhead>=F.start&&k.playhead<F.end).sort((F,M)=>F.track-M.track)[0];T&&(console.log("[ClipForge] 🔊 Volume changed:",{volume:C.volume,muted:C.muted}),_(T.id,{volume:C.volume,muted:C.muted}))}),()=>{e.current&&(e.current.destroy(),e.current=null)}},[]),Me(()=>{var M,A;if(console.log("[ClipForge] Video loading effect triggered. playerRef:",!!e.current,"currentClip:",!!f,"videoRef:",!!i.current),!e.current||!f||!i.current){console.log("[ClipForge] Video loading skipped - missing refs or clip");return}a(!1);const C=e.current,k=mc(f.path);console.log("[ClipForge] Loading video:",f.name,"from path:",f.path),console.log("[ClipForge] Converted source URL:",k);const T=B=>{console.error("[ClipForge] Video load error:",B);const E=i.current;E&&console.error("[ClipForge] Video error details:",{error:E.error,networkState:E.networkState,readyState:E.readyState,src:E.src})},F=()=>{if(!e.current||!f)return;console.log("[ClipForge] Video metadata loaded!"),a(!0);const E=qe.getState().playhead;let N=E-f.start;E<f.start?N=0:E>=f.end&&(N=f.end-f.start);const j=f.trimStart+N,L=Math.max(f.trimStart,Math.min(f.trimEnd,j));console.log("[ClipForge] Video loaded, seeking to initial position:",L),console.log("[ClipForge] Seeking to:",L),e.current.currentTime=L};return i.current&&(i.current.addEventListener("loadedmetadata",F,{once:!0}),i.current.addEventListener("error",T)),C.source={type:"video",sources:[{src:k,type:"video/mp4"}]},C.volume=(M=f.volume)!=null?M:1,C.muted=(A=f.muted)!=null?A:!1,()=>{i.current&&(i.current.removeEventListener("loadedmetadata",F),i.current.removeEventListener("error",T))}},[f==null?void 0:f.id,f==null?void 0:f.path]),Me(()=>{if(!e.current||!f||!i.current||t.current||!o)return;let C=u-f.start;u<f.start?C=0:u>=f.end&&(C=f.end-f.start);const k=f.trimStart+C,T=Math.max(f.trimStart,Math.min(f.trimEnd,k));console.log("[ClipForge] Playhead:",u,"Clip:",f.start,"-",f.end,"Trim:",f.trimStart,"-",f.trimEnd,"Timeline offset:",C,"Video time:",T);const F=()=>{!i.current||!e.current||(i.current.readyState>=2?Math.abs(e.current.currentTime-T)>.1&&(console.log("[ClipForge] Seeking to:",T),e.current.currentTime=T):setTimeout(F,50))};F()},[u,f==null?void 0:f.id,f==null?void 0:f.start,f==null?void 0:f.end,f==null?void 0:f.trimStart,f==null?void 0:f.trimEnd,o]),Me(()=>{if(!e.current||s.current)return;const C=e.current;d&&C.paused?(s.current=!0,C.play().then(()=>setTimeout(()=>{s.current=!1},100)).catch(()=>{p(!1),s.current=!1})):!d&&!C.paused&&(s.current=!0,C.pause(),setTimeout(()=>{s.current=!1},100))},[d,p]),m("div",{className:"flex flex-1 items-center justify-center bg-muted p-4",onDrop:C=>{C.preventDefault(),n(!1);try{const k=C.dataTransfer.getData("application/json");if(!k)return;const T=JSON.parse(k),F=h.length>0?Math.max(...h.map(M=>M.end)):0;y({...T,start:F,end:F+T.duration})}catch(k){console.error("[ClipForge] Failed to handle drop:",k)}},onDragOver:C=>{C.preventDefault(),C.dataTransfer.dropEffect="copy",n(!0)},onDragLeave:C=>{C.preventDefault(),n(!1)},children:[m("div",{className:"w-full h-full flex items-center justify-center px-8 py-6",children:m("div",{className:"relative bg-black rounded-lg overflow-hidden shadow-xl max-w-full max-h-full",style:{aspectRatio:"16/9",width:"min(95%, calc(100vh * 16/9))",height:"auto",display:f?"block":"none"},children:m("video",{ref:i,className:"w-full h-full object-contain",playsInline:!0})})}),!f&&m("div",{className:`absolute text-center text-muted-foreground transition-all duration-200 ${r?"scale-110":""}`,children:r?m(Le,{children:[m("div",{className:"text-6xl mb-4",children:"📹"}),m("p",{className:"text-xl font-semibold text-blue-400",children:"Drop video here"}),m("p",{className:"text-sm mt-2",children:"Add to timeline instantly"})]}):m(Le,{children:[m("p",{className:"text-lg",children:"No clip selected"}),m("p",{className:"text-sm",children:"Import a video to get started"}),m("p",{className:"text-xs mt-4 text-zinc-600",children:"💡 Drag clips from the library to add them to the timeline"})]})})]})}function C0(){const{isPlaying:i,setIsPlaying:e,playhead:t,setPlayhead:s,zoom:r,setZoom:n,clips:o,selectedClipId:a,trimClip:l,autoFitZoom:c,copyClip:h,pasteClip:u,copiedClip:d}=qe(),[g,p]=te(!1),[y,v]=te(800),_=o.find(N=>N.id===a),f=_&&(_.trimStart>0||_.trimEnd<_.duration),S=o.length>0?Math.max(...o.map(N=>N.end)):0;Me(()=>{const N=()=>{const j=document.querySelector("canvas");j&&v(j.width)};return N(),window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]);const C=()=>{e(!i)},k=()=>{s(Math.max(0,t-5))},T=()=>{s(Math.min(S,t+5))},F=()=>{n(Math.min(50,r*1.5))},M=()=>{n(Math.max(5,r/1.5))},A=()=>{c(y)},B=N=>{const j=Math.floor(N/60),L=Math.floor(N%60);return`${j}:${L.toString().padStart(2,"0")}`},E=async()=>{if(_){p(!0);try{await l(_.id,_.trimStart,_.trimEnd),console.log("[ClipForge] Trim applied successfully")}catch(N){console.error("[ClipForge] Failed to apply trim:",N)}finally{p(!1)}}};return m("div",{className:"flex items-center justify-between border-t border-zinc-700 bg-zinc-900 px-6 py-4 shadow-sm",children:[m("div",{className:"flex items-center gap-4",children:[m("div",{className:"flex items-center gap-2",children:[m($e,{variant:"ghost",size:"icon",className:"h-12 w-12 hover:bg-zinc-800 text-white border border-zinc-600",onClick:k,children:m(Hg,{className:"h-6 w-6"})}),m($e,{variant:"ghost",size:"icon",className:"h-12 w-12 hover:bg-blue-600 bg-blue-600 text-white border border-blue-500 shadow-md",onClick:C,children:i?m(Og,{className:"h-6 w-6"}):m(Pg,{className:"h-6 w-6"})}),m($e,{variant:"ghost",size:"icon",className:"h-12 w-12 hover:bg-zinc-800 text-white border border-zinc-600",onClick:T,children:m(Xg,{className:"h-6 w-6"})})]}),m("div",{className:"flex items-center gap-6 px-6 py-2 bg-zinc-800 rounded-lg border border-zinc-600",children:[m("span",{className:"font-mono text-lg text-zinc-200 font-medium",children:B(t)}),m("span",{className:"text-zinc-400",children:"/"}),m("span",{className:"font-mono text-lg text-zinc-200 font-medium",children:B(S)})]}),f&&m($e,{variant:"ghost",className:"h-12 px-6 bg-green-600 hover:bg-green-500 text-white border-2 border-green-500 shadow-lg transition-all duration-200 flex items-center gap-2",onClick:E,disabled:g,children:[m(zg,{className:"h-5 w-5"}),m("span",{className:"font-medium",children:g?"Applying...":"Apply Trim"})]}),m("div",{className:"flex items-center gap-2",children:[m($e,{variant:"ghost",size:"icon",className:"h-12 w-12 hover:bg-zinc-800 text-white border border-zinc-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>a&&h(a),disabled:!a,title:a?"Copy clip (Cmd/Ctrl+C)":"Select a clip to copy",children:m(gg,{className:"h-5 w-5"})}),m($e,{variant:"ghost",size:"icon",className:"h-12 w-12 hover:bg-zinc-800 text-white border border-zinc-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>u(),disabled:!d,title:d?"Paste clip (Cmd/Ctrl+V)":"Copy a clip first",children:m(ug,{className:"h-5 w-5"})})]})]}),m("div",{className:"flex items-center gap-4",children:m("div",{className:"flex items-center gap-2 px-4 py-2 bg-zinc-800 rounded-lg border border-zinc-600",children:[m($e,{variant:"ghost",size:"icon",className:"h-10 w-10 hover:bg-zinc-700 text-white",onClick:M,children:m(of,{className:"h-5 w-5"})}),m("span",{className:"w-16 text-center font-mono text-sm text-zinc-300",children:[Math.round(r),"x"]}),m($e,{variant:"ghost",size:"icon",className:"h-10 w-10 hover:bg-zinc-700 text-white",onClick:F,children:m(rf,{className:"h-5 w-5"})}),m("div",{className:"h-6 w-px bg-zinc-600 mx-2"}),m($e,{variant:"ghost",size:"icon",className:"h-10 w-10 hover:bg-blue-700 bg-blue-600 text-white",onClick:A,title:"Fit to timeline",children:m(_g,{className:"h-5 w-5"})})]})})]})}const uu=Te(({className:i,type:e,...t},s)=>m("input",{type:e,className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${i||""}`,ref:s,...t}));uu.displayName="Input";function S0(){const[i,e]=te(!1),[t,s]=te(null),[r,n]=te(""),[o,a]=te(null),[l,c]=te(!1),{clips:h,deleteClip:u}=qe(),d=f=>{const S=Math.floor(f/60),C=Math.floor(f%60);return`${S}:${C.toString().padStart(2,"0")}`},g=f=>f<1024?`${f} B`:f<1024*1024?`${(f/1024).toFixed(1)} KB`:f<1024*1024*1024?`${(f/(1024*1024)).toFixed(1)} MB`:`${(f/(1024*1024*1024)).toFixed(2)} GB`,p=f=>f<1e3?`${f} bps`:f<1e6?`${(f/1e3).toFixed(0)} kbps`:`${(f/1e6).toFixed(1)} Mbps`,y=pt(()=>{if(!r)return h;const f=r.toLowerCase();return h.filter(S=>!!(S.name.toLowerCase().includes(f)||S.codec&&S.codec.toLowerCase().includes(f)||S.resolution&&S.resolution.toLowerCase().includes(f)||S.file_size&&g(S.file_size).toLowerCase().includes(f)||S.fps&&S.fps.toString().includes(f)))},[h,r]),v=async f=>{try{await u(f),a(null),s(null)}catch(S){console.error("[MediaLibrary] Delete failed:",S),alert("Failed to delete clip. Please try again.")}};return m("div",{className:`relative flex flex-col h-full bg-zinc-900 border-r border-zinc-700 transition-all duration-300 ${i?"w-12":"w-80"}`,children:[m($e,{onClick:()=>e(!i),variant:"ghost",size:"icon",className:"absolute -right-3 top-4 z-10 h-6 w-6 rounded-full bg-zinc-800 border border-zinc-700 hover:bg-zinc-700",children:i?m(tg,{className:"h-4 w-4"}):m(Qd,{className:"h-4 w-4"})}),i?m("div",{className:"flex flex-col items-center py-4 gap-2",children:[m(di,{className:"h-6 w-6 text-zinc-500"}),m("div",{className:"text-xs text-zinc-500 [writing-mode:vertical-lr] rotate-180",children:"Media Library"})]}):m(Le,{children:[m("div",{className:"p-4 border-b border-zinc-700 space-y-3",children:[m("div",{className:"flex items-center justify-between",children:[m("div",{className:"flex items-center gap-2",children:[m(di,{className:"h-5 w-5 text-blue-500"}),m("h2",{className:"text-lg font-semibold",children:"Media Library"})]}),m("div",{className:"flex items-center gap-2",children:[m("button",{onClick:async()=>{try{c(!0),await Ie("regenerate_thumbnails"),alert("Thumbnails regenerated successfully!"),window.location.reload()}catch(f){console.error("[MediaLibrary] Thumbnail regeneration failed:",f),alert("Failed to regenerate thumbnails. Please check the console for details.")}finally{c(!1)}},disabled:l,className:"flex items-center gap-1 text-xs text-blue-400 hover:text-blue-300 disabled:text-zinc-500 disabled:cursor-not-allowed transition-colors",title:"Regenerate thumbnails for clips without them",children:[m(Ng,{className:`h-3 w-3 ${l?"animate-spin":""}`}),l?"Generating...":"Thumbnails"]}),m("div",{className:"text-xs text-zinc-500",children:[y.length," of ",h.length]})]})]}),m("div",{className:"relative",children:[m(Pa,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-500"}),m(uu,{type:"text",placeholder:"Search by name, codec, resolution...",value:r,onChange:f=>{var S;return n(((S=f.target)==null?void 0:S.value)||"")},className:"pl-9 pr-9 bg-zinc-800 border-zinc-700 text-sm h-9 focus:border-blue-500"}),r&&m("button",{onClick:()=>n(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 hover:text-zinc-300",children:m(tf,{className:"h-4 w-4"})})]})]}),m("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:h.length===0?m("div",{className:"text-center text-zinc-500 py-8",children:[m(di,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),m("p",{className:"text-sm",children:"No clips yet"}),m("p",{className:"text-xs mt-1",children:"Import videos to get started"})]}):y.length===0?m("div",{className:"text-center text-zinc-500 py-8",children:[m(Pa,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),m("p",{className:"text-sm",children:"No results found"}),m("p",{className:"text-xs mt-1",children:"Try a different search term"})]}):y.map(f=>m("div",{draggable:!0,onDragStart:S=>{S.dataTransfer&&(S.dataTransfer.setData("application/json",JSON.stringify(f)),S.dataTransfer.effectAllowed="copy"),S.currentTarget instanceof HTMLElement&&(S.currentTarget.style.opacity="0.5")},onDragEnd:S=>{S.currentTarget instanceof HTMLElement&&(S.currentTarget.style.opacity="1")},className:"bg-zinc-800 rounded-lg p-3 border border-zinc-700 hover:border-blue-500 transition-colors cursor-grab active:cursor-grabbing group",children:[m("div",{className:"aspect-video bg-zinc-700 rounded mb-2 overflow-hidden group-hover:ring-2 group-hover:ring-blue-500 transition-all",children:f.thumbnail_path?m("img",{src:mc(f.thumbnail_path),alt:f.name,className:"w-full h-full object-cover object-center",draggable:!1}):m("div",{className:"w-full h-full flex items-center justify-center",children:m(di,{className:"h-8 w-8 text-zinc-500"})})}),m("div",{className:"space-y-1",children:[m("p",{className:"text-sm font-medium truncate",title:f.name,children:f.name}),m("div",{className:"flex items-center justify-between text-xs text-zinc-500",children:[m("span",{children:d(f.duration)}),m("span",{className:"text-zinc-600",children:"•"}),m("span",{children:f.resolution||"Unknown"}),f.file_size&&m(Le,{children:[m("span",{className:"text-zinc-600",children:"•"}),m("span",{children:g(f.file_size)})]})]}),t===f.id&&m("div",{className:"mt-2 pt-2 border-t border-zinc-700 space-y-1 text-xs",children:[f.codec&&m("div",{className:"flex justify-between",children:[m("span",{className:"text-zinc-500",children:"Codec:"}),m("span",{className:"text-zinc-300 font-mono",children:f.codec.toUpperCase()})]}),f.fps&&m("div",{className:"flex justify-between",children:[m("span",{className:"text-zinc-500",children:"Frame Rate:"}),m("span",{className:"text-zinc-300",children:[f.fps.toFixed(2)," fps"]})]}),f.bit_rate&&m("div",{className:"flex justify-between",children:[m("span",{className:"text-zinc-500",children:"Bit Rate:"}),m("span",{className:"text-zinc-300",children:p(f.bit_rate)})]}),m("div",{className:"flex justify-between",children:[m("span",{className:"text-zinc-500",children:"Trim Range:"}),m("span",{className:"text-zinc-300",children:[d(f.trimStart)," - ",d(f.trimEnd)]})]})]}),m("div",{className:"flex gap-1 mt-2 border-t border-zinc-700 pt-2",children:o===f.id?m(Le,{children:[m("button",{onClick:S=>{S.stopPropagation(),v(f.id)},className:"flex-1 py-1.5 px-2 text-xs bg-red-600 hover:bg-red-700 text-white rounded transition-colors flex items-center justify-center gap-1",children:[m(Aa,{className:"h-3 w-3"}),"Confirm Delete"]}),m("button",{onClick:S=>{S.stopPropagation(),a(null)},className:"flex-1 py-1.5 px-2 text-xs bg-zinc-700 hover:bg-zinc-600 text-white rounded transition-colors",children:"Cancel"})]}):m(Le,{children:[m("button",{onClick:S=>{S.stopPropagation(),s(t===f.id?null:f.id)},className:"flex-1 py-1.5 px-2 text-xs text-zinc-500 hover:text-blue-400 hover:bg-zinc-700 rounded transition-colors flex items-center justify-center gap-1",children:t===f.id?m(Le,{children:[m(ig,{className:"h-3 w-3"}),"Less"]}):m(Le,{children:[m(Jd,{className:"h-3 w-3"}),"More"]})}),m("button",{onClick:S=>{S.stopPropagation(),a(f.id)},className:"py-1.5 px-3 text-xs text-red-400 hover:text-red-300 hover:bg-zinc-700 rounded transition-colors flex items-center gap-1",children:[m(Aa,{className:"h-3 w-3"}),"Delete"]})]})})]})]},f.id))})]})]})}function du(i,[e,t]){return Math.min(t,Math.max(e,i))}function zs(i,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(i==null||i(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function Nl(i,e){if(typeof i=="function")return i(e);i!=null&&(i.current=e)}function gu(...i){return e=>{let t=!1;const s=i.map(r=>{const n=Nl(r,e);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let r=0;r<s.length;r++){const n=s[r];typeof n=="function"?n():Nl(i[r],null)}}}}function hs(...i){return Li(gu(...i),i)}function fu(i,e=[]){let t=[];function s(n,o){const a=Us(o),l=t.length;t=[...t,o];const c=u=>{var _;const{scope:d,children:g,...p}=u,y=((_=d==null?void 0:d[i])==null?void 0:_[l])||a,v=pt(()=>p,Object.values(p));return m(y.Provider,{value:v,children:g})};c.displayName=n+"Provider";function h(u,d){var y;const g=((y=d==null?void 0:d[i])==null?void 0:y[l])||a,p=us(g);if(p)return p;if(o!==void 0)return o;throw new Error(`\`${u}\` must be used within \`${n}\``)}return[c,h]}const r=()=>{const n=t.map(o=>Us(o));return function(a){const l=(a==null?void 0:a[i])||n;return pt(()=>({[`__scope${i}`]:{...a,[i]:l}}),[a,l])}};return r.scopeName=i,[s,k0(r,...e)]}function k0(...i){const e=i[0];if(i.length===1)return e;const t=()=>{const s=i.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(n){const o=s.reduce((a,{useScope:l,scopeName:c})=>{const u=l(n)[`__scope${c}`];return{...a,...u}},{});return pt(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}var pu=globalThis!=null&&globalThis.document?Es:()=>{},T0=rd[" useInsertionEffect ".trim().toString()]||pu;function O0({prop:i,defaultProp:e,onChange:t=()=>{},caller:s}){const[r,n,o]=E0({defaultProp:e,onChange:t}),a=i!==void 0,l=a?i:r;{const h=we(i!==void 0);Me(()=>{const u=h.current;u!==a&&console.warn(`${s} is changing from ${u?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=a},[a,s])}const c=Li(h=>{var u;if(a){const d=M0(h)?h(i):h;d!==i&&((u=o.current)==null||u.call(o,d))}else n(h)},[a,i,n,o]);return[l,c]}function E0({defaultProp:i,onChange:e}){const[t,s]=te(i),r=we(t),n=we(e);return T0(()=>{n.current=e},[e]),Me(()=>{var o;r.current!==t&&((o=n.current)==null||o.call(n,t),r.current=t)},[t,r]),[t,s,n]}function M0(i){return typeof i=="function"}var D0=Us(void 0);function P0(i){const e=us(D0);return i||e||"ltr"}function A0(i){const e=we({value:i,previous:i});return pt(()=>(e.current.value!==i&&(e.current.previous=e.current.value,e.current.value=i),e.current.previous),[i])}function N0(i){const[e,t]=te(void 0);return pu(()=>{if(i){t({width:i.offsetWidth,height:i.offsetHeight});const s=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const n=r[0];let o,a;if("borderBoxSize"in n){const l=n.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=i.offsetWidth,a=i.offsetHeight;t({width:o,height:a})});return s.observe(i,{box:"border-box"}),()=>s.unobserve(i)}else t(void 0)},[i]),e}function ao(i){const e=F0(i),t=Te((s,r)=>{const{children:n,...o}=s,a=Ss.toArray(n),l=a.find(L0);if(l){const c=l.props.children,h=a.map(u=>u===l?Ss.count(c)>1?Ss.only(null):Gt(c)?c.props.children:null:u);return m(e,{...o,ref:r,children:Gt(c)?Ur(c,void 0,h):null})}return m(e,{...o,ref:r,children:n})});return t.displayName=`${i}.Slot`,t}function F0(i){const e=Te((t,s)=>{const{children:r,...n}=t;if(Gt(r)){const o=R0(r),a=I0(n,r.props);return r.type!==Le&&(a.ref=s?gu(s,o):o),Ur(r,a)}return Ss.count(r)>1?Ss.only(null):null});return e.displayName=`${i}.SlotClone`,e}var j0=Symbol("radix.slottable");function L0(i){return Gt(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===j0}function I0(i,e){const t={...e};for(const s in e){const r=i[s],n=e[s];/^on[A-Z]/.test(s)?r&&n?t[s]=(...a)=>{const l=n(...a);return r(...a),l}:r&&(t[s]=r):s==="style"?t[s]={...r,...n}:s==="className"&&(t[s]=[r,n].filter(Boolean).join(" "))}return{...i,...t}}function R0(i){var s,r;let e=(s=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=(r=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}var z0=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Hi=z0.reduce((i,e)=>{const t=ao(`Primitive.${e}`),s=Te((r,n)=>{const{asChild:o,...a}=r,l=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),m(l,{...a,ref:n})});return s.displayName=`Primitive.${e}`,{...i,[e]:s}},{});function B0(i){const e=i+"CollectionProvider",[t,s]=fu(e),[r,n]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=y=>{const{scope:v,children:_}=y,f=dt.useRef(null),S=dt.useRef(new Map).current;return m(r,{scope:v,itemMap:S,collectionRef:f,children:_})};o.displayName=e;const a=i+"CollectionSlot",l=ao(a),c=dt.forwardRef((y,v)=>{const{scope:_,children:f}=y,S=n(a,_),C=hs(v,S.collectionRef);return m(l,{ref:C,children:f})});c.displayName=a;const h=i+"CollectionItemSlot",u="data-radix-collection-item",d=ao(h),g=dt.forwardRef((y,v)=>{const{scope:_,children:f,...S}=y,C=dt.useRef(null),k=hs(v,C),T=n(h,_);return dt.useEffect(()=>(T.itemMap.set(C,{ref:C,...S}),()=>void T.itemMap.delete(C))),m(d,{[u]:"",ref:k,children:f})});g.displayName=h;function p(y){const v=n(i+"CollectionConsumer",y);return dt.useCallback(()=>{const f=v.collectionRef.current;if(!f)return[];const S=Array.from(f.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((T,F)=>S.indexOf(T.ref.current)-S.indexOf(F.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:o,Slot:c,ItemSlot:g},p,s]}var mu=["PageUp","PageDown"],yu=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],bu={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ri="Slider",[lo,$0,V0]=B0(ri),[vu]=fu(ri,[V0]),[W0,ln]=vu(ri),_u=Te((i,e)=>{const{name:t,min:s=0,max:r=100,step:n=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[s],value:h,onValueChange:u=()=>{},onValueCommit:d=()=>{},inverted:g=!1,form:p,...y}=i,v=we(new Set),_=we(0),S=o==="horizontal"?H0:U0,[C=[],k]=O0({prop:h,defaultProp:c,onChange:E=>{var j;(j=[...v.current][_.current])==null||j.focus(),u(E)}}),T=we(C);function F(E){const N=K0(C,E);B(E,N)}function M(E){B(E,_.current)}function A(){const E=T.current[_.current];C[_.current]!==E&&d(C)}function B(E,N,{commit:j}={commit:!1}){const L=eb(n),G=tb(Math.round((E-s)/n)*n+s,L),X=du(G,[s,r]);k((P=[])=>{const D=G0(P,X,N);if(Q0(D,l*n)){_.current=D.indexOf(X);const q=String(D)!==String(P);return q&&j&&d(D),q?D:P}else return P})}return m(W0,{scope:i.__scopeSlider,name:t,disabled:a,min:s,max:r,valueIndexToChangeRef:_,thumbs:v.current,values:C,orientation:o,form:p,children:m(lo.Provider,{scope:i.__scopeSlider,children:m(lo.Slot,{scope:i.__scopeSlider,children:m(S,{"aria-disabled":a,"data-disabled":a?"":void 0,...y,ref:e,onPointerDown:zs(y.onPointerDown,()=>{a||(T.current=C)}),min:s,max:r,inverted:g,onSlideStart:a?void 0:F,onSlideMove:a?void 0:M,onSlideEnd:a?void 0:A,onHomeKeyDown:()=>!a&&B(s,0,{commit:!0}),onEndKeyDown:()=>!a&&B(r,C.length-1,{commit:!0}),onStepKeyDown:({event:E,direction:N})=>{if(!a){const G=mu.includes(E.key)||E.shiftKey&&yu.includes(E.key)?10:1,X=_.current,P=C[X],D=n*G*N;B(P+D,X,{commit:!0})}}})})})})});_u.displayName=ri;var[wu,xu]=vu(ri,{startEdge:"left",endEdge:"right",size:"width",direction:1}),H0=Te((i,e)=>{const{min:t,max:s,dir:r,inverted:n,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...h}=i,[u,d]=te(null),g=hs(e,S=>d(S)),p=we(void 0),y=P0(r),v=y==="ltr",_=v&&!n||!v&&n;function f(S){const C=p.current||u.getBoundingClientRect(),k=[0,C.width],F=ta(k,_?[t,s]:[s,t]);return p.current=C,F(S-C.left)}return m(wu,{scope:i.__scopeSlider,startEdge:_?"left":"right",endEdge:_?"right":"left",direction:_?1:-1,size:"width",children:m(Cu,{dir:y,"data-orientation":"horizontal",...h,ref:g,style:{...h.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:S=>{const C=f(S.clientX);o==null||o(C)},onSlideMove:S=>{const C=f(S.clientX);a==null||a(C)},onSlideEnd:()=>{p.current=void 0,l==null||l()},onStepKeyDown:S=>{const k=bu[_?"from-left":"from-right"].includes(S.key);c==null||c({event:S,direction:k?-1:1})}})})}),U0=Te((i,e)=>{const{min:t,max:s,inverted:r,onSlideStart:n,onSlideMove:o,onSlideEnd:a,onStepKeyDown:l,...c}=i,h=we(null),u=hs(e,h),d=we(void 0),g=!r;function p(y){const v=d.current||h.current.getBoundingClientRect(),_=[0,v.height],S=ta(_,g?[s,t]:[t,s]);return d.current=v,S(y-v.top)}return m(wu,{scope:i.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:m(Cu,{"data-orientation":"vertical",...c,ref:u,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:y=>{const v=p(y.clientY);n==null||n(v)},onSlideMove:y=>{const v=p(y.clientY);o==null||o(v)},onSlideEnd:()=>{d.current=void 0,a==null||a()},onStepKeyDown:y=>{const _=bu[g?"from-bottom":"from-top"].includes(y.key);l==null||l({event:y,direction:_?-1:1})}})})}),Cu=Te((i,e)=>{const{__scopeSlider:t,onSlideStart:s,onSlideMove:r,onSlideEnd:n,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:l,...c}=i,h=ln(ri,t);return m(Hi.span,{...c,ref:e,onKeyDown:zs(i.onKeyDown,u=>{u.key==="Home"?(o(u),u.preventDefault()):u.key==="End"?(a(u),u.preventDefault()):mu.concat(yu).includes(u.key)&&(l(u),u.preventDefault())}),onPointerDown:zs(i.onPointerDown,u=>{const d=u.target;d.setPointerCapture(u.pointerId),u.preventDefault(),h.thumbs.has(d)?d.focus():s(u)}),onPointerMove:zs(i.onPointerMove,u=>{u.target.hasPointerCapture(u.pointerId)&&r(u)}),onPointerUp:zs(i.onPointerUp,u=>{const d=u.target;d.hasPointerCapture(u.pointerId)&&(d.releasePointerCapture(u.pointerId),n(u))})})}),Su="SliderTrack",ku=Te((i,e)=>{const{__scopeSlider:t,...s}=i,r=ln(Su,t);return m(Hi.span,{"data-disabled":r.disabled?"":void 0,"data-orientation":r.orientation,...s,ref:e})});ku.displayName=Su;var co="SliderRange",Tu=Te((i,e)=>{const{__scopeSlider:t,...s}=i,r=ln(co,t),n=xu(co,t),o=we(null),a=hs(e,o),l=r.values.length,c=r.values.map(d=>Mu(d,r.min,r.max)),h=l>1?Math.min(...c):0,u=100-Math.max(...c);return m(Hi.span,{"data-orientation":r.orientation,"data-disabled":r.disabled?"":void 0,...s,ref:a,style:{...i.style,[n.startEdge]:h+"%",[n.endEdge]:u+"%"}})});Tu.displayName=co;var ho="SliderThumb",Ou=Te((i,e)=>{const t=$0(i.__scopeSlider),[s,r]=te(null),n=hs(e,a=>r(a)),o=pt(()=>s?t().findIndex(a=>a.ref.current===s):-1,[t,s]);return m(X0,{...i,ref:n,index:o})}),X0=Te((i,e)=>{const{__scopeSlider:t,index:s,name:r,...n}=i,o=ln(ho,t),a=xu(ho,t),[l,c]=te(null),h=hs(e,f=>c(f)),u=l?o.form||!!l.closest("form"):!0,d=N0(l),g=o.values[s],p=g===void 0?0:Mu(g,o.min,o.max),y=q0(s,o.values.length),v=d==null?void 0:d[a.size],_=v?J0(v,p,a.direction):0;return Me(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),m("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${p}% + ${_}px)`},children:[m(lo.ItemSlot,{scope:i.__scopeSlider,children:m(Hi.span,{role:"slider","aria-label":i["aria-label"]||y,"aria-valuemin":o.min,"aria-valuenow":g,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...n,ref:h,style:g===void 0?{display:"none"}:i.style,onFocus:zs(i.onFocus,()=>{o.valueIndexToChangeRef.current=s})})}),u&&m(Eu,{name:r!=null?r:o.name?o.name+(o.values.length>1?"[]":""):void 0,form:o.form,value:g},s)]})});Ou.displayName=ho;var Y0="RadioBubbleInput",Eu=Te(({__scopeSlider:i,value:e,...t},s)=>{const r=we(null),n=hs(r,s),o=A0(e);return Me(()=>{const a=r.current;if(!a)return;const l=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==e&&h){const u=new Event("input",{bubbles:!0});h.call(a,e),a.dispatchEvent(u)}},[o,e]),m(Hi.input,{style:{display:"none"},...t,ref:n,defaultValue:e})});Eu.displayName=Y0;function G0(i=[],e,t){const s=[...i];return s[t]=e,s.sort((r,n)=>r-n)}function Mu(i,e,t){const n=100/(t-e)*(i-e);return du(n,[0,100])}function q0(i,e){return e>2?`Value ${i+1} of ${e}`:e===2?["Minimum","Maximum"][i]:void 0}function K0(i,e){if(i.length===1)return 0;const t=i.map(r=>Math.abs(r-e)),s=Math.min(...t);return t.indexOf(s)}function J0(i,e,t){const s=i/2,n=ta([0,50],[0,s]);return(s-n(e)*t)*t}function Z0(i){return i.slice(0,-1).map((e,t)=>i[t+1]-e)}function Q0(i,e){if(e>0){const t=Z0(i);return Math.min(...t)>=e}return!0}function ta(i,e){return t=>{if(i[0]===i[1]||e[0]===e[1])return e[0];const s=(e[1]-e[0])/(i[1]-i[0]);return e[0]+s*(t-i[0])}}function eb(i){return(String(i).split(".")[1]||"").length}function tb(i,e){const t=Math.pow(10,e);return Math.round(i*t)/t}var Du=_u,sb=ku,ib=Tu,rb=Ou;const Pu=Te(({className:i,...e},t)=>m(Du,{ref:t,className:`relative flex w-full touch-none select-none items-center ${i||""}`,...e,children:[m(sb,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-zinc-800",children:m(ib,{className:"absolute h-full bg-blue-500"})}),m(rb,{className:"block h-5 w-5 rounded-full border-2 border-blue-500 bg-zinc-900 ring-offset-zinc-950 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Pu.displayName=Du.displayName;function nb(){var c,h;const{clips:i,selectedClipId:e,updateClip:t}=qe(),s=i.find(u=>u.id===e);if(!s)return m("div",{className:"bg-zinc-900 border-t border-zinc-800 p-4",children:m("div",{className:"text-sm text-zinc-500 text-center",children:"Select a clip to adjust audio settings"})});const r=(c=s.volume)!=null?c:1,n=(h=s.muted)!=null?h:!1,o=u=>{const d=u[0];t(s.id,{volume:d})},a=()=>{t(s.id,{muted:!n})},l=Math.round(r*100);return m("div",{className:"bg-zinc-900 border-t border-zinc-800 p-4",children:m("div",{className:"max-w-2xl mx-auto space-y-4",children:[m("div",{className:"flex items-center justify-between",children:[m("h3",{className:"text-sm font-medium text-zinc-300",children:"Audio Controls"}),m("div",{className:"text-xs text-zinc-500",children:s.name})]}),m("div",{className:"space-y-2",children:[m("div",{className:"flex items-center justify-between",children:[m("label",{className:"text-sm text-zinc-400",children:"Volume"}),m("div",{className:"flex items-center gap-2",children:[m("span",{className:"text-sm text-zinc-400 font-mono w-12 text-right",children:n?"Muted":`${l}%`}),m("button",{onClick:a,className:`p-2 rounded-md transition-colors ${n?"bg-red-500/20 text-red-400 hover:bg-red-500/30":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700 hover:text-white"}`,title:n?"Unmute":"Mute",children:n?m(Fa,{className:"h-4 w-4"}):m(Zg,{className:"h-4 w-4"})})]})]}),m(Pu,{value:[r],onValueChange:o,min:0,max:1,step:.01,disabled:n,className:n?"opacity-50":""})]}),m("div",{className:"space-y-2",children:[m("label",{className:"text-sm text-zinc-400",children:"Waveform"}),m("div",{className:"h-16 bg-zinc-800 rounded-md border border-zinc-700 flex items-center justify-center overflow-hidden relative",children:[m("div",{className:"absolute inset-0 flex items-center justify-around px-1",children:Array.from({length:60}).map((u,d)=>{const g=s.id.charCodeAt(d%s.id.length)*(d+1),p=(Math.sin(g)*.5+.5)*80+10,y=n?.3:.7;return m("div",{className:"bg-blue-500 w-0.5 rounded-full transition-opacity",style:{height:`${p}%`,opacity:y}},d)})}),n&&m("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:m(Fa,{className:"h-8 w-8 text-red-400"})})]})]}),m("div",{className:"flex items-center justify-between text-xs text-zinc-500 pt-2 border-t border-zinc-800",children:[m("div",{children:["Duration: ",s.duration.toFixed(2),"s"]}),s.bit_rate&&m("div",{children:["Bit Rate: ",(s.bit_rate/1e3).toFixed(0)," kbps"]})]})]})})}function ob(){const{error:i,setError:e,hydrateFromWorkspace:t,isHydrated:s,isPlaying:r,setIsPlaying:n,selectedClipId:o,setSelectedClip:a,deleteClip:l,clips:c,copyClip:h,pasteClip:u}=qe();return Me(()=>{(async()=>{await t();try{const g=await Ie("check_ffmpeg");console.log("FFmpeg version:",g)}catch(g){e("FFmpeg not found. Please install FFmpeg to use ClipForge."),console.error("FFmpeg check failed:",g)}})()},[e,t]),Me(()=>{const d=g=>{const p=g.target;if(!(p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.isContentEditable))switch(g.key){case" ":g.preventDefault(),n(!r);break;case"Delete":case"Backspace":g.preventDefault(),o&&l(o);break;case"Escape":g.preventDefault(),a(null);break;case"a":case"A":(g.metaKey||g.ctrlKey)&&(g.preventDefault(),c.length>0&&a(c[0].id));break;case"c":case"C":(g.metaKey||g.ctrlKey)&&(g.preventDefault(),o&&h(o));break;case"v":case"V":(g.metaKey||g.ctrlKey)&&(g.preventDefault(),u());break}};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[r,n,o,a,l,c,h,u]),Me(()=>{const d=async()=>await yc("ffmpeg-warning",y=>{console.error("FFmpeg Warning:",y.payload),e(y.payload)});let g=null;return d().then(p=>{g=p}),()=>{g&&g()}},[e]),s?m("div",{className:"min-h-screen flex flex-col bg-black text-white p-8",children:m("div",{className:"flex flex-col h-full bg-zinc-900 rounded-lg overflow-hidden shadow-2xl border border-zinc-800",children:[m(Of,{}),i&&m(Oo,{variant:"destructive",className:"mx-6 mt-4",children:[m(ng,{className:"h-4 w-4"}),m(Eo,{children:i})]}),m("div",{className:"flex flex-1 min-h-0 overflow-hidden",children:[m(S0,{}),m("div",{className:"flex flex-1 flex-col min-h-0",children:[m("div",{className:"flex-1 flex items-center justify-center p-8 bg-zinc-800 rounded-lg mx-6 mt-4 mb-4",children:m(x0,{})}),m(C0,{})]})]}),m("div",{className:"w-full border-t border-zinc-700",children:m(my,{})}),m(nb,{})]})}):m("div",{className:"min-h-screen flex items-center justify-center bg-black text-white",children:m("div",{className:"text-center",children:[m("div",{className:"mb-4 text-lg text-zinc-300",children:"Loading workspace..."}),m("div",{className:"text-sm text-zinc-500",children:"Validating saved clips and settings"})]})})}Hs(m(ob,{}),document.getElementById("root"));
